[
  {
    "id": 106324789,
    "slug": "utlhxzug7pwdacov",
    "title": "Vite vs Webpack vs esbuild",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "--- <br /> title: Vite vs Webpack vs esbuild <br />categories:  前端工程化<br />tags:  [Vite,Webpack,Esbuild]<br />---\n<a name=\"y4CgD\"></a>\n# Vite和Webpack之对比\n开发阶段：Vite的速度远快于Webpack<br />主要原因：**Webpack是先打包再启动开发服务器，Vite是直接启动开发服务器，然后按需编译依赖文件。**<br />详细过程：\n\n1. webpack先打包，再启动开发服务器，请求服务器时直接给予打包后的结果；\n2. Vite直接启动开发服务器，请求哪个模块再对哪个模块进行实时编译；\n3. 由于现代浏览器本身就支持ES Modules，会主动发起请求去获取所需文件。Vite充分利用这一点，将开发环境下的模块文件，作为浏览器要执行的文件，而不是像webpack先打包，交给浏览器执行的文件是打包后的；\n4. 由于Vite启动时无需打包，也就无需分析模块依赖、编译，所以启动速度非常快。当浏览器请求需要的模块时，再对模块进行编译，这种按需动态编译的模式，极大地缩短了编译时间，当项目越大，文件越多，Vite的开发时优势越明显；\n5. 在HRM方面，当某个模块内容改变时，让浏览器去重新请求该模块即可，而不是像webpack重新将该模块的所有依赖重新编译；\n6. 当需要打包到生产环境时，Vite使用传统的rollup进行打包，所以，vite的优势体现在开发阶段，另外，由于vite使用的是ES Module，所以代码中不可以使用CommonJS。\n<a name=\"tm0Ny\"></a>\n# Vite为什么“快”？\n<a name=\"sr4SV\"></a>\n## 问题现状\n<a name=\"gMsh3\"></a>\n### 1. ES模块化支持的问题\n\n- 以前的浏览器不支持ES Module\n```javascript\n// index.js\n\nimport { add } from './add.js'\nimport { sub } from './sub.js'\nconsole.log(add(1, 2))\nconsole.log(sub(1, 2))\n\n// add.js\nexport const add = (a, b) => a + b \n\n// sub.js\nexport const sub = (a, b) => a - b \n```\n这样的一段代码放在浏览器不能直接运行。<br />解决方案：可以使用打包工具（如Webpack、Rollup、Parcel），将index.js、add.js、sub.js这三个文件打包在一个bundle.js文件中，然后在项目`index.html`中直接引入`bundle.js`，从而达到代码效果。\n<a name=\"mckwu\"></a>\n### 2. 项目启动与代码更新的问题\n\n- 项目启动：随着项目越来越大，启动一个项目可能需要几分钟\n- 代码更新：随着项目越来越大，修改一小段代码，保存后都要等待几秒才更新\n<a name=\"ln7Uw\"></a>\n## 解决问题\n<a name=\"CcHh3\"></a>\n### 1. 解决启动项目缓慢\nVite 在打包时，将模块分成两个区域`依赖`和`源码`：\n\n- 依赖：一般是那种在开发中不会改变的JS，比如组件库，或者一些较大的依赖（可能有上百个模块的库），这一部分使用esbuild来进行预构建依赖，esbuild使用的是Go进行编写，比JS编写的打包器预构建依赖快10-100倍。\n- 源码：一般是那种修改几率比较大的文件，例如JSX、CSS、Vue这些需要转换且时常会被修改编辑的文件。同时这些文件不是一下子全部加载，而是可以按需加载（例如路由懒加载）。Vite会将文件转换后，以`ES Module`的方式直接交给浏览器，因为现在的浏览器大多数都直接支持es module，这使性能提高很多。\n\n原因如下图：<br />第一张图，是以前的打包模式，<br />![1668601120853_43F96D26-9591-4a51-926F-A76249646CD6.png](https://cdn.nlark.com/yuque/0/2022/png/2324645/1668606127115-567c8a0b-dc4a-4546-bc92-3cd841e9ad03.png#averageHue=%232f3741&clientId=u0058c815-b7e9-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=408&id=uf56b9e97&margin=%5Bobject%20Object%5D&name=1668601120853_43F96D26-9591-4a51-926F-A76249646CD6.png&originHeight=408&originWidth=732&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55374&status=done&style=none&taskId=ubb96c9f1-fe8c-4837-83ee-2e3d29343fb&title=&width=732)\n",
    "body_draft": "--- <br /> title: Vite vs Webpack vs esbuild <br />categories:  前端工程化<br />tags:  [Vite,Webpack,Esbuild]<br />---\n<a name=\"y4CgD\"></a>\n# Vite和Webpack之对比\n开发阶段：Vite的速度远快于Webpack<br />主要原因：**Webpack是先打包再启动开发服务器，Vite是直接启动开发服务器，然后按需编译依赖文件。**<br />详细过程：\n\n1. webpack先打包，再启动开发服务器，请求服务器时直接给予打包后的结果；\n2. Vite直接启动开发服务器，请求哪个模块再对哪个模块进行实时编译；\n3. 由于现代浏览器本身就支持ES Modules，会主动发起请求去获取所需文件。Vite充分利用这一点，将开发环境下的模块文件，作为浏览器要执行的文件，而不是像webpack先打包，交给浏览器执行的文件是打包后的；\n4. 由于Vite启动时无需打包，也就无需分析模块依赖、编译，所以启动速度非常快。当浏览器请求需要的模块时，再对模块进行编译，这种按需动态编译的模式，极大地缩短了编译时间，当项目越大，文件越多，Vite的开发时优势越明显；\n5. 在HRM方面，当某个模块内容改变时，让浏览器去重新请求该模块即可，而不是像webpack重新将该模块的所有依赖重新编译；\n6. 当需要打包到生产环境时，Vite使用传统的rollup进行打包，所以，vite的优势体现在开发阶段，另外，由于vite使用的是ES Module，所以代码中不可以使用CommonJS。\n<a name=\"tm0Ny\"></a>\n# Vite为什么“快”？\n<a name=\"sr4SV\"></a>\n## 问题现状\n<a name=\"gMsh3\"></a>\n### 1. ES模块化支持的问题\n\n- 以前的浏览器不支持ES Module\n```javascript\n// index.js\n\nimport { add } from './add.js'\nimport { sub } from './sub.js'\nconsole.log(add(1, 2))\nconsole.log(sub(1, 2))\n\n// add.js\nexport const add = (a, b) => a + b \n\n// sub.js\nexport const sub = (a, b) => a - b \n```\n这样的一段代码放在浏览器不能直接运行。<br />解决方案：可以使用打包工具（如Webpack、Rollup、Parcel），将index.js、add.js、sub.js这三个文件打包在一个bundle.js文件中，然后在项目`index.html`中直接引入`bundle.js`，从而达到代码效果。\n<a name=\"mckwu\"></a>\n### 2. 项目启动与代码更新的问题\n\n- 项目启动：随着项目越来越大，启动一个项目可能需要几分钟\n- 代码更新：随着项目越来越大，修改一小段代码，保存后都要等待几秒才更新\n<a name=\"ln7Uw\"></a>\n## 解决问题\n<a name=\"CcHh3\"></a>\n### 1. 解决启动项目缓慢\nVite 在打包时，将模块分成两个区域`依赖`和`源码`：\n\n- 依赖：一般是那种在开发中不会改变的JS，比如组件库，或者一些较大的依赖（可能有上百个模块的库），这一部分使用esbuild来进行预构建依赖，esbuild使用的是Go进行编写，比JS编写的打包器预构建依赖快10-100倍。\n- 源码：一般是那种修改几率比较大的文件，例如JSX、CSS、Vue这些需要转换且时常会被修改编辑的文件。同时这些文件不是一下子全部加载，而是可以按需加载（例如路由懒加载）。Vite会将文件转换后，以`ES Module`的方式直接交给浏览器，因为现在的浏览器大多数都直接支持es module，这使性能提高很多。\n\n原因如下图：<br />第一张图，是以前的打包模式，<br />![1668601120853_43F96D26-9591-4a51-926F-A76249646CD6.png](https://cdn.nlark.com/yuque/0/2022/png/2324645/1668606127115-567c8a0b-dc4a-4546-bc92-3cd841e9ad03.png#averageHue=%232f3741&clientId=u0058c815-b7e9-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=408&id=uf56b9e97&margin=%5Bobject%20Object%5D&name=1668601120853_43F96D26-9591-4a51-926F-A76249646CD6.png&originHeight=408&originWidth=732&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55374&status=done&style=none&taskId=ubb96c9f1-fe8c-4837-83ee-2e3d29343fb&title=&width=732)\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"ue6b0aec1\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><p id=\"u28df9ae7\" class=\"ne-p\"><span class=\"ne-text\"> title: Vite vs Webpack vs esbuild </span></p><p id=\"u6da62028\" class=\"ne-p\"><span class=\"ne-text\">categories:  前端工程化</span></p><p id=\"u05972217\" class=\"ne-p\"><span class=\"ne-text\">tags:  [Vite,Webpack,Esbuild]</span></p><p id=\"ud767d639\" class=\"ne-p\"><span class=\"ne-text\">---</span></p><h1 id=\"y4CgD\"><span class=\"ne-text\">Vite和Webpack之对比</span></h1><p id=\"ue033c6fb\" class=\"ne-p\"><span class=\"ne-text\">开发阶段：Vite的速度远快于Webpack</span></p><p id=\"u8a1e5fd1\" class=\"ne-p\"><span class=\"ne-text\">主要原因：</span><strong><span class=\"ne-text\">Webpack是先打包再启动开发服务器，Vite是直接启动开发服务器，然后按需编译依赖文件。</span></strong></p><p id=\"u8e98e4b8\" class=\"ne-p\"><span class=\"ne-text\">详细过程：</span></p><ol class=\"ne-ol\"><li id=\"uc44f5e68\"><span class=\"ne-text\">webpack先打包，再启动开发服务器，请求服务器时直接给予打包后的结果；</span></li><li id=\"u6338faad\"><span class=\"ne-text\">Vite</span><span class=\"ne-text\" style=\"text-decoration: underline\">直接启动</span><span class=\"ne-text\">开发服务器，请求哪个模块再对哪个模块进行实时编译；</span></li><li id=\"ud84f0255\"><span class=\"ne-text\">由于现代浏览器本身就支持ES Modules，会主动发起请求去获取所需文件。Vite充分利用这一点，将开发环境下的模块文件，作为浏览器要执行的文件，而不是像webpack先打包，交给浏览器执行的文件是打包后的；</span></li><li id=\"u2fcdc6e1\"><span class=\"ne-text\">由于Vite启动时无需打包，也就无需分析模块依赖、编译，所以启动速度非常快。当浏览器请求需要的模块时，再对模块进行编译，这种按需动态编译的模式，极大地缩短了编译时间，当项目越大，文件越多，Vite的开发时优势越明显；</span></li><li id=\"u330c8674\"><span class=\"ne-text\">在HRM方面，当某个模块内容改变时，让浏览器去重新请求该模块即可，而不是像webpack重新将该模块的所有依赖重新编译；</span></li><li id=\"u7bb9a5dd\"><span class=\"ne-text\">当需要打包到生产环境时，Vite使用传统的rollup进行打包，所以，vite的优势体现在开发阶段，另外，由于vite使用的是ES Module，所以代码中不可以使用CommonJS。</span></li></ol><h1 id=\"tm0Ny\"><span class=\"ne-text\">Vite为什么“快”？</span></h1><h2 id=\"sr4SV\"><span class=\"ne-text\">问题现状</span></h2><h3 id=\"gMsh3\"><span class=\"ne-text\">1. ES模块化支持的问题</span></h3><ul class=\"ne-ul\"><li id=\"uf39daca7\"><span class=\"ne-text\">以前的浏览器不支持ES Module</span></li></ul><pre data-language=\"javascript\" id=\"AIy1s\" class=\"ne-codeblock language-javascript\">// index.js\n\nimport { add } from './add.js'\nimport { sub } from './sub.js'\nconsole.log(add(1, 2))\nconsole.log(sub(1, 2))\n\n// add.js\nexport const add = (a, b) =&gt; a + b \n\n// sub.js\nexport const sub = (a, b) =&gt; a - b </pre><p id=\"u6c59d56f\" class=\"ne-p\"><span class=\"ne-text\">这样的一段代码放在浏览器不能直接运行。</span></p><p id=\"u6afa13aa\" class=\"ne-p\"><span class=\"ne-text\">解决方案：可以使用打包工具（如Webpack、Rollup、Parcel），将index.js、add.js、sub.js这三个文件打包在一个bundle.js文件中，然后在项目</span><code class=\"ne-code\"><span class=\"ne-text\">index.html</span></code><span class=\"ne-text\">中直接引入</span><code class=\"ne-code\"><span class=\"ne-text\">bundle.js</span></code><span class=\"ne-text\">，从而达到代码效果。</span></p><h3 id=\"mckwu\"><span class=\"ne-text\">2. 项目启动与代码更新的问题</span></h3><ul class=\"ne-ul\"><li id=\"ufdfd326e\"><span class=\"ne-text\">项目启动：随着项目越来越大，启动一个项目可能需要几分钟</span></li><li id=\"u9719d827\"><span class=\"ne-text\">代码更新：随着项目越来越大，修改一小段代码，保存后都要等待几秒才更新</span></li></ul><h2 id=\"ln7Uw\"><span class=\"ne-text\">解决问题</span></h2><h3 id=\"CcHh3\"><span class=\"ne-text\">1. 解决启动项目缓慢</span></h3><p id=\"u884a7c28\" class=\"ne-p\"><span class=\"ne-text\">Vite 在打包时，将模块分成两个区域</span><code class=\"ne-code\"><span class=\"ne-text\">依赖</span></code><span class=\"ne-text\">和</span><code class=\"ne-code\"><span class=\"ne-text\">源码</span></code><span class=\"ne-text\">：</span></p><ul class=\"ne-ul\"><li id=\"u32c3fd45\"><span class=\"ne-text\">依赖：一般是那种在开发中不会改变的JS，比如组件库，或者一些较大的依赖（可能有上百个模块的库），这一部分使用esbuild来进行预构建依赖，esbuild使用的是Go进行编写，比JS编写的打包器预构建依赖快10-100倍。</span></li><li id=\"u48a7e8a9\"><span class=\"ne-text\">源码：一般是那种修改几率比较大的文件，例如JSX、CSS、Vue这些需要转换且时常会被修改编辑的文件。同时这些文件不是一下子全部加载，而是可以按需加载（例如路由懒加载）。Vite会将文件转换后，以</span><code class=\"ne-code\"><span class=\"ne-text\">ES Module</span></code><span class=\"ne-text\">的方式直接交给浏览器，因为现在的浏览器大多数都直接支持es module，这使性能提高很多。</span></li></ul><p id=\"ued4a1e1e\" class=\"ne-p\" style=\"text-indent: 2em\"><span class=\"ne-text\">原因如下图：</span></p><p id=\"ud5cc1a09\" class=\"ne-p\" style=\"text-indent: 2em\"><span class=\"ne-text\">第一张图，是以前的打包模式，<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2022/png/2324645/1668606127115-567c8a0b-dc4a-4546-bc92-3cd841e9ad03.png\" width=\"732\" id=\"uf56b9e97\" class=\"ne-image\"></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><meta name=\"paragraphSpacing\" content=\"relax\" /><p data-lake-id=\"ue6b0aec1\" id=\"ue6b0aec1\"><span data-lake-id=\"ubae4c690\" id=\"ubae4c690\">--- </span></p><p data-lake-id=\"u28df9ae7\" id=\"u28df9ae7\"><span data-lake-id=\"u160f1639\" id=\"u160f1639\"> title: Vite vs Webpack vs esbuild </span></p><p data-lake-id=\"u6da62028\" id=\"u6da62028\"><span data-lake-id=\"ua6aa27bd\" id=\"ua6aa27bd\">categories:  前端工程化</span></p><p data-lake-id=\"u05972217\" id=\"u05972217\"><span data-lake-id=\"u2aa627f1\" id=\"u2aa627f1\">tags:  [Vite,Webpack,Esbuild]</span></p><p data-lake-id=\"ud767d639\" id=\"ud767d639\"><span data-lake-id=\"uabc94e55\" id=\"uabc94e55\">---</span></p><h1 data-lake-id=\"y4CgD\" id=\"y4CgD\"><span data-lake-id=\"udf3f6b9b\" id=\"udf3f6b9b\">Vite和Webpack之对比</span></h1><p data-lake-id=\"ue033c6fb\" id=\"ue033c6fb\"><span data-lake-id=\"u459cd5f6\" id=\"u459cd5f6\">开发阶段：Vite的速度远快于Webpack</span></p><p data-lake-id=\"u8a1e5fd1\" id=\"u8a1e5fd1\"><span data-lake-id=\"ud7315736\" id=\"ud7315736\">主要原因：</span><strong><span data-lake-id=\"u3e08fdd6\" id=\"u3e08fdd6\">Webpack是先打包再启动开发服务器，Vite是直接启动开发服务器，然后按需编译依赖文件。</span></strong></p><p data-lake-id=\"u8e98e4b8\" id=\"u8e98e4b8\"><span data-lake-id=\"u7bfd0d20\" id=\"u7bfd0d20\">详细过程：</span></p><ol list=\"ua60b9211\"><li fid=\"u5447339c\" data-lake-id=\"uc44f5e68\" id=\"uc44f5e68\"><span data-lake-id=\"u59b9c9ff\" id=\"u59b9c9ff\">webpack先打包，再启动开发服务器，请求服务器时直接给予打包后的结果；</span></li><li fid=\"u5447339c\" data-lake-id=\"u6338faad\" id=\"u6338faad\"><span data-lake-id=\"ub217565c\" id=\"ub217565c\">Vite</span><u><span data-lake-id=\"ua5b844bc\" id=\"ua5b844bc\">直接启动</span></u><span data-lake-id=\"ue0e28728\" id=\"ue0e28728\">开发服务器，请求哪个模块再对哪个模块进行实时编译；</span></li><li fid=\"u5447339c\" data-lake-id=\"ud84f0255\" id=\"ud84f0255\"><span data-lake-id=\"ue952eba9\" id=\"ue952eba9\">由于现代浏览器本身就支持ES Modules，会主动发起请求去获取所需文件。Vite充分利用这一点，将开发环境下的模块文件，作为浏览器要执行的文件，而不是像webpack先打包，交给浏览器执行的文件是打包后的；</span></li><li fid=\"u5447339c\" data-lake-id=\"u2fcdc6e1\" id=\"u2fcdc6e1\"><span data-lake-id=\"ub2181575\" id=\"ub2181575\">由于Vite启动时无需打包，也就无需分析模块依赖、编译，所以启动速度非常快。当浏览器请求需要的模块时，再对模块进行编译，这种按需动态编译的模式，极大地缩短了编译时间，当项目越大，文件越多，Vite的开发时优势越明显；</span></li><li fid=\"u5447339c\" data-lake-id=\"u330c8674\" id=\"u330c8674\"><span data-lake-id=\"u6a3acedb\" id=\"u6a3acedb\">在HRM方面，当某个模块内容改变时，让浏览器去重新请求该模块即可，而不是像webpack重新将该模块的所有依赖重新编译；</span></li><li fid=\"u5447339c\" data-lake-id=\"u7bb9a5dd\" id=\"u7bb9a5dd\"><span data-lake-id=\"u1b2dfbb2\" id=\"u1b2dfbb2\">当需要打包到生产环境时，Vite使用传统的rollup进行打包，所以，vite的优势体现在开发阶段，另外，由于vite使用的是ES Module，所以代码中不可以使用CommonJS。</span></li></ol><h1 data-lake-id=\"tm0Ny\" id=\"tm0Ny\"><span data-lake-id=\"u92042b66\" id=\"u92042b66\">Vite为什么“快”？</span></h1><h2 data-lake-id=\"sr4SV\" id=\"sr4SV\"><span data-lake-id=\"ub93b37cc\" id=\"ub93b37cc\">问题现状</span></h2><h3 data-lake-id=\"gMsh3\" id=\"gMsh3\"><span data-lake-id=\"uf1743cbb\" id=\"uf1743cbb\">1. ES模块化支持的问题</span></h3><ul list=\"ue9bc1abf\"><li fid=\"u081db92c\" data-lake-id=\"uf39daca7\" id=\"uf39daca7\"><span data-lake-id=\"ufdace296\" id=\"ufdace296\">以前的浏览器不支持ES Module</span></li></ul><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22%2F%2F%20index.js%5Cn%5Cnimport%20%7B%20add%20%7D%20from%20'.%2Fadd.js'%5Cnimport%20%7B%20sub%20%7D%20from%20'.%2Fsub.js'%5Cnconsole.log(add(1%2C%202))%5Cnconsole.log(sub(1%2C%202))%5Cn%5Cn%2F%2F%20add.js%5Cnexport%20const%20add%20%3D%20(a%2C%20b)%20%3D%3E%20a%20%2B%20b%20%5Cn%5Cn%2F%2F%20sub.js%5Cnexport%20const%20sub%20%3D%20(a%2C%20b)%20%3D%3E%20a%20-%20b%20%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22AIy1s%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u6c59d56f\" id=\"u6c59d56f\"><span data-lake-id=\"u1ce801b1\" id=\"u1ce801b1\">这样的一段代码放在浏览器不能直接运行。</span></p><p data-lake-id=\"u6afa13aa\" id=\"u6afa13aa\"><span data-lake-id=\"u08443c0c\" id=\"u08443c0c\">解决方案：可以使用打包工具（如Webpack、Rollup、Parcel），将index.js、add.js、sub.js这三个文件打包在一个bundle.js文件中，然后在项目</span><code data-lake-id=\"u78d9e820\" id=\"u78d9e820\"><span data-lake-id=\"u136ef741\" id=\"u136ef741\">index.html</span></code><span data-lake-id=\"udac90f71\" id=\"udac90f71\">中直接引入</span><code data-lake-id=\"u71c62b13\" id=\"u71c62b13\"><span data-lake-id=\"u2481fbd9\" id=\"u2481fbd9\">bundle.js</span></code><span data-lake-id=\"ube7a43ca\" id=\"ube7a43ca\">，从而达到代码效果。</span></p><h3 data-lake-id=\"mckwu\" id=\"mckwu\"><span data-lake-id=\"u87ec3723\" id=\"u87ec3723\">2. 项目启动与代码更新的问题</span></h3><ul list=\"uc86fc130\"><li fid=\"u8b58ca58\" data-lake-id=\"ufdfd326e\" id=\"ufdfd326e\"><span data-lake-id=\"udc4ac870\" id=\"udc4ac870\">项目启动：随着项目越来越大，启动一个项目可能需要几分钟</span></li><li fid=\"u8b58ca58\" data-lake-id=\"u9719d827\" id=\"u9719d827\"><span data-lake-id=\"ub554c061\" id=\"ub554c061\">代码更新：随着项目越来越大，修改一小段代码，保存后都要等待几秒才更新</span></li></ul><h2 data-lake-id=\"ln7Uw\" id=\"ln7Uw\"><span data-lake-id=\"ub62b4118\" id=\"ub62b4118\">解决问题</span></h2><h3 data-lake-id=\"CcHh3\" id=\"CcHh3\"><span data-lake-id=\"uf743b45c\" id=\"uf743b45c\">1. 解决启动项目缓慢</span></h3><p data-lake-id=\"u884a7c28\" id=\"u884a7c28\"><span data-lake-id=\"u80578576\" id=\"u80578576\">Vite 在打包时，将模块分成两个区域</span><code data-lake-id=\"u79a4590e\" id=\"u79a4590e\"><span data-lake-id=\"u68421621\" id=\"u68421621\">依赖</span></code><span data-lake-id=\"u72556430\" id=\"u72556430\">和</span><code data-lake-id=\"ud94b13ce\" id=\"ud94b13ce\"><span data-lake-id=\"u2ebeddfe\" id=\"u2ebeddfe\">源码</span></code><span data-lake-id=\"u2792c224\" id=\"u2792c224\">：</span></p><ul list=\"u89870c3b\"><li fid=\"ue7baaab1\" data-lake-id=\"u32c3fd45\" id=\"u32c3fd45\"><span data-lake-id=\"u139d0a8c\" id=\"u139d0a8c\">依赖：一般是那种在开发中不会改变的JS，比如组件库，或者一些较大的依赖（可能有上百个模块的库），这一部分使用esbuild来进行预构建依赖，esbuild使用的是Go进行编写，比JS编写的打包器预构建依赖快10-100倍。</span></li><li fid=\"ue7baaab1\" data-lake-id=\"u48a7e8a9\" id=\"u48a7e8a9\"><span data-lake-id=\"u2c326276\" id=\"u2c326276\">源码：一般是那种修改几率比较大的文件，例如JSX、CSS、Vue这些需要转换且时常会被修改编辑的文件。同时这些文件不是一下子全部加载，而是可以按需加载（例如路由懒加载）。Vite会将文件转换后，以</span><code data-lake-id=\"u7c557e8c\" id=\"u7c557e8c\"><span data-lake-id=\"u0af69d6c\" id=\"u0af69d6c\">ES Module</span></code><span data-lake-id=\"ue8db98f1\" id=\"ue8db98f1\">的方式直接交给浏览器，因为现在的浏览器大多数都直接支持es module，这使性能提高很多。</span></li></ul><p data-lake-id=\"ued4a1e1e\" id=\"ued4a1e1e\" style=\"text-indent: 2em\"><span data-lake-id=\"uf5743435\" id=\"uf5743435\">原因如下图：</span></p><p data-lake-id=\"ud5cc1a09\" id=\"ud5cc1a09\" style=\"text-indent: 2em\"><span data-lake-id=\"u8153ef23\" id=\"u8153ef23\">第一张图，是以前的打包模式，<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F2324645%2F1668606127115-567c8a0b-dc4a-4546-bc92-3cd841e9ad03.png%22%2C%22taskId%22%3A%22ubb96c9f1-fe8c-4837-83ee-2e3d29343fb%22%2C%22clientId%22%3A%22u0058c815-b7e9-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A732%2C%22height%22%3A408%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%221668601120853_43F96D26-9591-4a51-926F-A76249646CD6.png%22%2C%22size%22%3A55374%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A732%2C%22originHeight%22%3A408%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22BUNDLE%20BASED%20DEV%20S%20SERVER%20MODULE%20MODUIE%20ROUTE%20SERVER%20BUNDLE%20ENTRY%20MODULE%20ROUTE%20READY%20MODULE%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A40.043438%2C%22y%22%3A27.115393%2C%22width%22%3A222.61113199999997%2C%22height%22%3A27.842522999999996%2C%22text%22%3A%22BUNDLE%20BASED%20DEV%20S%22%7D%2C%7B%22x%22%3A256.08603%2C%22y%22%3A34.18884%2C%22width%22%3A81.30376999999999%2C%22height%22%3A17.902503000000003%2C%22text%22%3A%22SERVER%22%7D%2C%7B%22x%22%3A332.149%2C%22y%22%3A110.04819%2C%22width%22%3A43.741780000000006%2C%22height%22%3A10.61632999999999%2C%22text%22%3A%22MODULE%22%7D%2C%7B%22x%22%3A331.86703%2C%22y%22%3A163.93964%2C%22width%22%3A43.777499999999975%2C%22height%22%3A10.058880000000016%2C%22text%22%3A%22MODUIE%22%7D%2C%7B%22x%22%3A212.50966%2C%22y%22%3A164.5023%2C%22width%22%3A36.2946%2C%22height%22%3A9.533240000000006%2C%22text%22%3A%22ROUTE%22%7D%2C%7B%22x%22%3A608.9008%2C%22y%22%3A201.63786%2C%22width%22%3A55.26296000000002%2C%22height%22%3A14.507280000000009%2C%22text%22%3A%22SERVER%22%7D%2C%7B%22x%22%3A481.5142%2C%22y%22%3A210.15442%2C%22width%22%3A55.45906999999994%2C%22height%22%3A14.753740000000022%2C%22text%22%3A%22BUNDLE%22%7D%2C%7B%22x%22%3A81.045616%2C%22y%22%3A213.32765%2C%22width%22%3A35.61722400000001%2C%22height%22%3A10.447309999999987%2C%22text%22%3A%22ENTRY%22%7D%2C%7B%22x%22%3A331.86368%2C%22y%22%3A212.61821%2C%22width%22%3A44.31218999999999%2C%22height%22%3A10.803470000000004%2C%22text%22%3A%22MODULE%22%7D%2C%7B%22x%22%3A213.05891%2C%22y%22%3A213.87514%2C%22width%22%3A35.57578000000001%2C%22height%22%3A9.614830000000012%2C%22text%22%3A%22ROUTE%22%7D%2C%7B%22x%22%3A615.14264%2C%22y%22%3A220.83333%2C%22width%22%3A44.32395999999994%2C%22height%22%3A13.2269%2C%22text%22%3A%22READY%22%7D%2C%7B%22x%22%3A332.05167%2C%22y%22%3A262.25995%2C%22width%22%3A44.089290000000005%2C%22height%22%3A10.405610000000024%2C%22text%22%3A%22MODULE%22%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3741%22%2C%22id%22%3A%22uf56b9e97%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><meta name=\"paragraphSpacing\" content=\"relax\" /><p data-lake-id=\"ue6b0aec1\" id=\"ue6b0aec1\"><span data-lake-id=\"ubae4c690\" id=\"ubae4c690\">--- </span></p><p data-lake-id=\"u28df9ae7\" id=\"u28df9ae7\"><span data-lake-id=\"u160f1639\" id=\"u160f1639\"> title: Vite vs Webpack vs esbuild </span></p><p data-lake-id=\"u6da62028\" id=\"u6da62028\"><span data-lake-id=\"ua6aa27bd\" id=\"ua6aa27bd\">categories:  前端工程化</span></p><p data-lake-id=\"u05972217\" id=\"u05972217\"><span data-lake-id=\"u2aa627f1\" id=\"u2aa627f1\">tags:  [Vite,Webpack,Esbuild]</span></p><p data-lake-id=\"ud767d639\" id=\"ud767d639\"><span data-lake-id=\"uabc94e55\" id=\"uabc94e55\">---</span></p><h1 data-lake-id=\"y4CgD\" id=\"y4CgD\"><span data-lake-id=\"udf3f6b9b\" id=\"udf3f6b9b\">Vite和Webpack之对比</span></h1><p data-lake-id=\"ue033c6fb\" id=\"ue033c6fb\"><span data-lake-id=\"u459cd5f6\" id=\"u459cd5f6\">开发阶段：Vite的速度远快于Webpack</span></p><p data-lake-id=\"u8a1e5fd1\" id=\"u8a1e5fd1\"><span data-lake-id=\"ud7315736\" id=\"ud7315736\">主要原因：</span><strong><span data-lake-id=\"u3e08fdd6\" id=\"u3e08fdd6\">Webpack是先打包再启动开发服务器，Vite是直接启动开发服务器，然后按需编译依赖文件。</span></strong></p><p data-lake-id=\"u8e98e4b8\" id=\"u8e98e4b8\"><span data-lake-id=\"u7bfd0d20\" id=\"u7bfd0d20\">详细过程：</span></p><ol list=\"ua60b9211\"><li fid=\"u5447339c\" data-lake-id=\"uc44f5e68\" id=\"uc44f5e68\"><span data-lake-id=\"u59b9c9ff\" id=\"u59b9c9ff\">webpack先打包，再启动开发服务器，请求服务器时直接给予打包后的结果；</span></li><li fid=\"u5447339c\" data-lake-id=\"u6338faad\" id=\"u6338faad\"><span data-lake-id=\"ub217565c\" id=\"ub217565c\">Vite</span><u><span data-lake-id=\"ua5b844bc\" id=\"ua5b844bc\">直接启动</span></u><span data-lake-id=\"ue0e28728\" id=\"ue0e28728\">开发服务器，请求哪个模块再对哪个模块进行实时编译；</span></li><li fid=\"u5447339c\" data-lake-id=\"ud84f0255\" id=\"ud84f0255\"><span data-lake-id=\"ue952eba9\" id=\"ue952eba9\">由于现代浏览器本身就支持ES Modules，会主动发起请求去获取所需文件。Vite充分利用这一点，将开发环境下的模块文件，作为浏览器要执行的文件，而不是像webpack先打包，交给浏览器执行的文件是打包后的；</span></li><li fid=\"u5447339c\" data-lake-id=\"u2fcdc6e1\" id=\"u2fcdc6e1\"><span data-lake-id=\"ub2181575\" id=\"ub2181575\">由于Vite启动时无需打包，也就无需分析模块依赖、编译，所以启动速度非常快。当浏览器请求需要的模块时，再对模块进行编译，这种按需动态编译的模式，极大地缩短了编译时间，当项目越大，文件越多，Vite的开发时优势越明显；</span></li><li fid=\"u5447339c\" data-lake-id=\"u330c8674\" id=\"u330c8674\"><span data-lake-id=\"u6a3acedb\" id=\"u6a3acedb\">在HRM方面，当某个模块内容改变时，让浏览器去重新请求该模块即可，而不是像webpack重新将该模块的所有依赖重新编译；</span></li><li fid=\"u5447339c\" data-lake-id=\"u7bb9a5dd\" id=\"u7bb9a5dd\"><span data-lake-id=\"u1b2dfbb2\" id=\"u1b2dfbb2\">当需要打包到生产环境时，Vite使用传统的rollup进行打包，所以，vite的优势体现在开发阶段，另外，由于vite使用的是ES Module，所以代码中不可以使用CommonJS。</span></li></ol><h1 data-lake-id=\"tm0Ny\" id=\"tm0Ny\"><span data-lake-id=\"u92042b66\" id=\"u92042b66\">Vite为什么“快”？</span></h1><h2 data-lake-id=\"sr4SV\" id=\"sr4SV\"><span data-lake-id=\"ub93b37cc\" id=\"ub93b37cc\">问题现状</span></h2><h3 data-lake-id=\"gMsh3\" id=\"gMsh3\"><span data-lake-id=\"uf1743cbb\" id=\"uf1743cbb\">1. ES模块化支持的问题</span></h3><ul list=\"ue9bc1abf\"><li fid=\"u081db92c\" data-lake-id=\"uf39daca7\" id=\"uf39daca7\"><span data-lake-id=\"ufdace296\" id=\"ufdace296\">以前的浏览器不支持ES Module</span></li></ul><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22%2F%2F%20index.js%5Cn%5Cnimport%20%7B%20add%20%7D%20from%20'.%2Fadd.js'%5Cnimport%20%7B%20sub%20%7D%20from%20'.%2Fsub.js'%5Cnconsole.log(add(1%2C%202))%5Cnconsole.log(sub(1%2C%202))%5Cn%5Cn%2F%2F%20add.js%5Cnexport%20const%20add%20%3D%20(a%2C%20b)%20%3D%3E%20a%20%2B%20b%20%5Cn%5Cn%2F%2F%20sub.js%5Cnexport%20const%20sub%20%3D%20(a%2C%20b)%20%3D%3E%20a%20-%20b%20%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22AIy1s%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u6c59d56f\" id=\"u6c59d56f\"><span data-lake-id=\"u1ce801b1\" id=\"u1ce801b1\">这样的一段代码放在浏览器不能直接运行。</span></p><p data-lake-id=\"u6afa13aa\" id=\"u6afa13aa\"><span data-lake-id=\"u08443c0c\" id=\"u08443c0c\">解决方案：可以使用打包工具（如Webpack、Rollup、Parcel），将index.js、add.js、sub.js这三个文件打包在一个bundle.js文件中，然后在项目</span><code data-lake-id=\"u78d9e820\" id=\"u78d9e820\"><span data-lake-id=\"u136ef741\" id=\"u136ef741\">index.html</span></code><span data-lake-id=\"udac90f71\" id=\"udac90f71\">中直接引入</span><code data-lake-id=\"u71c62b13\" id=\"u71c62b13\"><span data-lake-id=\"u2481fbd9\" id=\"u2481fbd9\">bundle.js</span></code><span data-lake-id=\"ube7a43ca\" id=\"ube7a43ca\">，从而达到代码效果。</span></p><h3 data-lake-id=\"mckwu\" id=\"mckwu\"><span data-lake-id=\"u87ec3723\" id=\"u87ec3723\">2. 项目启动与代码更新的问题</span></h3><ul list=\"uc86fc130\"><li fid=\"u8b58ca58\" data-lake-id=\"ufdfd326e\" id=\"ufdfd326e\"><span data-lake-id=\"udc4ac870\" id=\"udc4ac870\">项目启动：随着项目越来越大，启动一个项目可能需要几分钟</span></li><li fid=\"u8b58ca58\" data-lake-id=\"u9719d827\" id=\"u9719d827\"><span data-lake-id=\"ub554c061\" id=\"ub554c061\">代码更新：随着项目越来越大，修改一小段代码，保存后都要等待几秒才更新</span></li></ul><h2 data-lake-id=\"ln7Uw\" id=\"ln7Uw\"><span data-lake-id=\"ub62b4118\" id=\"ub62b4118\">解决问题</span></h2><h3 data-lake-id=\"CcHh3\" id=\"CcHh3\"><span data-lake-id=\"uf743b45c\" id=\"uf743b45c\">1. 解决启动项目缓慢</span></h3><p data-lake-id=\"u884a7c28\" id=\"u884a7c28\"><span data-lake-id=\"u80578576\" id=\"u80578576\">Vite 在打包时，将模块分成两个区域</span><code data-lake-id=\"u79a4590e\" id=\"u79a4590e\"><span data-lake-id=\"u68421621\" id=\"u68421621\">依赖</span></code><span data-lake-id=\"u72556430\" id=\"u72556430\">和</span><code data-lake-id=\"ud94b13ce\" id=\"ud94b13ce\"><span data-lake-id=\"u2ebeddfe\" id=\"u2ebeddfe\">源码</span></code><span data-lake-id=\"u2792c224\" id=\"u2792c224\">：</span></p><ul list=\"u89870c3b\"><li fid=\"ue7baaab1\" data-lake-id=\"u32c3fd45\" id=\"u32c3fd45\"><span data-lake-id=\"u139d0a8c\" id=\"u139d0a8c\">依赖：一般是那种在开发中不会改变的JS，比如组件库，或者一些较大的依赖（可能有上百个模块的库），这一部分使用esbuild来进行预构建依赖，esbuild使用的是Go进行编写，比JS编写的打包器预构建依赖快10-100倍。</span></li><li fid=\"ue7baaab1\" data-lake-id=\"u48a7e8a9\" id=\"u48a7e8a9\"><span data-lake-id=\"u2c326276\" id=\"u2c326276\">源码：一般是那种修改几率比较大的文件，例如JSX、CSS、Vue这些需要转换且时常会被修改编辑的文件。同时这些文件不是一下子全部加载，而是可以按需加载（例如路由懒加载）。Vite会将文件转换后，以</span><code data-lake-id=\"u7c557e8c\" id=\"u7c557e8c\"><span data-lake-id=\"u0af69d6c\" id=\"u0af69d6c\">ES Module</span></code><span data-lake-id=\"ue8db98f1\" id=\"ue8db98f1\">的方式直接交给浏览器，因为现在的浏览器大多数都直接支持es module，这使性能提高很多。</span></li></ul><p data-lake-id=\"ued4a1e1e\" id=\"ued4a1e1e\" style=\"text-indent: 2em\"><span data-lake-id=\"uf5743435\" id=\"uf5743435\">原因如下图：</span></p><p data-lake-id=\"ud5cc1a09\" id=\"ud5cc1a09\" style=\"text-indent: 2em\"><span data-lake-id=\"u8153ef23\" id=\"u8153ef23\">第一张图，是以前的打包模式，<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F2324645%2F1668606127115-567c8a0b-dc4a-4546-bc92-3cd841e9ad03.png%22%2C%22taskId%22%3A%22ubb96c9f1-fe8c-4837-83ee-2e3d29343fb%22%2C%22clientId%22%3A%22u0058c815-b7e9-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A732%2C%22height%22%3A408%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%221668601120853_43F96D26-9591-4a51-926F-A76249646CD6.png%22%2C%22size%22%3A55374%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A732%2C%22originHeight%22%3A408%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22BUNDLE%20BASED%20DEV%20S%20SERVER%20MODULE%20MODUIE%20ROUTE%20SERVER%20BUNDLE%20ENTRY%20MODULE%20ROUTE%20READY%20MODULE%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A40.043438%2C%22y%22%3A27.115393%2C%22width%22%3A222.61113199999997%2C%22height%22%3A27.842522999999996%2C%22text%22%3A%22BUNDLE%20BASED%20DEV%20S%22%7D%2C%7B%22x%22%3A256.08603%2C%22y%22%3A34.18884%2C%22width%22%3A81.30376999999999%2C%22height%22%3A17.902503000000003%2C%22text%22%3A%22SERVER%22%7D%2C%7B%22x%22%3A332.149%2C%22y%22%3A110.04819%2C%22width%22%3A43.741780000000006%2C%22height%22%3A10.61632999999999%2C%22text%22%3A%22MODULE%22%7D%2C%7B%22x%22%3A331.86703%2C%22y%22%3A163.93964%2C%22width%22%3A43.777499999999975%2C%22height%22%3A10.058880000000016%2C%22text%22%3A%22MODUIE%22%7D%2C%7B%22x%22%3A212.50966%2C%22y%22%3A164.5023%2C%22width%22%3A36.2946%2C%22height%22%3A9.533240000000006%2C%22text%22%3A%22ROUTE%22%7D%2C%7B%22x%22%3A608.9008%2C%22y%22%3A201.63786%2C%22width%22%3A55.26296000000002%2C%22height%22%3A14.507280000000009%2C%22text%22%3A%22SERVER%22%7D%2C%7B%22x%22%3A481.5142%2C%22y%22%3A210.15442%2C%22width%22%3A55.45906999999994%2C%22height%22%3A14.753740000000022%2C%22text%22%3A%22BUNDLE%22%7D%2C%7B%22x%22%3A81.045616%2C%22y%22%3A213.32765%2C%22width%22%3A35.61722400000001%2C%22height%22%3A10.447309999999987%2C%22text%22%3A%22ENTRY%22%7D%2C%7B%22x%22%3A331.86368%2C%22y%22%3A212.61821%2C%22width%22%3A44.31218999999999%2C%22height%22%3A10.803470000000004%2C%22text%22%3A%22MODULE%22%7D%2C%7B%22x%22%3A213.05891%2C%22y%22%3A213.87514%2C%22width%22%3A35.57578000000001%2C%22height%22%3A9.614830000000012%2C%22text%22%3A%22ROUTE%22%7D%2C%7B%22x%22%3A615.14264%2C%22y%22%3A220.83333%2C%22width%22%3A44.32395999999994%2C%22height%22%3A13.2269%2C%22text%22%3A%22READY%22%7D%2C%7B%22x%22%3A332.05167%2C%22y%22%3A262.25995%2C%22width%22%3A44.089290000000005%2C%22height%22%3A10.405610000000024%2C%22text%22%3A%22MODULE%22%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3741%22%2C%22id%22%3A%22uf56b9e97%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p>",
    "public": 1,
    "status": 1,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-16T13:42:12.000Z",
    "deleted_at": null,
    "created_at": "2022-11-16T08:51:59.000Z",
    "updated_at": "2022-11-16T13:42:12.000Z",
    "published_at": "2022-11-16T13:42:12.000Z",
    "first_published_at": "2022-11-16T09:33:19.996Z",
    "word_count": 957,
    "cover": "https://cdn.nlark.com/yuque/0/2022/png/2324645/1668606127115-567c8a0b-dc4a-4546-bc92-3cd841e9ad03.png",
    "description": "---  title: Vite vs Webpack vs esbuild categories:  前端工程化tags:  [Vite,Webpack,Esbuild]---Vite和Webpack之对比开发阶段：Vite的速度远快于Webpack主要原因：Webpack是先打包再启动开发...",
    "custom_description": null,
    "hits": 0,
    "_serializer": "v2.doc_detail"
  },
  {
    "id": 106268001,
    "slug": "hl6yp4ao1ebb8t7w",
    "title": "JS高频面试题",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "--- <br />title: JS高频面试题 <br />categories:  JS<br />tags:  JS<br />--- \n<a name=\"ZolgE\"></a>\n## apply、call、bind的区别\n\n- 三者都可以改变函数的this对象指向\n- 三者第一个参数都是this要指向的对象，如果如果没有这个参数或参数为undefined或null，则默认指向全局window\n- 三者都可以传参，但是apply是数组，而call是参数列表，且apply和call是一次性传入参数，而bind可以分为多次传入\n- bind是返回绑定this之后的函数，需要手动执行函数，apply、call 则是立即执行\n<a name=\"yuKWf\"></a>\n## new操作符的实现原理\nnew操作符的执⾏过程：<br />（1）⾸先创建了⼀个新的空对象<br />（2）设置原型，将对象的原型设置为函数的 prototype 对象。<br />（3）让函数的 this 指向这个对象，执⾏构造函数的代码（为这个新对象添加属性）<br />（4）判断函数的返回值类型，如果是值类型，返回创建的对象。如果是引⽤类型，就返回这个引⽤类<br />型的对象。\n```javascript\nfunction objectFactory() {\nlet newObject = null;\nlet constructor = Array.prototype.shift.call(arguments);\nlet result = null;\n// 判断参数是否是⼀个函数\nif (typeof constructor !== \"function\") {\nconsole.error(\"type error\");\nreturn;\n}\n// 新建⼀个空对象，对象的原型为构造函数的 prototype 对象\nnewObject = Object.create(constructor.prototype);\n// 将 this 指向新建对象，并执⾏函数\nresult = constructor.apply(newObject, arguments);\n// 判断返回对象\nlet flag = result && (typeof result === \"object\" || typeof result ===\n\"function\");\n// 判断返回结果\nreturn flag ? result : newObject;\n}\n// 使⽤⽅法\nobjectFactory(构造函数, 初始化参数);\n```\n<a name=\"EuRYC\"></a>\n## map()和foreach()的区别\n<a name=\"ogOb0\"></a>\n### 简洁回答\n都是⽤来遍历数组的，两者区别如下：\n\n- forEach()⽅法会针对每⼀个元素执⾏提供的函数，对数据的操作会改变原数组，该⽅法没有返回\n\n值；\n\n- map()⽅法不会改变原数组的值，返回⼀个新数组，新数组中的值为原数组调⽤函数处理之后的\n\n值；\n<a name=\"LgnBg\"></a>\n### 相同点\n\n1. 都是循环遍历数组的每一项\n2. 都相当于封装好的单层for循环，三个值都相同\n3. 每次执行匿名函数都支持三个参数，参数分别为item（当前每一项）、index（索引值）、arr（原数组）\n4. 匿名函数中的this都是指向window\n5. 只能遍历数组\n<a name=\"gJBw2\"></a>\n### 不同点\n\n- map()会分配内存空间存储新数组并有返回值，forEach()没有返回值\n- forEach()允许calllback更改原始数组的元素，map()返回新的数组，map()不会对空数组进行检测\n- forEach()遍历通常都是直接引入当前遍历数组的内存地址，生成的数组的值发生变化，当前遍历的数组对应的值也会发生变化。\n- map遍历后的数组通常会生成一个新的数组，新数组的值发生变化，当前遍历的数组值不会变化。\n- map的速度大于forEach\n<a name=\"qMAb9\"></a>\n### 使用场景\n\n1. forEach()适用于你并不打算改变数据的时候\n2. map()适用于你要改变数据的时候。不仅在于它更快，而且返回一个新数组。（因此可以使用复合（composition）（map(),filter(),reduce()等组合使用））\n\n性能上来说，for>forEach>map。\n<a name=\"fNTcb\"></a>\n## Symbol\n\n1. 什么是Symbol？\n\nSymbol是ES6新增的一种数据类型，被划分为**基本数据类型**。不能用 `new`。\n\n- 基本数据类型：字符串、数值、布尔、undefined、null、Symbol。\n- 引用数据类型：Object\n2. 作用\n\n用来表示一个独一无二的值。\n\n3. 格式：`let xxx = Symbol('标识字符串')`\n4. 为什么需要Symbol？\n\n为了避免第三方框框架的同名属性被覆盖。\n> 在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。\n\n5. 如果区分Symbol？\n\n在通过Symbol生成一个独一无二的值时，可以设置一个标记<br />这个标记仅仅用于区分，没有其他任何意义。\n\n6. 如果特殊情况需要读取这个标记，\n- Symbol类型可以转化为boolean或字符串，转化为字符串时前面会加上Symbol(wxy)，不方便\n- 可以直接通过description属性获取Symbol函数的字符串标识参数\n7. 使用Symbol类型作为属性名\n> 对象的属性要么是字符串，要么是Symbol类型\n\n- 默认是字符串，所以不加`\"\"`也可以；如果需要类型为Symbol，需要使用`[]`。\n- 不能用`.`来访问，因为点运算符后面总是字符串。\n- Symbol值作为属性名时，该属性还是公开属性，不是私有属性。\n8. 例子：\n```javascript\n//后面的括号可以给symbol做上标记便于识别\nlet name = Symbol(\"name\");\nlet say = Symbol(\"say\");\nlet obj = {\n    //如果想 使用变量作为对象属性的名称，必须加上中括号，.运算符后面跟着的都是字符串\n    [name]: \"lnj\",\n    [say]: function() {\n        console.log(\"say\");\n    },\n    // name: \"rose\",\n};\n// obj.name = \"it6661\";\nobj[Symbol(\"name\")] = \"it666\";\nconsole.log(obj);\nconsole.log(Reflect.ownKeys(obj));\n```\n> {\n>   [Symbol(name)]: 'lnj',\n>   [Symbol(say)]: [Function: [say]],\n>   [Symbol(name)]: 'it666'\n> }\n> [ Symbol(name), Symbol(say), Symbol(name) ]\n\n没有覆盖原来的name，因为都是独一无二的，那么就默认创建一个name的属性。\n<a name=\"PKuqe\"></a>\n### 注意点\n\n1. Symbol是基本数据类型，不能加new\n2. 后面括号可以传入一个字符串，只是一个标记，方便阅读，没有任何意义。\n3. 类型转化的时候，不可转化为数值，只能转化为字符串和布尔值。\n```javascript\nconsole.log(String(name));\nconsole.log(Boolean(name));\nconsole.log(Number(name)); // Cannot convert a Symbol value to a number\n```\n\n4. 不能做任何运算\n```javascript\nlet name=Symbol('name');\nconsole.log(name+111)\nconsole.log(name+'ccc')\n//全部报错 Cannot convert a Symbol value to a number\n```\n\n5. Symbol生成的值作为属性或方法的时候，一定要保存下来，否则后续无法使用。\n```javascript\nlet name=Symbol('name');\nlet obj={\n  // name:'lnj',\n    [Symbol('name')]:'lbj'\n}\nconsole.log(obj.name);  //访问不到，因为  [Symbol('name')]又是一个新的值，和上面的name不是同一个\n```\n应该改为如下：\n```javascript\nlet name = Symbol(\"name\");\nlet obj = {\n    [name]: \"lnj1\",\n    // [Symbol(\"name\")]: \"lbj\",\n};\n// console.log(obj.name); //访问不到，因为  [Symbol('name')]又是一个新的值，和上面的name不是同一个\nconsole.log(Reflect.ownKeys(obj));\nconsole.log(obj[name]);\n```\n> [ Symbol(name) ]\n> lnj1\n\n6. for循环遍历对象时无法遍历出Symbol的属性和方法\n```javascript\nlet name=Symbol('name');\nlet obj={\n  [name]:'lnj',\n    age:12,\n    teacher:'wyx'\n}\nfor(let key in obj){\n    console.log(key)   //只能打印出age和teacher\n}\n//这个方法可以单独取出Symbol(name)\nconsole.log(Object.getOwnPropertySymbols(obj))\n```\n<a name=\"bRIp6\"></a>\n### Symbol的应用\n\n1. 在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。\n2. 消除魔术字符串\n> 魔术字符串：在代码中多次出现，与代码形成强耦合的某一个具体的字符串或数值。风格良好的代码应该尽量消除魔术字符串，改由含义清晰的变量代替。‘\n\n```javascript\nconst gender = {\n   //这样就说明man就是一个独一无二的值，不用再man:'man'   \n    man: Symbol(),\n    woman: Symbol(),\n}\nfunction isMan(gender) {\n    switch (gender) {\n        case gender.man:\n            console.log('男性');\n            break;\n        case gender.woman:\n            console.log('女性');\n            break\n    }\n}\nisMan(gender.man)  //男性\n```\n\n3. 为对象定义一些非私有的、但又希望只用于内部的方法。\n> 由于以Symbol值作为键名，不会被常规方法遍历得到。我们可以利用这个特性，为对象定义一些非私有的、但又希望只用于内部的方法。\n> 注意：Symbol并不能实现真正的私有变量的效果，只是不能通过常规的遍历方法拿到Symbol类型的属性而已。\n\n**对象的遍历方法**：\n\n- for(let xx in obj)：i代表key\n- for(let xx of obj)：不是自带的\n- Object.keys(obj)：返回包含的key的数组\n- Object.values(obj)：返回包含value的数组\n- Object.getOwnPropertyNames()：返回包含key的数组\n\n上述的所有方法都遍历不到Symbol类型的（注意：是遍历时取不到Symbol，并不是我们访问不到对象的Symbol类型）<br />**可以遍历到Symbol的方法：**\n\n- **Object.getOwnPropertySymbols()**：返回对象中只包含Symbol类型key的数组\n- **Reflect.ownKeys()**：返回对象中所有类型key的数组（包含Symbol）\n```javascript\nlet _password = Symbol('password')\nconst obj = {\n    name: '小明',\n    gender: 'male',\n    [_password]: '11038'\n}\nfor (let item in obj) {\n    console.log(item);\n}\nconsole.log(Object.keys(obj));\nconsole.log(Object.values(obj));\nconsole.log(Object.getOwnPropertyNames(obj));\nconsole.log(Object.getOwnPropertySymbols(obj));\nconsole.log(Reflect.ownKeys(obj))\n// 输出11038，所以还是可以直接访问到symbol类型的属性，所以symbol并不能真正实现私有变量的设定，所以一般只用于定义一些非私有的、但又希望只用于内部的方法\nconsole.log(obj[_password]);\n```\n输出如下：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2324645/1668653745915-fc9503cf-b3b8-4973-b078-26b09f69ba22.png#averageHue=%23212121&clientId=u2b09cbdb-2331-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=116&id=u196ca470&margin=%5Bobject%20Object%5D&name=image.png&originHeight=245&originWidth=583&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46307&status=done&style=none&taskId=uda6b3e15-79e2-4aa7-982d-49fe7eb8eb8&title=&width=275)\n<a name=\"wAmPW\"></a>\n### Symbol自带的方法\n<a name=\"ZBbKp\"></a>\n#### 1. `Symbol.for()`\n重新使用同一个Symbol值。<br />接收一个字符串作为参数，搜索是否有以该参数作为名称的Symbol值，如果有，就返回这个Symbol值，否则就新建一个以该字符串为名称的Symbol值，并将其注册到全局。\n```javascript\nlet s1 = Symbol.for('foo');\nlet s2 = Symbol.for('foo');\n\ns1 === s2 // true\n```\n<a name=\"ezFW0\"></a>\n#### 2. `Symbol.keyFor()`\n返回一个已登记的Symbol类型值的`key`。<br />由于`Symbol()`写法没有登记机制，所以每次调用都会返回一个不同的值。\n```javascript\nlet s1 = Symbol.for(\"foo\");\nSymbol.keyFor(s1) // \"foo\"\n\nlet s2 = Symbol(\"foo\");\nSymbol.keyFor(s2) // undefined\n```\n<a name=\"hZIrL\"></a>\n## Map和Object区别\n|  | Map | Object |\n| --- | --- | --- |\n| 意外的键 | Map默认情况不包含任何键，只包含显式插入的键 | Object有一个原型，原型链上的键名有可能和自己在对象上设置的键名有冲突 |\n| 键的类型 | Map的键可以是任意值，包括函数、对象或任意基本类型 | Object的键必须是String或Symbol |\n| 键的顺序 | Map中的key是有序的。因此，当迭代的时候，Map对象以插入的顺序返回键值 | Object的键是无序的 |\n| Size | Map的键值对个数可以轻易地通过size属性获取 | Object建值对个数只能手动计算 |\n| 迭代 | Map是iterable的，所以可以直接被迭代 | 迭代Object需要以某种方式获取它的键然后才能迭代 |\n| 性能 | 在频繁增删值对的场景下表现更好 | 在频繁添加和删除键值对的场景下未做出优化 |\n\n<a name=\"N2G8K\"></a>\n## Map和WeakMap区别\n<a name=\"jjMeF\"></a>\n### Map \n本质上是键值对的集合，但是普通Object的中的键值只能是字符串。而ES6提供的数据结构类似于对象，但是它的键不限制范围，可以是任意类型，是一种更加完善的Hash结构。如果Map的键是一个原始数据类型，只要两个键严格相同，就视为是同一个键。<br />实际上是一个数组，它的每一个数据也就是一个数组，其形式如下：\n```javascript\nconst map = [\n  [\"name\",\"张三\"],\n  [\"age\",18],\n]\n```\nMap数据结构有以下操作方法：\n\n- size：map.size() 返回map结构的成员总数\n- set(key,value)：设置键名key对应的键值value，然后返回整个Map结构，如果key已经有值，则键值会被更新，否则就生成该键。（因为返回的是当前Map对象，所以可以链式调用）\n- get(key)：该方法读取key对应的键值，如果找不到key，返回undefined\n- has(key)：该方法返回一个布尔值，表示某个键是否在当前Map对象中。\n\n",
    "body_draft": "--- <br />title: JS高频面试题 <br />categories:  JS<br />tags:  JS<br />--- \n<a name=\"ZolgE\"></a>\n## apply、call、bind的区别\n\n- 三者都可以改变函数的this对象指向\n- 三者第一个参数都是this要指向的对象，如果如果没有这个参数或参数为undefined或null，则默认指向全局window\n- 三者都可以传参，但是apply是数组，而call是参数列表，且apply和call是一次性传入参数，而bind可以分为多次传入\n- bind是返回绑定this之后的函数，需要手动执行函数，apply、call 则是立即执行\n<a name=\"yuKWf\"></a>\n## new操作符的实现原理\nnew操作符的执⾏过程：<br />（1）⾸先创建了⼀个新的空对象<br />（2）设置原型，将对象的原型设置为函数的 prototype 对象。<br />（3）让函数的 this 指向这个对象，执⾏构造函数的代码（为这个新对象添加属性）<br />（4）判断函数的返回值类型，如果是值类型，返回创建的对象。如果是引⽤类型，就返回这个引⽤类<br />型的对象。\n```javascript\nfunction objectFactory() {\nlet newObject = null;\nlet constructor = Array.prototype.shift.call(arguments);\nlet result = null;\n// 判断参数是否是⼀个函数\nif (typeof constructor !== \"function\") {\nconsole.error(\"type error\");\nreturn;\n}\n// 新建⼀个空对象，对象的原型为构造函数的 prototype 对象\nnewObject = Object.create(constructor.prototype);\n// 将 this 指向新建对象，并执⾏函数\nresult = constructor.apply(newObject, arguments);\n// 判断返回对象\nlet flag = result && (typeof result === \"object\" || typeof result ===\n\"function\");\n// 判断返回结果\nreturn flag ? result : newObject;\n}\n// 使⽤⽅法\nobjectFactory(构造函数, 初始化参数);\n```\n<a name=\"EuRYC\"></a>\n## map()和foreach()的区别\n<a name=\"ogOb0\"></a>\n### 简洁回答\n都是⽤来遍历数组的，两者区别如下：\n\n- forEach()⽅法会针对每⼀个元素执⾏提供的函数，对数据的操作会改变原数组，该⽅法没有返回\n\n值；\n\n- map()⽅法不会改变原数组的值，返回⼀个新数组，新数组中的值为原数组调⽤函数处理之后的\n\n值；\n<a name=\"LgnBg\"></a>\n### 相同点\n\n1. 都是循环遍历数组的每一项\n2. 都相当于封装好的单层for循环，三个值都相同\n3. 每次执行匿名函数都支持三个参数，参数分别为item（当前每一项）、index（索引值）、arr（原数组）\n4. 匿名函数中的this都是指向window\n5. 只能遍历数组\n<a name=\"gJBw2\"></a>\n### 不同点\n\n- map()会分配内存空间存储新数组并有返回值，forEach()没有返回值\n- forEach()允许calllback更改原始数组的元素，map()返回新的数组，map()不会对空数组进行检测\n- forEach()遍历通常都是直接引入当前遍历数组的内存地址，生成的数组的值发生变化，当前遍历的数组对应的值也会发生变化。\n- map遍历后的数组通常会生成一个新的数组，新数组的值发生变化，当前遍历的数组值不会变化。\n- map的速度大于forEach\n<a name=\"qMAb9\"></a>\n### 使用场景\n\n1. forEach()适用于你并不打算改变数据的时候\n2. map()适用于你要改变数据的时候。不仅在于它更快，而且返回一个新数组。（因此可以使用复合（composition）（map(),filter(),reduce()等组合使用））\n\n性能上来说，for>forEach>map。\n<a name=\"fNTcb\"></a>\n## Symbol\n\n1. 什么是Symbol？\n\nSymbol是ES6新增的一种数据类型，被划分为**基本数据类型**。不能用 `new`。\n\n- 基本数据类型：字符串、数值、布尔、undefined、null、Symbol。\n- 引用数据类型：Object\n2. 作用\n\n用来表示一个独一无二的值。\n\n3. 格式：`let xxx = Symbol('标识字符串')`\n4. 为什么需要Symbol？\n\n为了避免第三方框框架的同名属性被覆盖。\n> 在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。\n\n5. 如果区分Symbol？\n\n在通过Symbol生成一个独一无二的值时，可以设置一个标记<br />这个标记仅仅用于区分，没有其他任何意义。\n\n6. 如果特殊情况需要读取这个标记，\n- Symbol类型可以转化为boolean或字符串，转化为字符串时前面会加上Symbol(wxy)，不方便\n- 可以直接通过description属性获取Symbol函数的字符串标识参数\n7. 使用Symbol类型作为属性名\n> 对象的属性要么是字符串，要么是Symbol类型\n\n- 默认是字符串，所以不加`\"\"`也可以；如果需要类型为Symbol，需要使用`[]`。\n- 不能用`.`来访问，因为点运算符后面总是字符串。\n- Symbol值作为属性名时，该属性还是公开属性，不是私有属性。\n8. 例子：\n```javascript\n//后面的括号可以给symbol做上标记便于识别\nlet name = Symbol(\"name\");\nlet say = Symbol(\"say\");\nlet obj = {\n    //如果想 使用变量作为对象属性的名称，必须加上中括号，.运算符后面跟着的都是字符串\n    [name]: \"lnj\",\n    [say]: function() {\n        console.log(\"say\");\n    },\n    // name: \"rose\",\n};\n// obj.name = \"it6661\";\nobj[Symbol(\"name\")] = \"it666\";\nconsole.log(obj);\nconsole.log(Reflect.ownKeys(obj));\n```\n> {\n>   [Symbol(name)]: 'lnj',\n>   [Symbol(say)]: [Function: [say]],\n>   [Symbol(name)]: 'it666'\n> }\n> [ Symbol(name), Symbol(say), Symbol(name) ]\n\n没有覆盖原来的name，因为都是独一无二的，那么就默认创建一个name的属性。\n<a name=\"PKuqe\"></a>\n### 注意点\n\n1. Symbol是基本数据类型，不能加new\n2. 后面括号可以传入一个字符串，只是一个标记，方便阅读，没有任何意义。\n3. 类型转化的时候，不可转化为数值，只能转化为字符串和布尔值。\n```javascript\nconsole.log(String(name));\nconsole.log(Boolean(name));\nconsole.log(Number(name)); // Cannot convert a Symbol value to a number\n```\n\n4. 不能做任何运算\n```javascript\nlet name=Symbol('name');\nconsole.log(name+111)\nconsole.log(name+'ccc')\n//全部报错 Cannot convert a Symbol value to a number\n```\n\n5. Symbol生成的值作为属性或方法的时候，一定要保存下来，否则后续无法使用。\n```javascript\nlet name=Symbol('name');\nlet obj={\n  // name:'lnj',\n    [Symbol('name')]:'lbj'\n}\nconsole.log(obj.name);  //访问不到，因为  [Symbol('name')]又是一个新的值，和上面的name不是同一个\n```\n应该改为如下：\n```javascript\nlet name = Symbol(\"name\");\nlet obj = {\n    [name]: \"lnj1\",\n    // [Symbol(\"name\")]: \"lbj\",\n};\n// console.log(obj.name); //访问不到，因为  [Symbol('name')]又是一个新的值，和上面的name不是同一个\nconsole.log(Reflect.ownKeys(obj));\nconsole.log(obj[name]);\n```\n> [ Symbol(name) ]\n> lnj1\n\n6. for循环遍历对象时无法遍历出Symbol的属性和方法\n```javascript\nlet name=Symbol('name');\nlet obj={\n  [name]:'lnj',\n    age:12,\n    teacher:'wyx'\n}\nfor(let key in obj){\n    console.log(key)   //只能打印出age和teacher\n}\n//这个方法可以单独取出Symbol(name)\nconsole.log(Object.getOwnPropertySymbols(obj))\n```\n<a name=\"bRIp6\"></a>\n### Symbol的应用\n\n1. 在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。\n2. 消除魔术字符串\n> 魔术字符串：在代码中多次出现，与代码形成强耦合的某一个具体的字符串或数值。风格良好的代码应该尽量消除魔术字符串，改由含义清晰的变量代替。‘\n\n```javascript\nconst gender = {\n   //这样就说明man就是一个独一无二的值，不用再man:'man'   \n    man: Symbol(),\n    woman: Symbol(),\n}\nfunction isMan(gender) {\n    switch (gender) {\n        case gender.man:\n            console.log('男性');\n            break;\n        case gender.woman:\n            console.log('女性');\n            break\n    }\n}\nisMan(gender.man)  //男性\n```\n\n3. 为对象定义一些非私有的、但又希望只用于内部的方法。\n> 由于以Symbol值作为键名，不会被常规方法遍历得到。我们可以利用这个特性，为对象定义一些非私有的、但又希望只用于内部的方法。\n> 注意：Symbol并不能实现真正的私有变量的效果，只是不能通过常规的遍历方法拿到Symbol类型的属性而已。\n\n**对象的遍历方法**：\n\n- for(let xx in obj)：i代表key\n- for(let xx of obj)：不是自带的\n- Object.keys(obj)：返回包含的key的数组\n- Object.values(obj)：返回包含value的数组\n- Object.getOwnPropertyNames()：返回包含key的数组\n\n上述的所有方法都遍历不到Symbol类型的（注意：是遍历时取不到Symbol，并不是我们访问不到对象的Symbol类型）<br />**可以遍历到Symbol的方法：**\n\n- **Object.getOwnPropertySymbols()**：返回对象中只包含Symbol类型key的数组\n- **Reflect.ownKeys()**：返回对象中所有类型key的数组（包含Symbol）\n```javascript\nlet _password = Symbol('password')\nconst obj = {\n    name: '小明',\n    gender: 'male',\n    [_password]: '11038'\n}\nfor (let item in obj) {\n    console.log(item);\n}\nconsole.log(Object.keys(obj));\nconsole.log(Object.values(obj));\nconsole.log(Object.getOwnPropertyNames(obj));\nconsole.log(Object.getOwnPropertySymbols(obj));\nconsole.log(Reflect.ownKeys(obj))\n// 输出11038，所以还是可以直接访问到symbol类型的属性，所以symbol并不能真正实现私有变量的设定，所以一般只用于定义一些非私有的、但又希望只用于内部的方法\nconsole.log(obj[_password]);\n```\n输出如下：<br />![image.png](https://cdn.nlark.com/yuque/0/2022/png/2324645/1668653745915-fc9503cf-b3b8-4973-b078-26b09f69ba22.png#averageHue=%23212121&clientId=u2b09cbdb-2331-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=116&id=u196ca470&margin=%5Bobject%20Object%5D&name=image.png&originHeight=245&originWidth=583&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46307&status=done&style=none&taskId=uda6b3e15-79e2-4aa7-982d-49fe7eb8eb8&title=&width=275)\n<a name=\"wAmPW\"></a>\n### Symbol自带的方法\n<a name=\"ZBbKp\"></a>\n#### 1. `Symbol.for()`\n重新使用同一个Symbol值。<br />接收一个字符串作为参数，搜索是否有以该参数作为名称的Symbol值，如果有，就返回这个Symbol值，否则就新建一个以该字符串为名称的Symbol值，并将其注册到全局。\n```javascript\nlet s1 = Symbol.for('foo');\nlet s2 = Symbol.for('foo');\n\ns1 === s2 // true\n```\n<a name=\"ezFW0\"></a>\n#### 2. `Symbol.keyFor()`\n返回一个已登记的Symbol类型值的`key`。<br />由于`Symbol()`写法没有登记机制，所以每次调用都会返回一个不同的值。\n```javascript\nlet s1 = Symbol.for(\"foo\");\nSymbol.keyFor(s1) // \"foo\"\n\nlet s2 = Symbol(\"foo\");\nSymbol.keyFor(s2) // undefined\n```\n<a name=\"hZIrL\"></a>\n## Map和Object区别\n|  | Map | Object |\n| --- | --- | --- |\n| 意外的键 | Map默认情况不包含任何键，只包含显式插入的键 | Object有一个原型，原型链上的键名有可能和自己在对象上设置的键名有冲突 |\n| 键的类型 | Map的键可以是任意值，包括函数、对象或任意基本类型 | Object的键必须是String或Symbol |\n| 键的顺序 | Map中的key是有序的。因此，当迭代的时候，Map对象以插入的顺序返回键值 | Object的键是无序的 |\n| Size | Map的键值对个数可以轻易地通过size属性获取 | Object建值对个数只能手动计算 |\n| 迭代 | Map是iterable的，所以可以直接被迭代 | 迭代Object需要以某种方式获取它的键然后才能迭代 |\n| 性能 | 在频繁增删值对的场景下表现更好 | 在频繁添加和删除键值对的场景下未做出优化 |\n\n<a name=\"N2G8K\"></a>\n## Map和WeakMap区别\n<a name=\"jjMeF\"></a>\n### Map \n本质上是键值对的集合，但是普通Object的中的键值只能是字符串。而ES6提供的数据结构类似于对象，但是它的键不限制范围，可以是任意类型，是一种更加完善的Hash结构。如果Map的键是一个原始数据类型，只要两个键严格相同，就视为是同一个键。<br />实际上是一个数组，它的每一个数据也就是一个数组，其形式如下：\n```javascript\nconst map = [\n  [\"name\",\"张三\"],\n  [\"age\",18],\n]\n```\nMap数据结构有以下操作方法：\n\n- size：map.size() 返回map结构的成员总数\n- set(key,value)：设置键名key对应的键值value，然后返回整个Map结构，如果key已经有值，则键值会被更新，否则就生成该键。（因为返回的是当前Map对象，所以可以链式调用）\n- get(key)：该方法读取key对应的键值，如果找不到key，返回undefined\n- has(key)：该方法返回一个布尔值，表示某个键是否在当前Map对象中。\n\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"u191f528d\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><p id=\"uaabe2cf3\" class=\"ne-p\"><span class=\"ne-text\">title: JS高频面试题 </span></p><p id=\"u6da62028\" class=\"ne-p\"><span class=\"ne-text\">categories:  JS</span></p><p id=\"u05972217\" class=\"ne-p\"><span class=\"ne-text\">tags:  JS</span></p><p id=\"ua7b72cc6\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><h2 id=\"ZolgE\"><span class=\"ne-text\">apply、call、bind的区别</span></h2><ul class=\"ne-ul\"><li id=\"u6bdab0b4\"><span class=\"ne-text\">三者都可以改变函数的this对象指向</span></li><li id=\"udff3d079\"><span class=\"ne-text\">三者第一个参数都是this要指向的对象，如果如果没有这个参数或参数为undefined或null，则默认指向全局window</span></li><li id=\"uc34d297e\"><span class=\"ne-text\">三者都可以传参，但是apply是数组，而call是参数列表，且apply和call是一次性传入参数，而bind可以分为多次传入</span></li><li id=\"uf1f6cdeb\"><span class=\"ne-text\">bind是返回绑定this之后的函数，需要手动执行函数，apply、call 则是立即执行</span></li></ul><h2 id=\"yuKWf\"><span class=\"ne-text\">new操作符的实现原理</span></h2><p id=\"u2e39dccc\" class=\"ne-p\"><span class=\"ne-text\">new操作符的执⾏过程：</span></p><p id=\"u5fc8def3\" class=\"ne-p\"><span class=\"ne-text\">（1）⾸先创建了⼀个新的空对象</span></p><p id=\"u91b99bd5\" class=\"ne-p\"><span class=\"ne-text\">（2）设置原型，将对象的原型设置为函数的 prototype 对象。</span></p><p id=\"uc08c9e71\" class=\"ne-p\"><span class=\"ne-text\">（3）让函数的 this 指向这个对象，执⾏构造函数的代码（为这个新对象添加属性）</span></p><p id=\"u5dd9eefa\" class=\"ne-p\"><span class=\"ne-text\">（4）判断函数的返回值类型，如果是值类型，返回创建的对象。如果是引⽤类型，就返回这个引⽤类</span></p><p id=\"u9e775328\" class=\"ne-p\"><span class=\"ne-text\">型的对象。</span></p><pre data-language=\"javascript\" id=\"HxWQB\" class=\"ne-codeblock language-javascript\">function objectFactory() {\nlet newObject = null;\nlet constructor = Array.prototype.shift.call(arguments);\nlet result = null;\n// 判断参数是否是⼀个函数\nif (typeof constructor !== &quot;function&quot;) {\nconsole.error(&quot;type error&quot;);\nreturn;\n}\n// 新建⼀个空对象，对象的原型为构造函数的 prototype 对象\nnewObject = Object.create(constructor.prototype);\n// 将 this 指向新建对象，并执⾏函数\nresult = constructor.apply(newObject, arguments);\n// 判断返回对象\nlet flag = result &amp;&amp; (typeof result === &quot;object&quot; || typeof result ===\n&quot;function&quot;);\n// 判断返回结果\nreturn flag ? result : newObject;\n}\n// 使⽤⽅法\nobjectFactory(构造函数, 初始化参数);</pre><h2 id=\"EuRYC\"><span class=\"ne-text\">map()和foreach()的区别</span></h2><h3 id=\"ogOb0\"><span class=\"ne-text\">简洁回答</span></h3><p id=\"u7a3aea33\" class=\"ne-p\"><span class=\"ne-text\">都是⽤来遍历数组的，两者区别如下：</span></p><ul class=\"ne-ul\"><li id=\"u24f06412\"><span class=\"ne-text\">forEach()⽅法会针对每⼀个元素执⾏提供的函数，对数据的操作会改变原数组，该⽅法没有返回</span></li></ul><p id=\"uaf7ac181\" class=\"ne-p\"><span class=\"ne-text\">值；</span></p><ul class=\"ne-ul\"><li id=\"u25e2e9ad\"><span class=\"ne-text\">map()⽅法不会改变原数组的值，返回⼀个新数组，新数组中的值为原数组调⽤函数处理之后的</span></li></ul><p id=\"u4eff17df\" class=\"ne-p\"><span class=\"ne-text\">值；</span></p><h3 id=\"LgnBg\"><span class=\"ne-text\">相同点</span></h3><ol class=\"ne-ol\"><li id=\"uc81910d8\"><span class=\"ne-text\">都是循环遍历数组的每一项</span></li><li id=\"uc92e479b\"><span class=\"ne-text\">都相当于封装好的单层for循环，三个值都相同</span></li><li id=\"u5ede89bf\"><span class=\"ne-text\">每次执行匿名函数都支持三个参数，参数分别为item（当前每一项）、index（索引值）、arr（原数组）</span></li><li id=\"ua6b771b6\"><span class=\"ne-text\">匿名函数中的this都是指向window</span></li><li id=\"uc61e0fa0\"><span class=\"ne-text\">只能遍历数组</span></li></ol><h3 id=\"gJBw2\"><span class=\"ne-text\">不同点</span></h3><ul class=\"ne-ul\"><li id=\"uaa3c5be7\"><span class=\"ne-text\">map()会分配内存空间存储新数组并有返回值，forEach()没有返回值</span></li><li id=\"uc5dcb627\"><span class=\"ne-text\">forEach()允许calllback更改原始数组的元素，map()返回新的数组，map()不会对空数组进行检测</span></li><li id=\"ub3699f29\"><span class=\"ne-text\">forEach()遍历通常都是直接引入当前遍历数组的内存地址，生成的数组的值发生变化，当前遍历的数组对应的值也会发生变化。</span></li><li id=\"uf52ca49a\"><span class=\"ne-text\">map遍历后的数组通常会生成一个新的数组，新数组的值发生变化，当前遍历的数组值不会变化。</span></li><li id=\"ua05c9eab\"><span class=\"ne-text\">map的速度大于forEach</span></li></ul><h3 id=\"qMAb9\"><span class=\"ne-text\">使用场景</span></h3><ol class=\"ne-ol\"><li id=\"ua4984c5a\"><span class=\"ne-text\">forEach()适用于你并不打算改变数据的时候</span></li><li id=\"u1faeb043\"><span class=\"ne-text\">map()适用于你要改变数据的时候。不仅在于它更快，而且返回一个新数组。（因此可以使用复合（composition）（map(),filter(),reduce()等组合使用））</span></li></ol><p id=\"ub47a1f9b\" class=\"ne-p\"><span class=\"ne-text\">性能上来说，for&gt;forEach&gt;map。</span></p><h2 id=\"fNTcb\"><span class=\"ne-text\">Symbol</span></h2><ol class=\"ne-ol\"><li id=\"u83c42b6d\"><span class=\"ne-text\">什么是Symbol？</span></li></ol><p id=\"u4ba1b7d7\" class=\"ne-p\" style=\"text-indent: 2em\"><span class=\"ne-text\">Symbol是ES6新增的一种数据类型，被划分为</span><strong><span class=\"ne-text\">基本数据类型</span></strong><span class=\"ne-text\">。不能用 </span><code class=\"ne-code\"><span class=\"ne-text\">new</span></code><span class=\"ne-text\">。</span></p><ul class=\"ne-ul\"><li id=\"ua21ebc77\"><span class=\"ne-text\">基本数据类型：字符串、数值、布尔、undefined、null、Symbol。</span></li><li id=\"u37091692\"><span class=\"ne-text\">引用数据类型：Object</span></li></ul><ol start=\"2\" class=\"ne-ol\"><li id=\"ua5c50a5a\"><span class=\"ne-text\">作用</span></li></ol><p id=\"u07e440cd\" class=\"ne-p\"><span class=\"ne-text\">用来表示一个独一无二的值。</span></p><ol start=\"3\" class=\"ne-ol\"><li id=\"u8323c438\"><span class=\"ne-text\">格式：</span><code class=\"ne-code\"><span class=\"ne-text\">let xxx = Symbol('标识字符串')</span></code></li><li id=\"u2c83ce55\"><span class=\"ne-text\">为什么需要Symbol？</span></li></ol><p id=\"u1a3e155d\" class=\"ne-p\" style=\"text-indent: 2em\"><span class=\"ne-text\">为了避免第三方框框架的同名属性被覆盖。</span></p><div class=\"ne-quote\" style=\"margin-left: 2em\"><p id=\"ubf547b48\" class=\"ne-p\"><span class=\"ne-text\">在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。</span></p></div><ol start=\"5\" class=\"ne-ol\"><li id=\"u791b2d4b\"><span class=\"ne-text\">如果区分Symbol？</span></li></ol><p id=\"u99726587\" class=\"ne-p\" style=\"text-indent: 2em\"><span class=\"ne-text\">在通过Symbol生成一个独一无二的值时，可以设置一个标记</span></p><p id=\"u59dd8786\" class=\"ne-p\" style=\"text-indent: 2em\"><span class=\"ne-text\">这个标记仅仅用于区分，没有其他任何意义。</span></p><ol start=\"6\" class=\"ne-ol\"><li id=\"u8d6baf17\"><span class=\"ne-text\">如果特殊情况需要读取这个标记，</span></li></ol><ul class=\"ne-ul\"><li id=\"ud73ce616\"><span class=\"ne-text\">Symbol类型可以转化为boolean或字符串，转化为字符串时前面会加上Symbol(wxy)，不方便</span></li><li id=\"ub5657a7d\"><span class=\"ne-text\">可以直接通过description属性获取Symbol函数的字符串标识参数</span></li></ul><ol start=\"7\" class=\"ne-ol\"><li id=\"u76de8cd9\"><span class=\"ne-text\">使用Symbol类型作为属性名</span></li></ol><div class=\"ne-quote\" style=\"margin-left: 2em\"><p id=\"u84c1fe0a\" class=\"ne-p\"><span class=\"ne-text\">对象的属性要么是字符串，要么是Symbol类型</span></p></div><ul class=\"ne-ul\"><li id=\"u5f898a70\"><span class=\"ne-text\">默认是字符串，所以不加</span><code class=\"ne-code\"><span class=\"ne-text\">&quot;&quot;</span></code><span class=\"ne-text\">也可以；如果需要类型为Symbol，需要使用</span><code class=\"ne-code\"><span class=\"ne-text\">[]</span></code><span class=\"ne-text\">。</span></li><li id=\"u26b3983a\"><span class=\"ne-text\">不能用</span><code class=\"ne-code\"><span class=\"ne-text\">.</span></code><span class=\"ne-text\">来访问，因为点运算符后面总是字符串。</span></li><li id=\"u8648d662\"><span class=\"ne-text\">Symbol值作为属性名时，该属性还是公开属性，不是私有属性。</span></li></ul><ol start=\"8\" class=\"ne-ol\"><li id=\"uad898f22\"><span class=\"ne-text\">例子：</span></li></ol><pre data-language=\"javascript\" id=\"KbTRx\" class=\"ne-codeblock language-javascript\">//后面的括号可以给symbol做上标记便于识别\nlet name = Symbol(&quot;name&quot;);\nlet say = Symbol(&quot;say&quot;);\nlet obj = {\n    //如果想 使用变量作为对象属性的名称，必须加上中括号，.运算符后面跟着的都是字符串\n    [name]: &quot;lnj&quot;,\n    [say]: function() {\n        console.log(&quot;say&quot;);\n    },\n    // name: &quot;rose&quot;,\n};\n// obj.name = &quot;it6661&quot;;\nobj[Symbol(&quot;name&quot;)] = &quot;it666&quot;;\nconsole.log(obj);\nconsole.log(Reflect.ownKeys(obj));</pre><div class=\"ne-quote\"><p id=\"uc4e8b106\" class=\"ne-p\"><span class=\"ne-text\">{</span></p><p id=\"ub2bf8ae8\" class=\"ne-p\"><span class=\"ne-text\">  [Symbol(name)]: 'lnj',</span></p><p id=\"u8a53f6f3\" class=\"ne-p\"><span class=\"ne-text\">  [Symbol(say)]: [Function: [say]],</span></p><p id=\"u8bf87a90\" class=\"ne-p\"><span class=\"ne-text\">  [Symbol(name)]: 'it666'</span></p><p id=\"udf34f821\" class=\"ne-p\"><span class=\"ne-text\">}</span></p><p id=\"uea186e60\" class=\"ne-p\"><span class=\"ne-text\">[ Symbol(name), Symbol(say), Symbol(name) ]</span></p></div><p id=\"u389f2d31\" class=\"ne-p\"><span class=\"ne-text\">没有覆盖原来的name，因为都是独一无二的，那么就默认创建一个name的属性。</span></p><h3 id=\"PKuqe\"><span class=\"ne-text\">注意点</span></h3><ol class=\"ne-ol\"><li id=\"ud0d58967\"><span class=\"ne-text\">Symbol是基本数据类型，不能加new</span></li><li id=\"u776509e4\"><span class=\"ne-text\">后面括号可以传入一个字符串，只是一个标记，方便阅读，没有任何意义。</span></li><li id=\"u7086a86c\"><span class=\"ne-text\">类型转化的时候，不可转化为数值，只能转化为字符串和布尔值。</span></li></ol><pre data-language=\"javascript\" id=\"cMRkp\" class=\"ne-codeblock language-javascript\">console.log(String(name));\nconsole.log(Boolean(name));\nconsole.log(Number(name)); // Cannot convert a Symbol value to a number</pre><ol start=\"4\" class=\"ne-ol\"><li id=\"u3fd16d74\"><span class=\"ne-text\">不能做任何运算</span></li></ol><pre data-language=\"javascript\" id=\"qAMCc\" class=\"ne-codeblock language-javascript\">let name=Symbol('name');\nconsole.log(name+111)\nconsole.log(name+'ccc')\n//全部报错 Cannot convert a Symbol value to a number</pre><ol start=\"5\" class=\"ne-ol\"><li id=\"uce6a6007\"><span class=\"ne-text\">Symbol生成的值作为属性或方法的时候，一定要保存下来，否则后续无法使用。</span></li></ol><pre data-language=\"javascript\" id=\"v77MM\" class=\"ne-codeblock language-javascript\">let name=Symbol('name');\nlet obj={\n  // name:'lnj',\n    [Symbol('name')]:'lbj'\n}\nconsole.log(obj.name);  //访问不到，因为  [Symbol('name')]又是一个新的值，和上面的name不是同一个</pre><p id=\"u7464468f\" class=\"ne-p\"><span class=\"ne-text\">应该改为如下：</span></p><pre data-language=\"javascript\" id=\"kKMvX\" class=\"ne-codeblock language-javascript\">let name = Symbol(&quot;name&quot;);\nlet obj = {\n    [name]: &quot;lnj1&quot;,\n    // [Symbol(&quot;name&quot;)]: &quot;lbj&quot;,\n};\n// console.log(obj.name); //访问不到，因为  [Symbol('name')]又是一个新的值，和上面的name不是同一个\nconsole.log(Reflect.ownKeys(obj));\nconsole.log(obj[name]);</pre><div class=\"ne-quote\"><p id=\"ueee19c8f\" class=\"ne-p\"><span class=\"ne-text\">[ Symbol(name) ]</span></p><p id=\"u21bead9f\" class=\"ne-p\"><span class=\"ne-text\">lnj1</span></p></div><ol start=\"6\" class=\"ne-ol\"><li id=\"u7a057185\"><span class=\"ne-text\">for循环遍历对象时无法遍历出Symbol的属性和方法</span></li></ol><pre data-language=\"javascript\" id=\"ikBuz\" class=\"ne-codeblock language-javascript\">let name=Symbol('name');\nlet obj={\n  [name]:'lnj',\n    age:12,\n    teacher:'wyx'\n}\nfor(let key in obj){\n    console.log(key)   //只能打印出age和teacher\n}\n//这个方法可以单独取出Symbol(name)\nconsole.log(Object.getOwnPropertySymbols(obj))</pre><h3 id=\"bRIp6\"><span class=\"ne-text\">Symbol的应用</span></h3><ol class=\"ne-ol\"><li id=\"u4e1ec221\"><span class=\"ne-text\">在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。</span></li><li id=\"ub601210a\"><span class=\"ne-text\">消除魔术字符串</span></li></ol><div class=\"ne-quote\" style=\"margin-left: 2em\"><p id=\"u8d0c3fa6\" class=\"ne-p\"><span class=\"ne-text\">魔术字符串：在代码中多次出现，与代码形成强耦合的某一个具体的字符串或数值。风格良好的代码应该尽量消除魔术字符串，改由含义清晰的变量代替。‘</span></p></div><pre data-language=\"javascript\" id=\"GChhH\" class=\"ne-codeblock language-javascript\">const gender = {\n   //这样就说明man就是一个独一无二的值，不用再man:'man'   \n    man: Symbol(),\n    woman: Symbol(),\n}\nfunction isMan(gender) {\n    switch (gender) {\n        case gender.man:\n            console.log('男性');\n            break;\n        case gender.woman:\n            console.log('女性');\n            break\n    }\n}\nisMan(gender.man)  //男性</pre><ol start=\"3\" class=\"ne-ol\"><li id=\"ud9b0e442\"><span class=\"ne-text\">为对象定义一些非私有的、但又希望只用于内部的方法。</span></li></ol><div class=\"ne-quote\" style=\"margin-left: 2em\"><p id=\"u375b8621\" class=\"ne-p\"><span class=\"ne-text\">由于以Symbol值作为键名，不会被常规方法遍历得到。我们可以利用这个特性，为对象定义一些非私有的、但又希望只用于内部的方法。</span></p><p id=\"u91f2d56b\" class=\"ne-p\"><span class=\"ne-text\">注意：Symbol并不能实现真正的私有变量的效果，只是不能通过常规的遍历方法拿到Symbol类型的属性而已。</span><strong><span class=\"ne-text\"></span></strong></p></div><p id=\"u47a54e0b\" class=\"ne-p\"><strong><span class=\"ne-text\">对象的遍历方法</span></strong><span class=\"ne-text\">：</span></p><ul class=\"ne-ul\"><li id=\"ue9a3f0f8\"><span class=\"ne-text\">for(let xx in obj)：i代表key</span></li><li id=\"u0b6ff3b5\"><span class=\"ne-text\">for(let xx of obj)：不是自带的</span></li><li id=\"u7e08b740\"><span class=\"ne-text\">Object.keys(obj)：返回包含的key的数组</span></li><li id=\"ua3870bab\"><span class=\"ne-text\">Object.values(obj)：返回包含value的数组</span></li><li id=\"ue8b94391\"><span class=\"ne-text\">Object.getOwnPropertyNames()：返回包含key的数组</span></li></ul><p id=\"uff9d61bc\" class=\"ne-p\"><span class=\"ne-text\">上述的所有方法都遍历不到Symbol类型的（注意：是遍历时取不到Symbol，并不是我们访问不到对象的Symbol类型）</span></p><p id=\"u39a24844\" class=\"ne-p\"><strong><span class=\"ne-text\">可以遍历到Symbol的方法：</span></strong></p><ul class=\"ne-ul\"><li id=\"ue6812e4e\"><strong><span class=\"ne-text\">Object.getOwnPropertySymbols()</span></strong><span class=\"ne-text\">：返回对象中只包含Symbol类型key的数组</span></li><li id=\"u8d1d2561\"><strong><span class=\"ne-text\">Reflect.ownKeys()</span></strong><span class=\"ne-text\">：返回对象中所有类型key的数组（包含Symbol）</span></li></ul><pre data-language=\"javascript\" id=\"b3zmv\" class=\"ne-codeblock language-javascript\">let _password = Symbol('password')\nconst obj = {\n    name: '小明',\n    gender: 'male',\n    [_password]: '11038'\n}\nfor (let item in obj) {\n    console.log(item);\n}\nconsole.log(Object.keys(obj));\nconsole.log(Object.values(obj));\nconsole.log(Object.getOwnPropertyNames(obj));\nconsole.log(Object.getOwnPropertySymbols(obj));\nconsole.log(Reflect.ownKeys(obj))\n// 输出11038，所以还是可以直接访问到symbol类型的属性，所以symbol并不能真正实现私有变量的设定，所以一般只用于定义一些非私有的、但又希望只用于内部的方法\nconsole.log(obj[_password]);</pre><p id=\"ub6d28c4f\" class=\"ne-p\"><span class=\"ne-text\">输出如下：</span></p><p id=\"u6f5cddec\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2022/png/2324645/1668653745915-fc9503cf-b3b8-4973-b078-26b09f69ba22.png\" width=\"275\" id=\"u196ca470\" class=\"ne-image\"></p><h3 id=\"wAmPW\"><span class=\"ne-text\">Symbol自带的方法</span></h3><h4 id=\"ZBbKp\"><span class=\"ne-text\">1. </span><code class=\"ne-code\"><span class=\"ne-text\">Symbol.for()</span></code></h4><p id=\"u8543ee7e\" class=\"ne-p\"><span class=\"ne-text\" style=\"text-decoration: underline\">重新使用同一个Symbol值。</span></p><p id=\"ue8a74dbc\" class=\"ne-p\"><span class=\"ne-text\">接收一个字符串作为参数，搜索是否有以该参数作为名称的Symbol值，如果有，就返回这个Symbol值，否则就新建一个以该字符串为名称的Symbol值，并将其注册到全局。</span></p><pre data-language=\"javascript\" id=\"d4Ilt\" class=\"ne-codeblock language-javascript\">let s1 = Symbol.for('foo');\nlet s2 = Symbol.for('foo');\n\ns1 === s2 // true</pre><h4 id=\"ezFW0\"><span class=\"ne-text\">2. </span><code class=\"ne-code\"><span class=\"ne-text\">Symbol.keyFor()</span></code></h4><p id=\"ue8538d75\" class=\"ne-p\"><span class=\"ne-text\" style=\"text-decoration: underline\">返回一个已登记的Symbol类型值的</span><code class=\"ne-code\"><span class=\"ne-text\" style=\"text-decoration: underline\">key</span></code><span class=\"ne-text\" style=\"text-decoration: underline\">。</span></p><p id=\"ua831422d\" class=\"ne-p\"><span class=\"ne-text\">由于</span><code class=\"ne-code\"><span class=\"ne-text\">Symbol()</span></code><span class=\"ne-text\">写法没有登记机制，所以每次调用都会返回一个不同的值。</span></p><pre data-language=\"javascript\" id=\"WTdtT\" class=\"ne-codeblock language-javascript\">let s1 = Symbol.for(&quot;foo&quot;);\nSymbol.keyFor(s1) // &quot;foo&quot;\n\nlet s2 = Symbol(&quot;foo&quot;);\nSymbol.keyFor(s2) // undefined</pre><h2 id=\"hZIrL\"><span class=\"ne-text\">Map和Object区别</span></h2><table id=\"gSZLR\" class=\"ne-table\" style=\"width: 579px\"><tbody><tr style=\"height: 33px\"><td width=\"193\"></td><td width=\"193\"><p id=\"u0c10bd72\" class=\"ne-p\"><span class=\"ne-text\">Map</span></p></td><td width=\"193\"><p id=\"u9adedb96\" class=\"ne-p\"><span class=\"ne-text\">Object</span></p></td></tr><tr style=\"height: 33px\"><td width=\"193\"><p id=\"u29c176ec\" class=\"ne-p\"><span class=\"ne-text\">意外的键</span></p></td><td width=\"193\"><p id=\"u3a8a62e7\" class=\"ne-p\"><span class=\"ne-text\">Map默认情况不包含任何键，只包含显式插入的键</span></p></td><td width=\"193\"><p id=\"ucac95cb2\" class=\"ne-p\"><span class=\"ne-text\">Object有一个原型，原型链上的键名有可能和自己在对象上设置的键名有冲突</span></p></td></tr><tr style=\"height: 33px\"><td width=\"193\"><p id=\"u1b8e415c\" class=\"ne-p\"><span class=\"ne-text\">键的类型</span></p></td><td width=\"193\"><p id=\"u594b9218\" class=\"ne-p\"><span class=\"ne-text\">Map的键可以是任意值，包括函数、对象或任意基本类型</span></p></td><td width=\"193\"><p id=\"u71c9a331\" class=\"ne-p\"><span class=\"ne-text\">Object的键必须是String或Symbol</span></p></td></tr><tr style=\"height: 33px\"><td width=\"193\"><p id=\"ua43fd71e\" class=\"ne-p\"><span class=\"ne-text\">键的顺序</span></p></td><td width=\"193\"><p id=\"u5ebbb823\" class=\"ne-p\"><span class=\"ne-text\">Map中的key是有序的。因此，当迭代的时候，Map对象以插入的顺序返回键值</span></p></td><td width=\"193\"><p id=\"u7f053dcb\" class=\"ne-p\"><span class=\"ne-text\">Object的键是无序的</span></p></td></tr><tr style=\"height: 33px\"><td width=\"193\"><p id=\"u1d5cefa1\" class=\"ne-p\"><span class=\"ne-text\">Size</span></p></td><td width=\"193\"><p id=\"uaebcc5cb\" class=\"ne-p\"><span class=\"ne-text\">Map的键值对个数可以轻易地通过size属性获取</span></p></td><td width=\"193\"><p id=\"u423d838d\" class=\"ne-p\"><span class=\"ne-text\">Object建值对个数只能手动计算</span></p></td></tr><tr style=\"height: 33px\"><td width=\"193\"><p id=\"u2e3c7b42\" class=\"ne-p\"><span class=\"ne-text\">迭代</span></p></td><td width=\"193\"><p id=\"u8d87dd99\" class=\"ne-p\"><span class=\"ne-text\">Map是iterable的，所以可以直接被迭代</span></p></td><td width=\"193\"><p id=\"ua3ad2d62\" class=\"ne-p\"><span class=\"ne-text\">迭代Object需要以某种方式获取它的键然后才能迭代</span></p></td></tr><tr style=\"height: 33px\"><td width=\"193\"><p id=\"u66e096f9\" class=\"ne-p\"><span class=\"ne-text\">性能</span></p></td><td width=\"193\"><p id=\"uc07f4794\" class=\"ne-p\"><span class=\"ne-text\">在频繁增删值对的场景下表现更好</span></p></td><td width=\"193\"><p id=\"ueaeee7be\" class=\"ne-p\"><span class=\"ne-text\">在频繁添加和删除键值对的场景下未做出优化</span></p></td></tr></tbody></table><h2 id=\"N2G8K\"><span class=\"ne-text\">Map和WeakMap区别</span></h2><h3 id=\"jjMeF\"><span class=\"ne-text\">Map </span></h3><p id=\"u69b54603\" class=\"ne-p\"><span class=\"ne-text\">本质上是键值对的集合，但是普通Object的中的键值只能是字符串。而ES6提供的数据结构类似于对象，但是它的键不限制范围，可以是任意类型，是一种更加完善的Hash结构。如果Map的键是一个原始数据类型，只要两个键严格相同，就视为是同一个键。</span></p><p id=\"u6571a952\" class=\"ne-p\"><span class=\"ne-text\">实际上是一个数组，它的每一个数据也就是一个数组，其形式如下：</span></p><pre data-language=\"javascript\" id=\"Czmyw\" class=\"ne-codeblock language-javascript\">const map = [\n  [&quot;name&quot;,&quot;张三&quot;],\n  [&quot;age&quot;,18],\n]</pre><p id=\"u5757c0e2\" class=\"ne-p\"><span class=\"ne-text\">Map数据结构有以下操作方法：</span></p><ul class=\"ne-ul\"><li id=\"u540be3ee\"><span class=\"ne-text\">size：map.size() 返回map结构的成员总数</span></li><li id=\"u8aef7ad9\"><span class=\"ne-text\">set(key,value)：设置键名key对应的键值value，然后返回整个Map结构，如果key已经有值，则键值会被更新，否则就生成该键。（因为返回的是当前Map对象，所以可以链式调用）</span></li><li id=\"u6eaf2244\"><span class=\"ne-text\">get(key)：该方法读取key对应的键值，如果找不到key，返回undefined</span></li><li id=\"ue2d3a94e\"><span class=\"ne-text\">has(key)：该方法返回一个布尔值，表示某个键是否在当前Map对象中。</span></li></ul><p id=\"udeba3e14\" class=\"ne-p\"><span class=\"ne-text\"></span></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"adapt\" /><meta name=\"paragraphSpacing\" content=\"relax\" /><p data-lake-id=\"u191f528d\" id=\"u191f528d\"><span data-lake-id=\"ubf0dab9f\" id=\"ubf0dab9f\">--- </span></p><p data-lake-id=\"uaabe2cf3\" id=\"uaabe2cf3\"><span data-lake-id=\"u60340cfc\" id=\"u60340cfc\">title: JS高频面试题 </span></p><p data-lake-id=\"u6da62028\" id=\"u6da62028\"><span data-lake-id=\"ua6aa27bd\" id=\"ua6aa27bd\">categories:  JS</span></p><p data-lake-id=\"u05972217\" id=\"u05972217\"><span data-lake-id=\"u2aa627f1\" id=\"u2aa627f1\">tags:  JS</span></p><p data-lake-id=\"ua7b72cc6\" id=\"ua7b72cc6\"><span data-lake-id=\"u5ab4e882\" id=\"u5ab4e882\">--- </span></p><h2 data-lake-id=\"ZolgE\" id=\"ZolgE\"><span data-lake-id=\"u4ed87c25\" id=\"u4ed87c25\">apply、call、bind的区别</span></h2><ul list=\"u07ec95a7\"><li fid=\"u39da92f1\" data-lake-id=\"u6bdab0b4\" id=\"u6bdab0b4\"><span data-lake-id=\"u14f3eb67\" id=\"u14f3eb67\">三者都可以改变函数的this对象指向</span></li><li fid=\"u39da92f1\" data-lake-id=\"udff3d079\" id=\"udff3d079\"><span data-lake-id=\"u4b30799f\" id=\"u4b30799f\">三者第一个参数都是this要指向的对象，如果如果没有这个参数或参数为undefined或null，则默认指向全局window</span></li><li fid=\"u39da92f1\" data-lake-id=\"uc34d297e\" id=\"uc34d297e\"><span data-lake-id=\"ua6ad47f5\" id=\"ua6ad47f5\">三者都可以传参，但是apply是数组，而call是参数列表，且apply和call是一次性传入参数，而bind可以分为多次传入</span></li><li fid=\"u39da92f1\" data-lake-id=\"uf1f6cdeb\" id=\"uf1f6cdeb\"><span data-lake-id=\"ufc1457f0\" id=\"ufc1457f0\">bind是返回绑定this之后的函数，需要手动执行函数，apply、call 则是立即执行</span></li></ul><h2 data-lake-id=\"yuKWf\" id=\"yuKWf\"><span data-lake-id=\"ua2630855\" id=\"ua2630855\">new操作符的实现原理</span></h2><p data-lake-id=\"u2e39dccc\" id=\"u2e39dccc\"><span data-lake-id=\"uf7a03099\" id=\"uf7a03099\">new操作符的执⾏过程：</span></p><p data-lake-id=\"u5fc8def3\" id=\"u5fc8def3\"><span data-lake-id=\"uefa723fe\" id=\"uefa723fe\">（1）⾸先创建了⼀个新的空对象</span></p><p data-lake-id=\"u91b99bd5\" id=\"u91b99bd5\"><span data-lake-id=\"u17e21575\" id=\"u17e21575\">（2）设置原型，将对象的原型设置为函数的 prototype 对象。</span></p><p data-lake-id=\"uc08c9e71\" id=\"uc08c9e71\"><span data-lake-id=\"uf5c63973\" id=\"uf5c63973\">（3）让函数的 this 指向这个对象，执⾏构造函数的代码（为这个新对象添加属性）</span></p><p data-lake-id=\"u5dd9eefa\" id=\"u5dd9eefa\"><span data-lake-id=\"uaba8e1a1\" id=\"uaba8e1a1\">（4）判断函数的返回值类型，如果是值类型，返回创建的对象。如果是引⽤类型，就返回这个引⽤类</span></p><p data-lake-id=\"u9e775328\" id=\"u9e775328\"><span data-lake-id=\"u4d7169f0\" id=\"u4d7169f0\">型的对象。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22function%20objectFactory()%20%7B%5Cnlet%20newObject%20%3D%20null%3B%5Cnlet%20constructor%20%3D%20Array.prototype.shift.call(arguments)%3B%5Cnlet%20result%20%3D%20null%3B%5Cn%2F%2F%20%E5%88%A4%E6%96%AD%E5%8F%82%E6%95%B0%E6%98%AF%E5%90%A6%E6%98%AF%E2%BC%80%E4%B8%AA%E5%87%BD%E6%95%B0%5Cnif%20(typeof%20constructor%20!%3D%3D%20%5C%22function%5C%22)%20%7B%5Cnconsole.error(%5C%22type%20error%5C%22)%3B%5Cnreturn%3B%5Cn%7D%5Cn%2F%2F%20%E6%96%B0%E5%BB%BA%E2%BC%80%E4%B8%AA%E7%A9%BA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8E%9F%E5%9E%8B%E4%B8%BA%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%20prototype%20%E5%AF%B9%E8%B1%A1%5CnnewObject%20%3D%20Object.create(constructor.prototype)%3B%5Cn%2F%2F%20%E5%B0%86%20this%20%E6%8C%87%E5%90%91%E6%96%B0%E5%BB%BA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%B9%B6%E6%89%A7%E2%BE%8F%E5%87%BD%E6%95%B0%5Cnresult%20%3D%20constructor.apply(newObject%2C%20arguments)%3B%5Cn%2F%2F%20%E5%88%A4%E6%96%AD%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%5Cnlet%20flag%20%3D%20result%20%26%26%20(typeof%20result%20%3D%3D%3D%20%5C%22object%5C%22%20%7C%7C%20typeof%20result%20%3D%3D%3D%5Cn%5C%22function%5C%22)%3B%5Cn%2F%2F%20%E5%88%A4%E6%96%AD%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%5Cnreturn%20flag%20%3F%20result%20%3A%20newObject%3B%5Cn%7D%5Cn%2F%2F%20%E4%BD%BF%E2%BD%A4%E2%BD%85%E6%B3%95%5CnobjectFactory(%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%2C%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%82%E6%95%B0)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22HxWQB%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h2 data-lake-id=\"EuRYC\" id=\"EuRYC\"><span data-lake-id=\"uae942fc9\" id=\"uae942fc9\">map()和foreach()的区别</span></h2><h3 data-lake-id=\"ogOb0\" id=\"ogOb0\"><span data-lake-id=\"ued1856aa\" id=\"ued1856aa\">简洁回答</span></h3><p data-lake-id=\"u7a3aea33\" id=\"u7a3aea33\"><span data-lake-id=\"ubcf5f5b6\" id=\"ubcf5f5b6\">都是⽤来遍历数组的，两者区别如下：</span></p><ul list=\"ud3e74295\"><li fid=\"u555dd7c7\" data-lake-id=\"u24f06412\" id=\"u24f06412\"><span data-lake-id=\"uda3e28c4\" id=\"uda3e28c4\">forEach()⽅法会针对每⼀个元素执⾏提供的函数，对数据的操作会改变原数组，该⽅法没有返回</span></li></ul><p data-lake-id=\"uaf7ac181\" id=\"uaf7ac181\"><span data-lake-id=\"u63b33eaf\" id=\"u63b33eaf\">值；</span></p><ul list=\"ud6f1821e\"><li fid=\"u17f5a1a7\" data-lake-id=\"u25e2e9ad\" id=\"u25e2e9ad\"><span data-lake-id=\"uf5e5e82e\" id=\"uf5e5e82e\">map()⽅法不会改变原数组的值，返回⼀个新数组，新数组中的值为原数组调⽤函数处理之后的</span></li></ul><p data-lake-id=\"u4eff17df\" id=\"u4eff17df\"><span data-lake-id=\"u95eaa78e\" id=\"u95eaa78e\">值；</span></p><h3 data-lake-id=\"LgnBg\" id=\"LgnBg\"><span data-lake-id=\"ua7d3a021\" id=\"ua7d3a021\">相同点</span></h3><ol list=\"u152663aa\"><li fid=\"u1b110533\" data-lake-id=\"uc81910d8\" id=\"uc81910d8\"><span data-lake-id=\"u233e51e3\" id=\"u233e51e3\">都是循环遍历数组的每一项</span></li><li fid=\"u1b110533\" data-lake-id=\"uc92e479b\" id=\"uc92e479b\"><span data-lake-id=\"u8573b682\" id=\"u8573b682\">都相当于封装好的单层for循环，三个值都相同</span></li><li fid=\"u1b110533\" data-lake-id=\"u5ede89bf\" id=\"u5ede89bf\"><span data-lake-id=\"uf445ca20\" id=\"uf445ca20\">每次执行匿名函数都支持三个参数，参数分别为item（当前每一项）、index（索引值）、arr（原数组）</span></li><li fid=\"u1b110533\" data-lake-id=\"ua6b771b6\" id=\"ua6b771b6\"><span data-lake-id=\"ua6990f34\" id=\"ua6990f34\">匿名函数中的this都是指向window</span></li><li fid=\"u1b110533\" data-lake-id=\"uc61e0fa0\" id=\"uc61e0fa0\"><span data-lake-id=\"u8cc432c0\" id=\"u8cc432c0\">只能遍历数组</span></li></ol><h3 data-lake-id=\"gJBw2\" id=\"gJBw2\"><span data-lake-id=\"ua62c8557\" id=\"ua62c8557\">不同点</span></h3><ul list=\"u1335ff5e\"><li fid=\"u97fc3c4e\" data-lake-id=\"uaa3c5be7\" id=\"uaa3c5be7\"><span data-lake-id=\"ubb200f28\" id=\"ubb200f28\">map()会分配内存空间存储新数组并有返回值，forEach()没有返回值</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"uc5dcb627\" id=\"uc5dcb627\"><span data-lake-id=\"u88a872e4\" id=\"u88a872e4\">forEach()允许calllback更改原始数组的元素，map()返回新的数组，map()不会对空数组进行检测</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"ub3699f29\" id=\"ub3699f29\"><span data-lake-id=\"u6f9b27d7\" id=\"u6f9b27d7\">forEach()遍历通常都是直接引入当前遍历数组的内存地址，生成的数组的值发生变化，当前遍历的数组对应的值也会发生变化。</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"uf52ca49a\" id=\"uf52ca49a\"><span data-lake-id=\"u827a391c\" id=\"u827a391c\">map遍历后的数组通常会生成一个新的数组，新数组的值发生变化，当前遍历的数组值不会变化。</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"ua05c9eab\" id=\"ua05c9eab\"><span data-lake-id=\"u6d7f55ad\" id=\"u6d7f55ad\">map的速度大于forEach</span></li></ul><h3 data-lake-id=\"qMAb9\" id=\"qMAb9\"><span data-lake-id=\"uf4f1bed0\" id=\"uf4f1bed0\">使用场景</span></h3><ol list=\"ua39ecbfd\"><li fid=\"uc5eb4a37\" data-lake-id=\"ua4984c5a\" id=\"ua4984c5a\"><span data-lake-id=\"u19f6e020\" id=\"u19f6e020\">forEach()适用于你并不打算改变数据的时候</span></li><li fid=\"uc5eb4a37\" data-lake-id=\"u1faeb043\" id=\"u1faeb043\"><span data-lake-id=\"u9261656d\" id=\"u9261656d\">map()适用于你要改变数据的时候。不仅在于它更快，而且返回一个新数组。（因此可以使用复合（composition）（map(),filter(),reduce()等组合使用））</span></li></ol><p data-lake-id=\"ub47a1f9b\" id=\"ub47a1f9b\"><span data-lake-id=\"u6400cd45\" id=\"u6400cd45\">性能上来说，for&gt;forEach&gt;map。</span></p><h2 data-lake-id=\"fNTcb\" id=\"fNTcb\"><span data-lake-id=\"udae3adf9\" id=\"udae3adf9\">Symbol</span></h2><ol list=\"u24991fc3\"><li fid=\"u6c32d8f1\" data-lake-id=\"u83c42b6d\" id=\"u83c42b6d\"><span data-lake-id=\"uf1ca22b3\" id=\"uf1ca22b3\">什么是Symbol？</span></li></ol><p data-lake-id=\"u4ba1b7d7\" id=\"u4ba1b7d7\" style=\"text-indent: 2em\"><span data-lake-id=\"u184c60ea\" id=\"u184c60ea\">Symbol是ES6新增的一种数据类型，被划分为</span><strong><span data-lake-id=\"u4290f69a\" id=\"u4290f69a\">基本数据类型</span></strong><span data-lake-id=\"ud5f52f5f\" id=\"ud5f52f5f\">。不能用 </span><code data-lake-id=\"u8c07b6e6\" id=\"u8c07b6e6\"><span data-lake-id=\"u3b0db586\" id=\"u3b0db586\">new</span></code><span data-lake-id=\"u75541d5e\" id=\"u75541d5e\">。</span></p><ul list=\"u5e2856f7\"><li fid=\"u6ccf7f8a\" data-lake-id=\"ua21ebc77\" id=\"ua21ebc77\"><span data-lake-id=\"ucc9cb7e6\" id=\"ucc9cb7e6\">基本数据类型：字符串、数值、布尔、undefined、null、Symbol。</span></li><li fid=\"u6ccf7f8a\" data-lake-id=\"u37091692\" id=\"u37091692\"><span data-lake-id=\"ubbbf09da\" id=\"ubbbf09da\">引用数据类型：Object</span></li></ul><ol list=\"u3b9dcdd7\" start=\"2\"><li fid=\"u8b96bea1\" data-lake-id=\"ua5c50a5a\" id=\"ua5c50a5a\"><span data-lake-id=\"uf8405b8c\" id=\"uf8405b8c\">作用</span></li></ol><p data-lake-id=\"u07e440cd\" id=\"u07e440cd\"><span data-lake-id=\"u23a49187\" id=\"u23a49187\">用来表示一个独一无二的值。</span></p><ol list=\"uf65cc4e4\" start=\"3\"><li fid=\"u796ac187\" data-lake-id=\"u8323c438\" id=\"u8323c438\"><span data-lake-id=\"u27940de6\" id=\"u27940de6\">格式：</span><code data-lake-id=\"u4a664624\" id=\"u4a664624\"><span data-lake-id=\"u1cdfe7ae\" id=\"u1cdfe7ae\">let xxx = Symbol('标识字符串')</span></code></li><li fid=\"u796ac187\" data-lake-id=\"u2c83ce55\" id=\"u2c83ce55\"><span data-lake-id=\"ue5686142\" id=\"ue5686142\">为什么需要Symbol？</span></li></ol><p data-lake-id=\"u1a3e155d\" id=\"u1a3e155d\" style=\"text-indent: 2em\"><span data-lake-id=\"u37301165\" id=\"u37301165\">为了避免第三方框框架的同名属性被覆盖。</span></p><blockquote data-lake-id=\"u6cdb980b\" id=\"u6cdb980b\" style=\"padding-left: 2em\"><p data-lake-id=\"ubf547b48\" id=\"ubf547b48\"><span data-lake-id=\"ue8037304\" id=\"ue8037304\">在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。</span></p></blockquote><ol list=\"ued0bdf73\" start=\"5\"><li fid=\"u2f3be6c2\" data-lake-id=\"u791b2d4b\" id=\"u791b2d4b\"><span data-lake-id=\"u23da1184\" id=\"u23da1184\">如果区分Symbol？</span></li></ol><p data-lake-id=\"u99726587\" id=\"u99726587\" style=\"text-indent: 2em\"><span data-lake-id=\"u01f4a6b3\" id=\"u01f4a6b3\">在通过Symbol生成一个独一无二的值时，可以设置一个标记</span></p><p data-lake-id=\"u59dd8786\" id=\"u59dd8786\" style=\"text-indent: 2em\"><span data-lake-id=\"u981044ac\" id=\"u981044ac\">这个标记仅仅用于区分，没有其他任何意义。</span></p><ol list=\"udc182035\" start=\"6\"><li fid=\"u8964f751\" data-lake-id=\"u8d6baf17\" id=\"u8d6baf17\"><span data-lake-id=\"u502922b4\" id=\"u502922b4\">如果特殊情况需要读取这个标记，</span></li></ol><ul list=\"uea6e2aec\"><li fid=\"uae9aadcd\" data-lake-id=\"ud73ce616\" id=\"ud73ce616\"><span data-lake-id=\"uc57cd015\" id=\"uc57cd015\">Symbol类型可以转化为boolean或字符串，转化为字符串时前面会加上Symbol(wxy)，不方便</span></li><li fid=\"uae9aadcd\" data-lake-id=\"ub5657a7d\" id=\"ub5657a7d\"><span data-lake-id=\"ub79e4f5b\" id=\"ub79e4f5b\">可以直接通过description属性获取Symbol函数的字符串标识参数</span></li></ul><ol list=\"u9dc85897\" start=\"7\"><li fid=\"uc78472fe\" data-lake-id=\"u76de8cd9\" id=\"u76de8cd9\"><span data-lake-id=\"u87225889\" id=\"u87225889\">使用Symbol类型作为属性名</span></li></ol><blockquote data-lake-id=\"u09282575\" id=\"u09282575\" style=\"padding-left: 2em\"><p data-lake-id=\"u84c1fe0a\" id=\"u84c1fe0a\"><span data-lake-id=\"u6fca0291\" id=\"u6fca0291\">对象的属性要么是字符串，要么是Symbol类型</span></p></blockquote><ul list=\"u27713a6c\"><li fid=\"u4e107979\" data-lake-id=\"u5f898a70\" id=\"u5f898a70\"><span data-lake-id=\"uf9426ce3\" id=\"uf9426ce3\">默认是字符串，所以不加</span><code data-lake-id=\"u410fb57d\" id=\"u410fb57d\"><span data-lake-id=\"ub52b0987\" id=\"ub52b0987\">&quot;&quot;</span></code><span data-lake-id=\"u31175675\" id=\"u31175675\">也可以；如果需要类型为Symbol，需要使用</span><code data-lake-id=\"ub4853563\" id=\"ub4853563\"><span data-lake-id=\"ubd388a31\" id=\"ubd388a31\">[]</span></code><span data-lake-id=\"u8e2b3a45\" id=\"u8e2b3a45\">。</span></li><li fid=\"u4e107979\" data-lake-id=\"u26b3983a\" id=\"u26b3983a\"><span data-lake-id=\"ud42b8d26\" id=\"ud42b8d26\">不能用</span><code data-lake-id=\"u52f4301e\" id=\"u52f4301e\"><span data-lake-id=\"ubd0df431\" id=\"ubd0df431\">.</span></code><span data-lake-id=\"ufd502dd0\" id=\"ufd502dd0\">来访问，因为点运算符后面总是字符串。</span></li><li fid=\"u4e107979\" data-lake-id=\"u8648d662\" id=\"u8648d662\"><span data-lake-id=\"ub4ecced6\" id=\"ub4ecced6\">Symbol值作为属性名时，该属性还是公开属性，不是私有属性。</span></li></ul><ol list=\"u033ef65e\" start=\"8\"><li fid=\"ub5b7f779\" data-lake-id=\"uad898f22\" id=\"uad898f22\"><span data-lake-id=\"u751c41ff\" id=\"u751c41ff\">例子：</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22%2F%2F%E5%90%8E%E9%9D%A2%E7%9A%84%E6%8B%AC%E5%8F%B7%E5%8F%AF%E4%BB%A5%E7%BB%99symbol%E5%81%9A%E4%B8%8A%E6%A0%87%E8%AE%B0%E4%BE%BF%E4%BA%8E%E8%AF%86%E5%88%AB%5Cnlet%20name%20%3D%20Symbol(%5C%22name%5C%22)%3B%5Cnlet%20say%20%3D%20Symbol(%5C%22say%5C%22)%3B%5Cnlet%20obj%20%3D%20%7B%5Cn%20%20%20%20%2F%2F%E5%A6%82%E6%9E%9C%E6%83%B3%20%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E4%BD%9C%E4%B8%BA%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E5%BF%85%E9%A1%BB%E5%8A%A0%E4%B8%8A%E4%B8%AD%E6%8B%AC%E5%8F%B7%EF%BC%8C.%E8%BF%90%E7%AE%97%E7%AC%A6%E5%90%8E%E9%9D%A2%E8%B7%9F%E7%9D%80%E7%9A%84%E9%83%BD%E6%98%AF%E5%AD%97%E7%AC%A6%E4%B8%B2%5Cn%20%20%20%20%5Bname%5D%3A%20%5C%22lnj%5C%22%2C%5Cn%20%20%20%20%5Bsay%5D%3A%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20console.log(%5C%22say%5C%22)%3B%5Cn%20%20%20%20%7D%2C%5Cn%20%20%20%20%2F%2F%20name%3A%20%5C%22rose%5C%22%2C%5Cn%7D%3B%5Cn%2F%2F%20obj.name%20%3D%20%5C%22it6661%5C%22%3B%5Cnobj%5BSymbol(%5C%22name%5C%22)%5D%20%3D%20%5C%22it666%5C%22%3B%5Cnconsole.log(obj)%3B%5Cnconsole.log(Reflect.ownKeys(obj))%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22KbTRx%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u5c458fbe\" id=\"u5c458fbe\"><p data-lake-id=\"uc4e8b106\" id=\"uc4e8b106\"><span data-lake-id=\"ufc96ae08\" id=\"ufc96ae08\">{</span></p><p data-lake-id=\"ub2bf8ae8\" id=\"ub2bf8ae8\"><span data-lake-id=\"u7ae59d0c\" id=\"u7ae59d0c\">  [Symbol(name)]: 'lnj',</span></p><p data-lake-id=\"u8a53f6f3\" id=\"u8a53f6f3\"><span data-lake-id=\"u0d8e88a2\" id=\"u0d8e88a2\">  [Symbol(say)]: [Function: [say]],</span></p><p data-lake-id=\"u8bf87a90\" id=\"u8bf87a90\"><span data-lake-id=\"uaf1b07ba\" id=\"uaf1b07ba\">  [Symbol(name)]: 'it666'</span></p><p data-lake-id=\"udf34f821\" id=\"udf34f821\"><span data-lake-id=\"uee640fc0\" id=\"uee640fc0\">}</span></p><p data-lake-id=\"uea186e60\" id=\"uea186e60\"><span data-lake-id=\"u0fc925f8\" id=\"u0fc925f8\">[ Symbol(name), Symbol(say), Symbol(name) ]</span></p></blockquote><p data-lake-id=\"u389f2d31\" id=\"u389f2d31\"><span data-lake-id=\"u6435f421\" id=\"u6435f421\">没有覆盖原来的name，因为都是独一无二的，那么就默认创建一个name的属性。</span></p><h3 data-lake-id=\"PKuqe\" id=\"PKuqe\"><span data-lake-id=\"u4d7d906f\" id=\"u4d7d906f\">注意点</span></h3><ol list=\"u0468c5db\"><li fid=\"u06497ca0\" data-lake-id=\"ud0d58967\" id=\"ud0d58967\"><span data-lake-id=\"u9415c704\" id=\"u9415c704\">Symbol是基本数据类型，不能加new</span></li><li fid=\"u06497ca0\" data-lake-id=\"u776509e4\" id=\"u776509e4\"><span data-lake-id=\"ue912a0a5\" id=\"ue912a0a5\">后面括号可以传入一个字符串，只是一个标记，方便阅读，没有任何意义。</span></li><li fid=\"u06497ca0\" data-lake-id=\"u7086a86c\" id=\"u7086a86c\"><span data-lake-id=\"u20f8ec19\" id=\"u20f8ec19\">类型转化的时候，不可转化为数值，只能转化为字符串和布尔值。</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22console.log(String(name))%3B%5Cnconsole.log(Boolean(name))%3B%5Cnconsole.log(Number(name))%3B%20%2F%2F%20Cannot%20convert%20a%20Symbol%20value%20to%20a%20number%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22cMRkp%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><ol list=\"u1fd64c61\" start=\"4\"><li fid=\"ubf28a9ce\" data-lake-id=\"u3fd16d74\" id=\"u3fd16d74\"><span data-lake-id=\"u033e53c7\" id=\"u033e53c7\">不能做任何运算</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%3DSymbol('name')%3B%5Cnconsole.log(name%2B111)%5Cnconsole.log(name%2B'ccc')%5Cn%2F%2F%E5%85%A8%E9%83%A8%E6%8A%A5%E9%94%99%20Cannot%20convert%20a%20Symbol%20value%20to%20a%20number%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22qAMCc%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><ol list=\"u0179c47e\" start=\"5\"><li fid=\"ufae85291\" data-lake-id=\"uce6a6007\" id=\"uce6a6007\"><span data-lake-id=\"u5b5148a7\" id=\"u5b5148a7\">Symbol生成的值作为属性或方法的时候，一定要保存下来，否则后续无法使用。</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%3DSymbol('name')%3B%5Cnlet%20obj%3D%7B%5Cn%20%20%2F%2F%20name%3A'lnj'%2C%5Cn%20%20%20%20%5BSymbol('name')%5D%3A'lbj'%5Cn%7D%5Cnconsole.log(obj.name)%3B%20%20%2F%2F%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0%EF%BC%8C%E5%9B%A0%E4%B8%BA%20%20%5BSymbol('name')%5D%E5%8F%88%E6%98%AF%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%80%BC%EF%BC%8C%E5%92%8C%E4%B8%8A%E9%9D%A2%E7%9A%84name%E4%B8%8D%E6%98%AF%E5%90%8C%E4%B8%80%E4%B8%AA%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22v77MM%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u7464468f\" id=\"u7464468f\"><span data-lake-id=\"u2cd67c21\" id=\"u2cd67c21\">应该改为如下：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%20%3D%20Symbol(%5C%22name%5C%22)%3B%5Cnlet%20obj%20%3D%20%7B%5Cn%20%20%20%20%5Bname%5D%3A%20%5C%22lnj1%5C%22%2C%5Cn%20%20%20%20%2F%2F%20%5BSymbol(%5C%22name%5C%22)%5D%3A%20%5C%22lbj%5C%22%2C%5Cn%7D%3B%5Cn%2F%2F%20console.log(obj.name)%3B%20%2F%2F%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0%EF%BC%8C%E5%9B%A0%E4%B8%BA%20%20%5BSymbol('name')%5D%E5%8F%88%E6%98%AF%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%80%BC%EF%BC%8C%E5%92%8C%E4%B8%8A%E9%9D%A2%E7%9A%84name%E4%B8%8D%E6%98%AF%E5%90%8C%E4%B8%80%E4%B8%AA%5Cnconsole.log(Reflect.ownKeys(obj))%3B%5Cnconsole.log(obj%5Bname%5D)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22kKMvX%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u6dbf2f19\" id=\"u6dbf2f19\"><p data-lake-id=\"ueee19c8f\" id=\"ueee19c8f\"><span data-lake-id=\"ufbc74536\" id=\"ufbc74536\">[ Symbol(name) ]</span></p><p data-lake-id=\"u21bead9f\" id=\"u21bead9f\"><span data-lake-id=\"ua7541ce2\" id=\"ua7541ce2\">lnj1</span></p></blockquote><ol list=\"ud9d45160\" start=\"6\"><li fid=\"u3137bd0f\" data-lake-id=\"u7a057185\" id=\"u7a057185\"><span data-lake-id=\"u10c54028\" id=\"u10c54028\">for循环遍历对象时无法遍历出Symbol的属性和方法</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%3DSymbol('name')%3B%5Cnlet%20obj%3D%7B%5Cn%20%20%5Bname%5D%3A'lnj'%2C%5Cn%20%20%20%20age%3A12%2C%5Cn%20%20%20%20teacher%3A'wyx'%5Cn%7D%5Cnfor(let%20key%20in%20obj)%7B%5Cn%20%20%20%20console.log(key)%20%20%20%2F%2F%E5%8F%AA%E8%83%BD%E6%89%93%E5%8D%B0%E5%87%BAage%E5%92%8Cteacher%5Cn%7D%5Cn%2F%2F%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%8F%AF%E4%BB%A5%E5%8D%95%E7%8B%AC%E5%8F%96%E5%87%BASymbol(name)%5Cnconsole.log(Object.getOwnPropertySymbols(obj))%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22ikBuz%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h3 data-lake-id=\"bRIp6\" id=\"bRIp6\"><span data-lake-id=\"u254abb34\" id=\"u254abb34\">Symbol的应用</span></h3><ol list=\"u690f0e57\"><li fid=\"ua112d1bd\" data-lake-id=\"u4e1ec221\" id=\"u4e1ec221\"><span data-lake-id=\"u889ee668\" id=\"u889ee668\">在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。</span></li><li fid=\"ua112d1bd\" data-lake-id=\"ub601210a\" id=\"ub601210a\"><span data-lake-id=\"u6cc20519\" id=\"u6cc20519\">消除魔术字符串</span></li></ol><blockquote data-lake-id=\"u40d13c63\" id=\"u40d13c63\" style=\"padding-left: 2em\"><p data-lake-id=\"u8d0c3fa6\" id=\"u8d0c3fa6\"><span data-lake-id=\"ub70b59c8\" id=\"ub70b59c8\">魔术字符串：在代码中多次出现，与代码形成强耦合的某一个具体的字符串或数值。风格良好的代码应该尽量消除魔术字符串，改由含义清晰的变量代替。‘</span></p></blockquote><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22const%20gender%20%3D%20%7B%5Cn%20%20%20%2F%2F%E8%BF%99%E6%A0%B7%E5%B0%B1%E8%AF%B4%E6%98%8Eman%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E7%8B%AC%E4%B8%80%E6%97%A0%E4%BA%8C%E7%9A%84%E5%80%BC%EF%BC%8C%E4%B8%8D%E7%94%A8%E5%86%8Dman%3A'man'%20%20%20%5Cn%20%20%20%20man%3A%20Symbol()%2C%5Cn%20%20%20%20woman%3A%20Symbol()%2C%5Cn%7D%5Cnfunction%20isMan(gender)%20%7B%5Cn%20%20%20%20switch%20(gender)%20%7B%5Cn%20%20%20%20%20%20%20%20case%20gender.man%3A%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.log('%E7%94%B7%E6%80%A7')%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20break%3B%5Cn%20%20%20%20%20%20%20%20case%20gender.woman%3A%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.log('%E5%A5%B3%E6%80%A7')%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20break%5Cn%20%20%20%20%7D%5Cn%7D%5CnisMan(gender.man)%20%20%2F%2F%E7%94%B7%E6%80%A7%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22GChhH%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><ol list=\"u25135ff0\" start=\"3\"><li fid=\"uc96c0670\" data-lake-id=\"ud9b0e442\" id=\"ud9b0e442\"><span data-lake-id=\"u9f71b790\" id=\"u9f71b790\">为对象定义一些非私有的、但又希望只用于内部的方法。</span></li></ol><blockquote data-lake-id=\"u0cda45e7\" id=\"u0cda45e7\" style=\"padding-left: 2em\"><p data-lake-id=\"u375b8621\" id=\"u375b8621\"><span data-lake-id=\"u58ade380\" id=\"u58ade380\">由于以Symbol值作为键名，不会被常规方法遍历得到。我们可以利用这个特性，为对象定义一些非私有的、但又希望只用于内部的方法。</span></p><p data-lake-id=\"u91f2d56b\" id=\"u91f2d56b\"><span data-lake-id=\"ud5c0b71c\" id=\"ud5c0b71c\">注意：Symbol并不能实现真正的私有变量的效果，只是不能通过常规的遍历方法拿到Symbol类型的属性而已。</span><strong><span data-lake-id=\"u487e0ee4\" id=\"u487e0ee4\">​</span></strong></p></blockquote><p data-lake-id=\"u47a54e0b\" id=\"u47a54e0b\"><strong><span data-lake-id=\"u33b230ef\" id=\"u33b230ef\">对象的遍历方法</span></strong><span data-lake-id=\"u84cc2fa9\" id=\"u84cc2fa9\">：</span></p><ul list=\"u33021964\"><li fid=\"u5f914a62\" data-lake-id=\"ue9a3f0f8\" id=\"ue9a3f0f8\"><span data-lake-id=\"u22d3926f\" id=\"u22d3926f\">for(let xx in obj)：i代表key</span></li><li fid=\"u5f914a62\" data-lake-id=\"u0b6ff3b5\" id=\"u0b6ff3b5\"><span data-lake-id=\"u25b6d72f\" id=\"u25b6d72f\">for(let xx of obj)：不是自带的</span></li><li fid=\"u5f914a62\" data-lake-id=\"u7e08b740\" id=\"u7e08b740\"><span data-lake-id=\"u6b135041\" id=\"u6b135041\">Object.keys(obj)：返回包含的key的数组</span></li><li fid=\"u5f914a62\" data-lake-id=\"ua3870bab\" id=\"ua3870bab\"><span data-lake-id=\"u94700e14\" id=\"u94700e14\">Object.values(obj)：返回包含value的数组</span></li><li fid=\"u5f914a62\" data-lake-id=\"ue8b94391\" id=\"ue8b94391\"><span data-lake-id=\"u84a512a2\" id=\"u84a512a2\">Object.getOwnPropertyNames()：返回包含key的数组</span></li></ul><p data-lake-id=\"uff9d61bc\" id=\"uff9d61bc\"><span data-lake-id=\"u70a70ea9\" id=\"u70a70ea9\">上述的所有方法都遍历不到Symbol类型的（注意：是遍历时取不到Symbol，并不是我们访问不到对象的Symbol类型）</span></p><p data-lake-id=\"u39a24844\" id=\"u39a24844\"><strong><span data-lake-id=\"u37837acd\" id=\"u37837acd\">可以遍历到Symbol的方法：</span></strong></p><ul list=\"u5bd44c7d\"><li fid=\"u5d780946\" data-lake-id=\"ue6812e4e\" id=\"ue6812e4e\"><strong><span data-lake-id=\"u96d15dc6\" id=\"u96d15dc6\">Object.getOwnPropertySymbols()</span></strong><span data-lake-id=\"u498cca83\" id=\"u498cca83\">：返回对象中只包含Symbol类型key的数组</span></li><li fid=\"u5d780946\" data-lake-id=\"u8d1d2561\" id=\"u8d1d2561\"><strong><span data-lake-id=\"u29f2b4c5\" id=\"u29f2b4c5\">Reflect.ownKeys()</span></strong><span data-lake-id=\"u27791941\" id=\"u27791941\">：返回对象中所有类型key的数组（包含Symbol）</span></li></ul><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20_password%20%3D%20Symbol('password')%5Cnconst%20obj%20%3D%20%7B%5Cn%20%20%20%20name%3A%20'%E5%B0%8F%E6%98%8E'%2C%5Cn%20%20%20%20gender%3A%20'male'%2C%5Cn%20%20%20%20%5B_password%5D%3A%20'11038'%5Cn%7D%5Cnfor%20(let%20item%20in%20obj)%20%7B%5Cn%20%20%20%20console.log(item)%3B%5Cn%7D%5Cnconsole.log(Object.keys(obj))%3B%5Cnconsole.log(Object.values(obj))%3B%5Cnconsole.log(Object.getOwnPropertyNames(obj))%3B%5Cnconsole.log(Object.getOwnPropertySymbols(obj))%3B%5Cnconsole.log(Reflect.ownKeys(obj))%5Cn%2F%2F%20%E8%BE%93%E5%87%BA11038%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%98%E6%98%AF%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%E5%88%B0symbol%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7%EF%BC%8C%E6%89%80%E4%BB%A5symbol%E5%B9%B6%E4%B8%8D%E8%83%BD%E7%9C%9F%E6%AD%A3%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E7%9A%84%E8%AE%BE%E5%AE%9A%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%80%E8%88%AC%E5%8F%AA%E7%94%A8%E4%BA%8E%E5%AE%9A%E4%B9%89%E4%B8%80%E4%BA%9B%E9%9D%9E%E7%A7%81%E6%9C%89%E7%9A%84%E3%80%81%E4%BD%86%E5%8F%88%E5%B8%8C%E6%9C%9B%E5%8F%AA%E7%94%A8%E4%BA%8E%E5%86%85%E9%83%A8%E7%9A%84%E6%96%B9%E6%B3%95%5Cnconsole.log(obj%5B_password%5D)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22b3zmv%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"ub6d28c4f\" id=\"ub6d28c4f\"><span data-lake-id=\"udcb2079f\" id=\"udcb2079f\">输出如下：</span></p><p data-lake-id=\"u6f5cddec\" id=\"u6f5cddec\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F2324645%2F1668653745915-fc9503cf-b3b8-4973-b078-26b09f69ba22.png%22%2C%22taskId%22%3A%22uda6b3e15-79e2-4aa7-982d-49fe7eb8eb8%22%2C%22clientId%22%3A%22u2b09cbdb-2331-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A275%2C%22height%22%3A116%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A46307%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A583%2C%22originHeight%22%3A245%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22NAME%20GENDER%20I%20GENDER%20NAME%20%E5%B0%8F%E6%98%8E%20MALE%20LI%20'GENDER'%20NAME%20SYMBOL(PASSWORD)%20SYMBOL(PASSWORD)%20%5D%20'GENDER'%20NAME%2011038%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A17.835613%2C%22y%22%3A10.28653%2C%22width%22%3A56.185383%2C%22height%22%3A16.532913%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A16.404135%2C%22y%22%3A39.320583%2C%22width%22%3A88.48623500000001%2C%22height%22%3A21.397437000000004%2C%22text%22%3A%22GENDER%22%7D%2C%7B%22x%22%3A283.29572%2C%22y%22%3A63.699017%2C%22width%22%3A13.722409999999968%2C%22height%22%3A33.523523%2C%22text%22%3A%22I%22%7D%2C%7B%22x%22%3A169.04576%2C%22y%22%3A65.59649%2C%22width%22%3A90.67936999999998%2C%22height%22%3A28.280149999999992%2C%22text%22%3A%22GENDER%22%7D%2C%7B%22x%22%3A59.44093%2C%22y%22%3A71.73817%2C%22width%22%3A57.067060000000005%2C%22height%22%3A17.633496000000008%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A56.391617%2C%22y%22%3A92.70355%2C%22width%22%3A64.32137300000001%2C%22height%22%3A29.49544999999999%2C%22text%22%3A%22%E5%B0%8F%E6%98%8E%22%7D%2C%7B%22x%22%3A169.89551%2C%22y%22%3A97.78831%2C%22width%22%3A60.10534000000001%2C%22height%22%3A22.076800000000006%2C%22text%22%3A%22MALE%22%7D%2C%7B%22x%22%3A283.78152%2C%22y%22%3A127.35834%2C%22width%22%3A13.303110000000004%2C%22height%22%3A58.46708000000001%2C%22text%22%3A%22LI%22%7D%2C%7B%22x%22%3A166.38359%2C%22y%22%3A127.61558%2C%22width%22%3A96.13987999999998%2C%22height%22%3A26.898140000000012%2C%22text%22%3A%22'GENDER'%22%7D%2C%7B%22x%22%3A58.253582%2C%22y%22%3A132.58513%2C%22width%22%3A59.170162%2C%22height%22%3A17.249590000000012%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A45.125946%2C%22y%22%3A156.71448%2C%22width%22%3A221.192454%2C%22height%22%3A28.156199999999984%2C%22text%22%3A%22SYMBOL(PASSWORD)%22%7D%2C%7B%22x%22%3A295.69482%2C%22y%22%3A186.42665%2C%22width%22%3A255.91798%2C%22height%22%3A30.39458000000002%2C%22text%22%3A%22SYMBOL(PASSWORD)%20%5D%22%7D%2C%7B%22x%22%3A164.94514%2C%22y%22%3A189.3633%2C%22width%22%3A100.78666000000001%2C%22height%22%3A25.321739999999977%2C%22text%22%3A%22'GENDER'%22%7D%2C%7B%22x%22%3A59.025814%2C%22y%22%3A192.88441%2C%22width%22%3A68.091286%2C%22height%22%3A19.300389999999993%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A17.268585%2C%22y%22%3A220.85193%2C%22width%22%3A72.02459%2C%22height%22%3A21.05176%2C%22text%22%3A%2211038%22%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23212121%22%2C%22id%22%3A%22u196ca470%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><h3 data-lake-id=\"wAmPW\" id=\"wAmPW\"><span data-lake-id=\"ucd1e1ca2\" id=\"ucd1e1ca2\">Symbol自带的方法</span></h3><h4 data-lake-id=\"ZBbKp\" id=\"ZBbKp\"><span data-lake-id=\"u68018dfd\" id=\"u68018dfd\">1. </span><code data-lake-id=\"u14edd727\" id=\"u14edd727\"><span data-lake-id=\"udb77d3db\" id=\"udb77d3db\">Symbol.for()</span></code></h4><p data-lake-id=\"u8543ee7e\" id=\"u8543ee7e\"><u><span data-lake-id=\"u496a72a9\" id=\"u496a72a9\">重新使用同一个Symbol值。</span></u></p><p data-lake-id=\"ue8a74dbc\" id=\"ue8a74dbc\"><span data-lake-id=\"ue0b30960\" id=\"ue0b30960\">接收一个字符串作为参数，搜索是否有以该参数作为名称的Symbol值，如果有，就返回这个Symbol值，否则就新建一个以该字符串为名称的Symbol值，并将其注册到全局。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20s1%20%3D%20Symbol.for('foo')%3B%5Cnlet%20s2%20%3D%20Symbol.for('foo')%3B%5Cn%5Cns1%20%3D%3D%3D%20s2%20%2F%2F%20true%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22d4Ilt%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h4 data-lake-id=\"ezFW0\" id=\"ezFW0\"><span data-lake-id=\"u9bebd769\" id=\"u9bebd769\">2. </span><code data-lake-id=\"u39070501\" id=\"u39070501\"><span data-lake-id=\"u6ff855c9\" id=\"u6ff855c9\">Symbol.keyFor()</span></code></h4><p data-lake-id=\"ue8538d75\" id=\"ue8538d75\"><u><span data-lake-id=\"u7cfa2fb1\" id=\"u7cfa2fb1\">返回一个已登记的Symbol类型值的</span></u><code data-lake-id=\"u87fab790\" id=\"u87fab790\"><u><span data-lake-id=\"ufa16d82e\" id=\"ufa16d82e\">key</span></u></code><u><span data-lake-id=\"u3c6f78ad\" id=\"u3c6f78ad\">。</span></u></p><p data-lake-id=\"ua831422d\" id=\"ua831422d\"><span data-lake-id=\"udc6f6145\" id=\"udc6f6145\">由于</span><code data-lake-id=\"ud99e8e29\" id=\"ud99e8e29\"><span data-lake-id=\"ua1479a57\" id=\"ua1479a57\">Symbol()</span></code><span data-lake-id=\"u13d195cd\" id=\"u13d195cd\">写法没有登记机制，所以每次调用都会返回一个不同的值。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20s1%20%3D%20Symbol.for(%5C%22foo%5C%22)%3B%5CnSymbol.keyFor(s1)%20%2F%2F%20%5C%22foo%5C%22%5Cn%5Cnlet%20s2%20%3D%20Symbol(%5C%22foo%5C%22)%3B%5CnSymbol.keyFor(s2)%20%2F%2F%20undefined%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22WTdtT%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h2 data-lake-id=\"hZIrL\" id=\"hZIrL\"><span data-lake-id=\"u372e1139\" id=\"u372e1139\">Map和Object区别</span></h2><table data-lake-id=\"gSZLR\" id=\"gSZLR\" width-mode=\"contain\" class=\"lake-table\" style=\"width: 579px\"><colgroup><col width=\"193\"><col width=\"193\"><col width=\"193\"></colgroup><tbody><tr data-lake-id=\"uaf5debc6\" id=\"uaf5debc6\"><td data-lake-id=\"ufd1ec073\" id=\"ufd1ec073\"></td><td data-lake-id=\"u389f0dd3\" id=\"u389f0dd3\"><p data-lake-id=\"u0c10bd72\" id=\"u0c10bd72\"><span data-lake-id=\"u5667c347\" id=\"u5667c347\">Map</span></p></td><td data-lake-id=\"u36a27eb3\" id=\"u36a27eb3\"><p data-lake-id=\"u9adedb96\" id=\"u9adedb96\"><span data-lake-id=\"u00f1095e\" id=\"u00f1095e\">Object</span></p></td></tr><tr data-lake-id=\"ue417e838\" id=\"ue417e838\"><td data-lake-id=\"u20819286\" id=\"u20819286\"><p data-lake-id=\"u29c176ec\" id=\"u29c176ec\"><span data-lake-id=\"u24bd2d31\" id=\"u24bd2d31\">意外的键</span></p></td><td data-lake-id=\"u75a7848e\" id=\"u75a7848e\"><p data-lake-id=\"u3a8a62e7\" id=\"u3a8a62e7\"><span data-lake-id=\"u9d088a5a\" id=\"u9d088a5a\">Map默认情况不包含任何键，只包含显式插入的键</span></p></td><td data-lake-id=\"ue1410836\" id=\"ue1410836\"><p data-lake-id=\"ucac95cb2\" id=\"ucac95cb2\"><span data-lake-id=\"u19aefccb\" id=\"u19aefccb\">Object有一个原型，原型链上的键名有可能和自己在对象上设置的键名有冲突</span></p></td></tr><tr data-lake-id=\"u1a0f1e6d\" id=\"u1a0f1e6d\"><td data-lake-id=\"u1f2b22b2\" id=\"u1f2b22b2\"><p data-lake-id=\"u1b8e415c\" id=\"u1b8e415c\"><span data-lake-id=\"ud40afe98\" id=\"ud40afe98\">键的类型</span></p></td><td data-lake-id=\"ucf23afea\" id=\"ucf23afea\"><p data-lake-id=\"u594b9218\" id=\"u594b9218\"><span data-lake-id=\"ua6ba2bb4\" id=\"ua6ba2bb4\">Map的键可以是任意值，包括函数、对象或任意基本类型</span></p></td><td data-lake-id=\"ub64fdfa4\" id=\"ub64fdfa4\"><p data-lake-id=\"u71c9a331\" id=\"u71c9a331\"><span data-lake-id=\"u165d0d3e\" id=\"u165d0d3e\">Object的键必须是String或Symbol</span></p></td></tr><tr data-lake-id=\"uce020e25\" id=\"uce020e25\"><td data-lake-id=\"u1cc54bf8\" id=\"u1cc54bf8\"><p data-lake-id=\"ua43fd71e\" id=\"ua43fd71e\"><span data-lake-id=\"u13bb6651\" id=\"u13bb6651\">键的顺序</span></p></td><td data-lake-id=\"ua35dccce\" id=\"ua35dccce\"><p data-lake-id=\"u5ebbb823\" id=\"u5ebbb823\"><span data-lake-id=\"u77ae10d1\" id=\"u77ae10d1\">Map中的key是有序的。因此，当迭代的时候，Map对象以插入的顺序返回键值</span></p></td><td data-lake-id=\"ua99c70a3\" id=\"ua99c70a3\"><p data-lake-id=\"u7f053dcb\" id=\"u7f053dcb\"><span data-lake-id=\"u424d2085\" id=\"u424d2085\">Object的键是无序的</span></p></td></tr><tr data-lake-id=\"u327109fb\" id=\"u327109fb\"><td data-lake-id=\"u2535e53c\" id=\"u2535e53c\"><p data-lake-id=\"u1d5cefa1\" id=\"u1d5cefa1\"><span data-lake-id=\"u6ff489d3\" id=\"u6ff489d3\">Size</span></p></td><td data-lake-id=\"u7ef72b8f\" id=\"u7ef72b8f\"><p data-lake-id=\"uaebcc5cb\" id=\"uaebcc5cb\"><span data-lake-id=\"ue4ed139b\" id=\"ue4ed139b\">Map的键值对个数可以轻易地通过size属性获取</span></p></td><td data-lake-id=\"ua99f76a9\" id=\"ua99f76a9\"><p data-lake-id=\"u423d838d\" id=\"u423d838d\"><span data-lake-id=\"u53123bba\" id=\"u53123bba\">Object建值对个数只能手动计算</span></p></td></tr><tr data-lake-id=\"u7db24806\" id=\"u7db24806\"><td data-lake-id=\"u909bcfcd\" id=\"u909bcfcd\"><p data-lake-id=\"u2e3c7b42\" id=\"u2e3c7b42\"><span data-lake-id=\"ubf18bb7c\" id=\"ubf18bb7c\">迭代</span></p></td><td data-lake-id=\"u8b5da74f\" id=\"u8b5da74f\"><p data-lake-id=\"u8d87dd99\" id=\"u8d87dd99\"><span data-lake-id=\"u59fa0589\" id=\"u59fa0589\">Map是iterable的，所以可以直接被迭代</span></p></td><td data-lake-id=\"u735ea899\" id=\"u735ea899\"><p data-lake-id=\"ua3ad2d62\" id=\"ua3ad2d62\"><span data-lake-id=\"u2615f875\" id=\"u2615f875\">迭代Object需要以某种方式获取它的键然后才能迭代</span></p></td></tr><tr data-lake-id=\"u9256710a\" id=\"u9256710a\"><td data-lake-id=\"u86ce7bfc\" id=\"u86ce7bfc\"><p data-lake-id=\"u66e096f9\" id=\"u66e096f9\"><span data-lake-id=\"u8a9a3e79\" id=\"u8a9a3e79\">性能</span></p></td><td data-lake-id=\"u809c04f7\" id=\"u809c04f7\"><p data-lake-id=\"uc07f4794\" id=\"uc07f4794\"><span data-lake-id=\"ue0f90096\" id=\"ue0f90096\">在频繁增删值对的场景下表现更好</span></p></td><td data-lake-id=\"u36fccccd\" id=\"u36fccccd\"><p data-lake-id=\"ueaeee7be\" id=\"ueaeee7be\"><span data-lake-id=\"u0e5888ce\" id=\"u0e5888ce\">在频繁添加和删除键值对的场景下未做出优化</span></p></td></tr></tbody></table><h2 data-lake-id=\"N2G8K\" id=\"N2G8K\"><span data-lake-id=\"u6ca8cd4b\" id=\"u6ca8cd4b\">Map和WeakMap区别</span></h2><h3 data-lake-id=\"jjMeF\" id=\"jjMeF\"><span data-lake-id=\"u6931846b\" id=\"u6931846b\">Map </span></h3><p data-lake-id=\"u69b54603\" id=\"u69b54603\"><span data-lake-id=\"ue01b1f22\" id=\"ue01b1f22\">本质上是键值对的集合，但是普通Object的中的键值只能是字符串。而ES6提供的数据结构类似于对象，但是它的键不限制范围，可以是任意类型，是一种更加完善的Hash结构。如果Map的键是一个原始数据类型，只要两个键严格相同，就视为是同一个键。</span></p><p data-lake-id=\"u6571a952\" id=\"u6571a952\"><span data-lake-id=\"u5cce6b8d\" id=\"u5cce6b8d\">实际上是一个数组，它的每一个数据也就是一个数组，其形式如下：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22const%20map%20%3D%20%5B%5Cn%20%20%5B%5C%22name%5C%22%2C%5C%22%E5%BC%A0%E4%B8%89%5C%22%5D%2C%5Cn%20%20%5B%5C%22age%5C%22%2C18%5D%2C%5Cn%5D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22Czmyw%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u5757c0e2\" id=\"u5757c0e2\"><span data-lake-id=\"ubc4c3d31\" id=\"ubc4c3d31\">Map数据结构有以下操作方法：</span></p><ul list=\"uf92b910b\"><li fid=\"ub4b02301\" data-lake-id=\"u540be3ee\" id=\"u540be3ee\"><span data-lake-id=\"ue4983cdb\" id=\"ue4983cdb\">size：map.size() 返回map结构的成员总数</span></li><li fid=\"ub4b02301\" data-lake-id=\"u8aef7ad9\" id=\"u8aef7ad9\"><span data-lake-id=\"u18725609\" id=\"u18725609\">set(key,value)：设置键名key对应的键值value，然后返回整个Map结构，如果key已经有值，则键值会被更新，否则就生成该键。（因为返回的是当前Map对象，所以可以链式调用）</span></li><li fid=\"ub4b02301\" data-lake-id=\"u6eaf2244\" id=\"u6eaf2244\"><span data-lake-id=\"u28d3dd8e\" id=\"u28d3dd8e\">get(key)：该方法读取key对应的键值，如果找不到key，返回undefined</span></li><li fid=\"ub4b02301\" data-lake-id=\"ue2d3a94e\" id=\"ue2d3a94e\"><span data-lake-id=\"ud35ef554\" id=\"ud35ef554\">has(key)：该方法返回一个布尔值，表示某个键是否在当前Map对象中。</span></li></ul><p data-lake-id=\"udeba3e14\" id=\"udeba3e14\"><span data-lake-id=\"u703b4c63\" id=\"u703b4c63\">​</span><br></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"adapt\" /><meta name=\"paragraphSpacing\" content=\"relax\" /><p data-lake-id=\"u191f528d\" id=\"u191f528d\"><span data-lake-id=\"ubf0dab9f\" id=\"ubf0dab9f\">--- </span></p><p data-lake-id=\"uaabe2cf3\" id=\"uaabe2cf3\"><span data-lake-id=\"u60340cfc\" id=\"u60340cfc\">title: JS高频面试题 </span></p><p data-lake-id=\"u6da62028\" id=\"u6da62028\"><span data-lake-id=\"ua6aa27bd\" id=\"ua6aa27bd\">categories:  JS</span></p><p data-lake-id=\"u05972217\" id=\"u05972217\"><span data-lake-id=\"u2aa627f1\" id=\"u2aa627f1\">tags:  JS</span></p><p data-lake-id=\"ua7b72cc6\" id=\"ua7b72cc6\"><span data-lake-id=\"u5ab4e882\" id=\"u5ab4e882\">--- </span></p><h2 data-lake-id=\"ZolgE\" id=\"ZolgE\"><span data-lake-id=\"u4ed87c25\" id=\"u4ed87c25\">apply、call、bind的区别</span></h2><ul list=\"u07ec95a7\"><li fid=\"u39da92f1\" data-lake-id=\"u6bdab0b4\" id=\"u6bdab0b4\"><span data-lake-id=\"u14f3eb67\" id=\"u14f3eb67\">三者都可以改变函数的this对象指向</span></li><li fid=\"u39da92f1\" data-lake-id=\"udff3d079\" id=\"udff3d079\"><span data-lake-id=\"u4b30799f\" id=\"u4b30799f\">三者第一个参数都是this要指向的对象，如果如果没有这个参数或参数为undefined或null，则默认指向全局window</span></li><li fid=\"u39da92f1\" data-lake-id=\"uc34d297e\" id=\"uc34d297e\"><span data-lake-id=\"ua6ad47f5\" id=\"ua6ad47f5\">三者都可以传参，但是apply是数组，而call是参数列表，且apply和call是一次性传入参数，而bind可以分为多次传入</span></li><li fid=\"u39da92f1\" data-lake-id=\"uf1f6cdeb\" id=\"uf1f6cdeb\"><span data-lake-id=\"ufc1457f0\" id=\"ufc1457f0\">bind是返回绑定this之后的函数，需要手动执行函数，apply、call 则是立即执行</span></li></ul><h2 data-lake-id=\"yuKWf\" id=\"yuKWf\"><span data-lake-id=\"ua2630855\" id=\"ua2630855\">new操作符的实现原理</span></h2><p data-lake-id=\"u2e39dccc\" id=\"u2e39dccc\"><span data-lake-id=\"uf7a03099\" id=\"uf7a03099\">new操作符的执⾏过程：</span></p><p data-lake-id=\"u5fc8def3\" id=\"u5fc8def3\"><span data-lake-id=\"uefa723fe\" id=\"uefa723fe\">（1）⾸先创建了⼀个新的空对象</span></p><p data-lake-id=\"u91b99bd5\" id=\"u91b99bd5\"><span data-lake-id=\"u17e21575\" id=\"u17e21575\">（2）设置原型，将对象的原型设置为函数的 prototype 对象。</span></p><p data-lake-id=\"uc08c9e71\" id=\"uc08c9e71\"><span data-lake-id=\"uf5c63973\" id=\"uf5c63973\">（3）让函数的 this 指向这个对象，执⾏构造函数的代码（为这个新对象添加属性）</span></p><p data-lake-id=\"u5dd9eefa\" id=\"u5dd9eefa\"><span data-lake-id=\"uaba8e1a1\" id=\"uaba8e1a1\">（4）判断函数的返回值类型，如果是值类型，返回创建的对象。如果是引⽤类型，就返回这个引⽤类</span></p><p data-lake-id=\"u9e775328\" id=\"u9e775328\"><span data-lake-id=\"u4d7169f0\" id=\"u4d7169f0\">型的对象。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22function%20objectFactory()%20%7B%5Cnlet%20newObject%20%3D%20null%3B%5Cnlet%20constructor%20%3D%20Array.prototype.shift.call(arguments)%3B%5Cnlet%20result%20%3D%20null%3B%5Cn%2F%2F%20%E5%88%A4%E6%96%AD%E5%8F%82%E6%95%B0%E6%98%AF%E5%90%A6%E6%98%AF%E2%BC%80%E4%B8%AA%E5%87%BD%E6%95%B0%5Cnif%20(typeof%20constructor%20!%3D%3D%20%5C%22function%5C%22)%20%7B%5Cnconsole.error(%5C%22type%20error%5C%22)%3B%5Cnreturn%3B%5Cn%7D%5Cn%2F%2F%20%E6%96%B0%E5%BB%BA%E2%BC%80%E4%B8%AA%E7%A9%BA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8E%9F%E5%9E%8B%E4%B8%BA%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%20prototype%20%E5%AF%B9%E8%B1%A1%5CnnewObject%20%3D%20Object.create(constructor.prototype)%3B%5Cn%2F%2F%20%E5%B0%86%20this%20%E6%8C%87%E5%90%91%E6%96%B0%E5%BB%BA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%B9%B6%E6%89%A7%E2%BE%8F%E5%87%BD%E6%95%B0%5Cnresult%20%3D%20constructor.apply(newObject%2C%20arguments)%3B%5Cn%2F%2F%20%E5%88%A4%E6%96%AD%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%5Cnlet%20flag%20%3D%20result%20%26%26%20(typeof%20result%20%3D%3D%3D%20%5C%22object%5C%22%20%7C%7C%20typeof%20result%20%3D%3D%3D%5Cn%5C%22function%5C%22)%3B%5Cn%2F%2F%20%E5%88%A4%E6%96%AD%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%5Cnreturn%20flag%20%3F%20result%20%3A%20newObject%3B%5Cn%7D%5Cn%2F%2F%20%E4%BD%BF%E2%BD%A4%E2%BD%85%E6%B3%95%5CnobjectFactory(%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%2C%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%82%E6%95%B0)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22HxWQB%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h2 data-lake-id=\"EuRYC\" id=\"EuRYC\"><span data-lake-id=\"uae942fc9\" id=\"uae942fc9\">map()和foreach()的区别</span></h2><h3 data-lake-id=\"ogOb0\" id=\"ogOb0\"><span data-lake-id=\"ued1856aa\" id=\"ued1856aa\">简洁回答</span></h3><p data-lake-id=\"u7a3aea33\" id=\"u7a3aea33\"><span data-lake-id=\"ubcf5f5b6\" id=\"ubcf5f5b6\">都是⽤来遍历数组的，两者区别如下：</span></p><ul list=\"ud3e74295\"><li fid=\"u555dd7c7\" data-lake-id=\"u24f06412\" id=\"u24f06412\"><span data-lake-id=\"uda3e28c4\" id=\"uda3e28c4\">forEach()⽅法会针对每⼀个元素执⾏提供的函数，对数据的操作会改变原数组，该⽅法没有返回</span></li></ul><p data-lake-id=\"uaf7ac181\" id=\"uaf7ac181\"><span data-lake-id=\"u63b33eaf\" id=\"u63b33eaf\">值；</span></p><ul list=\"ud6f1821e\"><li fid=\"u17f5a1a7\" data-lake-id=\"u25e2e9ad\" id=\"u25e2e9ad\"><span data-lake-id=\"uf5e5e82e\" id=\"uf5e5e82e\">map()⽅法不会改变原数组的值，返回⼀个新数组，新数组中的值为原数组调⽤函数处理之后的</span></li></ul><p data-lake-id=\"u4eff17df\" id=\"u4eff17df\"><span data-lake-id=\"u95eaa78e\" id=\"u95eaa78e\">值；</span></p><h3 data-lake-id=\"LgnBg\" id=\"LgnBg\"><span data-lake-id=\"ua7d3a021\" id=\"ua7d3a021\">相同点</span></h3><ol list=\"u152663aa\"><li fid=\"u1b110533\" data-lake-id=\"uc81910d8\" id=\"uc81910d8\"><span data-lake-id=\"u233e51e3\" id=\"u233e51e3\">都是循环遍历数组的每一项</span></li><li fid=\"u1b110533\" data-lake-id=\"uc92e479b\" id=\"uc92e479b\"><span data-lake-id=\"u8573b682\" id=\"u8573b682\">都相当于封装好的单层for循环，三个值都相同</span></li><li fid=\"u1b110533\" data-lake-id=\"u5ede89bf\" id=\"u5ede89bf\"><span data-lake-id=\"uf445ca20\" id=\"uf445ca20\">每次执行匿名函数都支持三个参数，参数分别为item（当前每一项）、index（索引值）、arr（原数组）</span></li><li fid=\"u1b110533\" data-lake-id=\"ua6b771b6\" id=\"ua6b771b6\"><span data-lake-id=\"ua6990f34\" id=\"ua6990f34\">匿名函数中的this都是指向window</span></li><li fid=\"u1b110533\" data-lake-id=\"uc61e0fa0\" id=\"uc61e0fa0\"><span data-lake-id=\"u8cc432c0\" id=\"u8cc432c0\">只能遍历数组</span></li></ol><h3 data-lake-id=\"gJBw2\" id=\"gJBw2\"><span data-lake-id=\"ua62c8557\" id=\"ua62c8557\">不同点</span></h3><ul list=\"u1335ff5e\"><li fid=\"u97fc3c4e\" data-lake-id=\"uaa3c5be7\" id=\"uaa3c5be7\"><span data-lake-id=\"ubb200f28\" id=\"ubb200f28\">map()会分配内存空间存储新数组并有返回值，forEach()没有返回值</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"uc5dcb627\" id=\"uc5dcb627\"><span data-lake-id=\"u88a872e4\" id=\"u88a872e4\">forEach()允许calllback更改原始数组的元素，map()返回新的数组，map()不会对空数组进行检测</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"ub3699f29\" id=\"ub3699f29\"><span data-lake-id=\"u6f9b27d7\" id=\"u6f9b27d7\">forEach()遍历通常都是直接引入当前遍历数组的内存地址，生成的数组的值发生变化，当前遍历的数组对应的值也会发生变化。</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"uf52ca49a\" id=\"uf52ca49a\"><span data-lake-id=\"u827a391c\" id=\"u827a391c\">map遍历后的数组通常会生成一个新的数组，新数组的值发生变化，当前遍历的数组值不会变化。</span></li><li fid=\"u97fc3c4e\" data-lake-id=\"ua05c9eab\" id=\"ua05c9eab\"><span data-lake-id=\"u6d7f55ad\" id=\"u6d7f55ad\">map的速度大于forEach</span></li></ul><h3 data-lake-id=\"qMAb9\" id=\"qMAb9\"><span data-lake-id=\"uf4f1bed0\" id=\"uf4f1bed0\">使用场景</span></h3><ol list=\"ua39ecbfd\"><li fid=\"uc5eb4a37\" data-lake-id=\"ua4984c5a\" id=\"ua4984c5a\"><span data-lake-id=\"u19f6e020\" id=\"u19f6e020\">forEach()适用于你并不打算改变数据的时候</span></li><li fid=\"uc5eb4a37\" data-lake-id=\"u1faeb043\" id=\"u1faeb043\"><span data-lake-id=\"u9261656d\" id=\"u9261656d\">map()适用于你要改变数据的时候。不仅在于它更快，而且返回一个新数组。（因此可以使用复合（composition）（map(),filter(),reduce()等组合使用））</span></li></ol><p data-lake-id=\"ub47a1f9b\" id=\"ub47a1f9b\"><span data-lake-id=\"u6400cd45\" id=\"u6400cd45\">性能上来说，for&gt;forEach&gt;map。</span></p><h2 data-lake-id=\"fNTcb\" id=\"fNTcb\"><span data-lake-id=\"udae3adf9\" id=\"udae3adf9\">Symbol</span></h2><ol list=\"u24991fc3\"><li fid=\"u6c32d8f1\" data-lake-id=\"u83c42b6d\" id=\"u83c42b6d\"><span data-lake-id=\"uf1ca22b3\" id=\"uf1ca22b3\">什么是Symbol？</span></li></ol><p data-lake-id=\"u4ba1b7d7\" id=\"u4ba1b7d7\" style=\"text-indent: 2em\"><span data-lake-id=\"u184c60ea\" id=\"u184c60ea\">Symbol是ES6新增的一种数据类型，被划分为</span><strong><span data-lake-id=\"u4290f69a\" id=\"u4290f69a\">基本数据类型</span></strong><span data-lake-id=\"ud5f52f5f\" id=\"ud5f52f5f\">。不能用 </span><code data-lake-id=\"u8c07b6e6\" id=\"u8c07b6e6\"><span data-lake-id=\"u3b0db586\" id=\"u3b0db586\">new</span></code><span data-lake-id=\"u75541d5e\" id=\"u75541d5e\">。</span></p><ul list=\"u5e2856f7\"><li fid=\"u6ccf7f8a\" data-lake-id=\"ua21ebc77\" id=\"ua21ebc77\"><span data-lake-id=\"ucc9cb7e6\" id=\"ucc9cb7e6\">基本数据类型：字符串、数值、布尔、undefined、null、Symbol。</span></li><li fid=\"u6ccf7f8a\" data-lake-id=\"u37091692\" id=\"u37091692\"><span data-lake-id=\"ubbbf09da\" id=\"ubbbf09da\">引用数据类型：Object</span></li></ul><ol list=\"u3b9dcdd7\" start=\"2\"><li fid=\"u8b96bea1\" data-lake-id=\"ua5c50a5a\" id=\"ua5c50a5a\"><span data-lake-id=\"uf8405b8c\" id=\"uf8405b8c\">作用</span></li></ol><p data-lake-id=\"u07e440cd\" id=\"u07e440cd\"><span data-lake-id=\"u23a49187\" id=\"u23a49187\">用来表示一个独一无二的值。</span></p><ol list=\"uf65cc4e4\" start=\"3\"><li fid=\"u796ac187\" data-lake-id=\"u8323c438\" id=\"u8323c438\"><span data-lake-id=\"u27940de6\" id=\"u27940de6\">格式：</span><code data-lake-id=\"u4a664624\" id=\"u4a664624\"><span data-lake-id=\"u1cdfe7ae\" id=\"u1cdfe7ae\">let xxx = Symbol('标识字符串')</span></code></li><li fid=\"u796ac187\" data-lake-id=\"u2c83ce55\" id=\"u2c83ce55\"><span data-lake-id=\"ue5686142\" id=\"ue5686142\">为什么需要Symbol？</span></li></ol><p data-lake-id=\"u1a3e155d\" id=\"u1a3e155d\" style=\"text-indent: 2em\"><span data-lake-id=\"u37301165\" id=\"u37301165\">为了避免第三方框框架的同名属性被覆盖。</span></p><blockquote data-lake-id=\"u6cdb980b\" id=\"u6cdb980b\" style=\"padding-left: 2em\"><p data-lake-id=\"ubf547b48\" id=\"ubf547b48\"><span data-lake-id=\"ue8037304\" id=\"ue8037304\">在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。</span></p></blockquote><ol list=\"ued0bdf73\" start=\"5\"><li fid=\"u2f3be6c2\" data-lake-id=\"u791b2d4b\" id=\"u791b2d4b\"><span data-lake-id=\"u23da1184\" id=\"u23da1184\">如果区分Symbol？</span></li></ol><p data-lake-id=\"u99726587\" id=\"u99726587\" style=\"text-indent: 2em\"><span data-lake-id=\"u01f4a6b3\" id=\"u01f4a6b3\">在通过Symbol生成一个独一无二的值时，可以设置一个标记</span></p><p data-lake-id=\"u59dd8786\" id=\"u59dd8786\" style=\"text-indent: 2em\"><span data-lake-id=\"u981044ac\" id=\"u981044ac\">这个标记仅仅用于区分，没有其他任何意义。</span></p><ol list=\"udc182035\" start=\"6\"><li fid=\"u8964f751\" data-lake-id=\"u8d6baf17\" id=\"u8d6baf17\"><span data-lake-id=\"u502922b4\" id=\"u502922b4\">如果特殊情况需要读取这个标记，</span></li></ol><ul list=\"uea6e2aec\"><li fid=\"uae9aadcd\" data-lake-id=\"ud73ce616\" id=\"ud73ce616\"><span data-lake-id=\"uc57cd015\" id=\"uc57cd015\">Symbol类型可以转化为boolean或字符串，转化为字符串时前面会加上Symbol(wxy)，不方便</span></li><li fid=\"uae9aadcd\" data-lake-id=\"ub5657a7d\" id=\"ub5657a7d\"><span data-lake-id=\"ub79e4f5b\" id=\"ub79e4f5b\">可以直接通过description属性获取Symbol函数的字符串标识参数</span></li></ul><ol list=\"u9dc85897\" start=\"7\"><li fid=\"uc78472fe\" data-lake-id=\"u76de8cd9\" id=\"u76de8cd9\"><span data-lake-id=\"u87225889\" id=\"u87225889\">使用Symbol类型作为属性名</span></li></ol><blockquote data-lake-id=\"u09282575\" id=\"u09282575\" style=\"padding-left: 2em\"><p data-lake-id=\"u84c1fe0a\" id=\"u84c1fe0a\"><span data-lake-id=\"u6fca0291\" id=\"u6fca0291\">对象的属性要么是字符串，要么是Symbol类型</span></p></blockquote><ul list=\"u27713a6c\"><li fid=\"u4e107979\" data-lake-id=\"u5f898a70\" id=\"u5f898a70\"><span data-lake-id=\"uf9426ce3\" id=\"uf9426ce3\">默认是字符串，所以不加</span><code data-lake-id=\"u410fb57d\" id=\"u410fb57d\"><span data-lake-id=\"ub52b0987\" id=\"ub52b0987\">&quot;&quot;</span></code><span data-lake-id=\"u31175675\" id=\"u31175675\">也可以；如果需要类型为Symbol，需要使用</span><code data-lake-id=\"ub4853563\" id=\"ub4853563\"><span data-lake-id=\"ubd388a31\" id=\"ubd388a31\">[]</span></code><span data-lake-id=\"u8e2b3a45\" id=\"u8e2b3a45\">。</span></li><li fid=\"u4e107979\" data-lake-id=\"u26b3983a\" id=\"u26b3983a\"><span data-lake-id=\"ud42b8d26\" id=\"ud42b8d26\">不能用</span><code data-lake-id=\"u52f4301e\" id=\"u52f4301e\"><span data-lake-id=\"ubd0df431\" id=\"ubd0df431\">.</span></code><span data-lake-id=\"ufd502dd0\" id=\"ufd502dd0\">来访问，因为点运算符后面总是字符串。</span></li><li fid=\"u4e107979\" data-lake-id=\"u8648d662\" id=\"u8648d662\"><span data-lake-id=\"ub4ecced6\" id=\"ub4ecced6\">Symbol值作为属性名时，该属性还是公开属性，不是私有属性。</span></li></ul><ol list=\"u033ef65e\" start=\"8\"><li fid=\"ub5b7f779\" data-lake-id=\"uad898f22\" id=\"uad898f22\"><span data-lake-id=\"u751c41ff\" id=\"u751c41ff\">例子：</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22%2F%2F%E5%90%8E%E9%9D%A2%E7%9A%84%E6%8B%AC%E5%8F%B7%E5%8F%AF%E4%BB%A5%E7%BB%99symbol%E5%81%9A%E4%B8%8A%E6%A0%87%E8%AE%B0%E4%BE%BF%E4%BA%8E%E8%AF%86%E5%88%AB%5Cnlet%20name%20%3D%20Symbol(%5C%22name%5C%22)%3B%5Cnlet%20say%20%3D%20Symbol(%5C%22say%5C%22)%3B%5Cnlet%20obj%20%3D%20%7B%5Cn%20%20%20%20%2F%2F%E5%A6%82%E6%9E%9C%E6%83%B3%20%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E4%BD%9C%E4%B8%BA%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E5%BF%85%E9%A1%BB%E5%8A%A0%E4%B8%8A%E4%B8%AD%E6%8B%AC%E5%8F%B7%EF%BC%8C.%E8%BF%90%E7%AE%97%E7%AC%A6%E5%90%8E%E9%9D%A2%E8%B7%9F%E7%9D%80%E7%9A%84%E9%83%BD%E6%98%AF%E5%AD%97%E7%AC%A6%E4%B8%B2%5Cn%20%20%20%20%5Bname%5D%3A%20%5C%22lnj%5C%22%2C%5Cn%20%20%20%20%5Bsay%5D%3A%20function()%20%7B%5Cn%20%20%20%20%20%20%20%20console.log(%5C%22say%5C%22)%3B%5Cn%20%20%20%20%7D%2C%5Cn%20%20%20%20%2F%2F%20name%3A%20%5C%22rose%5C%22%2C%5Cn%7D%3B%5Cn%2F%2F%20obj.name%20%3D%20%5C%22it6661%5C%22%3B%5Cnobj%5BSymbol(%5C%22name%5C%22)%5D%20%3D%20%5C%22it666%5C%22%3B%5Cnconsole.log(obj)%3B%5Cnconsole.log(Reflect.ownKeys(obj))%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22KbTRx%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u5c458fbe\" id=\"u5c458fbe\"><p data-lake-id=\"uc4e8b106\" id=\"uc4e8b106\"><span data-lake-id=\"ufc96ae08\" id=\"ufc96ae08\">{</span></p><p data-lake-id=\"ub2bf8ae8\" id=\"ub2bf8ae8\"><span data-lake-id=\"u7ae59d0c\" id=\"u7ae59d0c\">  [Symbol(name)]: 'lnj',</span></p><p data-lake-id=\"u8a53f6f3\" id=\"u8a53f6f3\"><span data-lake-id=\"u0d8e88a2\" id=\"u0d8e88a2\">  [Symbol(say)]: [Function: [say]],</span></p><p data-lake-id=\"u8bf87a90\" id=\"u8bf87a90\"><span data-lake-id=\"uaf1b07ba\" id=\"uaf1b07ba\">  [Symbol(name)]: 'it666'</span></p><p data-lake-id=\"udf34f821\" id=\"udf34f821\"><span data-lake-id=\"uee640fc0\" id=\"uee640fc0\">}</span></p><p data-lake-id=\"uea186e60\" id=\"uea186e60\"><span data-lake-id=\"u0fc925f8\" id=\"u0fc925f8\">[ Symbol(name), Symbol(say), Symbol(name) ]</span></p></blockquote><p data-lake-id=\"u389f2d31\" id=\"u389f2d31\"><span data-lake-id=\"u6435f421\" id=\"u6435f421\">没有覆盖原来的name，因为都是独一无二的，那么就默认创建一个name的属性。</span></p><h3 data-lake-id=\"PKuqe\" id=\"PKuqe\"><span data-lake-id=\"u4d7d906f\" id=\"u4d7d906f\">注意点</span></h3><ol list=\"u0468c5db\"><li fid=\"u06497ca0\" data-lake-id=\"ud0d58967\" id=\"ud0d58967\"><span data-lake-id=\"u9415c704\" id=\"u9415c704\">Symbol是基本数据类型，不能加new</span></li><li fid=\"u06497ca0\" data-lake-id=\"u776509e4\" id=\"u776509e4\"><span data-lake-id=\"ue912a0a5\" id=\"ue912a0a5\">后面括号可以传入一个字符串，只是一个标记，方便阅读，没有任何意义。</span></li><li fid=\"u06497ca0\" data-lake-id=\"u7086a86c\" id=\"u7086a86c\"><span data-lake-id=\"u20f8ec19\" id=\"u20f8ec19\">类型转化的时候，不可转化为数值，只能转化为字符串和布尔值。</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22console.log(String(name))%3B%5Cnconsole.log(Boolean(name))%3B%5Cnconsole.log(Number(name))%3B%20%2F%2F%20Cannot%20convert%20a%20Symbol%20value%20to%20a%20number%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22cMRkp%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><ol list=\"u1fd64c61\" start=\"4\"><li fid=\"ubf28a9ce\" data-lake-id=\"u3fd16d74\" id=\"u3fd16d74\"><span data-lake-id=\"u033e53c7\" id=\"u033e53c7\">不能做任何运算</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%3DSymbol('name')%3B%5Cnconsole.log(name%2B111)%5Cnconsole.log(name%2B'ccc')%5Cn%2F%2F%E5%85%A8%E9%83%A8%E6%8A%A5%E9%94%99%20Cannot%20convert%20a%20Symbol%20value%20to%20a%20number%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22qAMCc%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><ol list=\"u0179c47e\" start=\"5\"><li fid=\"ufae85291\" data-lake-id=\"uce6a6007\" id=\"uce6a6007\"><span data-lake-id=\"u5b5148a7\" id=\"u5b5148a7\">Symbol生成的值作为属性或方法的时候，一定要保存下来，否则后续无法使用。</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%3DSymbol('name')%3B%5Cnlet%20obj%3D%7B%5Cn%20%20%2F%2F%20name%3A'lnj'%2C%5Cn%20%20%20%20%5BSymbol('name')%5D%3A'lbj'%5Cn%7D%5Cnconsole.log(obj.name)%3B%20%20%2F%2F%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0%EF%BC%8C%E5%9B%A0%E4%B8%BA%20%20%5BSymbol('name')%5D%E5%8F%88%E6%98%AF%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%80%BC%EF%BC%8C%E5%92%8C%E4%B8%8A%E9%9D%A2%E7%9A%84name%E4%B8%8D%E6%98%AF%E5%90%8C%E4%B8%80%E4%B8%AA%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22v77MM%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u7464468f\" id=\"u7464468f\"><span data-lake-id=\"u2cd67c21\" id=\"u2cd67c21\">应该改为如下：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%20%3D%20Symbol(%5C%22name%5C%22)%3B%5Cnlet%20obj%20%3D%20%7B%5Cn%20%20%20%20%5Bname%5D%3A%20%5C%22lnj1%5C%22%2C%5Cn%20%20%20%20%2F%2F%20%5BSymbol(%5C%22name%5C%22)%5D%3A%20%5C%22lbj%5C%22%2C%5Cn%7D%3B%5Cn%2F%2F%20console.log(obj.name)%3B%20%2F%2F%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0%EF%BC%8C%E5%9B%A0%E4%B8%BA%20%20%5BSymbol('name')%5D%E5%8F%88%E6%98%AF%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%80%BC%EF%BC%8C%E5%92%8C%E4%B8%8A%E9%9D%A2%E7%9A%84name%E4%B8%8D%E6%98%AF%E5%90%8C%E4%B8%80%E4%B8%AA%5Cnconsole.log(Reflect.ownKeys(obj))%3B%5Cnconsole.log(obj%5Bname%5D)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22kKMvX%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u6dbf2f19\" id=\"u6dbf2f19\"><p data-lake-id=\"ueee19c8f\" id=\"ueee19c8f\"><span data-lake-id=\"ufbc74536\" id=\"ufbc74536\">[ Symbol(name) ]</span></p><p data-lake-id=\"u21bead9f\" id=\"u21bead9f\"><span data-lake-id=\"ua7541ce2\" id=\"ua7541ce2\">lnj1</span></p></blockquote><ol list=\"ud9d45160\" start=\"6\"><li fid=\"u3137bd0f\" data-lake-id=\"u7a057185\" id=\"u7a057185\"><span data-lake-id=\"u10c54028\" id=\"u10c54028\">for循环遍历对象时无法遍历出Symbol的属性和方法</span></li></ol><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20name%3DSymbol('name')%3B%5Cnlet%20obj%3D%7B%5Cn%20%20%5Bname%5D%3A'lnj'%2C%5Cn%20%20%20%20age%3A12%2C%5Cn%20%20%20%20teacher%3A'wyx'%5Cn%7D%5Cnfor(let%20key%20in%20obj)%7B%5Cn%20%20%20%20console.log(key)%20%20%20%2F%2F%E5%8F%AA%E8%83%BD%E6%89%93%E5%8D%B0%E5%87%BAage%E5%92%8Cteacher%5Cn%7D%5Cn%2F%2F%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%8F%AF%E4%BB%A5%E5%8D%95%E7%8B%AC%E5%8F%96%E5%87%BASymbol(name)%5Cnconsole.log(Object.getOwnPropertySymbols(obj))%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22ikBuz%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h3 data-lake-id=\"bRIp6\" id=\"bRIp6\"><span data-lake-id=\"u254abb34\" id=\"u254abb34\">Symbol的应用</span></h3><ol list=\"u690f0e57\"><li fid=\"ua112d1bd\" data-lake-id=\"u4e1ec221\" id=\"u4e1ec221\"><span data-lake-id=\"u889ee668\" id=\"u889ee668\">在企业开发中，如果需要对一些第三方的插件、框架进行自定义时，可能会因为添加了同名的属性或方法，将框架中原有的属性或方法覆盖掉，为了避免这种情况的发生，框架的作者告诉我们就可以使用Symbol作为属性或方法的名称。</span></li><li fid=\"ua112d1bd\" data-lake-id=\"ub601210a\" id=\"ub601210a\"><span data-lake-id=\"u6cc20519\" id=\"u6cc20519\">消除魔术字符串</span></li></ol><blockquote data-lake-id=\"u40d13c63\" id=\"u40d13c63\" style=\"padding-left: 2em\"><p data-lake-id=\"u8d0c3fa6\" id=\"u8d0c3fa6\"><span data-lake-id=\"ub70b59c8\" id=\"ub70b59c8\">魔术字符串：在代码中多次出现，与代码形成强耦合的某一个具体的字符串或数值。风格良好的代码应该尽量消除魔术字符串，改由含义清晰的变量代替。‘</span></p></blockquote><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22const%20gender%20%3D%20%7B%5Cn%20%20%20%2F%2F%E8%BF%99%E6%A0%B7%E5%B0%B1%E8%AF%B4%E6%98%8Eman%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E7%8B%AC%E4%B8%80%E6%97%A0%E4%BA%8C%E7%9A%84%E5%80%BC%EF%BC%8C%E4%B8%8D%E7%94%A8%E5%86%8Dman%3A'man'%20%20%20%5Cn%20%20%20%20man%3A%20Symbol()%2C%5Cn%20%20%20%20woman%3A%20Symbol()%2C%5Cn%7D%5Cnfunction%20isMan(gender)%20%7B%5Cn%20%20%20%20switch%20(gender)%20%7B%5Cn%20%20%20%20%20%20%20%20case%20gender.man%3A%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.log('%E7%94%B7%E6%80%A7')%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20break%3B%5Cn%20%20%20%20%20%20%20%20case%20gender.woman%3A%5Cn%20%20%20%20%20%20%20%20%20%20%20%20console.log('%E5%A5%B3%E6%80%A7')%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20break%5Cn%20%20%20%20%7D%5Cn%7D%5CnisMan(gender.man)%20%20%2F%2F%E7%94%B7%E6%80%A7%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22GChhH%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><ol list=\"u25135ff0\" start=\"3\"><li fid=\"uc96c0670\" data-lake-id=\"ud9b0e442\" id=\"ud9b0e442\"><span data-lake-id=\"u9f71b790\" id=\"u9f71b790\">为对象定义一些非私有的、但又希望只用于内部的方法。</span></li></ol><blockquote data-lake-id=\"u0cda45e7\" id=\"u0cda45e7\" style=\"padding-left: 2em\"><p data-lake-id=\"u375b8621\" id=\"u375b8621\"><span data-lake-id=\"u58ade380\" id=\"u58ade380\">由于以Symbol值作为键名，不会被常规方法遍历得到。我们可以利用这个特性，为对象定义一些非私有的、但又希望只用于内部的方法。</span></p><p data-lake-id=\"u91f2d56b\" id=\"u91f2d56b\"><span data-lake-id=\"ud5c0b71c\" id=\"ud5c0b71c\">注意：Symbol并不能实现真正的私有变量的效果，只是不能通过常规的遍历方法拿到Symbol类型的属性而已。</span><strong><span data-lake-id=\"u487e0ee4\" id=\"u487e0ee4\">​</span></strong></p></blockquote><p data-lake-id=\"u47a54e0b\" id=\"u47a54e0b\"><strong><span data-lake-id=\"u33b230ef\" id=\"u33b230ef\">对象的遍历方法</span></strong><span data-lake-id=\"u84cc2fa9\" id=\"u84cc2fa9\">：</span></p><ul list=\"u33021964\"><li fid=\"u5f914a62\" data-lake-id=\"ue9a3f0f8\" id=\"ue9a3f0f8\"><span data-lake-id=\"u22d3926f\" id=\"u22d3926f\">for(let xx in obj)：i代表key</span></li><li fid=\"u5f914a62\" data-lake-id=\"u0b6ff3b5\" id=\"u0b6ff3b5\"><span data-lake-id=\"u25b6d72f\" id=\"u25b6d72f\">for(let xx of obj)：不是自带的</span></li><li fid=\"u5f914a62\" data-lake-id=\"u7e08b740\" id=\"u7e08b740\"><span data-lake-id=\"u6b135041\" id=\"u6b135041\">Object.keys(obj)：返回包含的key的数组</span></li><li fid=\"u5f914a62\" data-lake-id=\"ua3870bab\" id=\"ua3870bab\"><span data-lake-id=\"u94700e14\" id=\"u94700e14\">Object.values(obj)：返回包含value的数组</span></li><li fid=\"u5f914a62\" data-lake-id=\"ue8b94391\" id=\"ue8b94391\"><span data-lake-id=\"u84a512a2\" id=\"u84a512a2\">Object.getOwnPropertyNames()：返回包含key的数组</span></li></ul><p data-lake-id=\"uff9d61bc\" id=\"uff9d61bc\"><span data-lake-id=\"u70a70ea9\" id=\"u70a70ea9\">上述的所有方法都遍历不到Symbol类型的（注意：是遍历时取不到Symbol，并不是我们访问不到对象的Symbol类型）</span></p><p data-lake-id=\"u39a24844\" id=\"u39a24844\"><strong><span data-lake-id=\"u37837acd\" id=\"u37837acd\">可以遍历到Symbol的方法：</span></strong></p><ul list=\"u5bd44c7d\"><li fid=\"u5d780946\" data-lake-id=\"ue6812e4e\" id=\"ue6812e4e\"><strong><span data-lake-id=\"u96d15dc6\" id=\"u96d15dc6\">Object.getOwnPropertySymbols()</span></strong><span data-lake-id=\"u498cca83\" id=\"u498cca83\">：返回对象中只包含Symbol类型key的数组</span></li><li fid=\"u5d780946\" data-lake-id=\"u8d1d2561\" id=\"u8d1d2561\"><strong><span data-lake-id=\"u29f2b4c5\" id=\"u29f2b4c5\">Reflect.ownKeys()</span></strong><span data-lake-id=\"u27791941\" id=\"u27791941\">：返回对象中所有类型key的数组（包含Symbol）</span></li></ul><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20_password%20%3D%20Symbol('password')%5Cnconst%20obj%20%3D%20%7B%5Cn%20%20%20%20name%3A%20'%E5%B0%8F%E6%98%8E'%2C%5Cn%20%20%20%20gender%3A%20'male'%2C%5Cn%20%20%20%20%5B_password%5D%3A%20'11038'%5Cn%7D%5Cnfor%20(let%20item%20in%20obj)%20%7B%5Cn%20%20%20%20console.log(item)%3B%5Cn%7D%5Cnconsole.log(Object.keys(obj))%3B%5Cnconsole.log(Object.values(obj))%3B%5Cnconsole.log(Object.getOwnPropertyNames(obj))%3B%5Cnconsole.log(Object.getOwnPropertySymbols(obj))%3B%5Cnconsole.log(Reflect.ownKeys(obj))%5Cn%2F%2F%20%E8%BE%93%E5%87%BA11038%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%98%E6%98%AF%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%E5%88%B0symbol%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7%EF%BC%8C%E6%89%80%E4%BB%A5symbol%E5%B9%B6%E4%B8%8D%E8%83%BD%E7%9C%9F%E6%AD%A3%E5%AE%9E%E7%8E%B0%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E7%9A%84%E8%AE%BE%E5%AE%9A%EF%BC%8C%E6%89%80%E4%BB%A5%E4%B8%80%E8%88%AC%E5%8F%AA%E7%94%A8%E4%BA%8E%E5%AE%9A%E4%B9%89%E4%B8%80%E4%BA%9B%E9%9D%9E%E7%A7%81%E6%9C%89%E7%9A%84%E3%80%81%E4%BD%86%E5%8F%88%E5%B8%8C%E6%9C%9B%E5%8F%AA%E7%94%A8%E4%BA%8E%E5%86%85%E9%83%A8%E7%9A%84%E6%96%B9%E6%B3%95%5Cnconsole.log(obj%5B_password%5D)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22b3zmv%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"ub6d28c4f\" id=\"ub6d28c4f\"><span data-lake-id=\"udcb2079f\" id=\"udcb2079f\">输出如下：</span></p><p data-lake-id=\"u6f5cddec\" id=\"u6f5cddec\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2022%2Fpng%2F2324645%2F1668653745915-fc9503cf-b3b8-4973-b078-26b09f69ba22.png%22%2C%22taskId%22%3A%22uda6b3e15-79e2-4aa7-982d-49fe7eb8eb8%22%2C%22clientId%22%3A%22u2b09cbdb-2331-4%22%2C%22originalType%22%3A%22binary%22%2C%22width%22%3A275%2C%22height%22%3A116%2C%22linkTarget%22%3A%22_blank%22%2C%22name%22%3A%22image.png%22%2C%22size%22%3A46307%2C%22from%22%3A%22paste%22%2C%22originWidth%22%3A583%2C%22originHeight%22%3A245%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22search%22%3A%22NAME%20GENDER%20I%20GENDER%20NAME%20%E5%B0%8F%E6%98%8E%20MALE%20LI%20'GENDER'%20NAME%20SYMBOL(PASSWORD)%20SYMBOL(PASSWORD)%20%5D%20'GENDER'%20NAME%2011038%22%2C%22ocrLocations%22%3A%5B%7B%22x%22%3A17.835613%2C%22y%22%3A10.28653%2C%22width%22%3A56.185383%2C%22height%22%3A16.532913%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A16.404135%2C%22y%22%3A39.320583%2C%22width%22%3A88.48623500000001%2C%22height%22%3A21.397437000000004%2C%22text%22%3A%22GENDER%22%7D%2C%7B%22x%22%3A283.29572%2C%22y%22%3A63.699017%2C%22width%22%3A13.722409999999968%2C%22height%22%3A33.523523%2C%22text%22%3A%22I%22%7D%2C%7B%22x%22%3A169.04576%2C%22y%22%3A65.59649%2C%22width%22%3A90.67936999999998%2C%22height%22%3A28.280149999999992%2C%22text%22%3A%22GENDER%22%7D%2C%7B%22x%22%3A59.44093%2C%22y%22%3A71.73817%2C%22width%22%3A57.067060000000005%2C%22height%22%3A17.633496000000008%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A56.391617%2C%22y%22%3A92.70355%2C%22width%22%3A64.32137300000001%2C%22height%22%3A29.49544999999999%2C%22text%22%3A%22%E5%B0%8F%E6%98%8E%22%7D%2C%7B%22x%22%3A169.89551%2C%22y%22%3A97.78831%2C%22width%22%3A60.10534000000001%2C%22height%22%3A22.076800000000006%2C%22text%22%3A%22MALE%22%7D%2C%7B%22x%22%3A283.78152%2C%22y%22%3A127.35834%2C%22width%22%3A13.303110000000004%2C%22height%22%3A58.46708000000001%2C%22text%22%3A%22LI%22%7D%2C%7B%22x%22%3A166.38359%2C%22y%22%3A127.61558%2C%22width%22%3A96.13987999999998%2C%22height%22%3A26.898140000000012%2C%22text%22%3A%22'GENDER'%22%7D%2C%7B%22x%22%3A58.253582%2C%22y%22%3A132.58513%2C%22width%22%3A59.170162%2C%22height%22%3A17.249590000000012%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A45.125946%2C%22y%22%3A156.71448%2C%22width%22%3A221.192454%2C%22height%22%3A28.156199999999984%2C%22text%22%3A%22SYMBOL(PASSWORD)%22%7D%2C%7B%22x%22%3A295.69482%2C%22y%22%3A186.42665%2C%22width%22%3A255.91798%2C%22height%22%3A30.39458000000002%2C%22text%22%3A%22SYMBOL(PASSWORD)%20%5D%22%7D%2C%7B%22x%22%3A164.94514%2C%22y%22%3A189.3633%2C%22width%22%3A100.78666000000001%2C%22height%22%3A25.321739999999977%2C%22text%22%3A%22'GENDER'%22%7D%2C%7B%22x%22%3A59.025814%2C%22y%22%3A192.88441%2C%22width%22%3A68.091286%2C%22height%22%3A19.300389999999993%2C%22text%22%3A%22NAME%22%7D%2C%7B%22x%22%3A17.268585%2C%22y%22%3A220.85193%2C%22width%22%3A72.02459%2C%22height%22%3A21.05176%2C%22text%22%3A%2211038%22%7D%5D%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23212121%22%2C%22id%22%3A%22u196ca470%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card></p><h3 data-lake-id=\"wAmPW\" id=\"wAmPW\"><span data-lake-id=\"ucd1e1ca2\" id=\"ucd1e1ca2\">Symbol自带的方法</span></h3><h4 data-lake-id=\"ZBbKp\" id=\"ZBbKp\"><span data-lake-id=\"u68018dfd\" id=\"u68018dfd\">1. </span><code data-lake-id=\"u14edd727\" id=\"u14edd727\"><span data-lake-id=\"udb77d3db\" id=\"udb77d3db\">Symbol.for()</span></code></h4><p data-lake-id=\"u8543ee7e\" id=\"u8543ee7e\"><u><span data-lake-id=\"u496a72a9\" id=\"u496a72a9\">重新使用同一个Symbol值。</span></u></p><p data-lake-id=\"ue8a74dbc\" id=\"ue8a74dbc\"><span data-lake-id=\"ue0b30960\" id=\"ue0b30960\">接收一个字符串作为参数，搜索是否有以该参数作为名称的Symbol值，如果有，就返回这个Symbol值，否则就新建一个以该字符串为名称的Symbol值，并将其注册到全局。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20s1%20%3D%20Symbol.for('foo')%3B%5Cnlet%20s2%20%3D%20Symbol.for('foo')%3B%5Cn%5Cns1%20%3D%3D%3D%20s2%20%2F%2F%20true%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22d4Ilt%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h4 data-lake-id=\"ezFW0\" id=\"ezFW0\"><span data-lake-id=\"u9bebd769\" id=\"u9bebd769\">2. </span><code data-lake-id=\"u39070501\" id=\"u39070501\"><span data-lake-id=\"u6ff855c9\" id=\"u6ff855c9\">Symbol.keyFor()</span></code></h4><p data-lake-id=\"ue8538d75\" id=\"ue8538d75\"><u><span data-lake-id=\"u7cfa2fb1\" id=\"u7cfa2fb1\">返回一个已登记的Symbol类型值的</span></u><code data-lake-id=\"u87fab790\" id=\"u87fab790\"><u><span data-lake-id=\"ufa16d82e\" id=\"ufa16d82e\">key</span></u></code><u><span data-lake-id=\"u3c6f78ad\" id=\"u3c6f78ad\">。</span></u></p><p data-lake-id=\"ua831422d\" id=\"ua831422d\"><span data-lake-id=\"udc6f6145\" id=\"udc6f6145\">由于</span><code data-lake-id=\"ud99e8e29\" id=\"ud99e8e29\"><span data-lake-id=\"ua1479a57\" id=\"ua1479a57\">Symbol()</span></code><span data-lake-id=\"u13d195cd\" id=\"u13d195cd\">写法没有登记机制，所以每次调用都会返回一个不同的值。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22let%20s1%20%3D%20Symbol.for(%5C%22foo%5C%22)%3B%5CnSymbol.keyFor(s1)%20%2F%2F%20%5C%22foo%5C%22%5Cn%5Cnlet%20s2%20%3D%20Symbol(%5C%22foo%5C%22)%3B%5CnSymbol.keyFor(s2)%20%2F%2F%20undefined%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22WTdtT%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><h2 data-lake-id=\"hZIrL\" id=\"hZIrL\"><span data-lake-id=\"u372e1139\" id=\"u372e1139\">Map和Object区别</span></h2><table data-lake-id=\"gSZLR\" id=\"gSZLR\" width-mode=\"contain\" class=\"lake-table\" style=\"width: 579px\"><colgroup><col width=\"193\"><col width=\"193\"><col width=\"193\"></colgroup><tbody><tr data-lake-id=\"uaf5debc6\" id=\"uaf5debc6\"><td data-lake-id=\"ufd1ec073\" id=\"ufd1ec073\"></td><td data-lake-id=\"u389f0dd3\" id=\"u389f0dd3\"><p data-lake-id=\"u0c10bd72\" id=\"u0c10bd72\"><span data-lake-id=\"u5667c347\" id=\"u5667c347\">Map</span></p></td><td data-lake-id=\"u36a27eb3\" id=\"u36a27eb3\"><p data-lake-id=\"u9adedb96\" id=\"u9adedb96\"><span data-lake-id=\"u00f1095e\" id=\"u00f1095e\">Object</span></p></td></tr><tr data-lake-id=\"ue417e838\" id=\"ue417e838\"><td data-lake-id=\"u20819286\" id=\"u20819286\"><p data-lake-id=\"u29c176ec\" id=\"u29c176ec\"><span data-lake-id=\"u24bd2d31\" id=\"u24bd2d31\">意外的键</span></p></td><td data-lake-id=\"u75a7848e\" id=\"u75a7848e\"><p data-lake-id=\"u3a8a62e7\" id=\"u3a8a62e7\"><span data-lake-id=\"u9d088a5a\" id=\"u9d088a5a\">Map默认情况不包含任何键，只包含显式插入的键</span></p></td><td data-lake-id=\"ue1410836\" id=\"ue1410836\"><p data-lake-id=\"ucac95cb2\" id=\"ucac95cb2\"><span data-lake-id=\"u19aefccb\" id=\"u19aefccb\">Object有一个原型，原型链上的键名有可能和自己在对象上设置的键名有冲突</span></p></td></tr><tr data-lake-id=\"u1a0f1e6d\" id=\"u1a0f1e6d\"><td data-lake-id=\"u1f2b22b2\" id=\"u1f2b22b2\"><p data-lake-id=\"u1b8e415c\" id=\"u1b8e415c\"><span data-lake-id=\"ud40afe98\" id=\"ud40afe98\">键的类型</span></p></td><td data-lake-id=\"ucf23afea\" id=\"ucf23afea\"><p data-lake-id=\"u594b9218\" id=\"u594b9218\"><span data-lake-id=\"ua6ba2bb4\" id=\"ua6ba2bb4\">Map的键可以是任意值，包括函数、对象或任意基本类型</span></p></td><td data-lake-id=\"ub64fdfa4\" id=\"ub64fdfa4\"><p data-lake-id=\"u71c9a331\" id=\"u71c9a331\"><span data-lake-id=\"u165d0d3e\" id=\"u165d0d3e\">Object的键必须是String或Symbol</span></p></td></tr><tr data-lake-id=\"uce020e25\" id=\"uce020e25\"><td data-lake-id=\"u1cc54bf8\" id=\"u1cc54bf8\"><p data-lake-id=\"ua43fd71e\" id=\"ua43fd71e\"><span data-lake-id=\"u13bb6651\" id=\"u13bb6651\">键的顺序</span></p></td><td data-lake-id=\"ua35dccce\" id=\"ua35dccce\"><p data-lake-id=\"u5ebbb823\" id=\"u5ebbb823\"><span data-lake-id=\"u77ae10d1\" id=\"u77ae10d1\">Map中的key是有序的。因此，当迭代的时候，Map对象以插入的顺序返回键值</span></p></td><td data-lake-id=\"ua99c70a3\" id=\"ua99c70a3\"><p data-lake-id=\"u7f053dcb\" id=\"u7f053dcb\"><span data-lake-id=\"u424d2085\" id=\"u424d2085\">Object的键是无序的</span></p></td></tr><tr data-lake-id=\"u327109fb\" id=\"u327109fb\"><td data-lake-id=\"u2535e53c\" id=\"u2535e53c\"><p data-lake-id=\"u1d5cefa1\" id=\"u1d5cefa1\"><span data-lake-id=\"u6ff489d3\" id=\"u6ff489d3\">Size</span></p></td><td data-lake-id=\"u7ef72b8f\" id=\"u7ef72b8f\"><p data-lake-id=\"uaebcc5cb\" id=\"uaebcc5cb\"><span data-lake-id=\"ue4ed139b\" id=\"ue4ed139b\">Map的键值对个数可以轻易地通过size属性获取</span></p></td><td data-lake-id=\"ua99f76a9\" id=\"ua99f76a9\"><p data-lake-id=\"u423d838d\" id=\"u423d838d\"><span data-lake-id=\"u53123bba\" id=\"u53123bba\">Object建值对个数只能手动计算</span></p></td></tr><tr data-lake-id=\"u7db24806\" id=\"u7db24806\"><td data-lake-id=\"u909bcfcd\" id=\"u909bcfcd\"><p data-lake-id=\"u2e3c7b42\" id=\"u2e3c7b42\"><span data-lake-id=\"ubf18bb7c\" id=\"ubf18bb7c\">迭代</span></p></td><td data-lake-id=\"u8b5da74f\" id=\"u8b5da74f\"><p data-lake-id=\"u8d87dd99\" id=\"u8d87dd99\"><span data-lake-id=\"u59fa0589\" id=\"u59fa0589\">Map是iterable的，所以可以直接被迭代</span></p></td><td data-lake-id=\"u735ea899\" id=\"u735ea899\"><p data-lake-id=\"ua3ad2d62\" id=\"ua3ad2d62\"><span data-lake-id=\"u2615f875\" id=\"u2615f875\">迭代Object需要以某种方式获取它的键然后才能迭代</span></p></td></tr><tr data-lake-id=\"u9256710a\" id=\"u9256710a\"><td data-lake-id=\"u86ce7bfc\" id=\"u86ce7bfc\"><p data-lake-id=\"u66e096f9\" id=\"u66e096f9\"><span data-lake-id=\"u8a9a3e79\" id=\"u8a9a3e79\">性能</span></p></td><td data-lake-id=\"u809c04f7\" id=\"u809c04f7\"><p data-lake-id=\"uc07f4794\" id=\"uc07f4794\"><span data-lake-id=\"ue0f90096\" id=\"ue0f90096\">在频繁增删值对的场景下表现更好</span></p></td><td data-lake-id=\"u36fccccd\" id=\"u36fccccd\"><p data-lake-id=\"ueaeee7be\" id=\"ueaeee7be\"><span data-lake-id=\"u0e5888ce\" id=\"u0e5888ce\">在频繁添加和删除键值对的场景下未做出优化</span></p></td></tr></tbody></table><h2 data-lake-id=\"N2G8K\" id=\"N2G8K\"><span data-lake-id=\"u6ca8cd4b\" id=\"u6ca8cd4b\">Map和WeakMap区别</span></h2><h3 data-lake-id=\"jjMeF\" id=\"jjMeF\"><span data-lake-id=\"u6931846b\" id=\"u6931846b\">Map </span></h3><p data-lake-id=\"u69b54603\" id=\"u69b54603\"><span data-lake-id=\"ue01b1f22\" id=\"ue01b1f22\">本质上是键值对的集合，但是普通Object的中的键值只能是字符串。而ES6提供的数据结构类似于对象，但是它的键不限制范围，可以是任意类型，是一种更加完善的Hash结构。如果Map的键是一个原始数据类型，只要两个键严格相同，就视为是同一个键。</span></p><p data-lake-id=\"u6571a952\" id=\"u6571a952\"><span data-lake-id=\"u5cce6b8d\" id=\"u5cce6b8d\">实际上是一个数组，它的每一个数据也就是一个数组，其形式如下：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22const%20map%20%3D%20%5B%5Cn%20%20%5B%5C%22name%5C%22%2C%5C%22%E5%BC%A0%E4%B8%89%5C%22%5D%2C%5Cn%20%20%5B%5C%22age%5C%22%2C18%5D%2C%5Cn%5D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Yuque%20Light%20Pro%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22Czmyw%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u5757c0e2\" id=\"u5757c0e2\"><span data-lake-id=\"ubc4c3d31\" id=\"ubc4c3d31\">Map数据结构有以下操作方法：</span></p><ul list=\"uf92b910b\"><li fid=\"ub4b02301\" data-lake-id=\"u540be3ee\" id=\"u540be3ee\"><span data-lake-id=\"ue4983cdb\" id=\"ue4983cdb\">size：map.size() 返回map结构的成员总数</span></li><li fid=\"ub4b02301\" data-lake-id=\"u8aef7ad9\" id=\"u8aef7ad9\"><span data-lake-id=\"u18725609\" id=\"u18725609\">set(key,value)：设置键名key对应的键值value，然后返回整个Map结构，如果key已经有值，则键值会被更新，否则就生成该键。（因为返回的是当前Map对象，所以可以链式调用）</span></li><li fid=\"ub4b02301\" data-lake-id=\"u6eaf2244\" id=\"u6eaf2244\"><span data-lake-id=\"u28d3dd8e\" id=\"u28d3dd8e\">get(key)：该方法读取key对应的键值，如果找不到key，返回undefined</span></li><li fid=\"ub4b02301\" data-lake-id=\"ue2d3a94e\" id=\"ue2d3a94e\"><span data-lake-id=\"ud35ef554\" id=\"ud35ef554\">has(key)：该方法返回一个布尔值，表示某个键是否在当前Map对象中。</span></li></ul><p data-lake-id=\"udeba3e14\" id=\"udeba3e14\"><span data-lake-id=\"u703b4c63\" id=\"u703b4c63\">​</span><br></p>",
    "public": 1,
    "status": 1,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-17T03:42:25.000Z",
    "deleted_at": null,
    "created_at": "2022-11-16T02:36:50.000Z",
    "updated_at": "2022-11-17T03:51:41.000Z",
    "published_at": "2022-11-17T03:45:45.000Z",
    "first_published_at": "2022-11-16T02:38:46.685Z",
    "word_count": 3098,
    "cover": "https://cdn.nlark.com/yuque/0/2022/png/2324645/1668653745915-fc9503cf-b3b8-4973-b078-26b09f69ba22.png",
    "description": "--- title: JS高频面试题 categories:  JStags:  JS--- apply、call、bind的区别三者都可以改变函数的this对象指向三者第一个参数都是this要指向的对象，如果如果没有这个参数或参数为undefined或null，则默认指向全局window三者...",
    "custom_description": null,
    "hits": 0,
    "_serializer": "v2.doc_detail"
  },
  {
    "id": 106224009,
    "slug": "bxodu8kp7dfwg12q",
    "title": "JS编译原理",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "--- <br />title: JS编译原理  <br />categories:  前端进阶<br />tags:  [JS,编译原理]<br />--- \n<a name=\"xlRa4\"></a>\n## JS编译原理\n```javascript\nvar name = \"rose\"\n```\n上面这行代码在JS中会这样呈现：\n```javascript\nvar name; // 编译阶段处理\nname = 'rose';  // 执行阶段处理\n```\nJS编译主要分为两个阶段：**编译阶段和执行阶段**。\n<a name=\"N4UAu\"></a>\n### 编译阶段\n此阶段主角为**编译器。**\n\n- JS找遍作用域，看是否存在name的变量\n   - 如果已经存在，则什么都不做，直接忽略`var name`这个声明，继续编译下去；\n   - 如果没有，则在当前作用域中新增一个`name`变量\n- 编译器会为引擎生成运行时所需的代码，程序就进入了执行阶段。\n<a name=\"zST4O\"></a>\n### 执行阶段\n此阶段主角为**JS引擎。**\n\n- **JS引擎**在运行时，会先找遍当前作用域，看是否有一个叫`name`的变量。\n   - 如果有，直接赋值\n   - 如果没有，则为当前作用域没有。则去父级作用域看是否有，如果无，则去上一级作用域中查找。\n   - 如果最终没有找到，则抛异常。\n> 作用域套作用域，即作用域链。\n\n<a name=\"zBAey\"></a>\n## 作用域\n变量最基本的能力就是**能够存储变量中的值，并且允许我们对此变量进行访问和修改**，而对于变量存储，访问的**规则**是 **作用域**。\n<a name=\"WnHa1\"></a>\n### 全局作用域\n在任何函数外或代码块外的顶层作用域就是全局作用域，里面的变量就是全局变量。\n```javascript\nvar name='rose';   //全局作用域\n\nfunction showName(){    //函数作用域\n  console.log(name);\n}\n{\n  name='test';    //块级作用域\n}\nshowName();    //test\n```\n> 可以看到，全局变量在全局作用域、函数作用域、块级作用域中都可以正常访问。\n\n<a name=\"F62EW\"></a>\n### 函数作用域\n在函数中的作用域就是函数作用域。\n```javascript\nfunction showName(){\n  var name='jack';    //函数作用域\n}\nshowName();   //方法调用\n{\n  console.log(name);  //块级作用域,Uncaught ReferenceError: name is not defined\n}\nconsole.log(name);  //全局作用域,Uncaught ReferenceError: name is not defined\n```\n> 可以看到，函数内部变量，在全局作用域及块级作用域中，都无法访问，只有在函数内部，才能访问到，所以函数内部的变量也称为**局部变量**。\n\n<a name=\"qBvlv\"></a>\n### 块级作用域\n`ES6`中新出的`let` 和`const`关键字 自带作用域。<br />块级作用域相当于是只在这块代码块中生效，如果它被大括号`{}`包围，则大括号就是一段代码块，代码块中使用`const`声明的变量也被称为**局部变量。**\n```javascript\n {\n   let name='rose';\n }\n\n console.log(name);    //Uncaught ReferenceError: name is not defined\n\n function showName{\n   console.log(name);\n }\n\n showName();    //Uncaught ReferenceError: name is not defined\n```\n> 可以看到，块级作用域中的变量，在代码块外面就访问不到了。\n\n<a name=\"ZK0tc\"></a>\n## 作用域链\n**作用域和作用域的嵌套，就产生了作用域链。作用域链的查找，向外不向内。**\n<a name=\"Ab127\"></a>\n## 变量提升\n```javascript\nname='rose';\nconsole.log(name);    //rose\nvar name;\n```\n可以发现，这段代码可以正常运行，并且不会报错。<br />在JS眼中代码实际上是这样的：\n```javascript\nvar name;\nname='rose';\nconsole.log(name);    // rose\n```\n\n---\n\n`let`和`const`代码：\n```javascript\nname='rose';\nconsole.log(name)    //Uncaught ReferenceError: Cannot access 'name' before initialization\nlet name;\n```\n> let 、const **禁用变量提升。**const 声明后必赋值。\n\n<a name=\"Bl19f\"></a>\n### let、const、var的区别\n\n1. **块级作用域**：块级作用域由`{}`包括，`let`和`const`具有块级作用域，`var`不存在块级作用域。\n\n块级作用域解决了`ES5`中的两个问题：\n\n   - 内层变量可能覆盖外层变量\n   - 用来计数的循环变量泄漏为全局变量\n2. **变量提升**：var 存在变量提升，let 和 const 不存在变量提升，即变量只能在声明后使用，否则会报错。\n3. **给全局添加属性**：浏览器的全局对象是window，Node的全局变量是global。var 声明的变量为全局变量，并且会将该变量添加为全局对象的属性，但是let和const不会。\n4. **重复声明**：var声明变量时，可以重复声明变量，后声明的变量会覆盖之前声明的变量。let 和 const 不允许在同一作用域下重复声明变量。\n5. **暂时性死区：**在使用let、const关键字声明变量时，该变量是不可用的，这在语法上，成为**暂时性死区**。\n\n使用var声明的变量不存在暂时性死区。\n\n6. **初始值设置**：在变量声明时，var和let可以不用设置初始值。而const声明变量必须设置初始值。\n7. **指针指向**：let和const都是ES6新增的用于创建变量的语法。let创建的变量可以更改指针指向（可以重新赋值）。但const声明的变量不允许改变指针的指向（不允许重新赋值）。\n<a name=\"kja5Y\"></a>\n## 暂时性死区\n```javascript\nvar name='rose';\n\n{\n  name='bob';\n  let name;    //Uncaught ReferenceError: Cannot access 'name' before initialization\n}\n```\n**如果区块中存在let和const，这个区块对于这些关键字声明的变量，从一开始就形成了封闭作用域。**<br />因为JS清楚地感知到了name是用let声明在当前这个代码块内的，所以会给这个变量name加上了暂时性死区的限制，它就不往外探出头了。<br />因此，如果我们把上面的`let name;`去掉，程序也能正常运行，name的值也能被成功修改为blob，就是正常地按照**作用域链**的规则，向外探出头去了。\n\n",
    "body_draft": "--- <br />title: JS编译原理  <br />categories:  前端进阶<br />tags:  [JS,编译原理]<br />--- \n<a name=\"xlRa4\"></a>\n## JS编译原理\n```javascript\nvar name = \"rose\"\n```\n上面这行代码在JS中会这样呈现：\n```javascript\nvar name; // 编译阶段处理\nname = 'rose';  // 执行阶段处理\n```\nJS编译主要分为两个阶段：**编译阶段和执行阶段**。\n<a name=\"N4UAu\"></a>\n### 编译阶段\n此阶段主角为**编译器。**\n\n- JS找遍作用域，看是否存在name的变量\n   - 如果已经存在，则什么都不做，直接忽略`var name`这个声明，继续编译下去；\n   - 如果没有，则在当前作用域中新增一个`name`变量\n- 编译器会为引擎生成运行时所需的代码，程序就进入了执行阶段。\n<a name=\"zST4O\"></a>\n### 执行阶段\n此阶段主角为**JS引擎。**\n\n- **JS引擎**在运行时，会先找遍当前作用域，看是否有一个叫`name`的变量。\n   - 如果有，直接赋值\n   - 如果没有，则为当前作用域没有。则去父级作用域看是否有，如果无，则去上一级作用域中查找。\n   - 如果最终没有找到，则抛异常。\n> 作用域套作用域，即作用域链。\n\n<a name=\"zBAey\"></a>\n## 作用域\n变量最基本的能力就是**能够存储变量中的值，并且允许我们对此变量进行访问和修改**，而对于变量存储，访问的**规则**是 **作用域**。\n<a name=\"WnHa1\"></a>\n### 全局作用域\n在任何函数外或代码块外的顶层作用域就是全局作用域，里面的变量就是全局变量。\n```javascript\nvar name='rose';   //全局作用域\n\nfunction showName(){    //函数作用域\n  console.log(name);\n}\n{\n  name='test';    //块级作用域\n}\nshowName();    //test\n```\n> 可以看到，全局变量在全局作用域、函数作用域、块级作用域中都可以正常访问。\n\n<a name=\"F62EW\"></a>\n### 函数作用域\n在函数中的作用域就是函数作用域。\n```javascript\nfunction showName(){\n  var name='jack';    //函数作用域\n}\nshowName();   //方法调用\n{\n  console.log(name);  //块级作用域,Uncaught ReferenceError: name is not defined\n}\nconsole.log(name);  //全局作用域,Uncaught ReferenceError: name is not defined\n```\n> 可以看到，函数内部变量，在全局作用域及块级作用域中，都无法访问，只有在函数内部，才能访问到，所以函数内部的变量也称为**局部变量**。\n\n<a name=\"qBvlv\"></a>\n### 块级作用域\n`ES6`中新出的`let` 和`const`关键字 自带作用域。<br />块级作用域相当于是只在这块代码块中生效，如果它被大括号`{}`包围，则大括号就是一段代码块，代码块中使用`const`声明的变量也被称为**局部变量。**\n```javascript\n {\n   let name='rose';\n }\n\n console.log(name);    //Uncaught ReferenceError: name is not defined\n\n function showName{\n   console.log(name);\n }\n\n showName();    //Uncaught ReferenceError: name is not defined\n```\n> 可以看到，块级作用域中的变量，在代码块外面就访问不到了。\n\n<a name=\"ZK0tc\"></a>\n## 作用域链\n**作用域和作用域的嵌套，就产生了作用域链。作用域链的查找，向外不向内。**\n<a name=\"Ab127\"></a>\n## 变量提升\n```javascript\nname='rose';\nconsole.log(name);    //rose\nvar name;\n```\n可以发现，这段代码可以正常运行，并且不会报错。<br />在JS眼中代码实际上是这样的：\n```javascript\nvar name;\nname='rose';\nconsole.log(name);    // rose\n```\n\n---\n\n`let`和`const`代码：\n```javascript\nname='rose';\nconsole.log(name)    //Uncaught ReferenceError: Cannot access 'name' before initialization\nlet name;\n```\n> let 、const **禁用变量提升。**const 声明后必赋值。\n\n<a name=\"Bl19f\"></a>\n### let、const、var的区别\n\n1. **块级作用域**：块级作用域由`{}`包括，`let`和`const`具有块级作用域，`var`不存在块级作用域。\n\n块级作用域解决了`ES5`中的两个问题：\n\n   - 内层变量可能覆盖外层变量\n   - 用来计数的循环变量泄漏为全局变量\n2. **变量提升**：var 存在变量提升，let 和 const 不存在变量提升，即变量只能在声明后使用，否则会报错。\n3. **给全局添加属性**：浏览器的全局对象是window，Node的全局变量是global。var 声明的变量为全局变量，并且会将该变量添加为全局对象的属性，但是let和const不会。\n4. **重复声明**：var声明变量时，可以重复声明变量，后声明的变量会覆盖之前声明的变量。let 和 const 不允许在同一作用域下重复声明变量。\n5. **暂时性死区：**在使用let、const关键字声明变量时，该变量是不可用的，这在语法上，成为**暂时性死区**。\n\n使用var声明的变量不存在暂时性死区。\n\n6. **初始值设置**：在变量声明时，var和let可以不用设置初始值。而const声明变量必须设置初始值。\n7. **指针指向**：let和const都是ES6新增的用于创建变量的语法。let创建的变量可以更改指针指向（可以重新赋值）。但const声明的变量不允许改变指针的指向（不允许重新赋值）。\n<a name=\"kja5Y\"></a>\n## 暂时性死区\n```javascript\nvar name='rose';\n\n{\n  name='bob';\n  let name;    //Uncaught ReferenceError: Cannot access 'name' before initialization\n}\n```\n**如果区块中存在let和const，这个区块对于这些关键字声明的变量，从一开始就形成了封闭作用域。**<br />因为JS清楚地感知到了name是用let声明在当前这个代码块内的，所以会给这个变量name加上了暂时性死区的限制，它就不往外探出头了。<br />因此，如果我们把上面的`let name;`去掉，程序也能正常运行，name的值也能被成功修改为blob，就是正常地按照**作用域链**的规则，向外探出头去了。\n\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"u191f528d\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><p id=\"uaabe2cf3\" class=\"ne-p\"><span class=\"ne-text\">title: JS编译原理  </span></p><p id=\"u6da62028\" class=\"ne-p\"><span class=\"ne-text\">categories:  前端进阶</span></p><p id=\"u05972217\" class=\"ne-p\"><span class=\"ne-text\">tags:  [JS,编译原理]</span></p><p id=\"ua7b72cc6\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><h2 id=\"xlRa4\"><span class=\"ne-text\">JS编译原理</span></h2><pre data-language=\"javascript\" id=\"keEto\" class=\"ne-codeblock language-javascript\">var name = &quot;rose&quot;</pre><p id=\"u176ac26e\" class=\"ne-p\"><span class=\"ne-text\">上面这行代码在JS中会这样呈现：</span></p><pre data-language=\"javascript\" id=\"CsAUc\" class=\"ne-codeblock language-javascript\">var name; // 编译阶段处理\nname = 'rose';  // 执行阶段处理</pre><p id=\"u96266933\" class=\"ne-p\"><span class=\"ne-text\">JS编译主要分为两个阶段：</span><strong><span class=\"ne-text\">编译阶段和执行阶段</span></strong><span class=\"ne-text\">。</span></p><h3 id=\"N4UAu\"><span class=\"ne-text\">编译阶段</span></h3><p id=\"u1703a650\" class=\"ne-p\"><span class=\"ne-text\">此阶段主角为</span><strong><span class=\"ne-text\">编译器。</span></strong><span class=\"ne-text\"></span></p><ul class=\"ne-ul\"><li id=\"u3a98c43f\"><span class=\"ne-text\">JS找遍作用域，看是否存在name的变量</span></li></ul><ul class=\"ne-list-wrap\"><ul ne-level=\"1\" class=\"ne-ul\"><li id=\"uf39dd4f2\"><span class=\"ne-text\">如果已经存在，则什么都不做，直接忽略</span><code class=\"ne-code\"><span class=\"ne-text\">var name</span></code><span class=\"ne-text\">这个声明，继续编译下去；</span></li><li id=\"u80ced5d6\"><span class=\"ne-text\">如果没有，则在当前作用域中新增一个</span><code class=\"ne-code\"><span class=\"ne-text\">name</span></code><span class=\"ne-text\">变量</span></li></ul></ul><ul class=\"ne-ul\"><li id=\"ub8660271\"><span class=\"ne-text\">编译器会为引擎生成运行时所需的代码，程序就进入了执行阶段。</span></li></ul><h3 id=\"zST4O\"><span class=\"ne-text\">执行阶段</span></h3><p id=\"u412a4438\" class=\"ne-p\"><span class=\"ne-text\">此阶段主角为</span><strong><span class=\"ne-text\">JS引擎。</span></strong></p><ul class=\"ne-ul\"><li id=\"u655ac592\"><strong><span class=\"ne-text\">JS引擎</span></strong><span class=\"ne-text\">在运行时，会先找遍当前作用域，看是否有一个叫</span><code class=\"ne-code\"><span class=\"ne-text\">name</span></code><span class=\"ne-text\">的变量。</span></li></ul><ul class=\"ne-list-wrap\"><ul ne-level=\"1\" class=\"ne-ul\"><li id=\"u45c0d4af\"><span class=\"ne-text\">如果有，直接赋值</span></li><li id=\"ue9854896\"><span class=\"ne-text\">如果没有，则为当前作用域没有。则去父级作用域看是否有，如果无，则去上一级作用域中查找。</span></li><li id=\"ue6dff1b4\"><span class=\"ne-text\">如果最终没有找到，则抛异常。</span></li></ul></ul><div class=\"ne-quote\"><p id=\"u34185550\" class=\"ne-p\"><span class=\"ne-text\">作用域套作用域，即作用域链。</span></p></div><h2 id=\"zBAey\"><span class=\"ne-text\">作用域</span></h2><p id=\"u0728abfe\" class=\"ne-p\"><span class=\"ne-text\">变量最基本的能力就是</span><strong><span class=\"ne-text\">能够存储变量中的值，并且允许我们对此变量进行访问和修改</span></strong><span class=\"ne-text\">，而对于变量存储，访问的</span><strong><span class=\"ne-text\">规则</span></strong><span class=\"ne-text\">是 </span><strong><span class=\"ne-text\">作用域</span></strong><span class=\"ne-text\">。</span></p><h3 id=\"WnHa1\"><span class=\"ne-text\">全局作用域</span></h3><p id=\"ue1aa2c17\" class=\"ne-p\"><span class=\"ne-text\">在任何函数外或代码块外的顶层作用域就是全局作用域，里面的变量就是全局变量。</span></p><pre data-language=\"javascript\" id=\"Xljsb\" class=\"ne-codeblock language-javascript\">var name='rose';   //全局作用域\n\nfunction showName(){    //函数作用域\n  console.log(name);\n}\n{\n  name='test';    //块级作用域\n}\nshowName();    //test</pre><div class=\"ne-quote\"><p id=\"u11f3be52\" class=\"ne-p\"><span class=\"ne-text\">可以看到，全局变量在全局作用域、函数作用域、块级作用域中都可以正常访问。</span></p></div><h3 id=\"F62EW\"><span class=\"ne-text\">函数作用域</span></h3><p id=\"ua216d393\" class=\"ne-p\"><span class=\"ne-text\">在函数中的作用域就是函数作用域。</span></p><pre data-language=\"javascript\" id=\"PVkNt\" class=\"ne-codeblock language-javascript\">function showName(){\n  var name='jack';    //函数作用域\n}\nshowName();   //方法调用\n{\n  console.log(name);  //块级作用域,Uncaught ReferenceError: name is not defined\n}\nconsole.log(name);  //全局作用域,Uncaught ReferenceError: name is not defined</pre><div class=\"ne-quote\"><p id=\"uf32c77ea\" class=\"ne-p\"><span class=\"ne-text\">可以看到，函数内部变量，在全局作用域及块级作用域中，都无法访问，只有在函数内部，才能访问到，所以函数内部的变量也称为</span><strong><span class=\"ne-text\">局部变量</span></strong><span class=\"ne-text\">。</span></p></div><h3 id=\"qBvlv\"><span class=\"ne-text\">块级作用域</span></h3><p id=\"u3e073e48\" class=\"ne-p\"><code class=\"ne-code\"><span class=\"ne-text\">ES6</span></code><span class=\"ne-text\">中新出的</span><code class=\"ne-code\"><span class=\"ne-text\">let</span></code><span class=\"ne-text\"> 和</span><code class=\"ne-code\"><span class=\"ne-text\">const</span></code><span class=\"ne-text\">关键字 自带作用域。</span></p><p id=\"u30259f9a\" class=\"ne-p\"><span class=\"ne-text\">块级作用域相当于是只在这块代码块中生效，如果它被大括号</span><code class=\"ne-code\"><span class=\"ne-text\">{}</span></code><span class=\"ne-text\">包围，则大括号就是一段代码块，代码块中使用</span><code class=\"ne-code\"><span class=\"ne-text\">const</span></code><span class=\"ne-text\">声明的变量也被称为</span><strong><span class=\"ne-text\">局部变量。</span></strong></p><pre data-language=\"javascript\" id=\"VtjIV\" class=\"ne-codeblock language-javascript\"> {\n   let name='rose';\n }\n\n console.log(name);    //Uncaught ReferenceError: name is not defined\n\n function showName{\n   console.log(name);\n }\n\n showName();    //Uncaught ReferenceError: name is not defined</pre><div class=\"ne-quote\"><p id=\"u6e4ec720\" class=\"ne-p\"><span class=\"ne-text\">可以看到，块级作用域中的变量，在代码块外面就访问不到了。</span></p></div><h2 id=\"ZK0tc\"><span class=\"ne-text\">作用域链</span></h2><p id=\"u5e8f7bad\" class=\"ne-p\"><strong><span class=\"ne-text\">作用域和作用域的嵌套，就产生了作用域链。作用域链的查找，向外不向内。</span></strong></p><h2 id=\"Ab127\"><span class=\"ne-text\">变量提升</span></h2><pre data-language=\"javascript\" id=\"LsUja\" class=\"ne-codeblock language-javascript\">name='rose';\nconsole.log(name);    //rose\nvar name;</pre><p id=\"ub973255c\" class=\"ne-p\"><span class=\"ne-text\">可以发现，这段代码可以正常运行，并且不会报错。</span></p><p id=\"u8c1c4959\" class=\"ne-p\"><span class=\"ne-text\">在JS眼中代码实际上是这样的：</span></p><pre data-language=\"javascript\" id=\"YlVL7\" class=\"ne-codeblock language-javascript\">var name;\nname='rose';\nconsole.log(name);    // rose</pre><hr id=\"jtmuJ\" class=\"ne-hr\"><p id=\"u5413eef6\" class=\"ne-p\"><code class=\"ne-code\"><span class=\"ne-text\">let</span></code><span class=\"ne-text\">和</span><code class=\"ne-code\"><span class=\"ne-text\">const</span></code><span class=\"ne-text\">代码：</span></p><pre data-language=\"javascript\" id=\"qGVyh\" class=\"ne-codeblock language-javascript\">name='rose';\nconsole.log(name)    //Uncaught ReferenceError: Cannot access 'name' before initialization\nlet name;</pre><div class=\"ne-quote\"><p id=\"ucb557f28\" class=\"ne-p\"><span class=\"ne-text\">let 、const </span><strong><span class=\"ne-text\">禁用变量提升。</span></strong><span class=\"ne-text\">const 声明后必赋值。</span></p></div><h3 id=\"Bl19f\"><span class=\"ne-text\">let、const、var的区别</span></h3><ol class=\"ne-ol\"><li id=\"u24c99da2\"><strong><span class=\"ne-text\">块级作用域</span></strong><span class=\"ne-text\">：块级作用域由</span><code class=\"ne-code\"><span class=\"ne-text\">{}</span></code><span class=\"ne-text\">包括，</span><code class=\"ne-code\"><span class=\"ne-text\">let</span></code><span class=\"ne-text\">和</span><code class=\"ne-code\"><span class=\"ne-text\">const</span></code><span class=\"ne-text\">具有块级作用域，</span><code class=\"ne-code\"><span class=\"ne-text\">var</span></code><span class=\"ne-text\">不存在块级作用域。</span></li></ol><p id=\"ue5046bec\" class=\"ne-p\" style=\"text-indent: 2em\"><span class=\"ne-text\">块级作用域解决了</span><code class=\"ne-code\"><span class=\"ne-text\">ES5</span></code><span class=\"ne-text\">中的两个问题：</span></p><ul class=\"ne-list-wrap\"><ul ne-level=\"1\" class=\"ne-ul\"><li id=\"u64d4e962\"><span class=\"ne-text\">内层变量可能覆盖外层变量</span></li><li id=\"u30b2979a\"><span class=\"ne-text\">用来计数的循环变量泄漏为全局变量</span></li></ul></ul><ol start=\"2\" class=\"ne-ol\"><li id=\"u8ab396a0\"><strong><span class=\"ne-text\">变量提升</span></strong><span class=\"ne-text\">：var 存在变量提升，let 和 const 不存在变量提升，即变量只能在声明后使用，否则会报错。</span></li><li id=\"ua25ffd8a\"><strong><span class=\"ne-text\">给全局添加属性</span></strong><span class=\"ne-text\">：浏览器的全局对象是window，Node的全局变量是global。var 声明的变量为全局变量，并且会将该变量添加为全局对象的属性，但是let和const不会。</span></li><li id=\"udb264a72\"><strong><span class=\"ne-text\">重复声明</span></strong><span class=\"ne-text\">：var声明变量时，可以重复声明变量，后声明的变量会覆盖之前声明的变量。let 和 const 不允许在同一作用域下重复声明变量。</span></li><li id=\"ub01b56be\"><strong><span class=\"ne-text\">暂时性死区：</span></strong><span class=\"ne-text\">在使用let、const关键字声明变量时，该变量是不可用的，这在语法上，成为</span><strong><span class=\"ne-text\">暂时性死区</span></strong><span class=\"ne-text\">。</span></li></ol><p id=\"u2df43a4e\" class=\"ne-p\"><span class=\"ne-text\">使用var声明的变量不存在暂时性死区。</span></p><ol start=\"6\" class=\"ne-ol\"><li id=\"u843deaf4\"><strong><span class=\"ne-text\">初始值设置</span></strong><span class=\"ne-text\">：在变量声明时，var和let可以不用设置初始值。而const声明变量必须设置初始值。</span></li><li id=\"ua65d024d\"><strong><span class=\"ne-text\">指针指向</span></strong><span class=\"ne-text\">：let和const都是ES6新增的用于创建变量的语法。let创建的变量可以更改指针指向（可以重新赋值）。但const声明的变量不允许改变指针的指向（不允许重新赋值）。</span></li></ol><h2 id=\"kja5Y\"><span class=\"ne-text\">暂时性死区</span></h2><pre data-language=\"javascript\" id=\"jNK4I\" class=\"ne-codeblock language-javascript\">var name='rose';\n\n{\n  name='bob';\n  let name;    //Uncaught ReferenceError: Cannot access 'name' before initialization\n}</pre><p id=\"u662742dc\" class=\"ne-p\"><strong><span class=\"ne-text\">如果区块中存在let和const，这个区块对于这些关键字声明的变量，从一开始就形成了封闭作用域。</span></strong></p><p id=\"ud45ef18b\" class=\"ne-p\"><span class=\"ne-text\">因为JS清楚地感知到了name是用let声明在当前这个代码块内的，所以会给这个变量name加上了暂时性死区的限制，它就不往外探出头了。</span></p><p id=\"u488c1d48\" class=\"ne-p\"><span class=\"ne-text\">因此，如果我们把上面的</span><code class=\"ne-code\"><span class=\"ne-text\">let name;</span></code><span class=\"ne-text\">去掉，程序也能正常运行，name的值也能被成功修改为blob，就是正常地按照</span><strong><span class=\"ne-text\">作用域链</span></strong><span class=\"ne-text\">的规则，向外探出头去了。</span></p><p id=\"u4858bc45\" class=\"ne-p\"><span class=\"ne-text\"></span></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><meta name=\"paragraphSpacing\" content=\"relax\" /><p data-lake-id=\"u191f528d\" id=\"u191f528d\"><span data-lake-id=\"ubf0dab9f\" id=\"ubf0dab9f\">--- </span></p><p data-lake-id=\"uaabe2cf3\" id=\"uaabe2cf3\"><span data-lake-id=\"u60340cfc\" id=\"u60340cfc\">title: JS编译原理  </span></p><p data-lake-id=\"u6da62028\" id=\"u6da62028\"><span data-lake-id=\"ua6aa27bd\" id=\"ua6aa27bd\">categories:  前端进阶</span></p><p data-lake-id=\"u05972217\" id=\"u05972217\"><span data-lake-id=\"u2aa627f1\" id=\"u2aa627f1\">tags:  [JS,编译原理]</span></p><p data-lake-id=\"ua7b72cc6\" id=\"ua7b72cc6\"><span data-lake-id=\"u5ab4e882\" id=\"u5ab4e882\">--- </span></p><h2 data-lake-id=\"xlRa4\" id=\"xlRa4\"><span data-lake-id=\"u8f131ccf\" id=\"u8f131ccf\">JS编译原理</span></h2><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%20%3D%20%5C%22rose%5C%22%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22keEto%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u176ac26e\" id=\"u176ac26e\"><span data-lake-id=\"ubd9b17f8\" id=\"ubd9b17f8\">上面这行代码在JS中会这样呈现：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3B%20%2F%2F%20%E7%BC%96%E8%AF%91%E9%98%B6%E6%AE%B5%E5%A4%84%E7%90%86%5Cnname%20%3D%20'rose'%3B%20%20%2F%2F%20%E6%89%A7%E8%A1%8C%E9%98%B6%E6%AE%B5%E5%A4%84%E7%90%86%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22CsAUc%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u96266933\" id=\"u96266933\"><span data-lake-id=\"ua5e83961\" id=\"ua5e83961\">JS编译主要分为两个阶段：</span><strong><span data-lake-id=\"u97904e60\" id=\"u97904e60\">编译阶段和执行阶段</span></strong><span data-lake-id=\"u5b0f48b5\" id=\"u5b0f48b5\">。</span></p><h3 data-lake-id=\"N4UAu\" id=\"N4UAu\"><span data-lake-id=\"u5c596e19\" id=\"u5c596e19\">编译阶段</span></h3><p data-lake-id=\"u1703a650\" id=\"u1703a650\"><span data-lake-id=\"ud43efef0\" id=\"ud43efef0\">此阶段主角为</span><strong><span data-lake-id=\"u0ae7ba16\" id=\"u0ae7ba16\">编译器。</span></strong><span data-lake-id=\"uc3f8ee65\" id=\"uc3f8ee65\">​</span></p><ul list=\"uc337c410\"><li fid=\"u82afc594\" data-lake-id=\"u3a98c43f\" id=\"u3a98c43f\"><span data-lake-id=\"uf1919b71\" id=\"uf1919b71\">JS找遍作用域，看是否存在name的变量</span></li></ul><ul list=\"uc337c410\" data-lake-indent=\"1\"><li fid=\"u82afc594\" data-lake-id=\"uf39dd4f2\" id=\"uf39dd4f2\"><span data-lake-id=\"u8a84bee4\" id=\"u8a84bee4\">如果已经存在，则什么都不做，直接忽略</span><code data-lake-id=\"u34684b43\" id=\"u34684b43\"><span data-lake-id=\"u7546971f\" id=\"u7546971f\">var name</span></code><span data-lake-id=\"ucf590efb\" id=\"ucf590efb\">这个声明，继续编译下去；</span></li><li fid=\"u82afc594\" data-lake-id=\"u80ced5d6\" id=\"u80ced5d6\"><span data-lake-id=\"ua2e5ac25\" id=\"ua2e5ac25\">如果没有，则在当前作用域中新增一个</span><code data-lake-id=\"ub879af03\" id=\"ub879af03\"><span data-lake-id=\"uf1b3969a\" id=\"uf1b3969a\">name</span></code><span data-lake-id=\"u79d1a60b\" id=\"u79d1a60b\">变量</span></li></ul><ul list=\"uc337c410\" start=\"2\"><li fid=\"u82afc594\" data-lake-id=\"ub8660271\" id=\"ub8660271\"><span data-lake-id=\"u42d54bc3\" id=\"u42d54bc3\">编译器会为引擎生成运行时所需的代码，程序就进入了执行阶段。</span></li></ul><h3 data-lake-id=\"zST4O\" id=\"zST4O\"><span data-lake-id=\"uea088bf2\" id=\"uea088bf2\">执行阶段</span></h3><p data-lake-id=\"u412a4438\" id=\"u412a4438\"><span data-lake-id=\"ue3342d89\" id=\"ue3342d89\">此阶段主角为</span><strong><span data-lake-id=\"u74810a3e\" id=\"u74810a3e\">JS引擎。</span></strong></p><ul list=\"u14ab37f6\"><li fid=\"ub09de1fb\" data-lake-id=\"u655ac592\" id=\"u655ac592\"><strong><span data-lake-id=\"uc107b231\" id=\"uc107b231\">JS引擎</span></strong><span data-lake-id=\"u541c4d68\" id=\"u541c4d68\">在运行时，会先找遍当前作用域，看是否有一个叫</span><code data-lake-id=\"u891a611a\" id=\"u891a611a\"><span data-lake-id=\"u73afc5b0\" id=\"u73afc5b0\">name</span></code><span data-lake-id=\"ufe5a3dfe\" id=\"ufe5a3dfe\">的变量。</span></li></ul><ul list=\"u14ab37f6\" data-lake-indent=\"1\"><li fid=\"ub09de1fb\" data-lake-id=\"u45c0d4af\" id=\"u45c0d4af\"><span data-lake-id=\"u41a7656d\" id=\"u41a7656d\">如果有，直接赋值</span></li><li fid=\"ub09de1fb\" data-lake-id=\"ue9854896\" id=\"ue9854896\"><span data-lake-id=\"u480e3c58\" id=\"u480e3c58\">如果没有，则为当前作用域没有。则去父级作用域看是否有，如果无，则去上一级作用域中查找。</span></li><li fid=\"ub09de1fb\" data-lake-id=\"ue6dff1b4\" id=\"ue6dff1b4\"><span data-lake-id=\"ue45c38d4\" id=\"ue45c38d4\">如果最终没有找到，则抛异常。</span></li></ul><blockquote data-lake-id=\"ud40df6a3\" id=\"ud40df6a3\"><p data-lake-id=\"u34185550\" id=\"u34185550\"><span data-lake-id=\"u02b2dacb\" id=\"u02b2dacb\">作用域套作用域，即作用域链。</span></p></blockquote><h2 data-lake-id=\"zBAey\" id=\"zBAey\"><span data-lake-id=\"ucad2e8c5\" id=\"ucad2e8c5\">作用域</span></h2><p data-lake-id=\"u0728abfe\" id=\"u0728abfe\"><span data-lake-id=\"ue603b568\" id=\"ue603b568\">变量最基本的能力就是</span><strong><span data-lake-id=\"u9a927b51\" id=\"u9a927b51\">能够存储变量中的值，并且允许我们对此变量进行访问和修改</span></strong><span data-lake-id=\"u7e88b447\" id=\"u7e88b447\">，而对于变量存储，访问的</span><strong><span data-lake-id=\"ube217353\" id=\"ube217353\">规则</span></strong><span data-lake-id=\"u079458fa\" id=\"u079458fa\">是 </span><strong><span data-lake-id=\"u5b2adab9\" id=\"u5b2adab9\">作用域</span></strong><span data-lake-id=\"u85e07f10\" id=\"u85e07f10\">。</span></p><h3 data-lake-id=\"WnHa1\" id=\"WnHa1\"><span data-lake-id=\"u4fd37e8c\" id=\"u4fd37e8c\">全局作用域</span></h3><p data-lake-id=\"ue1aa2c17\" id=\"ue1aa2c17\"><span data-lake-id=\"uc274c8a7\" id=\"uc274c8a7\">在任何函数外或代码块外的顶层作用域就是全局作用域，里面的变量就是全局变量。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3D'rose'%3B%20%20%20%2F%2F%E5%85%A8%E5%B1%80%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%5Cnfunction%20showName()%7B%20%20%20%20%2F%2F%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%20%20console.log(name)%3B%5Cn%7D%5Cn%7B%5Cn%20%20name%3D'test'%3B%20%20%20%20%2F%2F%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%7D%5CnshowName()%3B%20%20%20%20%2F%2Ftest%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22Xljsb%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u5b8db1d0\" id=\"u5b8db1d0\"><p data-lake-id=\"u11f3be52\" id=\"u11f3be52\"><span data-lake-id=\"ucca0f2c1\" id=\"ucca0f2c1\">可以看到，全局变量在全局作用域、函数作用域、块级作用域中都可以正常访问。</span></p></blockquote><h3 data-lake-id=\"F62EW\" id=\"F62EW\"><span data-lake-id=\"u9ed1f5b2\" id=\"u9ed1f5b2\">函数作用域</span></h3><p data-lake-id=\"ua216d393\" id=\"ua216d393\"><span data-lake-id=\"u4ba3746a\" id=\"u4ba3746a\">在函数中的作用域就是函数作用域。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22function%20showName()%7B%5Cn%20%20var%20name%3D'jack'%3B%20%20%20%20%2F%2F%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%7D%5CnshowName()%3B%20%20%20%2F%2F%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%5Cn%7B%5Cn%20%20console.log(name)%3B%20%20%2F%2F%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F%2CUncaught%20ReferenceError%3A%20name%20is%20not%20defined%5Cn%7D%5Cnconsole.log(name)%3B%20%20%2F%2F%E5%85%A8%E5%B1%80%E4%BD%9C%E7%94%A8%E5%9F%9F%2CUncaught%20ReferenceError%3A%20name%20is%20not%20defined%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22PVkNt%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"ud73a1bda\" id=\"ud73a1bda\"><p data-lake-id=\"uf32c77ea\" id=\"uf32c77ea\"><span data-lake-id=\"u471f35d1\" id=\"u471f35d1\">可以看到，函数内部变量，在全局作用域及块级作用域中，都无法访问，只有在函数内部，才能访问到，所以函数内部的变量也称为</span><strong><span data-lake-id=\"u81069536\" id=\"u81069536\">局部变量</span></strong><span data-lake-id=\"u75b645af\" id=\"u75b645af\">。</span></p></blockquote><h3 data-lake-id=\"qBvlv\" id=\"qBvlv\"><span data-lake-id=\"uea96aabf\" id=\"uea96aabf\">块级作用域</span></h3><p data-lake-id=\"u3e073e48\" id=\"u3e073e48\"><code data-lake-id=\"u82596cfa\" id=\"u82596cfa\"><span data-lake-id=\"u45ea6be8\" id=\"u45ea6be8\">ES6</span></code><span data-lake-id=\"uff64854b\" id=\"uff64854b\">中新出的</span><code data-lake-id=\"u3b0079cf\" id=\"u3b0079cf\"><span data-lake-id=\"u9dfacb7c\" id=\"u9dfacb7c\">let</span></code><span data-lake-id=\"u2864ea10\" id=\"u2864ea10\"> 和</span><code data-lake-id=\"ue596bc93\" id=\"ue596bc93\"><span data-lake-id=\"u8a3c363a\" id=\"u8a3c363a\">const</span></code><span data-lake-id=\"ufe3d60b0\" id=\"ufe3d60b0\">关键字 自带作用域。</span></p><p data-lake-id=\"u30259f9a\" id=\"u30259f9a\"><span data-lake-id=\"u0be12410\" id=\"u0be12410\">块级作用域相当于是只在这块代码块中生效，如果它被大括号</span><code data-lake-id=\"u4521af39\" id=\"u4521af39\"><span data-lake-id=\"u3f1fce7b\" id=\"u3f1fce7b\">{}</span></code><span data-lake-id=\"ua0903bc3\" id=\"ua0903bc3\">包围，则大括号就是一段代码块，代码块中使用</span><code data-lake-id=\"u04015a71\" id=\"u04015a71\"><span data-lake-id=\"u8ea54ba6\" id=\"u8ea54ba6\">const</span></code><span data-lake-id=\"u15a444a9\" id=\"u15a444a9\">声明的变量也被称为</span><strong><span data-lake-id=\"u1ed41699\" id=\"u1ed41699\">局部变量。</span></strong></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22%20%7B%5Cn%20%20%20let%20name%3D'rose'%3B%5Cn%20%7D%5Cn%5Cn%20console.log(name)%3B%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20name%20is%20not%20defined%5Cn%5Cn%20function%20showName%7B%5Cn%20%20%20console.log(name)%3B%5Cn%20%7D%5Cn%5Cn%20showName()%3B%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20name%20is%20not%20defined%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22VtjIV%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"ufabfcd92\" id=\"ufabfcd92\"><p data-lake-id=\"u6e4ec720\" id=\"u6e4ec720\"><span data-lake-id=\"u3caade56\" id=\"u3caade56\">可以看到，块级作用域中的变量，在代码块外面就访问不到了。</span></p></blockquote><h2 data-lake-id=\"ZK0tc\" id=\"ZK0tc\"><span data-lake-id=\"u8b852229\" id=\"u8b852229\">作用域链</span></h2><p data-lake-id=\"u5e8f7bad\" id=\"u5e8f7bad\"><strong><span data-lake-id=\"u28066fc1\" id=\"u28066fc1\">作用域和作用域的嵌套，就产生了作用域链。作用域链的查找，向外不向内。</span></strong></p><h2 data-lake-id=\"Ab127\" id=\"Ab127\"><span data-lake-id=\"u78055112\" id=\"u78055112\">变量提升</span></h2><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22name%3D'rose'%3B%5Cnconsole.log(name)%3B%20%20%20%20%2F%2Frose%5Cnvar%20name%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22LsUja%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"ub973255c\" id=\"ub973255c\"><span data-lake-id=\"uf9491d14\" id=\"uf9491d14\">可以发现，这段代码可以正常运行，并且不会报错。</span></p><p data-lake-id=\"u8c1c4959\" id=\"u8c1c4959\"><span data-lake-id=\"u6ab6be9b\" id=\"u6ab6be9b\">在JS眼中代码实际上是这样的：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3B%5Cnname%3D'rose'%3B%5Cnconsole.log(name)%3B%20%20%20%20%2F%2F%20rose%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22YlVL7%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><card type=\"block\" name=\"hr\" value=\"data:%7B%22id%22%3A%22jtmuJ%22%7D\"></card><p data-lake-id=\"u5413eef6\" id=\"u5413eef6\"><code data-lake-id=\"ucbd5fd85\" id=\"ucbd5fd85\"><span data-lake-id=\"uad03d633\" id=\"uad03d633\">let</span></code><span data-lake-id=\"u1b10175a\" id=\"u1b10175a\">和</span><code data-lake-id=\"u21960cad\" id=\"u21960cad\"><span data-lake-id=\"ubaf7bb88\" id=\"ubaf7bb88\">const</span></code><span data-lake-id=\"u300536c7\" id=\"u300536c7\">代码：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22name%3D'rose'%3B%5Cnconsole.log(name)%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20Cannot%20access%20'name'%20before%20initialization%5Cnlet%20name%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22qGVyh%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u0b506ec4\" id=\"u0b506ec4\"><p data-lake-id=\"ucb557f28\" id=\"ucb557f28\"><span data-lake-id=\"u4b646ac0\" id=\"u4b646ac0\">let 、const </span><strong><span data-lake-id=\"u43ed9f7e\" id=\"u43ed9f7e\">禁用变量提升。</span></strong><span data-lake-id=\"u3ca180fd\" id=\"u3ca180fd\">const 声明后必赋值。</span></p></blockquote><h3 data-lake-id=\"Bl19f\" id=\"Bl19f\"><span data-lake-id=\"u1525e958\" id=\"u1525e958\">let、const、var的区别</span></h3><ol list=\"ufe97e951\"><li fid=\"ua89a85e8\" data-lake-id=\"u24c99da2\" id=\"u24c99da2\"><strong><span data-lake-id=\"ub1d79d02\" id=\"ub1d79d02\">块级作用域</span></strong><span data-lake-id=\"ub0297370\" id=\"ub0297370\">：块级作用域由</span><code data-lake-id=\"u0d098daf\" id=\"u0d098daf\"><span data-lake-id=\"ua728a5f8\" id=\"ua728a5f8\">{}</span></code><span data-lake-id=\"udab01170\" id=\"udab01170\">包括，</span><code data-lake-id=\"u4a584c8a\" id=\"u4a584c8a\"><span data-lake-id=\"u7b133ece\" id=\"u7b133ece\">let</span></code><span data-lake-id=\"u0490345f\" id=\"u0490345f\">和</span><code data-lake-id=\"ufe69257b\" id=\"ufe69257b\"><span data-lake-id=\"ub12b0df0\" id=\"ub12b0df0\">const</span></code><span data-lake-id=\"u48288ee1\" id=\"u48288ee1\">具有块级作用域，</span><code data-lake-id=\"u85bccedb\" id=\"u85bccedb\"><span data-lake-id=\"u73c5bd91\" id=\"u73c5bd91\">var</span></code><span data-lake-id=\"ud4188673\" id=\"ud4188673\">不存在块级作用域。</span></li></ol><p data-lake-id=\"ue5046bec\" id=\"ue5046bec\" style=\"text-indent: 2em\"><span data-lake-id=\"u2993a276\" id=\"u2993a276\">块级作用域解决了</span><code data-lake-id=\"u6a83e3ac\" id=\"u6a83e3ac\"><span data-lake-id=\"u1ad25931\" id=\"u1ad25931\">ES5</span></code><span data-lake-id=\"u3f2c1b64\" id=\"u3f2c1b64\">中的两个问题：</span></p><ul list=\"udb3ccb60\" data-lake-indent=\"1\"><li fid=\"ubeb5f54a\" data-lake-id=\"u64d4e962\" id=\"u64d4e962\"><span data-lake-id=\"ub639e8d2\" id=\"ub639e8d2\">内层变量可能覆盖外层变量</span></li><li fid=\"ubeb5f54a\" data-lake-id=\"u30b2979a\" id=\"u30b2979a\"><span data-lake-id=\"u3060bf23\" id=\"u3060bf23\">用来计数的循环变量泄漏为全局变量</span></li></ul><ol list=\"ubd33a1c8\" start=\"2\"><li fid=\"u4f555d4d\" data-lake-id=\"u8ab396a0\" id=\"u8ab396a0\"><strong><span data-lake-id=\"u3eafd80e\" id=\"u3eafd80e\">变量提升</span></strong><span data-lake-id=\"ud999a1e2\" id=\"ud999a1e2\">：var 存在变量提升，let 和 const 不存在变量提升，即变量只能在声明后使用，否则会报错。</span></li><li fid=\"u4f555d4d\" data-lake-id=\"ua25ffd8a\" id=\"ua25ffd8a\"><strong><span data-lake-id=\"uaebee069\" id=\"uaebee069\">给全局添加属性</span></strong><span data-lake-id=\"uabbdb779\" id=\"uabbdb779\">：浏览器的全局对象是window，Node的全局变量是global。var 声明的变量为全局变量，并且会将该变量添加为全局对象的属性，但是let和const不会。</span></li><li fid=\"u4f555d4d\" data-lake-id=\"udb264a72\" id=\"udb264a72\"><strong><span data-lake-id=\"uba22d208\" id=\"uba22d208\">重复声明</span></strong><span data-lake-id=\"u7ebcf304\" id=\"u7ebcf304\">：var声明变量时，可以重复声明变量，后声明的变量会覆盖之前声明的变量。let 和 const 不允许在同一作用域下重复声明变量。</span></li><li fid=\"u4f555d4d\" data-lake-id=\"ub01b56be\" id=\"ub01b56be\"><strong><span data-lake-id=\"u8aec9f4f\" id=\"u8aec9f4f\">暂时性死区：</span></strong><span data-lake-id=\"u8fb4f6dc\" id=\"u8fb4f6dc\">在使用let、const关键字声明变量时，该变量是不可用的，这在语法上，成为</span><strong><span data-lake-id=\"ua637fb52\" id=\"ua637fb52\">暂时性死区</span></strong><span data-lake-id=\"ue96aceb1\" id=\"ue96aceb1\">。</span></li></ol><p data-lake-id=\"u2df43a4e\" id=\"u2df43a4e\"><span data-lake-id=\"uf31b3f3d\" id=\"uf31b3f3d\">使用var声明的变量不存在暂时性死区。</span></p><ol list=\"u0d62fb0e\" start=\"6\"><li fid=\"u306eb697\" data-lake-id=\"u843deaf4\" id=\"u843deaf4\"><strong><span data-lake-id=\"u9ae738b4\" id=\"u9ae738b4\">初始值设置</span></strong><span data-lake-id=\"u2cc98e0a\" id=\"u2cc98e0a\">：在变量声明时，var和let可以不用设置初始值。而const声明变量必须设置初始值。</span></li><li fid=\"u306eb697\" data-lake-id=\"ua65d024d\" id=\"ua65d024d\"><strong><span data-lake-id=\"u31de973c\" id=\"u31de973c\">指针指向</span></strong><span data-lake-id=\"uf1347e10\" id=\"uf1347e10\">：let和const都是ES6新增的用于创建变量的语法。let创建的变量可以更改指针指向（可以重新赋值）。但const声明的变量不允许改变指针的指向（不允许重新赋值）。</span></li></ol><h2 data-lake-id=\"kja5Y\" id=\"kja5Y\"><span data-lake-id=\"u0c1cd73f\" id=\"u0c1cd73f\">暂时性死区</span></h2><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3D'rose'%3B%5Cn%5Cn%7B%5Cn%20%20name%3D'bob'%3B%5Cn%20%20let%20name%3B%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20Cannot%20access%20'name'%20before%20initialization%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22jNK4I%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u662742dc\" id=\"u662742dc\"><strong><span data-lake-id=\"u9b74dfc2\" id=\"u9b74dfc2\">如果区块中存在let和const，这个区块对于这些关键字声明的变量，从一开始就形成了封闭作用域。</span></strong></p><p data-lake-id=\"ud45ef18b\" id=\"ud45ef18b\"><span data-lake-id=\"u29b22993\" id=\"u29b22993\">因为JS清楚地感知到了name是用let声明在当前这个代码块内的，所以会给这个变量name加上了暂时性死区的限制，它就不往外探出头了。</span></p><p data-lake-id=\"u488c1d48\" id=\"u488c1d48\"><span data-lake-id=\"u488612bd\" id=\"u488612bd\">因此，如果我们把上面的</span><code data-lake-id=\"u7c5dee22\" id=\"u7c5dee22\"><span data-lake-id=\"u6e0ad624\" id=\"u6e0ad624\">let name;</span></code><span data-lake-id=\"u2f2feec9\" id=\"u2f2feec9\">去掉，程序也能正常运行，name的值也能被成功修改为blob，就是正常地按照</span><strong><span data-lake-id=\"u1d9bac4d\" id=\"u1d9bac4d\">作用域链</span></strong><span data-lake-id=\"u3c4e7312\" id=\"u3c4e7312\">的规则，向外探出头去了。</span></p><p data-lake-id=\"u4858bc45\" id=\"u4858bc45\"><span data-lake-id=\"ubadbef55\" id=\"ubadbef55\">​</span><br></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><meta name=\"paragraphSpacing\" content=\"relax\" /><p data-lake-id=\"u191f528d\" id=\"u191f528d\"><span data-lake-id=\"ubf0dab9f\" id=\"ubf0dab9f\">--- </span></p><p data-lake-id=\"uaabe2cf3\" id=\"uaabe2cf3\"><span data-lake-id=\"u60340cfc\" id=\"u60340cfc\">title: JS编译原理  </span></p><p data-lake-id=\"u6da62028\" id=\"u6da62028\"><span data-lake-id=\"ua6aa27bd\" id=\"ua6aa27bd\">categories:  前端进阶</span></p><p data-lake-id=\"u05972217\" id=\"u05972217\"><span data-lake-id=\"u2aa627f1\" id=\"u2aa627f1\">tags:  [JS,编译原理]</span></p><p data-lake-id=\"ua7b72cc6\" id=\"ua7b72cc6\"><span data-lake-id=\"u5ab4e882\" id=\"u5ab4e882\">--- </span></p><h2 data-lake-id=\"xlRa4\" id=\"xlRa4\"><span data-lake-id=\"u8f131ccf\" id=\"u8f131ccf\">JS编译原理</span></h2><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%20%3D%20%5C%22rose%5C%22%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22keEto%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u176ac26e\" id=\"u176ac26e\"><span data-lake-id=\"ubd9b17f8\" id=\"ubd9b17f8\">上面这行代码在JS中会这样呈现：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3B%20%2F%2F%20%E7%BC%96%E8%AF%91%E9%98%B6%E6%AE%B5%E5%A4%84%E7%90%86%5Cnname%20%3D%20'rose'%3B%20%20%2F%2F%20%E6%89%A7%E8%A1%8C%E9%98%B6%E6%AE%B5%E5%A4%84%E7%90%86%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22CsAUc%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u96266933\" id=\"u96266933\"><span data-lake-id=\"ua5e83961\" id=\"ua5e83961\">JS编译主要分为两个阶段：</span><strong><span data-lake-id=\"u97904e60\" id=\"u97904e60\">编译阶段和执行阶段</span></strong><span data-lake-id=\"u5b0f48b5\" id=\"u5b0f48b5\">。</span></p><h3 data-lake-id=\"N4UAu\" id=\"N4UAu\"><span data-lake-id=\"u5c596e19\" id=\"u5c596e19\">编译阶段</span></h3><p data-lake-id=\"u1703a650\" id=\"u1703a650\"><span data-lake-id=\"ud43efef0\" id=\"ud43efef0\">此阶段主角为</span><strong><span data-lake-id=\"u0ae7ba16\" id=\"u0ae7ba16\">编译器。</span></strong><span data-lake-id=\"uc3f8ee65\" id=\"uc3f8ee65\">​</span></p><ul list=\"uc337c410\"><li fid=\"u82afc594\" data-lake-id=\"u3a98c43f\" id=\"u3a98c43f\"><span data-lake-id=\"uf1919b71\" id=\"uf1919b71\">JS找遍作用域，看是否存在name的变量</span></li></ul><ul list=\"uc337c410\" data-lake-indent=\"1\"><li fid=\"u82afc594\" data-lake-id=\"uf39dd4f2\" id=\"uf39dd4f2\"><span data-lake-id=\"u8a84bee4\" id=\"u8a84bee4\">如果已经存在，则什么都不做，直接忽略</span><code data-lake-id=\"u34684b43\" id=\"u34684b43\"><span data-lake-id=\"u7546971f\" id=\"u7546971f\">var name</span></code><span data-lake-id=\"ucf590efb\" id=\"ucf590efb\">这个声明，继续编译下去；</span></li><li fid=\"u82afc594\" data-lake-id=\"u80ced5d6\" id=\"u80ced5d6\"><span data-lake-id=\"ua2e5ac25\" id=\"ua2e5ac25\">如果没有，则在当前作用域中新增一个</span><code data-lake-id=\"ub879af03\" id=\"ub879af03\"><span data-lake-id=\"uf1b3969a\" id=\"uf1b3969a\">name</span></code><span data-lake-id=\"u79d1a60b\" id=\"u79d1a60b\">变量</span></li></ul><ul list=\"uc337c410\" start=\"2\"><li fid=\"u82afc594\" data-lake-id=\"ub8660271\" id=\"ub8660271\"><span data-lake-id=\"u42d54bc3\" id=\"u42d54bc3\">编译器会为引擎生成运行时所需的代码，程序就进入了执行阶段。</span></li></ul><h3 data-lake-id=\"zST4O\" id=\"zST4O\"><span data-lake-id=\"uea088bf2\" id=\"uea088bf2\">执行阶段</span></h3><p data-lake-id=\"u412a4438\" id=\"u412a4438\"><span data-lake-id=\"ue3342d89\" id=\"ue3342d89\">此阶段主角为</span><strong><span data-lake-id=\"u74810a3e\" id=\"u74810a3e\">JS引擎。</span></strong></p><ul list=\"u14ab37f6\"><li fid=\"ub09de1fb\" data-lake-id=\"u655ac592\" id=\"u655ac592\"><strong><span data-lake-id=\"uc107b231\" id=\"uc107b231\">JS引擎</span></strong><span data-lake-id=\"u541c4d68\" id=\"u541c4d68\">在运行时，会先找遍当前作用域，看是否有一个叫</span><code data-lake-id=\"u891a611a\" id=\"u891a611a\"><span data-lake-id=\"u73afc5b0\" id=\"u73afc5b0\">name</span></code><span data-lake-id=\"ufe5a3dfe\" id=\"ufe5a3dfe\">的变量。</span></li></ul><ul list=\"u14ab37f6\" data-lake-indent=\"1\"><li fid=\"ub09de1fb\" data-lake-id=\"u45c0d4af\" id=\"u45c0d4af\"><span data-lake-id=\"u41a7656d\" id=\"u41a7656d\">如果有，直接赋值</span></li><li fid=\"ub09de1fb\" data-lake-id=\"ue9854896\" id=\"ue9854896\"><span data-lake-id=\"u480e3c58\" id=\"u480e3c58\">如果没有，则为当前作用域没有。则去父级作用域看是否有，如果无，则去上一级作用域中查找。</span></li><li fid=\"ub09de1fb\" data-lake-id=\"ue6dff1b4\" id=\"ue6dff1b4\"><span data-lake-id=\"ue45c38d4\" id=\"ue45c38d4\">如果最终没有找到，则抛异常。</span></li></ul><blockquote data-lake-id=\"ud40df6a3\" id=\"ud40df6a3\"><p data-lake-id=\"u34185550\" id=\"u34185550\"><span data-lake-id=\"u02b2dacb\" id=\"u02b2dacb\">作用域套作用域，即作用域链。</span></p></blockquote><h2 data-lake-id=\"zBAey\" id=\"zBAey\"><span data-lake-id=\"ucad2e8c5\" id=\"ucad2e8c5\">作用域</span></h2><p data-lake-id=\"u0728abfe\" id=\"u0728abfe\"><span data-lake-id=\"ue603b568\" id=\"ue603b568\">变量最基本的能力就是</span><strong><span data-lake-id=\"u9a927b51\" id=\"u9a927b51\">能够存储变量中的值，并且允许我们对此变量进行访问和修改</span></strong><span data-lake-id=\"u7e88b447\" id=\"u7e88b447\">，而对于变量存储，访问的</span><strong><span data-lake-id=\"ube217353\" id=\"ube217353\">规则</span></strong><span data-lake-id=\"u079458fa\" id=\"u079458fa\">是 </span><strong><span data-lake-id=\"u5b2adab9\" id=\"u5b2adab9\">作用域</span></strong><span data-lake-id=\"u85e07f10\" id=\"u85e07f10\">。</span></p><h3 data-lake-id=\"WnHa1\" id=\"WnHa1\"><span data-lake-id=\"u4fd37e8c\" id=\"u4fd37e8c\">全局作用域</span></h3><p data-lake-id=\"ue1aa2c17\" id=\"ue1aa2c17\"><span data-lake-id=\"uc274c8a7\" id=\"uc274c8a7\">在任何函数外或代码块外的顶层作用域就是全局作用域，里面的变量就是全局变量。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3D'rose'%3B%20%20%20%2F%2F%E5%85%A8%E5%B1%80%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%5Cnfunction%20showName()%7B%20%20%20%20%2F%2F%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%20%20console.log(name)%3B%5Cn%7D%5Cn%7B%5Cn%20%20name%3D'test'%3B%20%20%20%20%2F%2F%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%7D%5CnshowName()%3B%20%20%20%20%2F%2Ftest%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22Xljsb%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u5b8db1d0\" id=\"u5b8db1d0\"><p data-lake-id=\"u11f3be52\" id=\"u11f3be52\"><span data-lake-id=\"ucca0f2c1\" id=\"ucca0f2c1\">可以看到，全局变量在全局作用域、函数作用域、块级作用域中都可以正常访问。</span></p></blockquote><h3 data-lake-id=\"F62EW\" id=\"F62EW\"><span data-lake-id=\"u9ed1f5b2\" id=\"u9ed1f5b2\">函数作用域</span></h3><p data-lake-id=\"ua216d393\" id=\"ua216d393\"><span data-lake-id=\"u4ba3746a\" id=\"u4ba3746a\">在函数中的作用域就是函数作用域。</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22function%20showName()%7B%5Cn%20%20var%20name%3D'jack'%3B%20%20%20%20%2F%2F%E5%87%BD%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F%5Cn%7D%5CnshowName()%3B%20%20%20%2F%2F%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%5Cn%7B%5Cn%20%20console.log(name)%3B%20%20%2F%2F%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F%2CUncaught%20ReferenceError%3A%20name%20is%20not%20defined%5Cn%7D%5Cnconsole.log(name)%3B%20%20%2F%2F%E5%85%A8%E5%B1%80%E4%BD%9C%E7%94%A8%E5%9F%9F%2CUncaught%20ReferenceError%3A%20name%20is%20not%20defined%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22PVkNt%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"ud73a1bda\" id=\"ud73a1bda\"><p data-lake-id=\"uf32c77ea\" id=\"uf32c77ea\"><span data-lake-id=\"u471f35d1\" id=\"u471f35d1\">可以看到，函数内部变量，在全局作用域及块级作用域中，都无法访问，只有在函数内部，才能访问到，所以函数内部的变量也称为</span><strong><span data-lake-id=\"u81069536\" id=\"u81069536\">局部变量</span></strong><span data-lake-id=\"u75b645af\" id=\"u75b645af\">。</span></p></blockquote><h3 data-lake-id=\"qBvlv\" id=\"qBvlv\"><span data-lake-id=\"uea96aabf\" id=\"uea96aabf\">块级作用域</span></h3><p data-lake-id=\"u3e073e48\" id=\"u3e073e48\"><code data-lake-id=\"u82596cfa\" id=\"u82596cfa\"><span data-lake-id=\"u45ea6be8\" id=\"u45ea6be8\">ES6</span></code><span data-lake-id=\"uff64854b\" id=\"uff64854b\">中新出的</span><code data-lake-id=\"u3b0079cf\" id=\"u3b0079cf\"><span data-lake-id=\"u9dfacb7c\" id=\"u9dfacb7c\">let</span></code><span data-lake-id=\"u2864ea10\" id=\"u2864ea10\"> 和</span><code data-lake-id=\"ue596bc93\" id=\"ue596bc93\"><span data-lake-id=\"u8a3c363a\" id=\"u8a3c363a\">const</span></code><span data-lake-id=\"ufe3d60b0\" id=\"ufe3d60b0\">关键字 自带作用域。</span></p><p data-lake-id=\"u30259f9a\" id=\"u30259f9a\"><span data-lake-id=\"u0be12410\" id=\"u0be12410\">块级作用域相当于是只在这块代码块中生效，如果它被大括号</span><code data-lake-id=\"u4521af39\" id=\"u4521af39\"><span data-lake-id=\"u3f1fce7b\" id=\"u3f1fce7b\">{}</span></code><span data-lake-id=\"ua0903bc3\" id=\"ua0903bc3\">包围，则大括号就是一段代码块，代码块中使用</span><code data-lake-id=\"u04015a71\" id=\"u04015a71\"><span data-lake-id=\"u8ea54ba6\" id=\"u8ea54ba6\">const</span></code><span data-lake-id=\"u15a444a9\" id=\"u15a444a9\">声明的变量也被称为</span><strong><span data-lake-id=\"u1ed41699\" id=\"u1ed41699\">局部变量。</span></strong></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22%20%7B%5Cn%20%20%20let%20name%3D'rose'%3B%5Cn%20%7D%5Cn%5Cn%20console.log(name)%3B%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20name%20is%20not%20defined%5Cn%5Cn%20function%20showName%7B%5Cn%20%20%20console.log(name)%3B%5Cn%20%7D%5Cn%5Cn%20showName()%3B%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20name%20is%20not%20defined%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22VtjIV%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"ufabfcd92\" id=\"ufabfcd92\"><p data-lake-id=\"u6e4ec720\" id=\"u6e4ec720\"><span data-lake-id=\"u3caade56\" id=\"u3caade56\">可以看到，块级作用域中的变量，在代码块外面就访问不到了。</span></p></blockquote><h2 data-lake-id=\"ZK0tc\" id=\"ZK0tc\"><span data-lake-id=\"u8b852229\" id=\"u8b852229\">作用域链</span></h2><p data-lake-id=\"u5e8f7bad\" id=\"u5e8f7bad\"><strong><span data-lake-id=\"u28066fc1\" id=\"u28066fc1\">作用域和作用域的嵌套，就产生了作用域链。作用域链的查找，向外不向内。</span></strong></p><h2 data-lake-id=\"Ab127\" id=\"Ab127\"><span data-lake-id=\"u78055112\" id=\"u78055112\">变量提升</span></h2><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22name%3D'rose'%3B%5Cnconsole.log(name)%3B%20%20%20%20%2F%2Frose%5Cnvar%20name%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22LsUja%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"ub973255c\" id=\"ub973255c\"><span data-lake-id=\"uf9491d14\" id=\"uf9491d14\">可以发现，这段代码可以正常运行，并且不会报错。</span></p><p data-lake-id=\"u8c1c4959\" id=\"u8c1c4959\"><span data-lake-id=\"u6ab6be9b\" id=\"u6ab6be9b\">在JS眼中代码实际上是这样的：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3B%5Cnname%3D'rose'%3B%5Cnconsole.log(name)%3B%20%20%20%20%2F%2F%20rose%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22YlVL7%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><card type=\"block\" name=\"hr\" value=\"data:%7B%22id%22%3A%22jtmuJ%22%7D\"></card><p data-lake-id=\"u5413eef6\" id=\"u5413eef6\"><code data-lake-id=\"ucbd5fd85\" id=\"ucbd5fd85\"><span data-lake-id=\"uad03d633\" id=\"uad03d633\">let</span></code><span data-lake-id=\"u1b10175a\" id=\"u1b10175a\">和</span><code data-lake-id=\"u21960cad\" id=\"u21960cad\"><span data-lake-id=\"ubaf7bb88\" id=\"ubaf7bb88\">const</span></code><span data-lake-id=\"u300536c7\" id=\"u300536c7\">代码：</span></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22name%3D'rose'%3B%5Cnconsole.log(name)%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20Cannot%20access%20'name'%20before%20initialization%5Cnlet%20name%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22qGVyh%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><blockquote data-lake-id=\"u0b506ec4\" id=\"u0b506ec4\"><p data-lake-id=\"ucb557f28\" id=\"ucb557f28\"><span data-lake-id=\"u4b646ac0\" id=\"u4b646ac0\">let 、const </span><strong><span data-lake-id=\"u43ed9f7e\" id=\"u43ed9f7e\">禁用变量提升。</span></strong><span data-lake-id=\"u3ca180fd\" id=\"u3ca180fd\">const 声明后必赋值。</span></p></blockquote><h3 data-lake-id=\"Bl19f\" id=\"Bl19f\"><span data-lake-id=\"u1525e958\" id=\"u1525e958\">let、const、var的区别</span></h3><ol list=\"ufe97e951\"><li fid=\"ua89a85e8\" data-lake-id=\"u24c99da2\" id=\"u24c99da2\"><strong><span data-lake-id=\"ub1d79d02\" id=\"ub1d79d02\">块级作用域</span></strong><span data-lake-id=\"ub0297370\" id=\"ub0297370\">：块级作用域由</span><code data-lake-id=\"u0d098daf\" id=\"u0d098daf\"><span data-lake-id=\"ua728a5f8\" id=\"ua728a5f8\">{}</span></code><span data-lake-id=\"udab01170\" id=\"udab01170\">包括，</span><code data-lake-id=\"u4a584c8a\" id=\"u4a584c8a\"><span data-lake-id=\"u7b133ece\" id=\"u7b133ece\">let</span></code><span data-lake-id=\"u0490345f\" id=\"u0490345f\">和</span><code data-lake-id=\"ufe69257b\" id=\"ufe69257b\"><span data-lake-id=\"ub12b0df0\" id=\"ub12b0df0\">const</span></code><span data-lake-id=\"u48288ee1\" id=\"u48288ee1\">具有块级作用域，</span><code data-lake-id=\"u85bccedb\" id=\"u85bccedb\"><span data-lake-id=\"u73c5bd91\" id=\"u73c5bd91\">var</span></code><span data-lake-id=\"ud4188673\" id=\"ud4188673\">不存在块级作用域。</span></li></ol><p data-lake-id=\"ue5046bec\" id=\"ue5046bec\" style=\"text-indent: 2em\"><span data-lake-id=\"u2993a276\" id=\"u2993a276\">块级作用域解决了</span><code data-lake-id=\"u6a83e3ac\" id=\"u6a83e3ac\"><span data-lake-id=\"u1ad25931\" id=\"u1ad25931\">ES5</span></code><span data-lake-id=\"u3f2c1b64\" id=\"u3f2c1b64\">中的两个问题：</span></p><ul list=\"udb3ccb60\" data-lake-indent=\"1\"><li fid=\"ubeb5f54a\" data-lake-id=\"u64d4e962\" id=\"u64d4e962\"><span data-lake-id=\"ub639e8d2\" id=\"ub639e8d2\">内层变量可能覆盖外层变量</span></li><li fid=\"ubeb5f54a\" data-lake-id=\"u30b2979a\" id=\"u30b2979a\"><span data-lake-id=\"u3060bf23\" id=\"u3060bf23\">用来计数的循环变量泄漏为全局变量</span></li></ul><ol list=\"ubd33a1c8\" start=\"2\"><li fid=\"u4f555d4d\" data-lake-id=\"u8ab396a0\" id=\"u8ab396a0\"><strong><span data-lake-id=\"u3eafd80e\" id=\"u3eafd80e\">变量提升</span></strong><span data-lake-id=\"ud999a1e2\" id=\"ud999a1e2\">：var 存在变量提升，let 和 const 不存在变量提升，即变量只能在声明后使用，否则会报错。</span></li><li fid=\"u4f555d4d\" data-lake-id=\"ua25ffd8a\" id=\"ua25ffd8a\"><strong><span data-lake-id=\"uaebee069\" id=\"uaebee069\">给全局添加属性</span></strong><span data-lake-id=\"uabbdb779\" id=\"uabbdb779\">：浏览器的全局对象是window，Node的全局变量是global。var 声明的变量为全局变量，并且会将该变量添加为全局对象的属性，但是let和const不会。</span></li><li fid=\"u4f555d4d\" data-lake-id=\"udb264a72\" id=\"udb264a72\"><strong><span data-lake-id=\"uba22d208\" id=\"uba22d208\">重复声明</span></strong><span data-lake-id=\"u7ebcf304\" id=\"u7ebcf304\">：var声明变量时，可以重复声明变量，后声明的变量会覆盖之前声明的变量。let 和 const 不允许在同一作用域下重复声明变量。</span></li><li fid=\"u4f555d4d\" data-lake-id=\"ub01b56be\" id=\"ub01b56be\"><strong><span data-lake-id=\"u8aec9f4f\" id=\"u8aec9f4f\">暂时性死区：</span></strong><span data-lake-id=\"u8fb4f6dc\" id=\"u8fb4f6dc\">在使用let、const关键字声明变量时，该变量是不可用的，这在语法上，成为</span><strong><span data-lake-id=\"ua637fb52\" id=\"ua637fb52\">暂时性死区</span></strong><span data-lake-id=\"ue96aceb1\" id=\"ue96aceb1\">。</span></li></ol><p data-lake-id=\"u2df43a4e\" id=\"u2df43a4e\"><span data-lake-id=\"uf31b3f3d\" id=\"uf31b3f3d\">使用var声明的变量不存在暂时性死区。</span></p><ol list=\"u0d62fb0e\" start=\"6\"><li fid=\"u306eb697\" data-lake-id=\"u843deaf4\" id=\"u843deaf4\"><strong><span data-lake-id=\"u9ae738b4\" id=\"u9ae738b4\">初始值设置</span></strong><span data-lake-id=\"u2cc98e0a\" id=\"u2cc98e0a\">：在变量声明时，var和let可以不用设置初始值。而const声明变量必须设置初始值。</span></li><li fid=\"u306eb697\" data-lake-id=\"ua65d024d\" id=\"ua65d024d\"><strong><span data-lake-id=\"u31de973c\" id=\"u31de973c\">指针指向</span></strong><span data-lake-id=\"uf1347e10\" id=\"uf1347e10\">：let和const都是ES6新增的用于创建变量的语法。let创建的变量可以更改指针指向（可以重新赋值）。但const声明的变量不允许改变指针的指向（不允许重新赋值）。</span></li></ol><h2 data-lake-id=\"kja5Y\" id=\"kja5Y\"><span data-lake-id=\"u0c1cd73f\" id=\"u0c1cd73f\">暂时性死区</span></h2><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22javascript%22%2C%22code%22%3A%22var%20name%3D'rose'%3B%5Cn%5Cn%7B%5Cn%20%20name%3D'bob'%3B%5Cn%20%20let%20name%3B%20%20%20%20%2F%2FUncaught%20ReferenceError%3A%20Cannot%20access%20'name'%20before%20initialization%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22__spacing%22%3A%22both%22%2C%22id%22%3A%22jNK4I%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%7D\"></card><p data-lake-id=\"u662742dc\" id=\"u662742dc\"><strong><span data-lake-id=\"u9b74dfc2\" id=\"u9b74dfc2\">如果区块中存在let和const，这个区块对于这些关键字声明的变量，从一开始就形成了封闭作用域。</span></strong></p><p data-lake-id=\"ud45ef18b\" id=\"ud45ef18b\"><span data-lake-id=\"u29b22993\" id=\"u29b22993\">因为JS清楚地感知到了name是用let声明在当前这个代码块内的，所以会给这个变量name加上了暂时性死区的限制，它就不往外探出头了。</span></p><p data-lake-id=\"u488c1d48\" id=\"u488c1d48\"><span data-lake-id=\"u488612bd\" id=\"u488612bd\">因此，如果我们把上面的</span><code data-lake-id=\"u7c5dee22\" id=\"u7c5dee22\"><span data-lake-id=\"u6e0ad624\" id=\"u6e0ad624\">let name;</span></code><span data-lake-id=\"u2f2feec9\" id=\"u2f2feec9\">去掉，程序也能正常运行，name的值也能被成功修改为blob，就是正常地按照</span><strong><span data-lake-id=\"u1d9bac4d\" id=\"u1d9bac4d\">作用域链</span></strong><span data-lake-id=\"u3c4e7312\" id=\"u3c4e7312\">的规则，向外探出头去了。</span></p><p data-lake-id=\"u4858bc45\" id=\"u4858bc45\"><span data-lake-id=\"ubadbef55\" id=\"ubadbef55\">​</span><br></p>",
    "public": 1,
    "status": 1,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-16T01:22:19.000Z",
    "deleted_at": null,
    "created_at": "2022-11-15T12:07:36.000Z",
    "updated_at": "2022-11-16T01:22:19.000Z",
    "published_at": "2022-11-16T01:22:19.000Z",
    "first_published_at": "2022-11-16T00:49:16.192Z",
    "word_count": 1485,
    "cover": null,
    "description": "--- title: JS编译原理  categories:  前端进阶tags:  [JS,编译原理]--- JS编译原理var name = \"rose\"上面这行代码在JS中会这样呈现：var name; // 编译阶段处理 name = 'rose';  // 执行阶段处理JS编译主要分...",
    "custom_description": null,
    "hits": 0,
    "_serializer": "v2.doc_detail"
  },
  {
    "id": 106185896,
    "slug": "uv03g7gbeafp8c4l",
    "title": "如何关联本地包",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "--- <br />title: 如何关联本地包<br />categories: 知识<br />tags: [前端工程化, 组件库]<br />---\n<a name=\"AF0Rd\"></a>\n## 关联本地包的方式\n\n1. npm link 关联到本地(某个目录)：包更新后，本地的引用会自动更新，无需重新关联即可进行调试。\n2. pnpm 的 `workspace` 自动关联：   \n\n① 在项目根目录下创建 `pnpm-workspace.yaml` 文件   ```yaml   packages:     - 'packages/\\_'   ```   代表 packages 下的所有项目都可被很容易的被其他项目自动 link（无需使用 `pnpm i 包名`），底下声明的文件夹都可成为 `workspace`。   <br />② 举例：如果我们想要在 `packages` 下的 `test` 中关联 `test2`，只需在 `test` 中的 `package.json` 中依赖加入对应的 `workspace` 下的项目即可，   ```json   \"dependencies\": {       \"test2\": \"workspace:_\"   }   ```   然后在 test 下执行`pnpm i`，就会自动关联 test2 到 test1 了。   <br />③ 实现步骤 2 的另一种做法：在 `test` 下执行 `pnpm i test2`，即可将 `test2` 关联到 `test`，可以看到版本号后出现`workspace`字样。\n",
    "body_draft": "--- <br />title: 如何关联本地包<br />categories: 知识<br />tags: [前端工程化, 组件库]<br />---\n<a name=\"AF0Rd\"></a>\n## 关联本地包的方式\n\n1. npm link 关联到本地(某个目录)：包更新后，本地的引用会自动更新，无需重新关联即可进行调试。\n2. pnpm 的 `workspace` 自动关联：   \n\n① 在项目根目录下创建 `pnpm-workspace.yaml` 文件   ```yaml   packages:     - 'packages/\\_'   ```   代表 packages 下的所有项目都可被很容易的被其他项目自动 link（无需使用 `pnpm i 包名`），底下声明的文件夹都可成为 `workspace`。   <br />② 举例：如果我们想要在 `packages` 下的 `test` 中关联 `test2`，只需在 `test` 中的 `package.json` 中依赖加入对应的 `workspace` 下的项目即可，   ```json   \"dependencies\": {       \"test2\": \"workspace:_\"   }   ```   然后在 test 下执行`pnpm i`，就会自动关联 test2 到 test1 了。   <br />③ 实现步骤 2 的另一种做法：在 `test` 下执行 `pnpm i test2`，即可将 `test2` 关联到 `test`，可以看到版本号后出现`workspace`字样。\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"u170efa3d\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><p id=\"u794c25e6\" class=\"ne-p\"><span class=\"ne-text\">title: 如何关联本地包</span></p><p id=\"u25151903\" class=\"ne-p\"><span class=\"ne-text\">categories: 知识</span></p><p id=\"u8f5b98cf\" class=\"ne-p\"><span class=\"ne-text\">tags: [前端工程化, 组件库]</span></p><p id=\"uc5d1981a\" class=\"ne-p\"><span class=\"ne-text\">---</span></p><h2 id=\"AF0Rd\"><span class=\"ne-text\">关联本地包的方式</span></h2><ol class=\"ne-ol\"><li id=\"uee7e7f0b\"><span class=\"ne-text\">npm link 关联到本地(某个目录)：包更新后，本地的引用会自动更新，无需重新关联即可进行调试。</span></li><li id=\"uc0dfdbbf\"><span class=\"ne-text\">pnpm 的 `workspace` 自动关联：   </span></li></ol><p id=\"u725256a5\" class=\"ne-p\" style=\"margin-left: 2em\"><span class=\"ne-text\">① 在项目根目录下创建 `pnpm-workspace.yaml` 文件   ```yaml   packages:     - 'packages/\\_'   ```   代表 packages 下的所有项目都可被很容易的被其他项目自动 link（无需使用 `pnpm i 包名`），底下声明的文件夹都可成为 `workspace`。   </span></p><p id=\"uda204f21\" class=\"ne-p\" style=\"margin-left: 2em\"><span class=\"ne-text\">② 举例：如果我们想要在 `packages` 下的 `test` 中关联 `test2`，只需在 `test` 中的 `package.json` 中依赖加入对应的 `workspace` 下的项目即可，   ```json   &quot;dependencies&quot;: {       &quot;test2&quot;: &quot;workspace:_&quot;   }   ```   然后在 test 下执行`pnpm i`，就会自动关联 test2 到 test1 了。   </span></p><p id=\"u13a8df35\" class=\"ne-p\" style=\"margin-left: 2em\"><span class=\"ne-text\">③ 实现步骤 2 的另一种做法：在 `test` 下执行 `pnpm i test2`，即可将 `test2` 关联到 `test`，可以看到版本号后出现`workspace`字样。</span></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"u170efa3d\" id=\"u170efa3d\"><span data-lake-id=\"ueb48a425\" id=\"ueb48a425\">--- </span></p><p data-lake-id=\"u794c25e6\" id=\"u794c25e6\"><span data-lake-id=\"u09de81ee\" id=\"u09de81ee\">title: 如何关联本地包</span></p><p data-lake-id=\"u25151903\" id=\"u25151903\"><span data-lake-id=\"u2889c155\" id=\"u2889c155\">categories: 知识</span></p><p data-lake-id=\"u8f5b98cf\" id=\"u8f5b98cf\"><span data-lake-id=\"ued3cc2f6\" id=\"ued3cc2f6\">tags: [前端工程化, 组件库]</span></p><p data-lake-id=\"uc5d1981a\" id=\"uc5d1981a\"><span data-lake-id=\"u7b86a13b\" id=\"u7b86a13b\">---</span></p><h2 data-lake-id=\"AF0Rd\" id=\"AF0Rd\"><span data-lake-id=\"udef23076\" id=\"udef23076\">关联本地包的方式</span></h2><ol list=\"uc3231d1a\"><li fid=\"u1fe86b23\" data-lake-id=\"uee7e7f0b\" id=\"uee7e7f0b\"><span data-lake-id=\"udd4344f5\" id=\"udd4344f5\">npm link 关联到本地(某个目录)：包更新后，本地的引用会自动更新，无需重新关联即可进行调试。</span></li><li fid=\"u1fe86b23\" data-lake-id=\"uc0dfdbbf\" id=\"uc0dfdbbf\"><span data-lake-id=\"ue39c95ba\" id=\"ue39c95ba\">pnpm 的 `workspace` 自动关联：   </span></li></ol><p data-lake-id=\"u725256a5\" id=\"u725256a5\" style=\"padding-left: 2em\"><span data-lake-id=\"ub5b20878\" id=\"ub5b20878\">① 在项目根目录下创建 `pnpm-workspace.yaml` 文件   ```yaml   packages:     - 'packages/\\_'   ```   代表 packages 下的所有项目都可被很容易的被其他项目自动 link（无需使用 `pnpm i 包名`），底下声明的文件夹都可成为 `workspace`。   </span></p><p data-lake-id=\"uda204f21\" id=\"uda204f21\" style=\"padding-left: 2em\"><span data-lake-id=\"u072c0662\" id=\"u072c0662\">② 举例：如果我们想要在 `packages` 下的 `test` 中关联 `test2`，只需在 `test` 中的 `package.json` 中依赖加入对应的 `workspace` 下的项目即可，   ```json   &quot;dependencies&quot;: {       &quot;test2&quot;: &quot;workspace:_&quot;   }   ```   然后在 test 下执行`pnpm i`，就会自动关联 test2 到 test1 了。   </span></p><p data-lake-id=\"u13a8df35\" id=\"u13a8df35\" style=\"padding-left: 2em\"><span data-lake-id=\"u1ef92113\" id=\"u1ef92113\">③ 实现步骤 2 的另一种做法：在 `test` 下执行 `pnpm i test2`，即可将 `test2` 关联到 `test`，可以看到版本号后出现`workspace`字样。</span></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"u170efa3d\" id=\"u170efa3d\"><span data-lake-id=\"ueb48a425\" id=\"ueb48a425\">--- </span></p><p data-lake-id=\"u794c25e6\" id=\"u794c25e6\"><span data-lake-id=\"u09de81ee\" id=\"u09de81ee\">title: 如何关联本地包</span></p><p data-lake-id=\"u25151903\" id=\"u25151903\"><span data-lake-id=\"u2889c155\" id=\"u2889c155\">categories: 知识</span></p><p data-lake-id=\"u8f5b98cf\" id=\"u8f5b98cf\"><span data-lake-id=\"ued3cc2f6\" id=\"ued3cc2f6\">tags: [前端工程化, 组件库]</span></p><p data-lake-id=\"uc5d1981a\" id=\"uc5d1981a\"><span data-lake-id=\"u7b86a13b\" id=\"u7b86a13b\">---</span></p><h2 data-lake-id=\"AF0Rd\" id=\"AF0Rd\"><span data-lake-id=\"udef23076\" id=\"udef23076\">关联本地包的方式</span></h2><ol list=\"uc3231d1a\"><li fid=\"u1fe86b23\" data-lake-id=\"uee7e7f0b\" id=\"uee7e7f0b\"><span data-lake-id=\"udd4344f5\" id=\"udd4344f5\">npm link 关联到本地(某个目录)：包更新后，本地的引用会自动更新，无需重新关联即可进行调试。</span></li><li fid=\"u1fe86b23\" data-lake-id=\"uc0dfdbbf\" id=\"uc0dfdbbf\"><span data-lake-id=\"ue39c95ba\" id=\"ue39c95ba\">pnpm 的 `workspace` 自动关联：   </span></li></ol><p data-lake-id=\"u725256a5\" id=\"u725256a5\" style=\"padding-left: 2em\"><span data-lake-id=\"ub5b20878\" id=\"ub5b20878\">① 在项目根目录下创建 `pnpm-workspace.yaml` 文件   ```yaml   packages:     - 'packages/\\_'   ```   代表 packages 下的所有项目都可被很容易的被其他项目自动 link（无需使用 `pnpm i 包名`），底下声明的文件夹都可成为 `workspace`。   </span></p><p data-lake-id=\"uda204f21\" id=\"uda204f21\" style=\"padding-left: 2em\"><span data-lake-id=\"u072c0662\" id=\"u072c0662\">② 举例：如果我们想要在 `packages` 下的 `test` 中关联 `test2`，只需在 `test` 中的 `package.json` 中依赖加入对应的 `workspace` 下的项目即可，   ```json   &quot;dependencies&quot;: {       &quot;test2&quot;: &quot;workspace:_&quot;   }   ```   然后在 test 下执行`pnpm i`，就会自动关联 test2 到 test1 了。   </span></p><p data-lake-id=\"u13a8df35\" id=\"u13a8df35\" style=\"padding-left: 2em\"><span data-lake-id=\"u1ef92113\" id=\"u1ef92113\">③ 实现步骤 2 的另一种做法：在 `test` 下执行 `pnpm i test2`，即可将 `test2` 关联到 `test`，可以看到版本号后出现`workspace`字样。</span></p>",
    "public": 1,
    "status": 1,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-15T08:49:08.000Z",
    "deleted_at": null,
    "created_at": "2022-11-15T07:25:12.000Z",
    "updated_at": "2022-11-15T08:49:08.000Z",
    "published_at": "2022-11-15T08:49:08.000Z",
    "first_published_at": "2022-11-15T07:25:12.427Z",
    "word_count": 268,
    "cover": null,
    "description": "--- title: 如何关联本地包categories: 知识tags: [前端工程化, 组件库]---## 关联本地包的方式1. npm link 关联到本地(某个目录)：包更新后，本地的引用会自动更新，无需重新关联即可进行调试。2. pnpm 的 `workspace` 自动关联：   ...",
    "custom_description": "--- title: 如何关联本地包categories: 知识tags: [前端工程化, 组件库]---## 关联本地包的方式1. npm link 关联到本地(某个目录)：包更新后，本地的引用会自动更新，无需重新关联即可进行调试。2. pnpm 的 `workspace` 自动关联：   ...",
    "hits": 0,
    "_serializer": "v2.doc_detail"
  },
  {
    "id": 106185882,
    "slug": "muygv7q215nc2vk2",
    "title": "RabbitMQ学习笔记",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "---<br />title: RabbitMQ学习笔记<br />categories: 知识<br />tags: [RabbitMQ, 消息中间件]<br />--- \n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1630671540955-650bc67f-569a-4cef-a095-ec73a3b34897.png#clientId=uc20dad1f-a2b4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=740&id=u64b4ea35&margin=%5Bobject%20Object%5D&name=image.png&originHeight=740&originWidth=1340&originalType=binary&ratio=1&rotation=0&showTitle=false&size=584856&status=done&style=none&taskId=u20a11e76-4e9c-49b4-8ca4-cc25eac0808&title=&width=1340#averageHue=%23efe7e7&crop=0&crop=0&crop=1&crop=1&id=FmDdj&originHeight=740&originWidth=1340&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1630672453989-c5f9d3cf-e77f-4c3e-8a9d-173b49f0aa4c.png#clientId=uc20dad1f-a2b4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=473&id=ub505e50f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=473&originWidth=1544&originalType=binary&ratio=1&rotation=0&showTitle=false&size=451836&status=done&style=none&taskId=u973d9d93-5ee4-44e2-9f50-b28d8e8f15e&title=&width=1544#averageHue=%23f6f6f6&crop=0&crop=0&crop=1&crop=1&id=N1Vbj&originHeight=473&originWidth=1544&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1630673109375-2f65953f-32f5-4be8-9353-9d08abb6587f.png#clientId=uc20dad1f-a2b4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=794&id=uce851ada&margin=%5Bobject%20Object%5D&name=image.png&originHeight=794&originWidth=1520&originalType=binary&ratio=1&rotation=0&showTitle=false&size=669042&status=done&style=none&taskId=u1e0c19d3-9eae-4ab1-9e35-b33c4bbbcd6&title=&width=1520#averageHue=%23b2b1b0&crop=0&crop=0&crop=1&crop=1&id=zGC4d&originHeight=794&originWidth=1520&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"9c0cd8ed\"></a>\n## 为什么要用 rabbitMQ？\n<a name=\"81220e89\"></a>\n### 1. 流量削峰\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1637998719062-ee3b7961-8606-40b9-9bd6-139143630402.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=91&id=u7a7d8c10&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78126&status=done&style=none&taskId=u903bdc4d-2ce4-4ac8-97d1-9cf8226327b&title=&width=495#averageHue=%23f3f3f3&crop=0&crop=0&crop=1&crop=1&id=Ds1E5&originHeight=182&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"c491023f\"></a>\n### 2. 应用解耦\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1637998760193-a4f14c2c-a22b-4c92-b207-ae58a962577a.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=182&id=u8f01ca2b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=363&originWidth=1085&originalType=binary&ratio=1&rotation=0&showTitle=false&size=190648&status=done&style=none&taskId=u30e77d52-0f3b-4d69-b06f-8229a9c232f&title=&width=542.5&referrerpolicy=no-referrer#averageHue=%23f7f7f7&crop=0&crop=0&crop=1&crop=1&id=hMEcn&originHeight=363&originWidth=1085&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"d4ef8fda\"></a>\n### 3. 异步处理\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009293978-1fde3fa6-5de6-476b-bc8f-4381749e748c.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=315&id=u2602b5b4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=630&originWidth=1167&originalType=binary&ratio=1&rotation=0&showTitle=false&size=283589&status=done&style=none&taskId=uf5236049-2c88-4e12-b15e-7d99585efad&title=&width=583.5#averageHue=%23f6f6f6&crop=0&crop=0&crop=1&crop=1&id=EqXpn&originHeight=630&originWidth=1167&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"753ccaa2\"></a>\n## RabbitMQ 核心部分\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009378104-cb162a2f-4170-4d24-99c1-4e3ee09087ae.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=284&id=u45cac300&margin=%5Bobject%20Object%5D&name=image.png&originHeight=568&originWidth=1077&originalType=binary&ratio=1&rotation=0&showTitle=false&size=305514&status=done&style=none&taskId=u95a38925-5c34-45dd-bfca-d140d73dc3f&title=&width=538.5#averageHue=%23f8f2f1&crop=0&crop=0&crop=1&crop=1&id=TB3Zf&originHeight=568&originWidth=1077&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"a260da3a\"></a>\n## 各个名词介绍\n\n\n\n<a name=\"c83a4ba0\"></a>\n### RabbitMQ 工作原理\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009501957-eb0902f3-1fa1-47d5-9bc7-8d03f6e12de0.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=257&id=u79c375f5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=514&originWidth=1060&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210068&status=done&style=none&taskId=ue02a7c50-c563-46af-a784-5ae4c1dcdfe&title=&width=530#averageHue=%23efc150&crop=0&crop=0&crop=1&crop=1&id=sf1J3&originHeight=514&originWidth=1060&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009567915-6084eb1d-d428-47ec-844f-b3b48c6c6d0c.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=310&id=u9337433a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=619&originWidth=1135&originalType=binary&ratio=1&rotation=0&showTitle=false&size=776522&status=done&style=none&taskId=uced2ac5e-e117-4050-8e39-087f63ff410&title=&width=567.5#averageHue=%23e1dccf&crop=0&crop=0&crop=1&crop=1&id=ft4q6&originHeight=619&originWidth=1135&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009610891-4a5dba18-6006-41bf-a068-b2f33ed7df48.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=63&id=u38d6f233&margin=%5Bobject%20Object%5D&name=image.png&originHeight=126&originWidth=1128&originalType=binary&ratio=1&rotation=0&showTitle=false&size=136646&status=done&style=none&taskId=u3dada18e-9ab8-40c9-8042-2e2f9f40306&title=&width=564#averageHue=%23cdc5b8&crop=0&crop=0&crop=1&crop=1&id=rJuNv&originHeight=126&originWidth=1128&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"e655a410\"></a>\n## 安装\n\n[rabbitmq.com/download.html](https://www.rabbitmq.com/download.html)<br />erlang 和 rabbitMQ 版本匹配：<br />[https://www.cnblogs.com/gne-hwz/p/10714013.html](https://www.cnblogs.com/gne-hwz/p/10714013.html)<br />安装：[https://blog.csdn.net/almahehe/article/details/75390572](https://blog.csdn.net/almahehe/article/details/75390572)<br />（建议看尚硅谷视频进行快速安装）<br />安装之后，可以访问 ip:15672 ，查看发送消息的端口（5672）和用户。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638169386681-e382c30c-baba-4fbb-bd40-aaa7b0a1eac6.png#clientId=uc4bbfa15-6ab6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=173&id=u1a771f9c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=102&originWidth=450&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28980&status=done&style=none&taskId=ua13bea1f-438b-4ef8-8913-b4ccb9fa78c&title=&width=761.9931030273438#averageHue=%23f1f1f1&crop=0&crop=0&crop=1&crop=1&id=pNXMC&originHeight=102&originWidth=450&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"c729f8ef\"></a>\n## 简单队列模式\n<a name=\"f5abe6f8\"></a>\n### 生产者代码\n\n1. 项目依赖：\n\n```xml\n<dependencies>\n        <!--指定jdk编译版本-->\n        <dependency>\n            <groupId>org.apache.maven.plugins</groupId>\n            <artifactId>maven-compiler-plugin</artifactId>\n            <version>3.8.1</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client -->\n        <!--rabbitmq依赖客户端-->\n        <dependency>\n            <groupId>com.rabbitmq</groupId>\n            <artifactId>amqp-client</artifactId>\n            <version>5.8.0</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/commons-io/commons-io -->\n        <!--操作文件流的依赖-->\n        <dependency>\n            <groupId>commons-io</groupId>\n            <artifactId>commons-io</artifactId>\n            <version>2.6</version>\n        </dependency>\n        <dependency>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-simple</artifactId>\n            <version>1.7.25</version>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n```\n\n2. 生产者代码：\n\n```java\njapackage com.atguigu.rabbitmq.one;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/28 22:15\n * 生产者 ：发消息\n */\npublic class Producer {\n    //队列名称\n    private static final String QUEUE_NAME = \"hello\";\n\n    //发消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建一个连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        //设置工厂ip  连接rabbitmq的队列\n        factory.setHost(\"59.110.171.189\");\n        //用户名\n        factory.setUsername(\"admin\");\n        //密码\n        factory.setPassword(\"123\");\n        //创建连接\n        Connection connection = factory.newConnection();\n        //获取信道\n        Channel channel = connection.createChannel();\n        /**\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n                4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n                5.其他参数（延迟消息......）\n         */\n\n        channel.queueDeclare(QUEUE_NAME,false,false,false,null);\n        //发消息\n        String message = \"hello world\";\n        /**\n         * 发送一个消息\n         * 1. 发送到哪个交换机\n         * 2. 路由的key值是哪个，本次是队列的名称\n         * 3. 其他参数信息\n         * 4. 发送消息的消息体\n         */\n        channel.basicPublish(\"\",QUEUE_NAME,null,message.getBytes());\n        System.out.println(\"消息发送完毕\");\n    }\n}\n```\n\n如果运行报超时错误，需要打开云服务器的安全组 5672 端口。<br />（参考博客：[https://www.cnblogs.com/jxearlier/p/11920825.html](https://www.cnblogs.com/jxearlier/p/11920825.html)）\n<a name=\"3b753fe7\"></a>\n### 消费者代码\n\n```xml\npackage com.atguigu.rabbitmq.one;\n\nimport com.rabbitmq.client.*;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 15:04\n * 消费者:接收消息\n */\npublic class Consumer {\n    //队列名称\n    public static final String QUEUE_NAME = \"hello\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"59.110.171.189\");\n        factory.setUsername(\"admin\");\n        factory.setPassword(\"123\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        //声明 接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(message);\n        };\n        //取消消息时的回调\n        CancelCallback cancelCallback = consumerTag -> {\n            System.out.println(\"消息消费被中断\");\n        };\n        /**\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true,deliverCallback,cancelCallback);\n    }\n}\n```\n\n运行结果：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638172828992-073b0df6-a480-4260-a724-e17e9191a44c.png#clientId=uc4bbfa15-6ab6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=20&id=u3ee077b2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=20&originWidth=296&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2932&status=done&style=none&taskId=ud645c173-0157-49f2-89fb-5d58c2cd89a&title=&width=296#averageHue=%232f3e49&crop=0&crop=0&crop=1&crop=1&id=kWU4Y&originHeight=20&originWidth=296&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"56a70cf7\"></a>\n### 测试生产者和消费者代码：\n\n1. 先运行消费者代码，发现没有消息，再运行生产者代码，发送消息，再看消费者代码控制台，此时已经接收到消息。\n\n<a name=\"3d1bae02\"></a>\n## 工作队列模式\n\n\n\n<a name=\"d9addd15\"></a>\n### 轮训分发消息\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638191830547-a43bbaa1-a524-4603-b6a9-0824e943cf9c.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=546&id=ucf96c5e0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=546&originWidth=1278&originalType=binary&ratio=1&rotation=0&showTitle=false&size=220503&status=done&style=none&taskId=ub030755f-49df-4184-9d0d-65bfa0e561e&title=&width=1278#averageHue=%23f7f7f7&crop=0&crop=0&crop=1&crop=1&id=kyxCV&originHeight=546&originWidth=1278&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 抽取连接工厂工具类：\n\n```xml\npackage com.atguigu.rabbitmq.utils;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 19:48\n * 连接工厂创建信道的工具类\n */\npublic class RabbitMqUtils {\n    public static Channel getChannel() throws IOException, TimeoutException {\n        //创建连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"59.110.171.189\");\n        factory.setUsername(\"admin\");\n        factory.setPassword(\"123\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        return channel;\n    }\n}\n```\n\n2. 工作线程代码：（消费者）\n\n```xml\npackage com.atguigu.rabbitmq.two;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.CancelCallback;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\nimport com.rabbitmq.client.Delivery;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 19:55\n * 这是一个工作线程（相当于之前的消费者）\n */\npublic class Worker01 {\n    //队列名称\n    public static final String QUEUE_NAME = \"hello\";\n\n    //接收消息 的工作线程\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //消息的接收\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"接收到的消息：\" + new String(message.getBody()));\n        };\n        //消息接收被取消时 执行\n        CancelCallback cancelCallback = (consumerTag) -> {\n            System.out.println(consumerTag + \"消费者取消消费接口回调逻辑\");\n        };\n        /*\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, cancelCallback);\n    }\n}\n```\n\n3. 启动两个工作线程（消费者）\n\n前提是在 idea 设置允许方法多个并行运行：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638188489814-b081e679-bc7f-4cad-964e-bfb80575820c.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=636&id=uf61f07dc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=869&originWidth=1143&originalType=binary&ratio=1&rotation=0&showTitle=false&size=94819&status=done&style=none&taskId=u4472c929-c48f-4a7d-ab7d-ec2994b75e5&title=&width=836.9862060546875#averageHue=%233b4043&crop=0&crop=0&crop=1&crop=1&id=zVInE&originHeight=869&originWidth=1143&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638188418807-97ce766a-47ef-458c-8413-d496cbcddbed.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=172&id=u35f12aab&margin=%5Bobject%20Object%5D&name=image.png&originHeight=172&originWidth=669&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20804&status=done&style=none&taskId=uf688cf36-6dc9-43f1-be3d-946b8a45d78&title=&width=669#averageHue=%232a373f&crop=0&crop=0&crop=1&crop=1&id=yNG1N&originHeight=172&originWidth=669&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n4. 生产者代码：\n\n```xml\npackage com.atguigu.rabbitmq.two;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 21:04\n * 生产者 发送大量消息\n */\npublic class Task01 {\n    public static final String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        /*\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n         4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n         5.其他参数（延迟消息......）\n         */\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes());\n            System.out.println(\"发送消息完成：\" + message);\n        }\n    }\n}\n```\n\n5. 测试：启动生产者\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192109706-2649384b-8559-4d7e-8609-220f576c3e25.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=275&id=u4261e57f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=275&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25224&status=done&style=none&taskId=ue3dff20d-583f-4d0b-bb12-94ccae95bc1&title=&width=591#averageHue=%232c373d&crop=0&crop=0&crop=1&crop=1&id=PuJou&originHeight=275&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />可以看见消费者轮循接收消息：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192164342-16d183be-bbe5-4de9-bac4-d87bd87a746b.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=179&id=ue97a7cdb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=179&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23018&status=done&style=none&taskId=u7cff6d1a-b142-4d52-a1c5-1cca6fd241e&title=&width=591#averageHue=%232f3c44&crop=0&crop=0&crop=1&crop=1&id=Upfv4&originHeight=179&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192176544-d380de90-ff7a-48a7-a080-c4a1ac193460.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=198&id=ubb73d589&margin=%5Bobject%20Object%5D&name=image.png&originHeight=198&originWidth=598&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23978&status=done&style=none&taskId=u3ac63e3a-6d82-4340-9fed-c68c8fbf564&title=&width=598#averageHue=%232f3b43&crop=0&crop=0&crop=1&crop=1&id=xLv8Q&originHeight=198&originWidth=598&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"269fc561\"></a>\n## 消息应答\n\n\n\n<a name=\"398e8d91\"></a>\n### 自动应答\n\n不建议使用，仅适用在消费者可以高效并以某种速率能够处理这些消息的情况。\n\n<a name=\"a7945bf1\"></a>\n### 手动应答\n\n\n\n<a name=\"bdff53ca\"></a>\n#### 消息应答的方法：\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638193415623-6b7ff26f-8cc3-4abd-b1c6-41f79897f0cf.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=312&id=ud16b0385&margin=%5Bobject%20Object%5D&name=image.png&originHeight=312&originWidth=737&originalType=binary&ratio=1&rotation=0&showTitle=false&size=100867&status=done&style=none&taskId=u39cf8244-b605-4c5d-baca-fe2103cd9d3&title=&width=737#averageHue=%23f5f5f5&crop=0&crop=0&crop=1&crop=1&id=S2b1y&originHeight=312&originWidth=737&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"70c2cd3d\"></a>\n#### 批量处理 Multiple\n\n手动应答的好处：可以批量应答，并减少网络拥堵。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638282925466-4d3081e6-809c-4a5f-9472-741dacb0cc7c.png#clientId=ub82069db-0272-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=588&id=u97ebb457&margin=%5Bobject%20Object%5D&name=image.png&originHeight=811&originWidth=1024&originalType=binary&ratio=1&rotation=0&showTitle=false&size=292383&status=done&style=none&taskId=uf04a703e-97b1-4fe2-b58f-33d8b0dff4d&title=&width=741.9931030273438#averageHue=%23f6f5f5&crop=0&crop=0&crop=1&crop=1&id=rUzZh&originHeight=811&originWidth=1024&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />但是批量应答可能会丢失消息。所以尽量不要批量应答，将 multiple 设置为 false。\n\n<a name=\"8f744d87\"></a>\n### 消息自动重新入队\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638317239422-ab1bab41-ac6f-4a05-b3c5-c539d9e6dcd1.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=85&id=u97c18f3b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=79&originWidth=665&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57746&status=done&style=none&taskId=u14e494b5-3291-4daf-ada5-47aafa5eab0&title=&width=715.0000610351562#averageHue=%23ebeae9&crop=0&crop=0&crop=1&crop=1&id=qAYOD&originHeight=79&originWidth=665&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638317701734-1133a417-ebbe-4ad9-8453-f0803583491a.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=308&id=u7be19416&margin=%5Bobject%20Object%5D&name=image.png&originHeight=469&originWidth=1088&originalType=binary&ratio=1&rotation=0&showTitle=false&size=306122&status=done&style=none&taskId=u7d90ec89-bd9a-4090-bda5-c09c6014c27&title=&width=714.9862060546875#averageHue=%23e5e4df&crop=0&crop=0&crop=1&crop=1&id=o9cFt&originHeight=469&originWidth=1088&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />测试：<br /> 1. 生产者：\n\n```xml\npackage com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:46\n * 消息在手动应答时不丢失,放回队列中重新消费\n */\npublic class Task2 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = \"ack_queue\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明队列\n        channel.queueDeclare(TASK_QUEUE_NAME, false, false, false, null);\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(\"\", TASK_QUEUE_NAME, null, message.getBytes());\n            System.out.println(\"生产者发出消息：\" + message);\n        }\n    }\n}\n```\n\n2. 两个消费者（消息手动应答）：\n\n消费者一：\n\n```xml\npackage com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.atguigu.rabbitmq.utils.SleepUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:58\n * 消息在手动应答时不丢失，放回队列中重新消费\n */\npublic class Work03 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = \"ack_queue\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(\"C1等待接收消息处理时间较短\");\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            //沉睡1s\n            SleepUtils.sleep(1);\n            System.out.println(\"接收到的消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n            //手动应答（通过信道）\n            /*参数：\n            1. 消息的标记 tag\n            2. 是否批量应答  false:不批量应答信道中的消息，true:批量\n             */\n            channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n        };\n        //采用手动应答\n        boolean autoAck = false;\n        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -> {\n            System.out.println(consumerTag + \"消费者取消消费接口的回调逻辑\");\n        }));\n    }\n}\n```\n\n消费者二：\n\n```xml\npackage com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.atguigu.rabbitmq.utils.SleepUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:58\n * 消息在手动应答时不丢失，放回队列中重新消费\n */\npublic class Work04 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = \"ack_queue\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(\"C2等待接收消息处理时间较短\");\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            //沉睡1s\n            SleepUtils.sleep(30);\n            System.out.println(\"接收到的消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n            //手动应答（通过信道）\n            /*参数：\n            1. 消息的标记 tag\n            2. 是否批量应答  false:不批量应答信道中的消息，true:批量\n             */\n            channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n        };\n        //采用手动应答\n        boolean autoAck = false;\n        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -> {\n            System.out.println(consumerTag + \"消费者取消消费接口的回调逻辑\");\n        }));\n    }\n}\n```\n\n测试步骤：<br />① 先启动 task2，创建 ack_queue 队列；（在 ip:15672 的 queue 列表中可以看到目前拥有的队列）<br />② 启动 work02，work03 接收消息（消费者）；<br />③ 发消息：在 task2 控制台输入 aa,bb,cc,dd,ee,ff，可以看到 work2 和 work3 是轮训接收消息；如果到 work03 应该接收消息 ee 时，work03 突然挂掉，此时 ee 会被转发给 work02 中的 C1，这时 C1 会接收到 ee，因此消息不会丢失，这说明了 rabbitmq 有手动应答的能力，只要没有收到消息，就不会手动应答，从而将消息放回队列。而队列又再次将消息传递给 C1 进行重新消费，从而导致 ee 并没有丢失。![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638348662336-051f5011-f512-44d1-bb05-053e49ba050c.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=499&id=u60c5aa9e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=499&originWidth=1092&originalType=binary&ratio=1&rotation=0&showTitle=false&size=254728&status=done&style=none&taskId=u6c03afcd-9d58-4d4b-b839-5e4801e20e0&title=&width=1092#averageHue=%23f5f5f5&crop=0&crop=0&crop=1&crop=1&id=Rq0q6&originHeight=499&originWidth=1092&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"274a6bb3\"></a>\n## 队列持久化\n\n如果存在同名未被持久化的队列，则需要先删除原先的未被持久化的队列，再重新生成一个持久化队列。\n\n```java\n//声明队列\nboolean durable = true; //在生产者中，需要让queue进行持久化\nchannel.queueDeclare(TASK_QUEUE_NAME, durable, false, false, null);\n```\n\n生成一个持久化队列之后，在 rabbitmq 控制台中这个队列的 features 属性会出现 D（代表持久化）。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638359722330-59d15b49-1b8d-4d93-85aa-ecd40227bd45.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=129&id=ufd6f763b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=129&originWidth=781&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13881&status=done&style=none&taskId=uab54d6ef-4036-4edf-bca6-ba4a9dcac1d&title=&width=781#averageHue=%23f3f1f0&crop=0&crop=0&crop=1&crop=1&id=iMXeX&originHeight=129&originWidth=781&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"f1739dad\"></a>\n## 消息持久化\n\n```java\n//设置生产者发送消息为持久化消息（要求保存到磁盘上MessageProperties.PERSISTENT_TEXT_PLAIN）\nchannel.basicPublish(\"\", TASK_QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());\n```\n\n\n\n<a name=\"afba844e\"></a>\n## 不公平分发\n\n```java\n//在消费者中接收消息之前设置不公平分发\nint prefetchCount = 1;\nchannel.basicQos(prefetchCount);\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361240814-a1349c7f-2e3e-410a-ba3b-f2f872fab0bb.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=232&id=u1ff04a34&margin=%5Bobject%20Object%5D&name=image.png&originHeight=232&originWidth=385&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20173&status=done&style=none&taskId=ub1b60899-802e-4d67-9aed-a99c48b5db3&title=&width=385#averageHue=%23303d45&crop=0&crop=0&crop=1&crop=1&id=vTMLG&originHeight=232&originWidth=385&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361251165-68b13d22-fe49-4fd8-9471-26161051c180.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=177&id=u477bebf6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=177&originWidth=431&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18613&status=done&style=none&taskId=ue60522ee-50ed-46f9-ae69-472369ce4b6&title=&width=431#averageHue=%232c3a42&crop=0&crop=0&crop=1&crop=1&id=zGQk4&originHeight=177&originWidth=431&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"e7e8ffe0\"></a>\n## 预取值\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361857297-fa168e46-191d-44b2-8ce2-df2cb52a382d.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=282&id=ue1e2c233&margin=%5Bobject%20Object%5D&name=image.png&originHeight=453&originWidth=1130&originalType=binary&ratio=1&rotation=0&showTitle=false&size=347909&status=done&style=none&taskId=ue241edd5-d375-46cb-9668-4a4eb4d7c9c&title=&width=703.0000610351562#averageHue=%23e4e4e5&crop=0&crop=0&crop=1&crop=1&id=mwjn3&originHeight=453&originWidth=1130&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\nint prefetchCount = 5;\nchannel.basicQos(prefetchCount);\n```\n\n\n\n<a name=\"1e9c309f\"></a>\n## 发布确认原理\n\n\n\n<a name=\"e61fd426\"></a>\n## ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638364988019-b29d7c44-ebca-4978-95fd-034500d1bd7b.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=369&id=u98ff6bb0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=369&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&size=222643&status=done&style=none&taskId=ua25c2547-8233-4893-8d5b-4406b84e85f&title=&width=930#averageHue=%23fafafb&crop=0&crop=0&crop=1&crop=1&id=Xek0V&originHeight=369&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n在信道之后开启发布确认：\n\n```java\n//信道开启发布确认\nchannel.confirmSelect();\n```\n\n\n\n<a name=\"f1ad8c9b\"></a>\n## 单个发布确认\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638365489548-64267da5-f60d-4b88-98af-bdf5806d5038.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=203&id=ub1148f56&margin=%5Bobject%20Object%5D&name=image.png&originHeight=203&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=342872&status=done&style=none&taskId=u2df32a3e-4c69-4599-868a-d81e33495ec&title=&width=993#averageHue=%23d0dcda&crop=0&crop=0&crop=1&crop=1&id=qVQAu&originHeight=203&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\npackage com.atguigu.rabbitmq.four;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.UUID;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 21:32\n * 发布确认模式：\n * 使用的时间  比较哪种确认方式是最好的\n * 1.单个确认\n * 2.批量确认\n * 3.异步批量确认\n */\npublic class ConfireMessage {\n    //批量发消息的个数\n    public static final int MESSAGE_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException, TimeoutException, IOException {\n        //1. 单个确认\n        ConfireMessage.publicMessageIndividually(); //发布1000个单独确认消息，耗时29726ms\n    }\n\n    //单个确认\n    public static void publicMessageIndividually() throws IOException, TimeoutException, InterruptedException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量发消息\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String massage = i + \"\";\n            channel.basicPublish(\"\", queueName, null, massage.getBytes());\n            //单个消息就马上进行发布确认\n            boolean flag = channel.waitForConfirms();\n            if (flag) {\n                System.out.println(\"消息发送成功\");\n            }\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\"+MESSAGE_COUNT+\"个单独确认消息，耗时\"+(end - begin)+\"ms\");\n    }\n}\n```\n\n\n\n<a name=\"498cf9b3\"></a>\n## 批量发布确认\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638366964213-10397181-357d-4896-9e91-84690b69c982.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=137&id=ude627a73&margin=%5Bobject%20Object%5D&name=image.png&originHeight=137&originWidth=968&originalType=binary&ratio=1&rotation=0&showTitle=false&size=206130&status=done&style=none&taskId=u0c3dafe3-1f66-4cc1-83ba-f5e8edae8b3&title=&width=968#averageHue=%23d7d9d8&crop=0&crop=0&crop=1&crop=1&id=tMsLz&originHeight=137&originWidth=968&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\n//批量发布确认\n    public static void publicMessageBatch() throws IOException, TimeoutException, InterruptedException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量确认消息大小\n        int batchSize = 100;\n        //批量发布消息， 批量发布确认\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String message = i + \"\";\n            channel.basicPublish(\"\", queueName, null, message.getBytes());\n            //发布确认\n            if (i % batchSize == 0) {\n                channel.waitForConfirms();\n            }\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\" + MESSAGE_COUNT + \"个批量确认消息，耗时\" + (end - begin) + \"ms\");\n    }\n```\n\n\n\n<a name=\"836eb661\"></a>\n## 异步发布确认\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638368249755-46e1c3b8-f891-48b0-a77b-21b9a80f4e5e.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=119&id=u5fcd19f7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=119&originWidth=1189&originalType=binary&ratio=1&rotation=0&showTitle=false&size=231115&status=done&style=none&taskId=u473c99f9-e088-4ad3-84e3-82e606c7d63&title=&width=1189#averageHue=%23e2dfd4&crop=0&crop=0&crop=1&crop=1&id=Jwh7I&originHeight=119&originWidth=1189&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638368124379-5cdb8cbd-707a-4a1f-92f4-3dc511a9ec11.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=u4b5d988b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=441&originWidth=964&originalType=binary&ratio=1&rotation=0&showTitle=false&size=239080&status=done&style=none&taskId=ua0b85de0-7119-4e3a-a0be-75854b9aaac&title=&width=1248.9931030273438#averageHue=%23f7f7f7&crop=0&crop=0&crop=1&crop=1&id=T1TVR&originHeight=441&originWidth=964&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\n//批量发消息的个数\n    public static final int MESSAGE_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException, TimeoutException, IOException {\n        //1. 单个确认\n//        ConfireMessage.publicMessageIndividually(); //发布1000个单独确认消息，耗时29726ms\n//        2. 批量确认\n//        ConfireMessage.publicMessageBatch();  //发布1000个批量确认消息，耗时761ms（弊端：无法确认哪个消息未被确认）\n//        3. 异步确认\n        ConfireMessage.publicMessageAsync(); //发布1000个异步确认消息，耗时181ms\n    }\n//异步发布确认\n    public static void publicMessageAsync() throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //消息确认成功，回调函数\n        ConfirmCallback ackCallback = (deliveryTag, multiple) -> {\n            System.out.println(\"确认的消息\" + deliveryTag);\n        };\n        //消息确认失败，回调函数\n        ConfirmCallback nackCallback = (deliveryTag, multiple) -> {\n            System.out.println(\"未确认的消息\" + deliveryTag);\n        };\n        //准备消息的监听器，监听哪些消息成功了，哪些消息失败了\n        channel.addConfirmListener(ackCallback, nackCallback);  //异步通知\n        //异步发布确认\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String massage = \"消息\" + i;\n            channel.basicPublish(\"\", queueName, null, massage.getBytes());\n\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\" + MESSAGE_COUNT + \"个异步确认消息，耗时\" + (end - begin) + \"ms\");\n    }\n```\n\n\n\n<a name=\"e8b363bb\"></a>\n## 如何处理异步未确认消息\n\n<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638404469016-06a08296-9aa6-4d65-8d1c-4c70fb4cd5b8.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=97&id=u0927e367&margin=%5Bobject%20Object%5D&name=image.png&originHeight=97&originWidth=1033&originalType=binary&ratio=1&rotation=0&showTitle=false&size=122865&status=done&style=none&taskId=u67d3a3c6-2f1a-4be9-9c0c-f7d2e743935&title=&width=1033#crop=0&crop=0&crop=1&crop=1&id=frSPr&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />上述异步确认有两个线程：\n\n- 发消息的线程\n- 监听器的线程\n\n两个线程之间交互，只能用**并发链路式队列（可以在确认发布与发布线程之间进行消息传递）**。\n\n```java\n//异步发布确认\n    public static void publicMessageAsync() throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        /*\n        线程安全有序的哈希表，适用于高并发的情况\n        1. 轻松的将序号与消息进行关联\n        2. 轻松批量删除条目，只要给序号\n        3.支持高并发(多线程)\n         */\n        ConcurrentSkipListMap<Long,String> outstandingConfirms = new ConcurrentSkipListMap<>();\n\n        //消息确认成功，回调函数\n        ConfirmCallback ackCallback = (deliveryTag, multiple) -> {\n            //2. 删除已经确认的消息   剩下的就是未确认的消息\n            if(multiple){\n                //如果是批量确认，就去批量删除\n                ConcurrentNavigableMap<Long,String> confirmed = outstandingConfirms.headMap(deliveryTag);\n                confirmed.clear();\n            }else{\n                //如果是单个确认，就去单个删除\n                outstandingConfirms.remove(deliveryTag);\n            }\n            System.out.println(\"确认的消息\" + deliveryTag);\n        };\n        //消息确认失败，回调函数\n        ConfirmCallback nackCallback = (deliveryTag, multiple) -> {\n            //3. 打印未确认的消息有哪些\n            String message = outstandingConfirms.get(deliveryTag);\n            System.out.println(\"未确认的消息是：\"+message+\":::::未确认的消息tag:\" + deliveryTag);\n        };\n        //准备消息的监听器，监听哪些消息成功了，哪些消息失败了\n        channel.addConfirmListener(ackCallback, nackCallback);  //异步通知\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量发送消息\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String message = \"消息\" + i;\n            // 1. 此处记录下所有要发送的消息  消息的总和(每发一次消息就记录一次)\n            outstandingConfirms.put(channel.getNextPublishSeqNo(),message);\n            channel.basicPublish(\"\", queueName, null, message.getBytes());\n\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\" + MESSAGE_COUNT + \"个异步确认消息，耗时\" + (end - begin) + \"ms\");\n    }\n```\n\n> 以上三种发布确认速度对比：\n\n\n- 单独发布消息：同步等待确认，简单，但吞吐量非常有限。\n- 批量发布消息：批量同步等待确认，简单，合理的吞吐量，一旦出现问题，很难推断出是哪条出现了问题\n- 异步处理：最佳性能和资源利用，在出现错误的情况下，可以很好的控制，但是实现起来稍微难些。\n\n<a name=\"04596875\"></a>\n## 交换机\n\n\n\n<a name=\"a3034a5f\"></a>\n### 交换机的作用\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638406810806-e429e00e-78d1-42e2-ab92-c3a53f8c2fa9.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=270&id=uc3415ba1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=387&originWidth=1291&originalType=binary&ratio=1&rotation=0&showTitle=false&size=191628&status=done&style=none&taskId=uee2f50b0-7b80-4d38-9c1b-25806445f5f&title=&width=900.9896240234375#crop=0&crop=0&crop=1&crop=1&id=tFgNi&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"f71f343d\"></a>\n### 交换机的类型\n\n- 直接（direct）== 路由类型\n- 主题（topic）\n- 标题（headers）（企业不常用）\n- 扇出（fanout）== 发布订阅类型\n- 无名类型（默认类型），通常用空串进行识别\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638407294007-f1bd9624-be98-4b90-ba72-9c29d88c326d.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=76&id=u21ac6756&margin=%5Bobject%20Object%5D&name=image.png&originHeight=76&originWidth=987&originalType=binary&ratio=1&rotation=0&showTitle=false&size=103665&status=done&style=none&taskId=u47150f74-3b3b-4cc4-befe-f25d9650214&title=&width=987#crop=0&crop=0&crop=1&crop=1&id=KlfHY&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"192ebf07\"></a>\n### 临时队列\n\n不带有持久化，一旦断开消费者的连接，队列将被自动删除。<br />\n\n创建临时队列：\n\n```java\nString queueName = channel.queueDeclare().getQueue();\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638407906977-786b78e8-bfba-4cab-9aee-9ac7ec38a884.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=278&id=u31ce7deb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=410&originWidth=1086&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55531&status=done&style=none&taskId=ub3aa0ca4-c823-418b-b8c7-0b7fbd67333&title=&width=736.9896240234375#crop=0&crop=0&crop=1&crop=1&id=T0K86&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"f4f12c7a\"></a>\n### 绑定\n\n就是交换机与队列之间的捆绑关系。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638408143523-d4c904d9-33e5-46bd-ad67-885e78b4c34b.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=637&id=u8140e36d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=637&originWidth=487&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26522&status=done&style=none&taskId=ua5ea4c46-36c5-4183-aefe-f6a3f676385&title=&width=487#crop=0&crop=0&crop=1&crop=1&id=fwITJ&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"b3f97d74\"></a>\n### 发布订阅模式（扇出模式 fanout）\n\n类似广播，两个 routingkey 相同<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638408427104-577b627a-521a-4d94-89be-5bf0102440ea.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=218&id=u3ae99c2f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=292&originWidth=1200&originalType=binary&ratio=1&rotation=0&showTitle=false&size=205919&status=done&style=none&taskId=ufe252eb8-02f2-410e-8b74-b8d091c0d4a&title=&width=894#crop=0&crop=0&crop=1&crop=1&id=PeGnm&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 生产者\n\n```java\npackage com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:59\n * 发消息：交换机\n */\npublic class EmitLog {\n    public static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(EXCHANGE_NAME, \"\", null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\"生产者发出消息：\" + message);\n        }\n    }\n}\n```\n\n2. 两个消费者\n\n```java\npackage com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:35\n */\npublic class ReceiveLogs01 {\n    //交换机的名称\n    public static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        //声明一个队列  临时队列 (生成一个临时队列，队列的名称是随机的，当消费者断开与队列的连接的时候，队列就自动删除)\n        String queueName = channel.queueDeclare().getQueue();\n        //绑定交换机与队列\n        channel.queueBind(queueName, EXCHANGE_NAME, \"\");\n        System.out.println(\"等待接收消息，把接收的消息打印在屏幕上。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs01控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(queueName, true,  deliverCallback,consumerTag->{});\n    }\n}\n```\n\n```java\npackage com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:35\n */\npublic class ReceiveLogs02 {\n    //交换机的名称\n    public static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        //声明一个队列  临时队列 (生成一个临时队列，队列的名称是随机的，当消费者断开与队列的连接的时候，队列就自动删除)\n        String queueName = channel.queueDeclare().getQueue();\n        //绑定交换机与队列\n        channel.queueBind(queueName, EXCHANGE_NAME, \"\");\n        System.out.println(\"等待接收消息，把接收的消息打印在屏幕上。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs02控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(queueName, true,  deliverCallback,consumerTag->{});\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410904168-80b297c1-26ef-4ee4-815c-065abea79bd2.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=328&id=u29891926&margin=%5Bobject%20Object%5D&name=image.png&originHeight=328&originWidth=580&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28269&status=done&style=none&taskId=u6700fa8b-9b2f-4717-91cf-0dfb20b528b&title=&width=580#crop=0&crop=0&crop=1&crop=1&id=Jf7Cl&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410913426-c4d1faa3-7b8b-478c-ba35-665d73e98e8b.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=248&id=ua55ed718&margin=%5Bobject%20Object%5D&name=image.png&originHeight=248&originWidth=528&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34020&status=done&style=none&taskId=u415b65a3-7d21-4e16-a1a0-a15d7f3c4ca&title=&width=528#crop=0&crop=0&crop=1&crop=1&id=HNmyl&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410920504-2f4c6248-02a0-4765-8647-4c8ab63551e1.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=255&id=u9c537a4f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=255&originWidth=517&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35282&status=done&style=none&taskId=u97bfb701-f8bd-45ca-ac41-6f8259d9775&title=&width=517#crop=0&crop=0&crop=1&crop=1&id=BBNfG&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"a7c987c4\"></a>\n### 直接交换机（路由模式 direct）\n\n两个 routingkey 不相同<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638411099834-bf80fb1d-473a-4a01-8553-e47ee2cd3670.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=303&id=ueba6aa41&margin=%5Bobject%20Object%5D&name=image.png&originHeight=303&originWidth=874&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98369&status=done&style=none&taskId=u2145da18-8429-4959-ab30-43bcc28bb61&title=&width=874#crop=0&crop=0&crop=1&crop=1&id=t5eGH&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />可以多重绑定。<br />**生产者发消息给队列，直接交换机通过不同 routingkey 路由到相应的队列，然后消费者接收指定日志。**\n\n1. 发消息\n\n```java\npackage com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:59\n * 发消息：交换机\n */\npublic class DirectLogs {\n    public static final String EXCHANGE_NAME = \"direct_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(EXCHANGE_NAME, \"error\", null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\"生产者发出消息：\" + message);\n        }\n    }\n}\n```\n\n2. 接收消息\n\n```java\npackage com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 10:15\n */\npublic class ReceiveLogsDirect01 {\n    public static final String EXCHANGE_NAME = \"direct_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n        //声明一个队列\n        channel.queueDeclare(\"console\",false,false,false,null);\n        channel.queueBind(\"console\",EXCHANGE_NAME,\"info\");\n        channel.queueBind(\"console\",EXCHANGE_NAME,\"warning\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs01控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(\"console\", true,  deliverCallback,consumerTag->{});\n\n    }\n}\n```\n\n```java\npackage com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 10:15\n */\npublic class ReceiveLogsDirect02 {\n    public static final String EXCHANGE_NAME = \"direct_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n        //声明一个队列\n        channel.queueDeclare(\"disk\",false,false,false,null);\n        channel.queueBind(\"disk\",EXCHANGE_NAME,\"error\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs02控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(\"disk\", true,  deliverCallback,consumerTag->{});\n\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638413931242-2c3ef4c2-f3e6-4e6e-ba39-5437dad24d40.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=182&id=u9de2b784&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=630&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21691&status=done&style=none&taskId=u7cd93b89-df35-4f94-aa33-6626b0dc70b&title=&width=630#crop=0&crop=0&crop=1&crop=1&id=eyPPs&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638413948375-568b73ae-0203-4f53-9a9b-528667192aa2.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=182&id=uc8400be0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=683&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24900&status=done&style=none&taskId=u38d71d59-3dd8-4324-9fae-335fd043524&title=&width=683#crop=0&crop=0&crop=1&crop=1&id=U0kJT&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"c4e17e43\"></a>\n### 主题交换机（Topic）\n\n规范：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638414479059-98f3dc8e-ee99-4093-b2cb-81eaecec9acb.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=226&id=u34e92b6a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=226&originWidth=834&originalType=binary&ratio=1&rotation=0&showTitle=false&size=170475&status=done&style=none&taskId=ue217ff8b-9da9-493e-9a4b-07c6ab22bab&title=&width=834#crop=0&crop=0&crop=1&crop=1&id=KCIOt&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415621949-8c1e4089-881d-482e-a377-ab7f224a2c92.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=257&id=u76cf3ab8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=257&originWidth=801&originalType=binary&ratio=1&rotation=0&showTitle=false&size=151366&status=done&style=none&taskId=u98d7748e-2fc6-4df3-a740-cae3ba06db9&title=&width=801#crop=0&crop=0&crop=1&crop=1&id=HeQJL&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415680787-e95ef7a6-bec4-44b3-8e45-1e0c4adac6f7.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=350&id=u280d2c9d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=350&originWidth=829&originalType=binary&ratio=1&rotation=0&showTitle=false&size=181864&status=done&style=none&taskId=u67807a72-c793-4b0b-a14e-e6270164016&title=&width=829#crop=0&crop=0&crop=1&crop=1&id=ZuvJl&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415855921-8e2750b0-e5df-4b1c-90a3-7e3f696543d6.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=188&id=uf97e55b4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=188&originWidth=920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=178229&status=done&style=none&taskId=ufb1118a1-0b9d-4a97-bd09-0ff626585f5&title=&width=920#crop=0&crop=0&crop=1&crop=1&id=iZC7I&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"36d4697d\"></a>\n### 主题交换机（实战）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638416303199-5f9e655c-c5c2-4a16-9d12-ba873c31c8e6.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=331&id=u07108cc7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=331&originWidth=1114&originalType=binary&ratio=1&rotation=0&showTitle=false&size=231103&status=done&style=none&taskId=ud57ef875-e371-4fa6-980a-20a29a7366e&title=&width=1114#crop=0&crop=0&crop=1&crop=1&id=zgYBJ&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 消费者\n\n```java\npackage com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 11:37\n * 声明主题交换机  及相关队列\n * <p>\n * 消费者 C2\n */\npublic class ReceiveLogsTopic01 {\n    //交换机名称\n    public static final String EXCHANGE_NAME = \"topic_logs\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n        //声明队列\n        String queueName = \"Q1\";\n        channel.queueDeclare(queueName, false, false, false, null);\n        //交换机绑定 routingkey\n        channel.queueBind(queueName, EXCHANGE_NAME, \"*.orange.*\");\n        System.out.println(\"等待接收消息。。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(new String(message.getBody(), StandardCharsets.UTF_8));\n            System.out.println(\"接收队列：\" + queueName + \"绑定键：\" + message.getEnvelope().getRoutingKey());\n        };\n        //接收消息\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -> {\n        });\n    }\n\n}\n```\n\n```java\npackage com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 11:37\n * 声明主题交换机  及相关队列\n * <p>\n * 消费者 C2\n */\npublic class ReceiveLogsTopic02 {\n    //交换机名称\n    public static final String EXCHANGE_NAME = \"topic_logs\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n        //声明队列\n        String queueName = \"Q2\";\n        channel.queueDeclare(queueName, false, false, false, null);\n        //交换机绑定 routingkey\n        channel.queueBind(queueName, EXCHANGE_NAME, \"*.*.rabbit\");\n        channel.queueBind(queueName, EXCHANGE_NAME, \"lazy.#\");\n        System.out.println(\"等待接收消息。。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(new String(message.getBody(), StandardCharsets.UTF_8));\n            System.out.println(\"接收队列：\" + queueName + \"绑定键：\" + message.getEnvelope().getRoutingKey());\n        };\n        //接收消息\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -> {\n        });\n    }\n\n}\n```\n\n2. 生产者\n\n```java\npackage com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.security.spec.ECField;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 14:45\n * 生产者\n */\npublic class EmitLogTopic {\n    public static final String EXCHANGE_NAME = \"topic_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        /**\n         * 下图绑定关系如下：\n         * Q1--> 绑定的是： 中间带3个单词的字符串（*.orange*）\n         * Q2--> 绑定的是： 最后一个单词是rabbit的3个单词（*.*.rabbit）\n         *                第一个单词是lazy的多个单词（lazy.#）\n         */\n        Map<String, String> bindingKeyMap = new HashMap<>();\n        bindingKeyMap.put(\"quick.orange.rabbit\", \"被队列Q1Q2接收到\");\n        bindingKeyMap.put(\"lazy.orange.elephant\", \"被队列Q1Q2接收到\");\n        bindingKeyMap.put(\"lazy.pink.rabbit\", \"被队列Q1接收到\");\n        bindingKeyMap.put(\"quick.brown.fox\", \"被队列Q2接收到\");\n        bindingKeyMap.put(\"quick.orange.male.rabbit\", \"虽然满足两个绑定但只被队列Q2接收一次\");\n        bindingKeyMap.put(\"quick.brown.fox\", \"不匹配任何绑定不会被任何队列接收到会被丢弃\");\n        bindingKeyMap.put(\"lazy.orange.male.rabbit\", \"是四个单词不匹配任何绑定定会丢弃\");\n        bindingKeyMap.put(\"lazy.orange.male.rabbit\", \"是四个单词但匹配Q2\");\n\n        for (Map.Entry<String, String> bindingKeyEntry : bindingKeyMap.entrySet()) {\n            String routingKey = bindingKeyEntry.getKey();\n            String message = bindingKeyEntry.getValue();\n            channel.basicPublish(EXCHANGE_NAME, routingKey, null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\"生产者发出消息\" + message);\n        }\n    }\n}\n```\n\n先启动消费者，再启动生产者。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430253833-e55a9ffe-37a0-4c04-b7b7-093a65480f71.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=540&id=u94f62b22&margin=%5Bobject%20Object%5D&name=image.png&originHeight=540&originWidth=683&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63817&status=done&style=none&taskId=u846aee7e-23e7-429c-8c68-098657667fa&title=&width=683#crop=0&crop=0&crop=1&crop=1&id=r1tul&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430292235-0a8fd8ca-fdd9-4f2e-9a52-de2398da4db4.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=548&id=u5b1d2810&margin=%5Bobject%20Object%5D&name=image.png&originHeight=548&originWidth=649&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60902&status=done&style=none&taskId=uf769df3d-232c-4803-866e-9b789b65799&title=&width=649#crop=0&crop=0&crop=1&crop=1&id=p0vbD&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430299720-f401248d-7efc-425f-aff1-59f8cda3349d.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=257&id=u7c6af404&margin=%5Bobject%20Object%5D&name=image.png&originHeight=257&originWidth=674&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33728&status=done&style=none&taskId=u0e4568aa-d243-4696-a1eb-02eebf586cf&title=&width=674#crop=0&crop=0&crop=1&crop=1&id=Axrk6&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"3dead64c\"></a>\n## 死信队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430356782-4196f6b8-209f-489a-a5e5-e61974e711ef.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=299&id=ud95905f1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=299&originWidth=1069&originalType=binary&ratio=1&rotation=0&showTitle=false&size=430772&status=done&style=none&taskId=ue469e4ea-c3e9-44f2-a5e6-4ac2443deba&title=&width=1069#crop=0&crop=0&crop=1&crop=1&id=ZL2Da&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430504276-84f3e02c-d80f-4fe9-9b9a-b8d9ac3b8290.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=298&id=u8670c10d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=298&originWidth=643&originalType=binary&ratio=1&rotation=0&showTitle=false&size=162345&status=done&style=none&taskId=ue72cf50e-a8d2-4f86-8a8f-e35ebf10e89&title=&width=643#crop=0&crop=0&crop=1&crop=1&id=rBdXQ&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430601814-eb3112b8-d77b-4213-ad2c-df3c394a36b7.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=553&id=ufda1712c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=553&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=162361&status=done&style=none&taskId=u55e88e2a-dc14-44b5-9eb9-8663773f317&title=&width=1136#crop=0&crop=0&crop=1&crop=1&id=pQqf7&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n- 消费者 1：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 15:40\n * 死信队列\n * 消费者1\n */\npublic class Consumer01 {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = \"normal_exchange\";\n    //死信队列的名称\n    public static final String DEAD_EXCHANGE = \"dead_exchange\";\n    //普通队列的名称\n    public static final String NORMAL_QUEUE = \"normal_queue\";\n    //死信队列的名称\n    public static final String DEAD_QUEUE = \"dead_queue\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明死信和普通交换机， 类型为direct\n        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);\n        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);\n        //声明普通队列\n        Map<String, Object> arguments = new HashMap<>();\n        //过期时间\n//        arguments.put(\"x-message-ttl\",10000);\n        //正常队列设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", DEAD_EXCHANGE);\n        //设置死信RoutingKey\n        arguments.put(\"x-dead-letter-routing-key\", \"lisi\");\n        //设置正常队列的长度的限制\n//        arguments.put(\"x-max-length\", 19);\n        channel.queueDeclare(NORMAL_QUEUE, false, false, false, arguments);\n        ///////////////////////////////////////////////////\n        //声明死信队列\n        channel.queueDeclare(DEAD_QUEUE, false, false, false, null);\n        //交换机与队列绑定\n        //绑定普通交换机与普通队列\n        channel.queueBind(NORMAL_QUEUE, NORMAL_EXCHANGE, \"zhangsan\");\n        //绑定死信交换机与死信队列\n        channel.queueBind(DEAD_QUEUE, DEAD_EXCHANGE, \"lisi\");\n        System.out.println(\"等待接收消息.........\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            String msg = new String(message.getBody(), StandardCharsets.UTF_8);\n            if (msg.equals(\"info5\")) {\n                System.out.println(\"此消息被C1拒绝的\" + msg);\n                //拒绝此消息，并且不放回队列中。因此成为死信\n                channel.basicReject(message.getEnvelope().getDeliveryTag(), false);\n            } else {\n                System.out.println(\"Consumer01接收的消息\" + msg);\n                //不批量应答\n                channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n            }\n        };\n        //开启手动应答（如果不开启手动应答，就不存在拒绝了）\n        channel.basicConsume(NORMAL_QUEUE, false, deliverCallback, consumerTag -> {\n        });\n    }\n}\n```\n\n- 消费者 2：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 15:40\n * 死信队列\n * 消费者2\n */\npublic class Consumer02 {\n    //死信队列的名称\n    public static final String DEAD_QUEUE = \"dead_queue\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(\"等待接收消息.........\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"Consumer02接收的消息\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(DEAD_QUEUE, false, deliverCallback, consumerTag -> {\n\n        });\n    }\n}\n```\n\n- 生产者：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 16:13\n * 死信队列-生产者\n */\npublic class Producer {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = \"normal_exchange\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //死信时间  设置ttl时间\n        AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().expiration(\"10000\").build();\n        for (int i = 1; i < 11; i++) {\n            String message = \"info\" + i;\n            channel.basicPublish(NORMAL_EXCHANGE, \"zhangsan\", properties, message.getBytes());\n        }\n    }\n}\n```\n\n测试步骤：\n\n1. 运行消费者：会发现普通和死信交换机已经绑定各自的队列。\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638445377947-e4a087d0-b755-4178-aa6d-7ae082107bb0.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=495&id=ud91030e8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=495&originWidth=541&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23775&status=done&style=none&taskId=u8f85c23d-a811-41b4-a478-a20609fc50a&title=&width=541#crop=0&crop=0&crop=1&crop=1&id=xwjE9&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638445475857-ba40932b-588f-43d3-b3a6-5f2660bcd241.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=498&id=ub28b2410&margin=%5Bobject%20Object%5D&name=image.png&originHeight=498&originWidth=601&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25129&status=done&style=none&taskId=u8de3a461-08ce-49b9-9936-e0cf7fa1363&title=&width=601#crop=0&crop=0&crop=1&crop=1&id=Jcymv&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n2. 测试**队列达到最大长度**，关闭消费者 1 和 2，开启生产者：消息会积压在队列中，消费者 1 所在的普通队列消息限制有 6 条，剩下的 4 条会进入消费者 2 所在的死信队列。如下图所示：\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638448087379-8c4e5c46-39ca-49fd-8024-4111b0a5d431.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=u9eb9c88a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=571&originWidth=1083&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79389&status=done&style=none&taskId=ua5f78b60-fd26-4cb8-9cf8-f0e0f17270b&title=&width=1083#crop=0&crop=0&crop=1&crop=1&id=s5bzi&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n3. 取消普通队列的最大长度限制，测试**消息 ttl 过期**：关闭消费者 1 和 2，开启生产者发送消息。（消息会因为没人接收，会在 ttl 时间内积压在普通队列中， ttl 过期后，消息会进入死信队列中。）\n\n生产者：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 16:13\n * 死信队列-生产者\n */\npublic class Producer {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = \"normal_exchange\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //死信时间  设置ttl时间\n        AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().expiration(\"10000\").build();\n        for (int i = 1; i < 11; i++) {\n            String message = \"info\" + i;\n            channel.basicPublish(NORMAL_EXCHANGE, \"zhangsan\", properties, message.getBytes());\n        }\n    }\n}\n```\n\n4. 测试**消息被拒**：\n\n开启消费者 1 和 2，再开启生产者。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450659287-e191b69a-07c6-4d5e-8f54-05d22263a235.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=274&id=u03d42d3b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=274&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32103&status=done&style=none&taskId=uf69d66f1-feae-4ff6-83ca-af7f8a83127&title=&width=642#crop=0&crop=0&crop=1&crop=1&id=jR4qW&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450668535-06aa1842-3563-455e-bb20-6376694fae1f.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=202&id=u33f7f3ac&margin=%5Bobject%20Object%5D&name=image.png&originHeight=202&originWidth=616&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23460&status=done&style=none&taskId=ua7a303f7-25d6-4fc0-8d46-d522a51ded6&title=&width=616#crop=0&crop=0&crop=1&crop=1&id=vAYSS&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"38e2258c\"></a>\n## 延迟队列（基于死信队列）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450862631-363c8d24-6a72-463a-b827-201e6f79cb79.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=128&id=u8aa7212b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=128&originWidth=1081&originalType=binary&ratio=1&rotation=0&showTitle=false&size=190603&status=done&style=none&taskId=ue97c71c8-4947-4c82-be00-e98e36ba920&title=&width=1081#crop=0&crop=0&crop=1&crop=1&id=xrjpE&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638451047144-5f4983f1-3a0e-472b-95f3-26635a911749.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=399&id=ud5620b6f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=399&originWidth=869&originalType=binary&ratio=1&rotation=0&showTitle=false&size=265988&status=done&style=none&taskId=ub1f53a1e-1377-4e43-ab1d-13e29cf4118&title=&width=869#crop=0&crop=0&crop=1&crop=1&id=O4W2R&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"5bff6472\"></a>\n### 整合 SpringBoot\n\n\n\n<a name=\"73ad366e\"></a>\n#### 实现延迟队列：\n\n1. 依赖：\n\n```java\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.6.1</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.atguigu.rabbitmq</groupId>\n    <artifactId>springboot-rabbitmq</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>springboot-rabbitmq</name>\n    <description>Demo project for Spring Boot</description>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-amqp</artifactId>\n            <version>2.6.1</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web -->\n        <!--web服务器，可以自启动-->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n            <version>2.6.1</version>\n        </dependency>\n        <!--快速进行json转换-->\n        <!-- https://mvnrepository.com/artifact/com.alibaba/fastjson -->\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>fastjson</artifactId>\n            <version>1.2.78</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 -->\n        <dependency>\n            <groupId>io.springfox</groupId>\n            <artifactId>springfox-swagger2</artifactId>\n            <version>3.0.0</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui -->\n        <dependency>\n            <groupId>io.springfox</groupId>\n            <artifactId>springfox-swagger-ui</artifactId>\n            <version>3.0.0</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework.amqp/spring-rabbit-test -->\n        <dependency>\n            <groupId>org.springframework.amqp</groupId>\n            <artifactId>spring-rabbit-test</artifactId>\n            <version>2.4.0</version>\n            <scope>test</scope>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <version>1.18.22</version>\n            <scope>provided</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n```\n\n2. yml 配置文件：\n\n```java\nspring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n```\n\n3. swagger 配置类：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.context.annotation.Bean;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.service.Contact;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 22:34\n */\npublic class SwaggerConfig {\n    @Bean\n    public Docket webApiConfig() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .groupName(\"webApi\")\n                .apiInfo(webApiInfo())\n                .select()\n                .build();\n    }\n\n    private ApiInfo webApiInfo() {\n        return new ApiInfoBuilder()\n                .title(\"rabbitmq  接口文档\")\n                .description(\" 本文档描述了 rabbitmq  微服务接口定义\")\n                .version(\"1.0\")\n                .contact(new Contact(\"enjoy6288\", \"http://atguigu.com\",\n                        \"1846015350@qq.com\"))\n                .build();\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638490298754-a2b1ced5-676b-4f68-86e0-31f05266088f.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=215&id=u8ba627f6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=215&originWidth=1100&originalType=binary&ratio=1&rotation=0&showTitle=false&size=132048&status=done&style=none&taskId=ud9c3f28a-b8df-44d1-b9df-dc90c70e046&title=&width=1100#crop=0&crop=0&crop=1&crop=1&id=Iv7m8&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n4. 声明队列配置文件：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 8:15\n * TTL队列，  配置文件类代码\n */\n@Configuration\npublic class TtlQueueConfig {\n    //普通交换机的名称\n    public static final String X_EXCHANGE = \"X\";\n    //死信交换机的名称\n    public static final String Y_DEAD_LETTER_EXCHANGE = \"Y\";\n    //普通队列的名称\n    public static final String QUEUE_A = \"QA\";\n    public static final String QUEUE_B = \"QB\";\n    //死信队列的名称\n    public static final String DEAD_LETTER_QUEUE = \"QD\";\n\n    //声明xExchange 别名\n    @Bean(\"xExchange\")\n    public DirectExchange xExchange() {\n        return new DirectExchange(X_EXCHANGE);\n    }\n\n    @Bean(\"yExchange\")\n    public DirectExchange yExchange() {\n        return new DirectExchange(Y_DEAD_LETTER_EXCHANGE);\n    }\n\n    //声明普通队列  ttl为10s\n    @Bean(\"queueA\")\n    public Queue queueA() {\n        Map<String, Object> arguments = new HashMap<>(3);\n        //设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", Y_DEAD_LETTER_EXCHANGE);\n        //设置死信 routing-key\n        arguments.put(\"x-dead-letter-routing-key\", \"YD\");\n        //设置ttl  单位为ms\n        arguments.put(\"x-message-ttl\", 10000);\n        return QueueBuilder.durable(QUEUE_A).withArguments(arguments).build();\n    }\n\n    //声明普通队列  ttl为40s\n    @Bean(\"queueB\")\n    public Queue queueB() {\n        Map<String, Object> arguments = new HashMap<>(3);\n        //设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", Y_DEAD_LETTER_EXCHANGE);\n        //设置死信 routing-key\n        arguments.put(\"x-dead-letter-routing-key\", \"YD\");\n        //设置ttl  单位为ms\n        arguments.put(\"x-message-ttl\", 40000);\n        return QueueBuilder.durable(QUEUE_B).withArguments(arguments).build();\n    }\n\n    //死信队列\n    @Bean(\"queueD\")\n    public Queue queueD() {\n        return QueueBuilder.durable(DEAD_LETTER_QUEUE).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueABindingX(@Qualifier(\"queueA\") Queue queueA, @Qualifier(\"xExchange\") DirectExchange xExchange) {\n        return BindingBuilder.bind(queueA).to(xExchange).with(\"XA\");\n    }\n\n    @Bean\n    public Binding queueBBindingX(@Qualifier(\"queueB\") Queue queueB, @Qualifier(\"xExchange\") DirectExchange xExchange) {\n        return BindingBuilder.bind(queueB).to(xExchange).with(\"XB\");\n    }\n\n    @Bean\n    public Binding queueDBindingY(@Qualifier(\"queueD\") Queue queueD, @Qualifier(\"yExchange\") DirectExchange yExchange) {\n        return BindingBuilder.bind(queueD).to(yExchange).with(\"YD\");\n    }\n}\n```\n\n5. 消费者：接收消息\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.rabbitmq.client.Channel;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 9:01\n * 队列ttl 消费者\n */\n@Slf4j\n@Component\npublic class DeadLetterQueueConsumer {\n\n    //接收消息\n    @RabbitListener(queues = \"QD\")\n    public void receiveD(Message message, Channel channel) {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间：{}，收到死信队列的消息：{}\", new Date().toString(), msg);\n    }\n}\n```\n\n6. 发送消息：Controller\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 8:47\n * 发送延迟消息\n * <p>\n * http://localhost:8080/ttl/sendMsg/嘻嘻嘻\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ttl\")\npublic class SendMsgController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //开始发消息\n    @GetMapping(\"/sendMsg/{message}\")\n    public void sendMsg(@PathVariable String message) {\n        log.info(\"当前时间：{}，发送一条消息给两个ttl队列:{}\", new Date().toString(), message);\n        rabbitTemplate.convertAndSend(\"X\", \"XA\", \"消息来自ttl为10s的队列\" + message);\n        rabbitTemplate.convertAndSend(\"X\", \"XB\", \"消息来自ttl为40s的队列\" + message);\n    }\n}\n```\n\n<br />访问：[http://localhost:8080/ttl/sendMsg/](http://localhost:8080/ttl/sendMsg/)嘻嘻嘻<br />控制台打印结果：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638494307481-a59aaddb-4efb-4200-9e05-0e34602ded36.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=202&id=u66541ef9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=202&originWidth=1365&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62756&status=done&style=none&taskId=ua128108f-eaa5-47fc-ab0d-e56fe3f57f4&title=&width=1365#crop=0&crop=0&crop=1&crop=1&id=tO8el&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"5d575387\"></a>\n#### 延迟队列优化：\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638494906968-c2a2e16a-a5b3-4c44-83bc-5846e35977d0.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=333&id=u5def25ea&margin=%5Bobject%20Object%5D&name=image.png&originHeight=333&originWidth=1070&originalType=binary&ratio=1&rotation=0&showTitle=false&size=169463&status=done&style=none&taskId=uede9888d-c22a-46c9-a810-c9c1899d23a&title=&width=1070#crop=0&crop=0&crop=1&crop=1&id=PCbH9&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />增加一个 QC 普通队列声明后并绑定交换机 XC。<br />队列配置 中添加：\n\n```java\n//--------------------------------优化延迟队列-------------------------------------\n    //普通队列的名称（为了优化延迟队列）\n    public static final String QUEUE_C = \"QC\";\n\n    //声明QC\n    @Bean(\"queueC\")\n    public Queue queueC() {\n        Map<String, Object> arguments = new HashMap<>(2);\n        //设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", Y_DEAD_LETTER_EXCHANGE);\n        //设置死信routing-key\n        arguments.put(\"x-dead-letter-routing-key\", \"YD\");\n        return QueueBuilder.durable(QUEUE_C).withArguments(arguments).build();\n    }\n\n    //绑定普通队列QC和交换机\n    @Bean\n    public Binding queueCBindingX(@Qualifier(\"queueC\") Queue queueC,\n                                  @Qualifier(\"xExchange\") DirectExchange xExchange) {\n        return BindingBuilder.bind(queueC).to(xExchange).with(\"XC\");\n    }\n    //-----------------------------------优化延迟队列----------------------------------\n```\n\n添加 Controller 发消息控制器：\n\n```java\n//开始发消息  消息ttl\n    @GetMapping(\"/sendExpireMsg/{message}/{ttlTime}\")\n    public void sendMsg(@PathVariable String message, @PathVariable String ttlTime) {\n        log.info(\"当前时间：{}，发送一条时长{}毫秒，ttl信息给队列QC:{}\", new Date().toString(), ttlTime, message);\n        rabbitTemplate.convertAndSend(\"X\", \"XC\", message, msg -> {\n            //发送消息的时候  延迟时长\n            msg.getMessageProperties().setExpiration(ttlTime);\n            return msg;\n        });\n    }\n```\n\n测试：\n\n1. http://localhost:8080/ttl/sendExpireMsg/你好 1/20000\n2. http://localhost:8080/ttl/sendExpireMsg/你好 2/2000\n\n结果：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638517312025-dfbbfd0b-a82c-4432-a395-2e7cc7c6e48f.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=149&id=u18e59259&margin=%5Bobject%20Object%5D&name=image.png&originHeight=149&originWidth=1285&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42107&status=done&style=none&taskId=uff6fb06a-df03-451f-b886-52364055048&title=&width=1285#crop=0&crop=0&crop=1&crop=1&id=efjYm&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"d0cad89d\"></a>\n## 延迟队列（基于插件）\n\n进入 rabbitmq 安装目录下的 plugins 目录 ，cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins<br />执行命令让该插件生效：rabbitmq-plugins enable rabbitmq_delayed_message_exchange<br />然后重启 rabbitmq：systemctl restart rabbitmq-server<br />会发现交换机多了一个新类型，意味着延迟消息将由交换机来完成，而不是队列。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638519642120-f3258006-3639-4551-805e-26bbd1e67c85.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=530&id=u66b7d498&margin=%5Bobject%20Object%5D&name=image.png&originHeight=767&originWidth=690&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56472&status=done&style=none&taskId=u707609ca-e368-4b6c-9833-ec8cc57ca15&title=&width=477.00006103515625#crop=0&crop=0&crop=1&crop=1&id=PD1AH&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n原来的情况：基于死信<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520455616-cfcde47e-bee3-4ef6-83b6-6630dbe54d9a.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=443&id=ua9957719&margin=%5Bobject%20Object%5D&name=image.png&originHeight=601&originWidth=1033&originalType=binary&ratio=1&rotation=0&showTitle=false&size=226301&status=done&style=none&taskId=ua95f3b09-635a-4782-abfd-57901f34a8b&title=&width=760.9862060546875#crop=0&crop=0&crop=1&crop=1&id=UOPGa&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />现在：基于延迟插件<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520591056-7591eaf6-b99f-4059-8cbb-6a6ee0ea64f2.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=177&id=u11577081&margin=%5Bobject%20Object%5D&name=image.png&originHeight=224&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=94107&status=done&style=none&taskId=u47b17a31-4f94-4f3c-a75f-2014f181765&title=&width=770.9896240234375#crop=0&crop=0&crop=1&crop=1&id=a4gyh&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />代码架构：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520764180-7b9e927e-1166-470d-ac32-dda16bb87ae1.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=188&id=ud9b4ba5b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=188&originWidth=1062&originalType=binary&ratio=1&rotation=0&showTitle=false&size=84300&status=done&style=none&taskId=u12c568cb-6151-4b2f-8f49-3f721530b6d&title=&width=1062#crop=0&crop=0&crop=1&crop=1&id=cPAio&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 配置类\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 16:41\n */\n@Configuration\npublic class DelayedQueueConfig {\n    //队列\n    public static final String DELAYED_QUEUE_NAME = \"delayed.name\";\n    //交换机\n    public static final String DELAYED_EXCHANGE_NAME = \"delayed.exchange\";\n    //routing-key\n    public static final String DELAYED_ROUTING_KEY = \"delayed.routingkey\";\n\n    //声明队列\n    @Bean\n    public Queue delayedQueue() {\n        return QueueBuilder.durable(DELAYED_QUEUE_NAME).build();\n    }\n\n    //声明交换机 基于插件\n    @Bean\n    public CustomExchange delayedExchange() {\n        Map<String, Object> arguments = new HashMap<>();\n        arguments.put(\"x-delayed-type\", \"direct\");\n        /**\n         * 1. 交换机的名称\n         * 2. 交换机的类型\n         * 3. 是否需要持久化\n         * 4. 是否需要自动删除\n         * 5. 其他的参数\n         */\n        return new CustomExchange(DELAYED_EXCHANGE_NAME, \"x-delayed-message\", true, false, arguments);\n    }\n\n    //绑定\n    @Bean\n    public Binding delayedQueueBindingDelayedExchange(@Qualifier(\"delayedQueue\") Queue delayedQueue,\n                                                      @Qualifier(\"delayedExchange\") CustomExchange delayedExchange) {\n        return BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();\n    }\n}\n```\n\n2. Controller 生产者：\n\n```java\n//发消息  基于延迟插件\n    @GetMapping(\"/sendDelayMsg/{message}/{delayTime}\")\n    public void sendMsg(@PathVariable String message, @PathVariable Integer delayTime) {\n        log.info(\"当前时间:{},发送一条时长{}毫秒信息给延迟队列delayed.queue:{}\", new Date().toString(), delayTime, message);\n        rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME, DelayedQueueConfig.DELAYED_ROUTING_KEY, message, msg -> {\n            //发送消息的时候   延迟时长  单位：ms\n            msg.getMessageProperties().setDelay(delayTime);\n            return msg;\n        });\n    }\n```\n\n3. 消费者：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.DelayedQueueConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 19:36\n * 消费者 基于插件的延迟消息\n */\n@Slf4j\n@Component\npublic class DelayQueueConsumer {\n    //监听消息\n    @RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE_NAME)\n    public void receiveDelayQueue(Message message) {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间:{},收到延迟队列的消息：{}\", new Date().toString(), msg);\n    }\n}\n```\n\n测试：<br />发起请求：[http://localhost:8080/ttl/sendDelayMsg/com](http://localhost:8080/ttl/sendDelayMsg/com) on baby1/20000<br /> [http://localhost:8080/ttl/sendDelayMsg/com](http://localhost:8080/ttl/sendDelayMsg/com) on baby2/2000<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638532349237-315b969f-d021-4448-8aa8-d5a1d41950a0.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=208&id=uf33e7fe7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=208&originWidth=1432&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71640&status=done&style=none&taskId=ue722c22b-16d9-40a2-9a28-e95348df5d0&title=&width=1432#crop=0&crop=0&crop=1&crop=1&id=P79jF&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638532663153-40afab72-d363-4536-94fc-4889e40d764b.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=224&id=u7813c3ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=266&originWidth=1121&originalType=binary&ratio=1&rotation=0&showTitle=false&size=457006&status=done&style=none&taskId=u0e4002d8-2179-43cc-bcfd-7c69cd127b5&title=&width=941.9896240234375#crop=0&crop=0&crop=1&crop=1&id=aEVGf&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"d338501f\"></a>\n## 发布确认高级\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638533419869-3aa9b7ad-ee4e-4fd8-9e42-fd6af4aafe70.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=225&id=u7ed4e098&margin=%5Bobject%20Object%5D&name=image.png&originHeight=341&originWidth=945&originalType=binary&ratio=1&rotation=0&showTitle=false&size=186643&status=done&style=none&taskId=uc65852ff-c2a9-416e-bef6-2991c80fa8b&title=&width=623.0000610351562#crop=0&crop=0&crop=1&crop=1&id=OAmnb&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=) <br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638533456413-9ead4e1d-f118-4a55-8d05-bcdd4d5fc47f.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=131&id=u954992f9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=144&originWidth=839&originalType=binary&ratio=1&rotation=0&showTitle=false&size=73103&status=done&style=none&taskId=u9819bc42-f398-487a-b319-358e2acd1ba&title=&width=762.9931030273438#crop=0&crop=0&crop=1&crop=1&id=sjopK&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"3f64dd13\"></a>\n### 回调接口 : (若交换机收不到消息)\n\n1. 配置类\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:15\n * 配置类  发布确认 （高级）\n */\n@Configuration\npublic class ConfirmConfig {\n    //交换机\n    public static final String CONFIRM_EXCHANGE_NAME = \"confirm_exchange\";\n    //队列\n    public static final String CONFIRM_QUEUE_NAME = \"confirm_queue\";\n    //routing-key\n    public static final String CONFIRM_ROUTING_KEY = \"key1\";\n\n    //声明交换机\n    @Bean\n    public DirectExchange confirmExchange() {\n        return new DirectExchange(CONFIRM_EXCHANGE_NAME);\n    }\n\n    //声明队列\n    @Bean\n    public Queue confirmQueue() {\n        return QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueBindingExchange(@Qualifier(\"confirmQueue\") Queue confirmQueue,\n                                        @Qualifier(\"confirmExchange\") DirectExchange confirmExchange) {\n        return BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);\n    }\n}\n```\n\n2. 生产者：发消息\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:27\n * 开始发消息\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/confirm\")\npublic class ProducerController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //发消息\n    @GetMapping(\"/sendMessage/{message}\")\n    public void sendMessage(@PathVariable String message) {\n        CorrelationData correlationData = new CorrelationData(\"1\");\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME, ConfirmConfig.CONFIRM_ROUTING_KEY, message, correlationData);\n        log.info(\"发送消息内容为：{}\", message);\n    }\n}\n```\n\n3. 消费者：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:33\n * 接收消息\n */\n@Slf4j\n@Component\npublic class Consumer {\n    @RabbitListener(queues = ConfirmConfig.CONFIRM_QUEUE_NAME)\n    public void receiveConfirmMessage(Message message) {\n        String msg = new String(message.getBody());\n        log.info(\"接收到的队列confirm.queue消息：{}\", msg);\n    }\n}\n```\n\n4. 回调接口\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\nimport javax.annotation.PostConstruct;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:50\n * 回调接口\n */\n@Slf4j\n@Component\npublic class MyCallBack implements RabbitTemplate.ConfirmCallback {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    public void init() {\n        //注入 （需要将当前实现类注入到RabbitTemplate的ConfirmCallback函数式接口中）\n        rabbitTemplate.setConfirmCallback(this);\n    }\n\n    /**\n     * 交换机确认回调方法\n     * 1. 发消息  交换机接收到了  回调\n     * 1.1 correlationData 保存回调消息的id及相关信息\n     * 1.2 交换机收到消息  ack = true\n     * 1.3 cause  null\n     * 2. 发消息 交换机接收失败 回调\n     * 2.1 correlationData 保存回调消息的id及相关信息\n     * 2.2 交换机收到消息 ack = false\n     * 2.3 cause  失败的原因\n     *\n     * @param correlationData\n     * @param ack\n     * @param cause\n     */\n    @Override\n    public void confirm(CorrelationData correlationData, boolean ack, String cause) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (ack) {\n            log.info(\"交换机已经收到id为：{}的消息\", id);\n        } else {\n            log.error(\"交换机还未收到id为:{}的消息，由于原因：{}\", id, cause);\n        }\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638537772169-a45dc229-e5ed-410a-8e46-69f3fb39f21e.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=518&id=u396acbb1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=518&originWidth=973&originalType=binary&ratio=1&rotation=0&showTitle=false&size=369736&status=done&style=none&taskId=u8a93ee99-1d87-4fd1-880d-a166a5e50f1&title=&width=973#crop=0&crop=0&crop=1&crop=1&id=Bk8N5&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\nspring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n    publisher-confirm-type: correlated    # 消息确认机制\n```\n\n5. 发送请求 : http://localhost:8080/confirm/sendMessage/大家好 1\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638537854600-e11783cd-28be-4b75-8f36-434ecab3f990.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=190&id=ue332f12f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=190&originWidth=1135&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51915&status=done&style=none&taskId=uba52e997-898f-49e3-9067-645cfb69f68&title=&width=1135#crop=0&crop=0&crop=1&crop=1&id=Emijw&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n6. 测试交换机收不到消息：在发送消息中，将交换机名字后面拼接上\"123\"，再次启动，发送请求： http://localhost:8080/confirm/sendMessage/大家好 1\n\n会得到：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638538268620-8dcbc2ae-eaa1-4b60-8822-9cd20f509c52.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=222&id=u3e470d69&margin=%5Bobject%20Object%5D&name=image.png&originHeight=222&originWidth=1872&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66288&status=done&style=none&taskId=u7f0330f7-a846-488e-8b25-71c1f3cf0a7&title=&width=1872#crop=0&crop=0&crop=1&crop=1&id=J3ZRH&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n7. 测试队列收不到消息\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:27\n * 开始发消息  生产者\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/confirm\")\npublic class ProducerController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //发消息\n    @GetMapping(\"/sendMessage/{message}\")\n    public void sendMessage(@PathVariable String message) {\n        CorrelationData correlationData1 = new CorrelationData(\"1\");\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,\n                ConfirmConfig.CONFIRM_ROUTING_KEY, message, correlationData1);\n        log.info(\"发送消息内容为：{}\", message);\n\n        CorrelationData correlationData2 = new CorrelationData(\"2\");\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,\n                ConfirmConfig.CONFIRM_ROUTING_KEY+\"2\", message, correlationData2);\n        log.info(\"发送消息内容为：{}\", message);\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638538743381-bfc4680e-692b-4303-a0f3-87cd9425978d.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=247&id=u241a2996&margin=%5Bobject%20Object%5D&name=image.png&originHeight=247&originWidth=1157&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67266&status=done&style=none&taskId=u3edf7078-e740-4b0a-866c-03de3cfb9db&title=&width=1157#crop=0&crop=0&crop=1&crop=1&id=SGy2Z&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />可见，队列没有收到消息，也没有应答和确认。\n\n<a name=\"9a49228a\"></a>\n### 若队列收不到消息\n\n\n\n<a name=\"7df88dac\"></a>\n#### 回退消息\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638539584832-557a9bbc-89d4-4162-a0d4-599eb7f3df21.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=210&id=u40b5093d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=210&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=298616&status=done&style=none&taskId=u13a46749-be43-4430-beb2-483ea013efc&title=&width=976#crop=0&crop=0&crop=1&crop=1&id=thCkG&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\nspring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n    publisher-confirm-type: correlated   # 消息确认机制\n    publisher-returns: true       # 发布确认机制（消息在交换机那若路由失败，则会回退消息给生产者）\n```\n\n回退接口：\n\n```java\n//注入\n@PostConstruct\n    public void init() {\n        //注入 （需要将当前实现类注入到RabbitTemplate的ConfirmCallback函数式接口中）\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setReturnsCallback(this);\n    }\n/**\n     * 可以在当消息传递过程中，不可达目的地时将消息返回给生产者\n     * 只有不可到目的地时，才进行回退\n     *\n     * @param returnedMessage\n     */\n    @Override\n    public void returnedMessage(ReturnedMessage returnedMessage) {\n        log.error(\"消息{}，被交换机{}退回，退回原因：{},路由key:{}\",\n                new String(returnedMessage.getMessage().getBody()),\n                returnedMessage.getExchange(),\n                returnedMessage.getReplyText(),\n                returnedMessage.getRoutingKey());\n    }\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638542234889-03b41ef6-8fc5-4ffb-9f36-7287d4ff9476.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=267&id=uddd5e8ec&margin=%5Bobject%20Object%5D&name=image.png&originHeight=267&originWidth=1293&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78730&status=done&style=none&taskId=u4c513758-cf34-415c-a9f3-845a33faec5&title=&width=1293#crop=0&crop=0&crop=1&crop=1&id=tOHQ4&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"2d534732\"></a>\n#### 备份交换机\n\n添加一个交换机和两个队列。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638578627259-759238ba-aac5-42f9-b645-401c5c9a05d2.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=328&id=ud35a1613&margin=%5Bobject%20Object%5D&name=image.png&originHeight=328&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&size=197049&status=done&style=none&taskId=u04e4ef45-34c3-49a8-84c0-93d70b4ebb6&title=&width=930#crop=0&crop=0&crop=1&crop=1&id=j2ALj&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 配置类\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:15\n * 配置类  发布确认 （高级）\n */\n@Configuration\npublic class ConfirmConfig {\n    //交换机\n    public static final String CONFIRM_EXCHANGE_NAME = \"confirm_exchange\";\n    //队列\n    public static final String CONFIRM_QUEUE_NAME = \"confirm_queue\";\n    //routing-key\n    public static final String CONFIRM_ROUTING_KEY = \"key1\";\n    // --------------------------备份交换机---------------------------------\n    //备份交换机\n    public static final String BACKUP_EXCHANGE_NAME = \"backup_exchange\";\n\n    //备份队列\n    public static final String BACKUP_QUEUE_NAME = \"backup_queue\";\n\n    //报警队列\n    public static final String WARNING_QUEUE_NAME = \"warning_queue\";\n\n    //--------------------------------------------------------------------\n    //声明确认交换机（要转发到备份交换机）\n    @Bean\n    public DirectExchange confirmExchange() {\n        return ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(true)\n                .withArgument(\"alternate-exchange\", BACKUP_EXCHANGE_NAME).build();\n    }\n\n    //声明队列\n    @Bean\n    public Queue confirmQueue() {\n        return QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueBindingExchange(@Qualifier(\"confirmQueue\") Queue confirmQueue,\n                                        @Qualifier(\"confirmExchange\") DirectExchange confirmExchange) {\n        return BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);\n    }\n\n    //备份交换机\n    @Bean\n    public FanoutExchange backupExchange() {\n        return new FanoutExchange(BACKUP_EXCHANGE_NAME);\n    }\n\n    //备份队列\n    @Bean\n    public Queue backupQueue() {\n        return QueueBuilder.durable(BACKUP_QUEUE_NAME).build();\n    }\n\n    //报警队列\n    @Bean\n    public Queue warningQueue() {\n        return QueueBuilder.durable(WARNING_QUEUE_NAME).build();\n    }\n\n    //绑定（备份交换机和备份队列）\n    @Bean\n    public Binding backupQueueBindingBackupExchange(@Qualifier(\"backupExchange\") FanoutExchange backupExchange, @Qualifier(\"backupQueue\") Queue backupQueue) {\n        return BindingBuilder.bind(backupQueue).to(backupExchange);\n    }\n\n    //绑定（备份交换机和报警队列）\n    @Bean\n    public Binding warningQueueBindingBackupExchange(@Qualifier(\"backupExchange\") FanoutExchange backupExchange, @Qualifier(\"warningQueue\") Queue warningQueue) {\n        return BindingBuilder.bind(warningQueue).to(backupExchange);\n    }\n}\n```\n\n2. 消费者（报警消费者）\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/4 9:10\n * 报警消费者\n */\n@Component\n@Slf4j\npublic class WarningConsumer {\n    //接收报警消息\n    @RabbitListener(queues = ConfirmConfig.WARNING_QUEUE_NAME)\n    public void receiveWarningMsg(Message message) {\n        String msg = new String(message.getBody());\n        log.error(\"报警发现不可路由消息：{}\", msg);\n    }\n}\n```\n\n发送请求：http://localhost:8080/confirm/sendMessage/大家好 1<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638581402507-07326d95-5109-4750-b3ab-c4751b23d55d.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=263&id=udc9907e1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=263&originWidth=1171&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75848&status=done&style=none&taskId=u7fb8b716-7979-4acf-b11c-fe1cb99bebd&title=&width=1171#crop=0&crop=0&crop=1&crop=1&id=Lep12&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n> **备份交换机的优先级高于回退消息、**\n\n\n\n\n<a name=\"c06ec42e\"></a>\n## 其他知识点\n\n\n\n<a name=\"71a92fdf\"></a>\n### 幂等性\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638581856478-4611604a-34c1-486b-a3b7-c809f3d94f0e.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=620&id=ua03a1a2a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=620&originWidth=977&originalType=binary&ratio=1&rotation=0&showTitle=false&size=628166&status=done&style=none&taskId=u3bbefde1-d01a-481e-b831-abe2598835f&title=&width=977#crop=0&crop=0&crop=1&crop=1&id=pWlKw&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582165848-9189cc73-c68b-4631-b30d-dad30387a032.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=523&id=u37f187c9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=523&originWidth=1001&originalType=binary&ratio=1&rotation=0&showTitle=false&size=609037&status=done&style=none&taskId=udd6ff171-0753-4d6f-a510-a8761c65fcb&title=&width=1001#crop=0&crop=0&crop=1&crop=1&id=o6DXP&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n\n\n<a name=\"507580b5\"></a>\n### 优先级队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582363595-025332ba-94e1-4485-b6ab-e0542d69fab7.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=326&id=u83200fbd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=326&originWidth=987&originalType=binary&ratio=1&rotation=0&showTitle=false&size=447217&status=done&style=none&taskId=ueea7db03-7906-4cef-baef-0ebe50a0185&title=&width=987#crop=0&crop=0&crop=1&crop=1&id=h3cca&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582579936-dd221c3d-efc6-4e4b-b854-6667d27682a1.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=343&id=u3930b1c7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=402&originWidth=1186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=288467&status=done&style=none&taskId=u70a2eadf-0b86-470c-a5a8-b7d8f612ad3&title=&width=1010.9896240234375#crop=0&crop=0&crop=1&crop=1&id=WVQYU&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />实现优先级:\n\n1. 生产者：\n\n```java\npackage com.atguigu.rabbitmq.one;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport java.io.IOException;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/28 22:15\n * 生产者 ：发消息\n */\npublic class Producer {\n    //队列名称\n    private static final String QUEUE_NAME = \"hello1\";\n\n    //发消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建一个连接工厂\n//        ConnectionFactory factory = new ConnectionFactory();\n//        //设置工厂ip  连接rabbitmq的队列\n//        factory.setHost(\"59.110.171.189\");\n//        //用户名\n//        factory.setUsername(\"admin\");\n//        //密码\n//        factory.setPassword(\"123\");\n//        //创建连接\n//        Connection connection = factory.newConnection();\n//        //获取信道\n//        Channel channel = connection.createChannel();\n        Channel channel = RabbitMqUtils.getChannel();\n        /**\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n         4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n         5.其他参数（延迟消息......）\n         */\n        Map<String, Object> arguments = new HashMap<>();\n        //官方允许是0-255之间。此处设置10. 允许优先级范围为0-10   不要设置过大   浪费CPU与内存\n        arguments.put(\"x-max-priority\", 10);\n        channel.queueDeclare(QUEUE_NAME, true, false, false, arguments);\n        //发消息\n        for (int i = 0; i < 11; i++) {\n            String message = \"info\" + i;\n            if (i == 5) {\n                //设置优先级\n                AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().priority(5).build();\n                channel.basicPublish(\"\", QUEUE_NAME, properties, message.getBytes());\n            } else {\n                channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes());\n            }\n        }\n        /*\n         * 发送一个消息\n         * 1. 发送到哪个交换机\n         * 2. 路由的key值是哪个，本次是队列的名称\n         * 3. 其他参数信息\n         * 4. 发送消息的消息体\n         */\n        System.out.println(\"消息发送完毕\");\n    }\n}\n```\n\n启动生产者：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584428018-a99005d9-2193-463c-9f45-3f72656510ca.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=245&id=u9109bfc5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=245&originWidth=673&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24479&status=done&style=none&taskId=u0a4a6f5a-f03f-4ab3-8fcc-d9bdc327aad&title=&width=673#crop=0&crop=0&crop=1&crop=1&id=shKB3&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"07eab7c1\"></a>\n### ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584267331-0bf02c8d-6536-43a8-aa18-ee5f4ed82255.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=500&id=AvLAP&margin=%5Bobject%20Object%5D&name=image.png&originHeight=500&originWidth=1065&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74831&status=done&style=none&taskId=u77c77f80-cfec-453b-bc9f-f82bf26b07c&title=&width=1065#crop=0&crop=0&crop=1&crop=1&id=cIQXz&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n2. 消费者 :\n\n```java\npackage com.atguigu.rabbitmq.one;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.*;\n\nimport java.io.IOException;\nimport java.util.Arrays;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 15:04\n * 消费者:接收消息\n */\npublic class Consumer {\n    //队列名称\n    public static final String QUEUE_NAME = \"hello1\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建连接工厂\n//        ConnectionFactory factory = new ConnectionFactory();\n//        factory.setHost(\"59.110.171.189\");\n//        factory.setUsername(\"admin\");\n//        factory.setPassword(\"123\");\n//        Connection connection = factory.newConnection();\n//        Channel channel = connection.createChannel();\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明 接收消息(成功后的回调)\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(new String(message.getBody()));\n        };\n        //取消消息时的回调\n        CancelCallback cancelCallback = consumerTag -> {\n            System.out.println(\"消息消费被中断\");\n        };\n        /*\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, cancelCallback);\n    }\n}\n```\n\n启动消费者，<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584610103-d784c402-b9b7-4321-80d9-c4b95990f410.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=346&id=u91a8ee8e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=346&originWidth=652&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36450&status=done&style=none&taskId=u90a3da53-d612-4152-b8b6-157c3e789ca&title=&width=652#crop=0&crop=0&crop=1&crop=1&id=UEHzd&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"8508a884\"></a>\n### 惰性队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584657059-9bf42f28-e7a0-4c4f-8a39-c56038bd0071.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=425&id=ud4e3da7e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=425&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=597255&status=done&style=none&taskId=u2ff8ea80-3715-4c63-a718-4d71e1b8488&title=&width=993#crop=0&crop=0&crop=1&crop=1&id=wMAkZ&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584904322-348e89b5-e2f2-4df0-ba11-7540a061f849.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=613&id=u9cab5578&margin=%5Bobject%20Object%5D&name=image.png&originHeight=613&originWidth=1175&originalType=binary&ratio=1&rotation=0&showTitle=false&size=404748&status=done&style=none&taskId=uc0905b86-a7ec-4a0f-8a69-356a47ad688&title=&width=1175#crop=0&crop=0&crop=1&crop=1&id=NaNR3&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />惰性队列执行性能不太好，因此默认情况下不使用惰性队列，而使用正常队列。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638585096408-ecb74216-dfa9-41e3-b7bd-bd5236b2c1da.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=431&id=u4ab29e59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=431&originWidth=967&originalType=binary&ratio=1&rotation=0&showTitle=false&size=466179&status=done&style=none&taskId=ub1da4c7a-e46a-44f7-9b2f-e5129f4a839&title=&width=967#crop=0&crop=0&crop=1&crop=1&id=ZtuGu&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638585305462-e73859d4-5121-406a-b308-57cede7f1bac.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=413&id=uf8c1b8a8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=413&originWidth=966&originalType=binary&ratio=1&rotation=0&showTitle=false&size=247424&status=done&style=none&taskId=ua29dd158-1851-4974-bd9b-3c01a9c0ea5&title=&width=966#crop=0&crop=0&crop=1&crop=1&id=wFSJu&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n- 惰性队列从**磁盘**上读取消息，因此消费消息比较慢，但是内存消耗较小，在内存中只存储一些索引。一旦需要消费这些消息时，惰性队列会通过内存中的索引，去读取磁盘中相应的消息，到内存，再消费消息。\n- 正常队列从**内存**中读取消息，因此消费消息比较快，但是内存消耗较大。\n\n<a name=\"23eaf825\"></a>\n## rabbitmq 集群\n\n\n\n<a name=\"c0131d2a\"></a>\n### 集群原理\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638586666884-b99e8e77-81ef-4547-a9cd-1dcd00e86009.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=501&id=u84ce9d05&margin=%5Bobject%20Object%5D&name=image.png&originHeight=501&originWidth=1025&originalType=binary&ratio=1&rotation=0&showTitle=false&size=171726&status=done&style=none&taskId=ud7aa0990-8e0c-4e31-9dd1-c6d20007401&title=&width=1025#crop=0&crop=0&crop=1&crop=1&id=hjXVB&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"b80e581a\"></a>\n### 镜像队列（备份）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638587610363-c97ef89e-768e-4278-a087-89f20e211145.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=348&id=ue8695270&margin=%5Bobject%20Object%5D&name=image.png&originHeight=348&originWidth=981&originalType=binary&ratio=1&rotation=0&showTitle=false&size=453959&status=done&style=none&taskId=ue9f78068-c45e-4cc9-a3e0-595ae6c7337&title=&width=981#crop=0&crop=0&crop=1&crop=1&id=FTNYI&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"3702723f\"></a>\n### 高可用负载均衡\n\n若节点 1 宕机了，生产者需要连接节点 2 或节点 3。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588031855-ab97c0f3-9861-4222-b593-0a4dbfbf566d.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=754&id=u0c60fb59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=754&originWidth=1028&originalType=binary&ratio=1&rotation=0&showTitle=false&size=344345&status=done&style=none&taskId=uaef85042-099b-42a3-8caf-268a89b7438&title=&width=1028#crop=0&crop=0&crop=1&crop=1&id=XmCHx&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />出现问题：生产者无法变更 rabbitmq 的 ip，此时需要借助外力 Haproxy。\n\n<a name=\"ea97af39\"></a>\n#### Haproxy 实现高可用 负载均衡（高并发）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588332155-384a9066-f6ed-434c-bd8d-a08678795b99.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=177&id=u91155287&margin=%5Bobject%20Object%5D&name=image.png&originHeight=177&originWidth=973&originalType=binary&ratio=1&rotation=0&showTitle=false&size=240431&status=done&style=none&taskId=u9a4dff8d-f824-447c-b845-2962ddc0650&title=&width=973#crop=0&crop=0&crop=1&crop=1&id=BHuXj&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588403571-837d2496-d169-4b00-aa3c-4459e5dfd616.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=644&id=u63b0c105&margin=%5Bobject%20Object%5D&name=image.png&originHeight=644&originWidth=740&originalType=binary&ratio=1&rotation=0&showTitle=false&size=224363&status=done&style=none&taskId=u400f5630-901e-4db7-8556-6d72a1f206a&title=&width=740#crop=0&crop=0&crop=1&crop=1&id=FRrD8&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588495639-57e1823e-e317-48f1-bd99-4a64ab26b8b3.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=711&id=uefaa64c3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=711&originWidth=860&originalType=binary&ratio=1&rotation=0&showTitle=false&size=371827&status=done&style=none&taskId=u8f30ca6f-4949-4c9d-899d-b31600baa56&title=&width=860#crop=0&crop=0&crop=1&crop=1&id=K5Fpn&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"80fc5d12\"></a>\n## 联合交换机\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638600972390-f8eabb13-fdba-432b-8b93-c4798757e13e.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=660&id=u1565c7a2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=660&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=882067&status=done&style=none&taskId=u40ae3ed4-1bbc-4baa-b912-40f55e8b353&title=&width=1136#crop=0&crop=0&crop=1&crop=1&id=FkHCS&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638601768985-91857261-fe17-4687-bc9f-f8d9daf1a364.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=524&id=uafeaba48&margin=%5Bobject%20Object%5D&name=image.png&originHeight=524&originWidth=1115&originalType=binary&ratio=1&rotation=0&showTitle=false&size=307899&status=done&style=none&taskId=u4499a665-a618-4138-a2f2-5bdf1dbaca0&title=&width=1115#crop=0&crop=0&crop=1&crop=1&id=FgJli&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638601930969-0c445ecb-7e66-43cd-a7d1-3aa8c76f884d.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=581&id=u6d4c749b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=581&originWidth=505&originalType=binary&ratio=1&rotation=0&showTitle=false&size=221677&status=done&style=none&taskId=uf8d981fd-837f-4eb6-83f6-a7deba0a018&title=&width=505#crop=0&crop=0&crop=1&crop=1&id=NxTl9&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602088334-f76d8ba1-5c6d-4280-87c8-b7d58d42f902.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=506&id=u4b7146f5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=506&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=158537&status=done&style=none&taskId=u64d80530-7388-4c12-9d3b-48d90765e0b&title=&width=976#crop=0&crop=0&crop=1&crop=1&id=oVYwK&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602110103-8ee2df46-7982-4b08-a6c8-e4d9c701b69f.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=666&id=u65df8122&margin=%5Bobject%20Object%5D&name=image.png&originHeight=666&originWidth=933&originalType=binary&ratio=1&rotation=0&showTitle=false&size=302115&status=done&style=none&taskId=u970ef30c-4b50-4327-928e-6bf0cdbc242&title=&width=933#crop=0&crop=0&crop=1&crop=1&id=A9wRm&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"997a4ba0\"></a>\n## 联邦队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602602857-2efc1842-e9c7-409e-a302-2b4c63e92027.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=833&id=u3d500d40&margin=%5Bobject%20Object%5D&name=image.png&originHeight=833&originWidth=1312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=553687&status=done&style=none&taskId=u77ecfe28-0a6d-4318-bc8e-c80d6183ecc&title=&width=1312#crop=0&crop=0&crop=1&crop=1&id=qvMwP&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />两个不同地区数据同步。<br /> ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603240478-ba4a3a39-d3dc-41b3-9ee9-c8d9f2718ff9.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=551&id=u0dc6d91b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=551&originWidth=1149&originalType=binary&ratio=1&rotation=0&showTitle=false&size=244288&status=done&style=none&taskId=u65c1251d-b002-4909-ae1d-f27aa9d85ee&title=&width=1149#crop=0&crop=0&crop=1&crop=1&id=Rmak1&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"Shovel\"></a>\n## Shovel\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603352779-28d006e0-d330-4802-935c-040341c1ca8d.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=324&id=uc852da4a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=1287&originalType=binary&ratio=1&rotation=0&showTitle=false&size=568699&status=done&style=none&taskId=u2b770501-53fa-4cbc-a428-000590e2c17&title=&width=1287#crop=0&crop=0&crop=1&crop=1&id=fxL0i&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603460089-03466d04-df20-4ab2-8968-f1b5ef5905ca.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=409&id=ua502f49e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=409&originWidth=871&originalType=binary&ratio=1&rotation=0&showTitle=false&size=188661&status=done&style=none&taskId=u48a08d45-4dad-40e0-9723-55db3e3ef79&title=&width=871#crop=0&crop=0&crop=1&crop=1&id=lh1tz&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603378352-15aca4d9-af9b-48c1-b796-60a86b637ebd.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=667&id=uec9ad770&margin=%5Bobject%20Object%5D&name=image.png&originHeight=667&originWidth=864&originalType=binary&ratio=1&rotation=0&showTitle=false&size=266940&status=done&style=none&taskId=u8acd6a6e-3ed2-4306-8639-2eeb16612c3&title=&width=864#crop=0&crop=0&crop=1&crop=1&id=jpTqS&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br /> ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603594801-6bd296a5-c23b-418f-a94e-5261833d5605.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=592&id=u903663bb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=592&originWidth=994&originalType=binary&ratio=1&rotation=0&showTitle=false&size=194438&status=done&style=none&taskId=ud10d2c55-8f5b-4b88-b096-8942402c361&title=&width=994#crop=0&crop=0&crop=1&crop=1&id=oSJ3T&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603639753-9ae10564-7bad-4528-afd2-867c58d1f413.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=121&id=u71e6fa9c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=121&originWidth=1169&originalType=binary&ratio=1&rotation=0&showTitle=false&size=88867&status=done&style=none&taskId=u55070310-f786-4b38-98ce-55db2f75ca1&title=&width=1169#crop=0&crop=0&crop=1&crop=1&id=Gjcgc&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n",
    "body_draft": "---<br />title: RabbitMQ学习笔记<br />categories: 知识<br />tags: [RabbitMQ, 消息中间件]<br />--- \n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1630671540955-650bc67f-569a-4cef-a095-ec73a3b34897.png#clientId=uc20dad1f-a2b4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=740&id=u64b4ea35&margin=%5Bobject%20Object%5D&name=image.png&originHeight=740&originWidth=1340&originalType=binary&ratio=1&rotation=0&showTitle=false&size=584856&status=done&style=none&taskId=u20a11e76-4e9c-49b4-8ca4-cc25eac0808&title=&width=1340#averageHue=%23efe7e7&crop=0&crop=0&crop=1&crop=1&id=FmDdj&originHeight=740&originWidth=1340&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1630672453989-c5f9d3cf-e77f-4c3e-8a9d-173b49f0aa4c.png#clientId=uc20dad1f-a2b4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=473&id=ub505e50f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=473&originWidth=1544&originalType=binary&ratio=1&rotation=0&showTitle=false&size=451836&status=done&style=none&taskId=u973d9d93-5ee4-44e2-9f50-b28d8e8f15e&title=&width=1544#averageHue=%23f6f6f6&crop=0&crop=0&crop=1&crop=1&id=N1Vbj&originHeight=473&originWidth=1544&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1630673109375-2f65953f-32f5-4be8-9353-9d08abb6587f.png#clientId=uc20dad1f-a2b4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=794&id=uce851ada&margin=%5Bobject%20Object%5D&name=image.png&originHeight=794&originWidth=1520&originalType=binary&ratio=1&rotation=0&showTitle=false&size=669042&status=done&style=none&taskId=u1e0c19d3-9eae-4ab1-9e35-b33c4bbbcd6&title=&width=1520#averageHue=%23b2b1b0&crop=0&crop=0&crop=1&crop=1&id=zGC4d&originHeight=794&originWidth=1520&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"9c0cd8ed\"></a>\n## 为什么要用 rabbitMQ？\n<a name=\"81220e89\"></a>\n### 1. 流量削峰\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1637998719062-ee3b7961-8606-40b9-9bd6-139143630402.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=91&id=u7a7d8c10&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78126&status=done&style=none&taskId=u903bdc4d-2ce4-4ac8-97d1-9cf8226327b&title=&width=495#averageHue=%23f3f3f3&crop=0&crop=0&crop=1&crop=1&id=Ds1E5&originHeight=182&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"c491023f\"></a>\n### 2. 应用解耦\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1637998760193-a4f14c2c-a22b-4c92-b207-ae58a962577a.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=182&id=u8f01ca2b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=363&originWidth=1085&originalType=binary&ratio=1&rotation=0&showTitle=false&size=190648&status=done&style=none&taskId=u30e77d52-0f3b-4d69-b06f-8229a9c232f&title=&width=542.5&referrerpolicy=no-referrer#averageHue=%23f7f7f7&crop=0&crop=0&crop=1&crop=1&id=hMEcn&originHeight=363&originWidth=1085&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"d4ef8fda\"></a>\n### 3. 异步处理\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009293978-1fde3fa6-5de6-476b-bc8f-4381749e748c.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=315&id=u2602b5b4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=630&originWidth=1167&originalType=binary&ratio=1&rotation=0&showTitle=false&size=283589&status=done&style=none&taskId=uf5236049-2c88-4e12-b15e-7d99585efad&title=&width=583.5#averageHue=%23f6f6f6&crop=0&crop=0&crop=1&crop=1&id=EqXpn&originHeight=630&originWidth=1167&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"753ccaa2\"></a>\n## RabbitMQ 核心部分\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009378104-cb162a2f-4170-4d24-99c1-4e3ee09087ae.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=284&id=u45cac300&margin=%5Bobject%20Object%5D&name=image.png&originHeight=568&originWidth=1077&originalType=binary&ratio=1&rotation=0&showTitle=false&size=305514&status=done&style=none&taskId=u95a38925-5c34-45dd-bfca-d140d73dc3f&title=&width=538.5#averageHue=%23f8f2f1&crop=0&crop=0&crop=1&crop=1&id=TB3Zf&originHeight=568&originWidth=1077&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"a260da3a\"></a>\n## 各个名词介绍\n\n\n\n<a name=\"c83a4ba0\"></a>\n### RabbitMQ 工作原理\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009501957-eb0902f3-1fa1-47d5-9bc7-8d03f6e12de0.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=257&id=u79c375f5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=514&originWidth=1060&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210068&status=done&style=none&taskId=ue02a7c50-c563-46af-a784-5ae4c1dcdfe&title=&width=530#averageHue=%23efc150&crop=0&crop=0&crop=1&crop=1&id=sf1J3&originHeight=514&originWidth=1060&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009567915-6084eb1d-d428-47ec-844f-b3b48c6c6d0c.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=310&id=u9337433a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=619&originWidth=1135&originalType=binary&ratio=1&rotation=0&showTitle=false&size=776522&status=done&style=none&taskId=uced2ac5e-e117-4050-8e39-087f63ff410&title=&width=567.5#averageHue=%23e1dccf&crop=0&crop=0&crop=1&crop=1&id=ft4q6&originHeight=619&originWidth=1135&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009610891-4a5dba18-6006-41bf-a068-b2f33ed7df48.png#clientId=udb8aea13-24db-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=63&id=u38d6f233&margin=%5Bobject%20Object%5D&name=image.png&originHeight=126&originWidth=1128&originalType=binary&ratio=1&rotation=0&showTitle=false&size=136646&status=done&style=none&taskId=u3dada18e-9ab8-40c9-8042-2e2f9f40306&title=&width=564#averageHue=%23cdc5b8&crop=0&crop=0&crop=1&crop=1&id=rJuNv&originHeight=126&originWidth=1128&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"e655a410\"></a>\n## 安装\n\n[rabbitmq.com/download.html](https://www.rabbitmq.com/download.html)<br />erlang 和 rabbitMQ 版本匹配：<br />[https://www.cnblogs.com/gne-hwz/p/10714013.html](https://www.cnblogs.com/gne-hwz/p/10714013.html)<br />安装：[https://blog.csdn.net/almahehe/article/details/75390572](https://blog.csdn.net/almahehe/article/details/75390572)<br />（建议看尚硅谷视频进行快速安装）<br />安装之后，可以访问 ip:15672 ，查看发送消息的端口（5672）和用户。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638169386681-e382c30c-baba-4fbb-bd40-aaa7b0a1eac6.png#clientId=uc4bbfa15-6ab6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=173&id=u1a771f9c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=102&originWidth=450&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28980&status=done&style=none&taskId=ua13bea1f-438b-4ef8-8913-b4ccb9fa78c&title=&width=761.9931030273438#averageHue=%23f1f1f1&crop=0&crop=0&crop=1&crop=1&id=pNXMC&originHeight=102&originWidth=450&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"c729f8ef\"></a>\n## 简单队列模式\n<a name=\"f5abe6f8\"></a>\n### 生产者代码\n\n1. 项目依赖：\n\n```xml\n<dependencies>\n        <!--指定jdk编译版本-->\n        <dependency>\n            <groupId>org.apache.maven.plugins</groupId>\n            <artifactId>maven-compiler-plugin</artifactId>\n            <version>3.8.1</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client -->\n        <!--rabbitmq依赖客户端-->\n        <dependency>\n            <groupId>com.rabbitmq</groupId>\n            <artifactId>amqp-client</artifactId>\n            <version>5.8.0</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/commons-io/commons-io -->\n        <!--操作文件流的依赖-->\n        <dependency>\n            <groupId>commons-io</groupId>\n            <artifactId>commons-io</artifactId>\n            <version>2.6</version>\n        </dependency>\n        <dependency>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-simple</artifactId>\n            <version>1.7.25</version>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n```\n\n2. 生产者代码：\n\n```java\njapackage com.atguigu.rabbitmq.one;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/28 22:15\n * 生产者 ：发消息\n */\npublic class Producer {\n    //队列名称\n    private static final String QUEUE_NAME = \"hello\";\n\n    //发消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建一个连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        //设置工厂ip  连接rabbitmq的队列\n        factory.setHost(\"59.110.171.189\");\n        //用户名\n        factory.setUsername(\"admin\");\n        //密码\n        factory.setPassword(\"123\");\n        //创建连接\n        Connection connection = factory.newConnection();\n        //获取信道\n        Channel channel = connection.createChannel();\n        /**\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n                4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n                5.其他参数（延迟消息......）\n         */\n\n        channel.queueDeclare(QUEUE_NAME,false,false,false,null);\n        //发消息\n        String message = \"hello world\";\n        /**\n         * 发送一个消息\n         * 1. 发送到哪个交换机\n         * 2. 路由的key值是哪个，本次是队列的名称\n         * 3. 其他参数信息\n         * 4. 发送消息的消息体\n         */\n        channel.basicPublish(\"\",QUEUE_NAME,null,message.getBytes());\n        System.out.println(\"消息发送完毕\");\n    }\n}\n```\n\n如果运行报超时错误，需要打开云服务器的安全组 5672 端口。<br />（参考博客：[https://www.cnblogs.com/jxearlier/p/11920825.html](https://www.cnblogs.com/jxearlier/p/11920825.html)）\n<a name=\"3b753fe7\"></a>\n### 消费者代码\n\n```xml\npackage com.atguigu.rabbitmq.one;\n\nimport com.rabbitmq.client.*;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 15:04\n * 消费者:接收消息\n */\npublic class Consumer {\n    //队列名称\n    public static final String QUEUE_NAME = \"hello\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"59.110.171.189\");\n        factory.setUsername(\"admin\");\n        factory.setPassword(\"123\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        //声明 接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(message);\n        };\n        //取消消息时的回调\n        CancelCallback cancelCallback = consumerTag -> {\n            System.out.println(\"消息消费被中断\");\n        };\n        /**\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true,deliverCallback,cancelCallback);\n    }\n}\n```\n\n运行结果：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638172828992-073b0df6-a480-4260-a724-e17e9191a44c.png#clientId=uc4bbfa15-6ab6-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=20&id=u3ee077b2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=20&originWidth=296&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2932&status=done&style=none&taskId=ud645c173-0157-49f2-89fb-5d58c2cd89a&title=&width=296#averageHue=%232f3e49&crop=0&crop=0&crop=1&crop=1&id=kWU4Y&originHeight=20&originWidth=296&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"56a70cf7\"></a>\n### 测试生产者和消费者代码：\n\n1. 先运行消费者代码，发现没有消息，再运行生产者代码，发送消息，再看消费者代码控制台，此时已经接收到消息。\n\n<a name=\"3d1bae02\"></a>\n## 工作队列模式\n\n\n\n<a name=\"d9addd15\"></a>\n### 轮训分发消息\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638191830547-a43bbaa1-a524-4603-b6a9-0824e943cf9c.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=546&id=ucf96c5e0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=546&originWidth=1278&originalType=binary&ratio=1&rotation=0&showTitle=false&size=220503&status=done&style=none&taskId=ub030755f-49df-4184-9d0d-65bfa0e561e&title=&width=1278#averageHue=%23f7f7f7&crop=0&crop=0&crop=1&crop=1&id=kyxCV&originHeight=546&originWidth=1278&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 抽取连接工厂工具类：\n\n```xml\npackage com.atguigu.rabbitmq.utils;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 19:48\n * 连接工厂创建信道的工具类\n */\npublic class RabbitMqUtils {\n    public static Channel getChannel() throws IOException, TimeoutException {\n        //创建连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(\"59.110.171.189\");\n        factory.setUsername(\"admin\");\n        factory.setPassword(\"123\");\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        return channel;\n    }\n}\n```\n\n2. 工作线程代码：（消费者）\n\n```xml\npackage com.atguigu.rabbitmq.two;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.CancelCallback;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\nimport com.rabbitmq.client.Delivery;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 19:55\n * 这是一个工作线程（相当于之前的消费者）\n */\npublic class Worker01 {\n    //队列名称\n    public static final String QUEUE_NAME = \"hello\";\n\n    //接收消息 的工作线程\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //消息的接收\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"接收到的消息：\" + new String(message.getBody()));\n        };\n        //消息接收被取消时 执行\n        CancelCallback cancelCallback = (consumerTag) -> {\n            System.out.println(consumerTag + \"消费者取消消费接口回调逻辑\");\n        };\n        /*\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, cancelCallback);\n    }\n}\n```\n\n3. 启动两个工作线程（消费者）\n\n前提是在 idea 设置允许方法多个并行运行：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638188489814-b081e679-bc7f-4cad-964e-bfb80575820c.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=636&id=uf61f07dc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=869&originWidth=1143&originalType=binary&ratio=1&rotation=0&showTitle=false&size=94819&status=done&style=none&taskId=u4472c929-c48f-4a7d-ab7d-ec2994b75e5&title=&width=836.9862060546875#averageHue=%233b4043&crop=0&crop=0&crop=1&crop=1&id=zVInE&originHeight=869&originWidth=1143&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638188418807-97ce766a-47ef-458c-8413-d496cbcddbed.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=172&id=u35f12aab&margin=%5Bobject%20Object%5D&name=image.png&originHeight=172&originWidth=669&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20804&status=done&style=none&taskId=uf688cf36-6dc9-43f1-be3d-946b8a45d78&title=&width=669#averageHue=%232a373f&crop=0&crop=0&crop=1&crop=1&id=yNG1N&originHeight=172&originWidth=669&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n4. 生产者代码：\n\n```xml\npackage com.atguigu.rabbitmq.two;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 21:04\n * 生产者 发送大量消息\n */\npublic class Task01 {\n    public static final String QUEUE_NAME = \"hello\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        /*\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n         4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n         5.其他参数（延迟消息......）\n         */\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes());\n            System.out.println(\"发送消息完成：\" + message);\n        }\n    }\n}\n```\n\n5. 测试：启动生产者\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192109706-2649384b-8559-4d7e-8609-220f576c3e25.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=275&id=u4261e57f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=275&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25224&status=done&style=none&taskId=ue3dff20d-583f-4d0b-bb12-94ccae95bc1&title=&width=591#averageHue=%232c373d&crop=0&crop=0&crop=1&crop=1&id=PuJou&originHeight=275&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />可以看见消费者轮循接收消息：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192164342-16d183be-bbe5-4de9-bac4-d87bd87a746b.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=179&id=ue97a7cdb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=179&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23018&status=done&style=none&taskId=u7cff6d1a-b142-4d52-a1c5-1cca6fd241e&title=&width=591#averageHue=%232f3c44&crop=0&crop=0&crop=1&crop=1&id=Upfv4&originHeight=179&originWidth=591&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192176544-d380de90-ff7a-48a7-a080-c4a1ac193460.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=198&id=ubb73d589&margin=%5Bobject%20Object%5D&name=image.png&originHeight=198&originWidth=598&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23978&status=done&style=none&taskId=u3ac63e3a-6d82-4340-9fed-c68c8fbf564&title=&width=598#averageHue=%232f3b43&crop=0&crop=0&crop=1&crop=1&id=xLv8Q&originHeight=198&originWidth=598&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"269fc561\"></a>\n## 消息应答\n\n\n\n<a name=\"398e8d91\"></a>\n### 自动应答\n\n不建议使用，仅适用在消费者可以高效并以某种速率能够处理这些消息的情况。\n\n<a name=\"a7945bf1\"></a>\n### 手动应答\n\n\n\n<a name=\"bdff53ca\"></a>\n#### 消息应答的方法：\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638193415623-6b7ff26f-8cc3-4abd-b1c6-41f79897f0cf.png#clientId=u43ded51d-0244-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=312&id=ud16b0385&margin=%5Bobject%20Object%5D&name=image.png&originHeight=312&originWidth=737&originalType=binary&ratio=1&rotation=0&showTitle=false&size=100867&status=done&style=none&taskId=u39cf8244-b605-4c5d-baca-fe2103cd9d3&title=&width=737#averageHue=%23f5f5f5&crop=0&crop=0&crop=1&crop=1&id=S2b1y&originHeight=312&originWidth=737&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"70c2cd3d\"></a>\n#### 批量处理 Multiple\n\n手动应答的好处：可以批量应答，并减少网络拥堵。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638282925466-4d3081e6-809c-4a5f-9472-741dacb0cc7c.png#clientId=ub82069db-0272-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=588&id=u97ebb457&margin=%5Bobject%20Object%5D&name=image.png&originHeight=811&originWidth=1024&originalType=binary&ratio=1&rotation=0&showTitle=false&size=292383&status=done&style=none&taskId=uf04a703e-97b1-4fe2-b58f-33d8b0dff4d&title=&width=741.9931030273438#averageHue=%23f6f5f5&crop=0&crop=0&crop=1&crop=1&id=rUzZh&originHeight=811&originWidth=1024&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />但是批量应答可能会丢失消息。所以尽量不要批量应答，将 multiple 设置为 false。\n\n<a name=\"8f744d87\"></a>\n### 消息自动重新入队\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638317239422-ab1bab41-ac6f-4a05-b3c5-c539d9e6dcd1.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=85&id=u97c18f3b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=79&originWidth=665&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57746&status=done&style=none&taskId=u14e494b5-3291-4daf-ada5-47aafa5eab0&title=&width=715.0000610351562#averageHue=%23ebeae9&crop=0&crop=0&crop=1&crop=1&id=qAYOD&originHeight=79&originWidth=665&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638317701734-1133a417-ebbe-4ad9-8453-f0803583491a.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=308&id=u7be19416&margin=%5Bobject%20Object%5D&name=image.png&originHeight=469&originWidth=1088&originalType=binary&ratio=1&rotation=0&showTitle=false&size=306122&status=done&style=none&taskId=u7d90ec89-bd9a-4090-bda5-c09c6014c27&title=&width=714.9862060546875#averageHue=%23e5e4df&crop=0&crop=0&crop=1&crop=1&id=o9cFt&originHeight=469&originWidth=1088&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />测试：<br /> 1. 生产者：\n\n```xml\npackage com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:46\n * 消息在手动应答时不丢失,放回队列中重新消费\n */\npublic class Task2 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = \"ack_queue\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明队列\n        channel.queueDeclare(TASK_QUEUE_NAME, false, false, false, null);\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(\"\", TASK_QUEUE_NAME, null, message.getBytes());\n            System.out.println(\"生产者发出消息：\" + message);\n        }\n    }\n}\n```\n\n2. 两个消费者（消息手动应答）：\n\n消费者一：\n\n```xml\npackage com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.atguigu.rabbitmq.utils.SleepUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:58\n * 消息在手动应答时不丢失，放回队列中重新消费\n */\npublic class Work03 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = \"ack_queue\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(\"C1等待接收消息处理时间较短\");\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            //沉睡1s\n            SleepUtils.sleep(1);\n            System.out.println(\"接收到的消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n            //手动应答（通过信道）\n            /*参数：\n            1. 消息的标记 tag\n            2. 是否批量应答  false:不批量应答信道中的消息，true:批量\n             */\n            channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n        };\n        //采用手动应答\n        boolean autoAck = false;\n        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -> {\n            System.out.println(consumerTag + \"消费者取消消费接口的回调逻辑\");\n        }));\n    }\n}\n```\n\n消费者二：\n\n```xml\npackage com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.atguigu.rabbitmq.utils.SleepUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:58\n * 消息在手动应答时不丢失，放回队列中重新消费\n */\npublic class Work04 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = \"ack_queue\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(\"C2等待接收消息处理时间较短\");\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            //沉睡1s\n            SleepUtils.sleep(30);\n            System.out.println(\"接收到的消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n            //手动应答（通过信道）\n            /*参数：\n            1. 消息的标记 tag\n            2. 是否批量应答  false:不批量应答信道中的消息，true:批量\n             */\n            channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n        };\n        //采用手动应答\n        boolean autoAck = false;\n        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -> {\n            System.out.println(consumerTag + \"消费者取消消费接口的回调逻辑\");\n        }));\n    }\n}\n```\n\n测试步骤：<br />① 先启动 task2，创建 ack_queue 队列；（在 ip:15672 的 queue 列表中可以看到目前拥有的队列）<br />② 启动 work02，work03 接收消息（消费者）；<br />③ 发消息：在 task2 控制台输入 aa,bb,cc,dd,ee,ff，可以看到 work2 和 work3 是轮训接收消息；如果到 work03 应该接收消息 ee 时，work03 突然挂掉，此时 ee 会被转发给 work02 中的 C1，这时 C1 会接收到 ee，因此消息不会丢失，这说明了 rabbitmq 有手动应答的能力，只要没有收到消息，就不会手动应答，从而将消息放回队列。而队列又再次将消息传递给 C1 进行重新消费，从而导致 ee 并没有丢失。![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638348662336-051f5011-f512-44d1-bb05-053e49ba050c.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=499&id=u60c5aa9e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=499&originWidth=1092&originalType=binary&ratio=1&rotation=0&showTitle=false&size=254728&status=done&style=none&taskId=u6c03afcd-9d58-4d4b-b839-5e4801e20e0&title=&width=1092#averageHue=%23f5f5f5&crop=0&crop=0&crop=1&crop=1&id=Rq0q6&originHeight=499&originWidth=1092&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"274a6bb3\"></a>\n## 队列持久化\n\n如果存在同名未被持久化的队列，则需要先删除原先的未被持久化的队列，再重新生成一个持久化队列。\n\n```java\n//声明队列\nboolean durable = true; //在生产者中，需要让queue进行持久化\nchannel.queueDeclare(TASK_QUEUE_NAME, durable, false, false, null);\n```\n\n生成一个持久化队列之后，在 rabbitmq 控制台中这个队列的 features 属性会出现 D（代表持久化）。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638359722330-59d15b49-1b8d-4d93-85aa-ecd40227bd45.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=129&id=ufd6f763b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=129&originWidth=781&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13881&status=done&style=none&taskId=uab54d6ef-4036-4edf-bca6-ba4a9dcac1d&title=&width=781#averageHue=%23f3f1f0&crop=0&crop=0&crop=1&crop=1&id=iMXeX&originHeight=129&originWidth=781&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"f1739dad\"></a>\n## 消息持久化\n\n```java\n//设置生产者发送消息为持久化消息（要求保存到磁盘上MessageProperties.PERSISTENT_TEXT_PLAIN）\nchannel.basicPublish(\"\", TASK_QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());\n```\n\n\n\n<a name=\"afba844e\"></a>\n## 不公平分发\n\n```java\n//在消费者中接收消息之前设置不公平分发\nint prefetchCount = 1;\nchannel.basicQos(prefetchCount);\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361240814-a1349c7f-2e3e-410a-ba3b-f2f872fab0bb.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=232&id=u1ff04a34&margin=%5Bobject%20Object%5D&name=image.png&originHeight=232&originWidth=385&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20173&status=done&style=none&taskId=ub1b60899-802e-4d67-9aed-a99c48b5db3&title=&width=385#averageHue=%23303d45&crop=0&crop=0&crop=1&crop=1&id=vTMLG&originHeight=232&originWidth=385&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361251165-68b13d22-fe49-4fd8-9471-26161051c180.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=177&id=u477bebf6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=177&originWidth=431&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18613&status=done&style=none&taskId=ue60522ee-50ed-46f9-ae69-472369ce4b6&title=&width=431#averageHue=%232c3a42&crop=0&crop=0&crop=1&crop=1&id=zGQk4&originHeight=177&originWidth=431&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"e7e8ffe0\"></a>\n## 预取值\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361857297-fa168e46-191d-44b2-8ce2-df2cb52a382d.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=282&id=ue1e2c233&margin=%5Bobject%20Object%5D&name=image.png&originHeight=453&originWidth=1130&originalType=binary&ratio=1&rotation=0&showTitle=false&size=347909&status=done&style=none&taskId=ue241edd5-d375-46cb-9668-4a4eb4d7c9c&title=&width=703.0000610351562#averageHue=%23e4e4e5&crop=0&crop=0&crop=1&crop=1&id=mwjn3&originHeight=453&originWidth=1130&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\nint prefetchCount = 5;\nchannel.basicQos(prefetchCount);\n```\n\n\n\n<a name=\"1e9c309f\"></a>\n## 发布确认原理\n\n\n\n<a name=\"e61fd426\"></a>\n## ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638364988019-b29d7c44-ebca-4978-95fd-034500d1bd7b.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=369&id=u98ff6bb0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=369&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&size=222643&status=done&style=none&taskId=ua25c2547-8233-4893-8d5b-4406b84e85f&title=&width=930#averageHue=%23fafafb&crop=0&crop=0&crop=1&crop=1&id=Xek0V&originHeight=369&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n在信道之后开启发布确认：\n\n```java\n//信道开启发布确认\nchannel.confirmSelect();\n```\n\n\n\n<a name=\"f1ad8c9b\"></a>\n## 单个发布确认\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638365489548-64267da5-f60d-4b88-98af-bdf5806d5038.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=203&id=ub1148f56&margin=%5Bobject%20Object%5D&name=image.png&originHeight=203&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=342872&status=done&style=none&taskId=u2df32a3e-4c69-4599-868a-d81e33495ec&title=&width=993#averageHue=%23d0dcda&crop=0&crop=0&crop=1&crop=1&id=qVQAu&originHeight=203&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\npackage com.atguigu.rabbitmq.four;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.UUID;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 21:32\n * 发布确认模式：\n * 使用的时间  比较哪种确认方式是最好的\n * 1.单个确认\n * 2.批量确认\n * 3.异步批量确认\n */\npublic class ConfireMessage {\n    //批量发消息的个数\n    public static final int MESSAGE_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException, TimeoutException, IOException {\n        //1. 单个确认\n        ConfireMessage.publicMessageIndividually(); //发布1000个单独确认消息，耗时29726ms\n    }\n\n    //单个确认\n    public static void publicMessageIndividually() throws IOException, TimeoutException, InterruptedException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量发消息\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String massage = i + \"\";\n            channel.basicPublish(\"\", queueName, null, massage.getBytes());\n            //单个消息就马上进行发布确认\n            boolean flag = channel.waitForConfirms();\n            if (flag) {\n                System.out.println(\"消息发送成功\");\n            }\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\"+MESSAGE_COUNT+\"个单独确认消息，耗时\"+(end - begin)+\"ms\");\n    }\n}\n```\n\n\n\n<a name=\"498cf9b3\"></a>\n## 批量发布确认\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638366964213-10397181-357d-4896-9e91-84690b69c982.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=137&id=ude627a73&margin=%5Bobject%20Object%5D&name=image.png&originHeight=137&originWidth=968&originalType=binary&ratio=1&rotation=0&showTitle=false&size=206130&status=done&style=none&taskId=u0c3dafe3-1f66-4cc1-83ba-f5e8edae8b3&title=&width=968#averageHue=%23d7d9d8&crop=0&crop=0&crop=1&crop=1&id=tMsLz&originHeight=137&originWidth=968&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\n//批量发布确认\n    public static void publicMessageBatch() throws IOException, TimeoutException, InterruptedException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量确认消息大小\n        int batchSize = 100;\n        //批量发布消息， 批量发布确认\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String message = i + \"\";\n            channel.basicPublish(\"\", queueName, null, message.getBytes());\n            //发布确认\n            if (i % batchSize == 0) {\n                channel.waitForConfirms();\n            }\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\" + MESSAGE_COUNT + \"个批量确认消息，耗时\" + (end - begin) + \"ms\");\n    }\n```\n\n\n\n<a name=\"836eb661\"></a>\n## 异步发布确认\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638368249755-46e1c3b8-f891-48b0-a77b-21b9a80f4e5e.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=119&id=u5fcd19f7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=119&originWidth=1189&originalType=binary&ratio=1&rotation=0&showTitle=false&size=231115&status=done&style=none&taskId=u473c99f9-e088-4ad3-84e3-82e606c7d63&title=&width=1189#averageHue=%23e2dfd4&crop=0&crop=0&crop=1&crop=1&id=Jwh7I&originHeight=119&originWidth=1189&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638368124379-5cdb8cbd-707a-4a1f-92f4-3dc511a9ec11.png#clientId=u446e2507-b64d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=u4b5d988b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=441&originWidth=964&originalType=binary&ratio=1&rotation=0&showTitle=false&size=239080&status=done&style=none&taskId=ua0b85de0-7119-4e3a-a0be-75854b9aaac&title=&width=1248.9931030273438#averageHue=%23f7f7f7&crop=0&crop=0&crop=1&crop=1&id=T1TVR&originHeight=441&originWidth=964&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\n//批量发消息的个数\n    public static final int MESSAGE_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException, TimeoutException, IOException {\n        //1. 单个确认\n//        ConfireMessage.publicMessageIndividually(); //发布1000个单独确认消息，耗时29726ms\n//        2. 批量确认\n//        ConfireMessage.publicMessageBatch();  //发布1000个批量确认消息，耗时761ms（弊端：无法确认哪个消息未被确认）\n//        3. 异步确认\n        ConfireMessage.publicMessageAsync(); //发布1000个异步确认消息，耗时181ms\n    }\n//异步发布确认\n    public static void publicMessageAsync() throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //消息确认成功，回调函数\n        ConfirmCallback ackCallback = (deliveryTag, multiple) -> {\n            System.out.println(\"确认的消息\" + deliveryTag);\n        };\n        //消息确认失败，回调函数\n        ConfirmCallback nackCallback = (deliveryTag, multiple) -> {\n            System.out.println(\"未确认的消息\" + deliveryTag);\n        };\n        //准备消息的监听器，监听哪些消息成功了，哪些消息失败了\n        channel.addConfirmListener(ackCallback, nackCallback);  //异步通知\n        //异步发布确认\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String massage = \"消息\" + i;\n            channel.basicPublish(\"\", queueName, null, massage.getBytes());\n\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\" + MESSAGE_COUNT + \"个异步确认消息，耗时\" + (end - begin) + \"ms\");\n    }\n```\n\n\n\n<a name=\"e8b363bb\"></a>\n## 如何处理异步未确认消息\n\n<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638404469016-06a08296-9aa6-4d65-8d1c-4c70fb4cd5b8.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=97&id=u0927e367&margin=%5Bobject%20Object%5D&name=image.png&originHeight=97&originWidth=1033&originalType=binary&ratio=1&rotation=0&showTitle=false&size=122865&status=done&style=none&taskId=u67d3a3c6-2f1a-4be9-9c0c-f7d2e743935&title=&width=1033#averageHue=%23dcd8cd&crop=0&crop=0&crop=1&crop=1&id=frSPr&originHeight=97&originWidth=1033&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />上述异步确认有两个线程：\n\n- 发消息的线程\n- 监听器的线程\n\n两个线程之间交互，只能用**并发链路式队列（可以在确认发布与发布线程之间进行消息传递）**。\n\n```java\n//异步发布确认\n    public static void publicMessageAsync() throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        /*\n        线程安全有序的哈希表，适用于高并发的情况\n        1. 轻松的将序号与消息进行关联\n        2. 轻松批量删除条目，只要给序号\n        3.支持高并发(多线程)\n         */\n        ConcurrentSkipListMap<Long,String> outstandingConfirms = new ConcurrentSkipListMap<>();\n\n        //消息确认成功，回调函数\n        ConfirmCallback ackCallback = (deliveryTag, multiple) -> {\n            //2. 删除已经确认的消息   剩下的就是未确认的消息\n            if(multiple){\n                //如果是批量确认，就去批量删除\n                ConcurrentNavigableMap<Long,String> confirmed = outstandingConfirms.headMap(deliveryTag);\n                confirmed.clear();\n            }else{\n                //如果是单个确认，就去单个删除\n                outstandingConfirms.remove(deliveryTag);\n            }\n            System.out.println(\"确认的消息\" + deliveryTag);\n        };\n        //消息确认失败，回调函数\n        ConfirmCallback nackCallback = (deliveryTag, multiple) -> {\n            //3. 打印未确认的消息有哪些\n            String message = outstandingConfirms.get(deliveryTag);\n            System.out.println(\"未确认的消息是：\"+message+\":::::未确认的消息tag:\" + deliveryTag);\n        };\n        //准备消息的监听器，监听哪些消息成功了，哪些消息失败了\n        channel.addConfirmListener(ackCallback, nackCallback);  //异步通知\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量发送消息\n        for (int i = 0; i < MESSAGE_COUNT; i++) {\n            String message = \"消息\" + i;\n            // 1. 此处记录下所有要发送的消息  消息的总和(每发一次消息就记录一次)\n            outstandingConfirms.put(channel.getNextPublishSeqNo(),message);\n            channel.basicPublish(\"\", queueName, null, message.getBytes());\n\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(\"发布\" + MESSAGE_COUNT + \"个异步确认消息，耗时\" + (end - begin) + \"ms\");\n    }\n```\n\n> 以上三种发布确认速度对比：\n\n\n- 单独发布消息：同步等待确认，简单，但吞吐量非常有限。\n- 批量发布消息：批量同步等待确认，简单，合理的吞吐量，一旦出现问题，很难推断出是哪条出现了问题\n- 异步处理：最佳性能和资源利用，在出现错误的情况下，可以很好的控制，但是实现起来稍微难些。\n\n<a name=\"04596875\"></a>\n## 交换机\n\n\n\n<a name=\"a3034a5f\"></a>\n### 交换机的作用\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638406810806-e429e00e-78d1-42e2-ab92-c3a53f8c2fa9.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=270&id=uc3415ba1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=387&originWidth=1291&originalType=binary&ratio=1&rotation=0&showTitle=false&size=191628&status=done&style=none&taskId=uee2f50b0-7b80-4d38-9c1b-25806445f5f&title=&width=900.9896240234375#averageHue=%23f5f4f4&crop=0&crop=0&crop=1&crop=1&id=tFgNi&originHeight=387&originWidth=1291&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"f71f343d\"></a>\n### 交换机的类型\n\n- 直接（direct）== 路由类型\n- 主题（topic）\n- 标题（headers）（企业不常用）\n- 扇出（fanout）== 发布订阅类型\n- 无名类型（默认类型），通常用空串进行识别\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638407294007-f1bd9624-be98-4b90-ba72-9c29d88c326d.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=76&id=u21ac6756&margin=%5Bobject%20Object%5D&name=image.png&originHeight=76&originWidth=987&originalType=binary&ratio=1&rotation=0&showTitle=false&size=103665&status=done&style=none&taskId=u47150f74-3b3b-4cc4-befe-f25d9650214&title=&width=987#averageHue=%23cbc7bb&crop=0&crop=0&crop=1&crop=1&id=KlfHY&originHeight=76&originWidth=987&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"192ebf07\"></a>\n### 临时队列\n\n不带有持久化，一旦断开消费者的连接，队列将被自动删除。<br />\n\n创建临时队列：\n\n```java\nString queueName = channel.queueDeclare().getQueue();\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638407906977-786b78e8-bfba-4cab-9aee-9ac7ec38a884.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=278&id=u31ce7deb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=410&originWidth=1086&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55531&status=done&style=none&taskId=ub3aa0ca4-c823-418b-b8c7-0b7fbd67333&title=&width=736.9896240234375#averageHue=%23f4f2f1&crop=0&crop=0&crop=1&crop=1&id=T0K86&originHeight=410&originWidth=1086&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"f4f12c7a\"></a>\n### 绑定\n\n就是交换机与队列之间的捆绑关系。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638408143523-d4c904d9-33e5-46bd-ad67-885e78b4c34b.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=637&id=u8140e36d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=637&originWidth=487&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26522&status=done&style=none&taskId=ua5ea4c46-36c5-4183-aefe-f6a3f676385&title=&width=487#averageHue=%23faf5f5&crop=0&crop=0&crop=1&crop=1&id=fwITJ&originHeight=637&originWidth=487&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"b3f97d74\"></a>\n### 发布订阅模式（扇出模式 fanout）\n\n类似广播，两个 routingkey 相同<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638408427104-577b627a-521a-4d94-89be-5bf0102440ea.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=218&id=u3ae99c2f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=292&originWidth=1200&originalType=binary&ratio=1&rotation=0&showTitle=false&size=205919&status=done&style=none&taskId=ufe252eb8-02f2-410e-8b74-b8d091c0d4a&title=&width=894#averageHue=%23f8ebea&crop=0&crop=0&crop=1&crop=1&id=PeGnm&originHeight=292&originWidth=1200&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 生产者\n\n```java\npackage com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:59\n * 发消息：交换机\n */\npublic class EmitLog {\n    public static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(EXCHANGE_NAME, \"\", null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\"生产者发出消息：\" + message);\n        }\n    }\n}\n```\n\n2. 两个消费者\n\n```java\npackage com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:35\n */\npublic class ReceiveLogs01 {\n    //交换机的名称\n    public static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        //声明一个队列  临时队列 (生成一个临时队列，队列的名称是随机的，当消费者断开与队列的连接的时候，队列就自动删除)\n        String queueName = channel.queueDeclare().getQueue();\n        //绑定交换机与队列\n        channel.queueBind(queueName, EXCHANGE_NAME, \"\");\n        System.out.println(\"等待接收消息，把接收的消息打印在屏幕上。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs01控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(queueName, true,  deliverCallback,consumerTag->{});\n    }\n}\n```\n\n```java\npackage com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:35\n */\npublic class ReceiveLogs02 {\n    //交换机的名称\n    public static final String EXCHANGE_NAME = \"logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"fanout\");\n        //声明一个队列  临时队列 (生成一个临时队列，队列的名称是随机的，当消费者断开与队列的连接的时候，队列就自动删除)\n        String queueName = channel.queueDeclare().getQueue();\n        //绑定交换机与队列\n        channel.queueBind(queueName, EXCHANGE_NAME, \"\");\n        System.out.println(\"等待接收消息，把接收的消息打印在屏幕上。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs02控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(queueName, true,  deliverCallback,consumerTag->{});\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410904168-80b297c1-26ef-4ee4-815c-065abea79bd2.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=328&id=u29891926&margin=%5Bobject%20Object%5D&name=image.png&originHeight=328&originWidth=580&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28269&status=done&style=none&taskId=u6700fa8b-9b2f-4717-91cf-0dfb20b528b&title=&width=580#averageHue=%232c383f&crop=0&crop=0&crop=1&crop=1&id=Jf7Cl&originHeight=328&originWidth=580&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410913426-c4d1faa3-7b8b-478c-ba35-665d73e98e8b.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=248&id=ua55ed718&margin=%5Bobject%20Object%5D&name=image.png&originHeight=248&originWidth=528&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34020&status=done&style=none&taskId=u415b65a3-7d21-4e16-a1a0-a15d7f3c4ca&title=&width=528#averageHue=%23323e46&crop=0&crop=0&crop=1&crop=1&id=HNmyl&originHeight=248&originWidth=528&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410920504-2f4c6248-02a0-4765-8647-4c8ab63551e1.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=255&id=u9c537a4f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=255&originWidth=517&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35282&status=done&style=none&taskId=u97bfb701-f8bd-45ca-ac41-6f8259d9775&title=&width=517#averageHue=%23323e46&crop=0&crop=0&crop=1&crop=1&id=BBNfG&originHeight=255&originWidth=517&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"a7c987c4\"></a>\n### 直接交换机（路由模式 direct）\n\n两个 routingkey 不相同<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638411099834-bf80fb1d-473a-4a01-8553-e47ee2cd3670.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=303&id=ueba6aa41&margin=%5Bobject%20Object%5D&name=image.png&originHeight=303&originWidth=874&originalType=binary&ratio=1&rotation=0&showTitle=false&size=98369&status=done&style=none&taskId=u2145da18-8429-4959-ab30-43bcc28bb61&title=&width=874#averageHue=%23f6e6e4&crop=0&crop=0&crop=1&crop=1&id=t5eGH&originHeight=303&originWidth=874&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />可以多重绑定。<br />**生产者发消息给队列，直接交换机通过不同 routingkey 路由到相应的队列，然后消费者接收指定日志。**\n\n1. 发消息\n\n```java\npackage com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:59\n * 发消息：交换机\n */\npublic class DirectLogs {\n    public static final String EXCHANGE_NAME = \"direct_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(EXCHANGE_NAME, \"error\", null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\"生产者发出消息：\" + message);\n        }\n    }\n}\n```\n\n2. 接收消息\n\n```java\npackage com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 10:15\n */\npublic class ReceiveLogsDirect01 {\n    public static final String EXCHANGE_NAME = \"direct_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n        //声明一个队列\n        channel.queueDeclare(\"console\",false,false,false,null);\n        channel.queueBind(\"console\",EXCHANGE_NAME,\"info\");\n        channel.queueBind(\"console\",EXCHANGE_NAME,\"warning\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs01控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(\"console\", true,  deliverCallback,consumerTag->{});\n\n    }\n}\n```\n\n```java\npackage com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 10:15\n */\npublic class ReceiveLogsDirect02 {\n    public static final String EXCHANGE_NAME = \"direct_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n        //声明一个队列\n        channel.queueDeclare(\"disk\",false,false,false,null);\n        channel.queueBind(\"disk\",EXCHANGE_NAME,\"error\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"ReceiveLogs02控制台接收到消息：\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(\"disk\", true,  deliverCallback,consumerTag->{});\n\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638413931242-2c3ef4c2-f3e6-4e6e-ba39-5437dad24d40.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=182&id=u9de2b784&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=630&originalType=binary&ratio=1&rotation=0&showTitle=false&size=21691&status=done&style=none&taskId=u7cd93b89-df35-4f94-aa33-6626b0dc70b&title=&width=630#crop=0&crop=0&crop=1&crop=1&id=eyPPs&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638413948375-568b73ae-0203-4f53-9a9b-528667192aa2.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=182&id=uc8400be0&margin=%5Bobject%20Object%5D&name=image.png&originHeight=182&originWidth=683&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24900&status=done&style=none&taskId=u38d71d59-3dd8-4324-9fae-335fd043524&title=&width=683#crop=0&crop=0&crop=1&crop=1&id=U0kJT&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"c4e17e43\"></a>\n### 主题交换机（Topic）\n\n规范：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638414479059-98f3dc8e-ee99-4093-b2cb-81eaecec9acb.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=226&id=u34e92b6a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=226&originWidth=834&originalType=binary&ratio=1&rotation=0&showTitle=false&size=170475&status=done&style=none&taskId=ue217ff8b-9da9-493e-9a4b-07c6ab22bab&title=&width=834#crop=0&crop=0&crop=1&crop=1&id=KCIOt&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415621949-8c1e4089-881d-482e-a377-ab7f224a2c92.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=257&id=u76cf3ab8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=257&originWidth=801&originalType=binary&ratio=1&rotation=0&showTitle=false&size=151366&status=done&style=none&taskId=u98d7748e-2fc6-4df3-a740-cae3ba06db9&title=&width=801#crop=0&crop=0&crop=1&crop=1&id=HeQJL&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415680787-e95ef7a6-bec4-44b3-8e45-1e0c4adac6f7.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=350&id=u280d2c9d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=350&originWidth=829&originalType=binary&ratio=1&rotation=0&showTitle=false&size=181864&status=done&style=none&taskId=u67807a72-c793-4b0b-a14e-e6270164016&title=&width=829#crop=0&crop=0&crop=1&crop=1&id=ZuvJl&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415855921-8e2750b0-e5df-4b1c-90a3-7e3f696543d6.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=188&id=uf97e55b4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=188&originWidth=920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=178229&status=done&style=none&taskId=ufb1118a1-0b9d-4a97-bd09-0ff626585f5&title=&width=920#crop=0&crop=0&crop=1&crop=1&id=iZC7I&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"36d4697d\"></a>\n### 主题交换机（实战）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638416303199-5f9e655c-c5c2-4a16-9d12-ba873c31c8e6.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=331&id=u07108cc7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=331&originWidth=1114&originalType=binary&ratio=1&rotation=0&showTitle=false&size=231103&status=done&style=none&taskId=ud57ef875-e371-4fa6-980a-20a29a7366e&title=&width=1114#crop=0&crop=0&crop=1&crop=1&id=zgYBJ&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 消费者\n\n```java\npackage com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 11:37\n * 声明主题交换机  及相关队列\n * <p>\n * 消费者 C2\n */\npublic class ReceiveLogsTopic01 {\n    //交换机名称\n    public static final String EXCHANGE_NAME = \"topic_logs\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n        //声明队列\n        String queueName = \"Q1\";\n        channel.queueDeclare(queueName, false, false, false, null);\n        //交换机绑定 routingkey\n        channel.queueBind(queueName, EXCHANGE_NAME, \"*.orange.*\");\n        System.out.println(\"等待接收消息。。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(new String(message.getBody(), StandardCharsets.UTF_8));\n            System.out.println(\"接收队列：\" + queueName + \"绑定键：\" + message.getEnvelope().getRoutingKey());\n        };\n        //接收消息\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -> {\n        });\n    }\n\n}\n```\n\n```java\npackage com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 11:37\n * 声明主题交换机  及相关队列\n * <p>\n * 消费者 C2\n */\npublic class ReceiveLogsTopic02 {\n    //交换机名称\n    public static final String EXCHANGE_NAME = \"topic_logs\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, \"topic\");\n        //声明队列\n        String queueName = \"Q2\";\n        channel.queueDeclare(queueName, false, false, false, null);\n        //交换机绑定 routingkey\n        channel.queueBind(queueName, EXCHANGE_NAME, \"*.*.rabbit\");\n        channel.queueBind(queueName, EXCHANGE_NAME, \"lazy.#\");\n        System.out.println(\"等待接收消息。。。。。\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(new String(message.getBody(), StandardCharsets.UTF_8));\n            System.out.println(\"接收队列：\" + queueName + \"绑定键：\" + message.getEnvelope().getRoutingKey());\n        };\n        //接收消息\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -> {\n        });\n    }\n\n}\n```\n\n2. 生产者\n\n```java\npackage com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.security.spec.ECField;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 14:45\n * 生产者\n */\npublic class EmitLogTopic {\n    public static final String EXCHANGE_NAME = \"topic_logs\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        /**\n         * 下图绑定关系如下：\n         * Q1--> 绑定的是： 中间带3个单词的字符串（*.orange*）\n         * Q2--> 绑定的是： 最后一个单词是rabbit的3个单词（*.*.rabbit）\n         *                第一个单词是lazy的多个单词（lazy.#）\n         */\n        Map<String, String> bindingKeyMap = new HashMap<>();\n        bindingKeyMap.put(\"quick.orange.rabbit\", \"被队列Q1Q2接收到\");\n        bindingKeyMap.put(\"lazy.orange.elephant\", \"被队列Q1Q2接收到\");\n        bindingKeyMap.put(\"lazy.pink.rabbit\", \"被队列Q1接收到\");\n        bindingKeyMap.put(\"quick.brown.fox\", \"被队列Q2接收到\");\n        bindingKeyMap.put(\"quick.orange.male.rabbit\", \"虽然满足两个绑定但只被队列Q2接收一次\");\n        bindingKeyMap.put(\"quick.brown.fox\", \"不匹配任何绑定不会被任何队列接收到会被丢弃\");\n        bindingKeyMap.put(\"lazy.orange.male.rabbit\", \"是四个单词不匹配任何绑定定会丢弃\");\n        bindingKeyMap.put(\"lazy.orange.male.rabbit\", \"是四个单词但匹配Q2\");\n\n        for (Map.Entry<String, String> bindingKeyEntry : bindingKeyMap.entrySet()) {\n            String routingKey = bindingKeyEntry.getKey();\n            String message = bindingKeyEntry.getValue();\n            channel.basicPublish(EXCHANGE_NAME, routingKey, null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(\"生产者发出消息\" + message);\n        }\n    }\n}\n```\n\n先启动消费者，再启动生产者。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430253833-e55a9ffe-37a0-4c04-b7b7-093a65480f71.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=540&id=u94f62b22&margin=%5Bobject%20Object%5D&name=image.png&originHeight=540&originWidth=683&originalType=binary&ratio=1&rotation=0&showTitle=false&size=63817&status=done&style=none&taskId=u846aee7e-23e7-429c-8c68-098657667fa&title=&width=683#crop=0&crop=0&crop=1&crop=1&id=r1tul&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430292235-0a8fd8ca-fdd9-4f2e-9a52-de2398da4db4.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=548&id=u5b1d2810&margin=%5Bobject%20Object%5D&name=image.png&originHeight=548&originWidth=649&originalType=binary&ratio=1&rotation=0&showTitle=false&size=60902&status=done&style=none&taskId=uf769df3d-232c-4803-866e-9b789b65799&title=&width=649#crop=0&crop=0&crop=1&crop=1&id=p0vbD&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430299720-f401248d-7efc-425f-aff1-59f8cda3349d.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=257&id=u7c6af404&margin=%5Bobject%20Object%5D&name=image.png&originHeight=257&originWidth=674&originalType=binary&ratio=1&rotation=0&showTitle=false&size=33728&status=done&style=none&taskId=u0e4568aa-d243-4696-a1eb-02eebf586cf&title=&width=674#crop=0&crop=0&crop=1&crop=1&id=Axrk6&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"3dead64c\"></a>\n## 死信队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430356782-4196f6b8-209f-489a-a5e5-e61974e711ef.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=299&id=ud95905f1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=299&originWidth=1069&originalType=binary&ratio=1&rotation=0&showTitle=false&size=430772&status=done&style=none&taskId=ue469e4ea-c3e9-44f2-a5e6-4ac2443deba&title=&width=1069#crop=0&crop=0&crop=1&crop=1&id=ZL2Da&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430504276-84f3e02c-d80f-4fe9-9b9a-b8d9ac3b8290.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=298&id=u8670c10d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=298&originWidth=643&originalType=binary&ratio=1&rotation=0&showTitle=false&size=162345&status=done&style=none&taskId=ue72cf50e-a8d2-4f86-8a8f-e35ebf10e89&title=&width=643#crop=0&crop=0&crop=1&crop=1&id=rBdXQ&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430601814-eb3112b8-d77b-4213-ad2c-df3c394a36b7.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=553&id=ufda1712c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=553&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=162361&status=done&style=none&taskId=u55e88e2a-dc14-44b5-9eb9-8663773f317&title=&width=1136#crop=0&crop=0&crop=1&crop=1&id=pQqf7&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n- 消费者 1：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 15:40\n * 死信队列\n * 消费者1\n */\npublic class Consumer01 {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = \"normal_exchange\";\n    //死信队列的名称\n    public static final String DEAD_EXCHANGE = \"dead_exchange\";\n    //普通队列的名称\n    public static final String NORMAL_QUEUE = \"normal_queue\";\n    //死信队列的名称\n    public static final String DEAD_QUEUE = \"dead_queue\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明死信和普通交换机， 类型为direct\n        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);\n        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);\n        //声明普通队列\n        Map<String, Object> arguments = new HashMap<>();\n        //过期时间\n//        arguments.put(\"x-message-ttl\",10000);\n        //正常队列设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", DEAD_EXCHANGE);\n        //设置死信RoutingKey\n        arguments.put(\"x-dead-letter-routing-key\", \"lisi\");\n        //设置正常队列的长度的限制\n//        arguments.put(\"x-max-length\", 19);\n        channel.queueDeclare(NORMAL_QUEUE, false, false, false, arguments);\n        ///////////////////////////////////////////////////\n        //声明死信队列\n        channel.queueDeclare(DEAD_QUEUE, false, false, false, null);\n        //交换机与队列绑定\n        //绑定普通交换机与普通队列\n        channel.queueBind(NORMAL_QUEUE, NORMAL_EXCHANGE, \"zhangsan\");\n        //绑定死信交换机与死信队列\n        channel.queueBind(DEAD_QUEUE, DEAD_EXCHANGE, \"lisi\");\n        System.out.println(\"等待接收消息.........\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            String msg = new String(message.getBody(), StandardCharsets.UTF_8);\n            if (msg.equals(\"info5\")) {\n                System.out.println(\"此消息被C1拒绝的\" + msg);\n                //拒绝此消息，并且不放回队列中。因此成为死信\n                channel.basicReject(message.getEnvelope().getDeliveryTag(), false);\n            } else {\n                System.out.println(\"Consumer01接收的消息\" + msg);\n                //不批量应答\n                channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n            }\n        };\n        //开启手动应答（如果不开启手动应答，就不存在拒绝了）\n        channel.basicConsume(NORMAL_QUEUE, false, deliverCallback, consumerTag -> {\n        });\n    }\n}\n```\n\n- 消费者 2：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 15:40\n * 死信队列\n * 消费者2\n */\npublic class Consumer02 {\n    //死信队列的名称\n    public static final String DEAD_QUEUE = \"dead_queue\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(\"等待接收消息.........\");\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(\"Consumer02接收的消息\" + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(DEAD_QUEUE, false, deliverCallback, consumerTag -> {\n\n        });\n    }\n}\n```\n\n- 生产者：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 16:13\n * 死信队列-生产者\n */\npublic class Producer {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = \"normal_exchange\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //死信时间  设置ttl时间\n        AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().expiration(\"10000\").build();\n        for (int i = 1; i < 11; i++) {\n            String message = \"info\" + i;\n            channel.basicPublish(NORMAL_EXCHANGE, \"zhangsan\", properties, message.getBytes());\n        }\n    }\n}\n```\n\n测试步骤：\n\n1. 运行消费者：会发现普通和死信交换机已经绑定各自的队列。\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638445377947-e4a087d0-b755-4178-aa6d-7ae082107bb0.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=495&id=ud91030e8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=495&originWidth=541&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23775&status=done&style=none&taskId=u8f85c23d-a811-41b4-a478-a20609fc50a&title=&width=541#crop=0&crop=0&crop=1&crop=1&id=xwjE9&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638445475857-ba40932b-588f-43d3-b3a6-5f2660bcd241.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=498&id=ub28b2410&margin=%5Bobject%20Object%5D&name=image.png&originHeight=498&originWidth=601&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25129&status=done&style=none&taskId=u8de3a461-08ce-49b9-9936-e0cf7fa1363&title=&width=601#crop=0&crop=0&crop=1&crop=1&id=Jcymv&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n2. 测试**队列达到最大长度**，关闭消费者 1 和 2，开启生产者：消息会积压在队列中，消费者 1 所在的普通队列消息限制有 6 条，剩下的 4 条会进入消费者 2 所在的死信队列。如下图所示：\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638448087379-8c4e5c46-39ca-49fd-8024-4111b0a5d431.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=u9eb9c88a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=571&originWidth=1083&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79389&status=done&style=none&taskId=ua5f78b60-fd26-4cb8-9cf8-f0e0f17270b&title=&width=1083#crop=0&crop=0&crop=1&crop=1&id=s5bzi&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n3. 取消普通队列的最大长度限制，测试**消息 ttl 过期**：关闭消费者 1 和 2，开启生产者发送消息。（消息会因为没人接收，会在 ttl 时间内积压在普通队列中， ttl 过期后，消息会进入死信队列中。）\n\n生产者：\n\n```java\npackage com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 16:13\n * 死信队列-生产者\n */\npublic class Producer {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = \"normal_exchange\";\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //死信时间  设置ttl时间\n        AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().expiration(\"10000\").build();\n        for (int i = 1; i < 11; i++) {\n            String message = \"info\" + i;\n            channel.basicPublish(NORMAL_EXCHANGE, \"zhangsan\", properties, message.getBytes());\n        }\n    }\n}\n```\n\n4. 测试**消息被拒**：\n\n开启消费者 1 和 2，再开启生产者。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450659287-e191b69a-07c6-4d5e-8f54-05d22263a235.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=274&id=u03d42d3b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=274&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32103&status=done&style=none&taskId=uf69d66f1-feae-4ff6-83ca-af7f8a83127&title=&width=642#crop=0&crop=0&crop=1&crop=1&id=jR4qW&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450668535-06aa1842-3563-455e-bb20-6376694fae1f.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=202&id=u33f7f3ac&margin=%5Bobject%20Object%5D&name=image.png&originHeight=202&originWidth=616&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23460&status=done&style=none&taskId=ua7a303f7-25d6-4fc0-8d46-d522a51ded6&title=&width=616#crop=0&crop=0&crop=1&crop=1&id=vAYSS&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"38e2258c\"></a>\n## 延迟队列（基于死信队列）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450862631-363c8d24-6a72-463a-b827-201e6f79cb79.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=128&id=u8aa7212b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=128&originWidth=1081&originalType=binary&ratio=1&rotation=0&showTitle=false&size=190603&status=done&style=none&taskId=ue97c71c8-4947-4c82-be00-e98e36ba920&title=&width=1081#crop=0&crop=0&crop=1&crop=1&id=xrjpE&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638451047144-5f4983f1-3a0e-472b-95f3-26635a911749.png#clientId=u268c19fe-902d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=399&id=ud5620b6f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=399&originWidth=869&originalType=binary&ratio=1&rotation=0&showTitle=false&size=265988&status=done&style=none&taskId=ub1f53a1e-1377-4e43-ab1d-13e29cf4118&title=&width=869#crop=0&crop=0&crop=1&crop=1&id=O4W2R&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"5bff6472\"></a>\n### 整合 SpringBoot\n\n\n\n<a name=\"73ad366e\"></a>\n#### 实现延迟队列：\n\n1. 依赖：\n\n```java\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.6.1</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n    <groupId>com.atguigu.rabbitmq</groupId>\n    <artifactId>springboot-rabbitmq</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>springboot-rabbitmq</name>\n    <description>Demo project for Spring Boot</description>\n    <properties>\n        <java.version>1.8</java.version>\n    </properties>\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp -->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-amqp</artifactId>\n            <version>2.6.1</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web -->\n        <!--web服务器，可以自启动-->\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n            <version>2.6.1</version>\n        </dependency>\n        <!--快速进行json转换-->\n        <!-- https://mvnrepository.com/artifact/com.alibaba/fastjson -->\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>fastjson</artifactId>\n            <version>1.2.78</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 -->\n        <dependency>\n            <groupId>io.springfox</groupId>\n            <artifactId>springfox-swagger2</artifactId>\n            <version>3.0.0</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui -->\n        <dependency>\n            <groupId>io.springfox</groupId>\n            <artifactId>springfox-swagger-ui</artifactId>\n            <version>3.0.0</version>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.springframework.amqp/spring-rabbit-test -->\n        <dependency>\n            <groupId>org.springframework.amqp</groupId>\n            <artifactId>spring-rabbit-test</artifactId>\n            <version>2.4.0</version>\n            <scope>test</scope>\n        </dependency>\n        <!-- https://mvnrepository.com/artifact/org.projectlombok/lombok -->\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <version>1.18.22</version>\n            <scope>provided</scope>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n</project>\n```\n\n2. yml 配置文件：\n\n```java\nspring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n```\n\n3. swagger 配置类：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.context.annotation.Bean;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.service.Contact;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 22:34\n */\npublic class SwaggerConfig {\n    @Bean\n    public Docket webApiConfig() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .groupName(\"webApi\")\n                .apiInfo(webApiInfo())\n                .select()\n                .build();\n    }\n\n    private ApiInfo webApiInfo() {\n        return new ApiInfoBuilder()\n                .title(\"rabbitmq  接口文档\")\n                .description(\" 本文档描述了 rabbitmq  微服务接口定义\")\n                .version(\"1.0\")\n                .contact(new Contact(\"enjoy6288\", \"http://atguigu.com\",\n                        \"1846015350@qq.com\"))\n                .build();\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638490298754-a2b1ced5-676b-4f68-86e0-31f05266088f.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=215&id=u8ba627f6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=215&originWidth=1100&originalType=binary&ratio=1&rotation=0&showTitle=false&size=132048&status=done&style=none&taskId=ud9c3f28a-b8df-44d1-b9df-dc90c70e046&title=&width=1100#crop=0&crop=0&crop=1&crop=1&id=Iv7m8&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n4. 声明队列配置文件：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 8:15\n * TTL队列，  配置文件类代码\n */\n@Configuration\npublic class TtlQueueConfig {\n    //普通交换机的名称\n    public static final String X_EXCHANGE = \"X\";\n    //死信交换机的名称\n    public static final String Y_DEAD_LETTER_EXCHANGE = \"Y\";\n    //普通队列的名称\n    public static final String QUEUE_A = \"QA\";\n    public static final String QUEUE_B = \"QB\";\n    //死信队列的名称\n    public static final String DEAD_LETTER_QUEUE = \"QD\";\n\n    //声明xExchange 别名\n    @Bean(\"xExchange\")\n    public DirectExchange xExchange() {\n        return new DirectExchange(X_EXCHANGE);\n    }\n\n    @Bean(\"yExchange\")\n    public DirectExchange yExchange() {\n        return new DirectExchange(Y_DEAD_LETTER_EXCHANGE);\n    }\n\n    //声明普通队列  ttl为10s\n    @Bean(\"queueA\")\n    public Queue queueA() {\n        Map<String, Object> arguments = new HashMap<>(3);\n        //设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", Y_DEAD_LETTER_EXCHANGE);\n        //设置死信 routing-key\n        arguments.put(\"x-dead-letter-routing-key\", \"YD\");\n        //设置ttl  单位为ms\n        arguments.put(\"x-message-ttl\", 10000);\n        return QueueBuilder.durable(QUEUE_A).withArguments(arguments).build();\n    }\n\n    //声明普通队列  ttl为40s\n    @Bean(\"queueB\")\n    public Queue queueB() {\n        Map<String, Object> arguments = new HashMap<>(3);\n        //设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", Y_DEAD_LETTER_EXCHANGE);\n        //设置死信 routing-key\n        arguments.put(\"x-dead-letter-routing-key\", \"YD\");\n        //设置ttl  单位为ms\n        arguments.put(\"x-message-ttl\", 40000);\n        return QueueBuilder.durable(QUEUE_B).withArguments(arguments).build();\n    }\n\n    //死信队列\n    @Bean(\"queueD\")\n    public Queue queueD() {\n        return QueueBuilder.durable(DEAD_LETTER_QUEUE).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueABindingX(@Qualifier(\"queueA\") Queue queueA, @Qualifier(\"xExchange\") DirectExchange xExchange) {\n        return BindingBuilder.bind(queueA).to(xExchange).with(\"XA\");\n    }\n\n    @Bean\n    public Binding queueBBindingX(@Qualifier(\"queueB\") Queue queueB, @Qualifier(\"xExchange\") DirectExchange xExchange) {\n        return BindingBuilder.bind(queueB).to(xExchange).with(\"XB\");\n    }\n\n    @Bean\n    public Binding queueDBindingY(@Qualifier(\"queueD\") Queue queueD, @Qualifier(\"yExchange\") DirectExchange yExchange) {\n        return BindingBuilder.bind(queueD).to(yExchange).with(\"YD\");\n    }\n}\n```\n\n5. 消费者：接收消息\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.rabbitmq.client.Channel;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 9:01\n * 队列ttl 消费者\n */\n@Slf4j\n@Component\npublic class DeadLetterQueueConsumer {\n\n    //接收消息\n    @RabbitListener(queues = \"QD\")\n    public void receiveD(Message message, Channel channel) {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间：{}，收到死信队列的消息：{}\", new Date().toString(), msg);\n    }\n}\n```\n\n6. 发送消息：Controller\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 8:47\n * 发送延迟消息\n * <p>\n * http://localhost:8080/ttl/sendMsg/嘻嘻嘻\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/ttl\")\npublic class SendMsgController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //开始发消息\n    @GetMapping(\"/sendMsg/{message}\")\n    public void sendMsg(@PathVariable String message) {\n        log.info(\"当前时间：{}，发送一条消息给两个ttl队列:{}\", new Date().toString(), message);\n        rabbitTemplate.convertAndSend(\"X\", \"XA\", \"消息来自ttl为10s的队列\" + message);\n        rabbitTemplate.convertAndSend(\"X\", \"XB\", \"消息来自ttl为40s的队列\" + message);\n    }\n}\n```\n\n<br />访问：[http://localhost:8080/ttl/sendMsg/](http://localhost:8080/ttl/sendMsg/)嘻嘻嘻<br />控制台打印结果：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638494307481-a59aaddb-4efb-4200-9e05-0e34602ded36.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=202&id=u66541ef9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=202&originWidth=1365&originalType=binary&ratio=1&rotation=0&showTitle=false&size=62756&status=done&style=none&taskId=ua128108f-eaa5-47fc-ab0d-e56fe3f57f4&title=&width=1365#crop=0&crop=0&crop=1&crop=1&id=tO8el&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"5d575387\"></a>\n#### 延迟队列优化：\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638494906968-c2a2e16a-a5b3-4c44-83bc-5846e35977d0.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=333&id=u5def25ea&margin=%5Bobject%20Object%5D&name=image.png&originHeight=333&originWidth=1070&originalType=binary&ratio=1&rotation=0&showTitle=false&size=169463&status=done&style=none&taskId=uede9888d-c22a-46c9-a810-c9c1899d23a&title=&width=1070#crop=0&crop=0&crop=1&crop=1&id=PCbH9&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />增加一个 QC 普通队列声明后并绑定交换机 XC。<br />队列配置 中添加：\n\n```java\n//--------------------------------优化延迟队列-------------------------------------\n    //普通队列的名称（为了优化延迟队列）\n    public static final String QUEUE_C = \"QC\";\n\n    //声明QC\n    @Bean(\"queueC\")\n    public Queue queueC() {\n        Map<String, Object> arguments = new HashMap<>(2);\n        //设置死信交换机\n        arguments.put(\"x-dead-letter-exchange\", Y_DEAD_LETTER_EXCHANGE);\n        //设置死信routing-key\n        arguments.put(\"x-dead-letter-routing-key\", \"YD\");\n        return QueueBuilder.durable(QUEUE_C).withArguments(arguments).build();\n    }\n\n    //绑定普通队列QC和交换机\n    @Bean\n    public Binding queueCBindingX(@Qualifier(\"queueC\") Queue queueC,\n                                  @Qualifier(\"xExchange\") DirectExchange xExchange) {\n        return BindingBuilder.bind(queueC).to(xExchange).with(\"XC\");\n    }\n    //-----------------------------------优化延迟队列----------------------------------\n```\n\n添加 Controller 发消息控制器：\n\n```java\n//开始发消息  消息ttl\n    @GetMapping(\"/sendExpireMsg/{message}/{ttlTime}\")\n    public void sendMsg(@PathVariable String message, @PathVariable String ttlTime) {\n        log.info(\"当前时间：{}，发送一条时长{}毫秒，ttl信息给队列QC:{}\", new Date().toString(), ttlTime, message);\n        rabbitTemplate.convertAndSend(\"X\", \"XC\", message, msg -> {\n            //发送消息的时候  延迟时长\n            msg.getMessageProperties().setExpiration(ttlTime);\n            return msg;\n        });\n    }\n```\n\n测试：\n\n1. http://localhost:8080/ttl/sendExpireMsg/你好 1/20000\n2. http://localhost:8080/ttl/sendExpireMsg/你好 2/2000\n\n结果：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638517312025-dfbbfd0b-a82c-4432-a395-2e7cc7c6e48f.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=149&id=u18e59259&margin=%5Bobject%20Object%5D&name=image.png&originHeight=149&originWidth=1285&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42107&status=done&style=none&taskId=uff6fb06a-df03-451f-b886-52364055048&title=&width=1285#crop=0&crop=0&crop=1&crop=1&id=efjYm&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"d0cad89d\"></a>\n## 延迟队列（基于插件）\n\n进入 rabbitmq 安装目录下的 plugins 目录 ，cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins<br />执行命令让该插件生效：rabbitmq-plugins enable rabbitmq_delayed_message_exchange<br />然后重启 rabbitmq：systemctl restart rabbitmq-server<br />会发现交换机多了一个新类型，意味着延迟消息将由交换机来完成，而不是队列。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638519642120-f3258006-3639-4551-805e-26bbd1e67c85.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=530&id=u66b7d498&margin=%5Bobject%20Object%5D&name=image.png&originHeight=767&originWidth=690&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56472&status=done&style=none&taskId=u707609ca-e368-4b6c-9833-ec8cc57ca15&title=&width=477.00006103515625#crop=0&crop=0&crop=1&crop=1&id=PD1AH&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n原来的情况：基于死信<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520455616-cfcde47e-bee3-4ef6-83b6-6630dbe54d9a.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=443&id=ua9957719&margin=%5Bobject%20Object%5D&name=image.png&originHeight=601&originWidth=1033&originalType=binary&ratio=1&rotation=0&showTitle=false&size=226301&status=done&style=none&taskId=ua95f3b09-635a-4782-abfd-57901f34a8b&title=&width=760.9862060546875#crop=0&crop=0&crop=1&crop=1&id=UOPGa&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />现在：基于延迟插件<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520591056-7591eaf6-b99f-4059-8cbb-6a6ee0ea64f2.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=177&id=u11577081&margin=%5Bobject%20Object%5D&name=image.png&originHeight=224&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=94107&status=done&style=none&taskId=u47b17a31-4f94-4f3c-a75f-2014f181765&title=&width=770.9896240234375#crop=0&crop=0&crop=1&crop=1&id=a4gyh&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />代码架构：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520764180-7b9e927e-1166-470d-ac32-dda16bb87ae1.png#clientId=u7522214d-0203-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=188&id=ud9b4ba5b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=188&originWidth=1062&originalType=binary&ratio=1&rotation=0&showTitle=false&size=84300&status=done&style=none&taskId=u12c568cb-6151-4b2f-8f49-3f721530b6d&title=&width=1062#crop=0&crop=0&crop=1&crop=1&id=cPAio&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 配置类\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 16:41\n */\n@Configuration\npublic class DelayedQueueConfig {\n    //队列\n    public static final String DELAYED_QUEUE_NAME = \"delayed.name\";\n    //交换机\n    public static final String DELAYED_EXCHANGE_NAME = \"delayed.exchange\";\n    //routing-key\n    public static final String DELAYED_ROUTING_KEY = \"delayed.routingkey\";\n\n    //声明队列\n    @Bean\n    public Queue delayedQueue() {\n        return QueueBuilder.durable(DELAYED_QUEUE_NAME).build();\n    }\n\n    //声明交换机 基于插件\n    @Bean\n    public CustomExchange delayedExchange() {\n        Map<String, Object> arguments = new HashMap<>();\n        arguments.put(\"x-delayed-type\", \"direct\");\n        /**\n         * 1. 交换机的名称\n         * 2. 交换机的类型\n         * 3. 是否需要持久化\n         * 4. 是否需要自动删除\n         * 5. 其他的参数\n         */\n        return new CustomExchange(DELAYED_EXCHANGE_NAME, \"x-delayed-message\", true, false, arguments);\n    }\n\n    //绑定\n    @Bean\n    public Binding delayedQueueBindingDelayedExchange(@Qualifier(\"delayedQueue\") Queue delayedQueue,\n                                                      @Qualifier(\"delayedExchange\") CustomExchange delayedExchange) {\n        return BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();\n    }\n}\n```\n\n2. Controller 生产者：\n\n```java\n//发消息  基于延迟插件\n    @GetMapping(\"/sendDelayMsg/{message}/{delayTime}\")\n    public void sendMsg(@PathVariable String message, @PathVariable Integer delayTime) {\n        log.info(\"当前时间:{},发送一条时长{}毫秒信息给延迟队列delayed.queue:{}\", new Date().toString(), delayTime, message);\n        rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME, DelayedQueueConfig.DELAYED_ROUTING_KEY, message, msg -> {\n            //发送消息的时候   延迟时长  单位：ms\n            msg.getMessageProperties().setDelay(delayTime);\n            return msg;\n        });\n    }\n```\n\n3. 消费者：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.DelayedQueueConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 19:36\n * 消费者 基于插件的延迟消息\n */\n@Slf4j\n@Component\npublic class DelayQueueConsumer {\n    //监听消息\n    @RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE_NAME)\n    public void receiveDelayQueue(Message message) {\n        String msg = new String(message.getBody());\n        log.info(\"当前时间:{},收到延迟队列的消息：{}\", new Date().toString(), msg);\n    }\n}\n```\n\n测试：<br />发起请求：[http://localhost:8080/ttl/sendDelayMsg/com](http://localhost:8080/ttl/sendDelayMsg/com) on baby1/20000<br /> [http://localhost:8080/ttl/sendDelayMsg/com](http://localhost:8080/ttl/sendDelayMsg/com) on baby2/2000<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638532349237-315b969f-d021-4448-8aa8-d5a1d41950a0.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=208&id=uf33e7fe7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=208&originWidth=1432&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71640&status=done&style=none&taskId=ue722c22b-16d9-40a2-9a28-e95348df5d0&title=&width=1432#crop=0&crop=0&crop=1&crop=1&id=P79jF&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638532663153-40afab72-d363-4536-94fc-4889e40d764b.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=224&id=u7813c3ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=266&originWidth=1121&originalType=binary&ratio=1&rotation=0&showTitle=false&size=457006&status=done&style=none&taskId=u0e4002d8-2179-43cc-bcfd-7c69cd127b5&title=&width=941.9896240234375#crop=0&crop=0&crop=1&crop=1&id=aEVGf&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"d338501f\"></a>\n## 发布确认高级\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638533419869-3aa9b7ad-ee4e-4fd8-9e42-fd6af4aafe70.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=225&id=u7ed4e098&margin=%5Bobject%20Object%5D&name=image.png&originHeight=341&originWidth=945&originalType=binary&ratio=1&rotation=0&showTitle=false&size=186643&status=done&style=none&taskId=uc65852ff-c2a9-416e-bef6-2991c80fa8b&title=&width=623.0000610351562#crop=0&crop=0&crop=1&crop=1&id=OAmnb&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=) <br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638533456413-9ead4e1d-f118-4a55-8d05-bcdd4d5fc47f.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=131&id=u954992f9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=144&originWidth=839&originalType=binary&ratio=1&rotation=0&showTitle=false&size=73103&status=done&style=none&taskId=u9819bc42-f398-487a-b319-358e2acd1ba&title=&width=762.9931030273438#crop=0&crop=0&crop=1&crop=1&id=sjopK&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"3f64dd13\"></a>\n### 回调接口 : (若交换机收不到消息)\n\n1. 配置类\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:15\n * 配置类  发布确认 （高级）\n */\n@Configuration\npublic class ConfirmConfig {\n    //交换机\n    public static final String CONFIRM_EXCHANGE_NAME = \"confirm_exchange\";\n    //队列\n    public static final String CONFIRM_QUEUE_NAME = \"confirm_queue\";\n    //routing-key\n    public static final String CONFIRM_ROUTING_KEY = \"key1\";\n\n    //声明交换机\n    @Bean\n    public DirectExchange confirmExchange() {\n        return new DirectExchange(CONFIRM_EXCHANGE_NAME);\n    }\n\n    //声明队列\n    @Bean\n    public Queue confirmQueue() {\n        return QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueBindingExchange(@Qualifier(\"confirmQueue\") Queue confirmQueue,\n                                        @Qualifier(\"confirmExchange\") DirectExchange confirmExchange) {\n        return BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);\n    }\n}\n```\n\n2. 生产者：发消息\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:27\n * 开始发消息\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/confirm\")\npublic class ProducerController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //发消息\n    @GetMapping(\"/sendMessage/{message}\")\n    public void sendMessage(@PathVariable String message) {\n        CorrelationData correlationData = new CorrelationData(\"1\");\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME, ConfirmConfig.CONFIRM_ROUTING_KEY, message, correlationData);\n        log.info(\"发送消息内容为：{}\", message);\n    }\n}\n```\n\n3. 消费者：\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:33\n * 接收消息\n */\n@Slf4j\n@Component\npublic class Consumer {\n    @RabbitListener(queues = ConfirmConfig.CONFIRM_QUEUE_NAME)\n    public void receiveConfirmMessage(Message message) {\n        String msg = new String(message.getBody());\n        log.info(\"接收到的队列confirm.queue消息：{}\", msg);\n    }\n}\n```\n\n4. 回调接口\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\nimport javax.annotation.PostConstruct;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:50\n * 回调接口\n */\n@Slf4j\n@Component\npublic class MyCallBack implements RabbitTemplate.ConfirmCallback {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    public void init() {\n        //注入 （需要将当前实现类注入到RabbitTemplate的ConfirmCallback函数式接口中）\n        rabbitTemplate.setConfirmCallback(this);\n    }\n\n    /**\n     * 交换机确认回调方法\n     * 1. 发消息  交换机接收到了  回调\n     * 1.1 correlationData 保存回调消息的id及相关信息\n     * 1.2 交换机收到消息  ack = true\n     * 1.3 cause  null\n     * 2. 发消息 交换机接收失败 回调\n     * 2.1 correlationData 保存回调消息的id及相关信息\n     * 2.2 交换机收到消息 ack = false\n     * 2.3 cause  失败的原因\n     *\n     * @param correlationData\n     * @param ack\n     * @param cause\n     */\n    @Override\n    public void confirm(CorrelationData correlationData, boolean ack, String cause) {\n        String id = correlationData != null ? correlationData.getId() : \"\";\n        if (ack) {\n            log.info(\"交换机已经收到id为：{}的消息\", id);\n        } else {\n            log.error(\"交换机还未收到id为:{}的消息，由于原因：{}\", id, cause);\n        }\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638537772169-a45dc229-e5ed-410a-8e46-69f3fb39f21e.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=518&id=u396acbb1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=518&originWidth=973&originalType=binary&ratio=1&rotation=0&showTitle=false&size=369736&status=done&style=none&taskId=u8a93ee99-1d87-4fd1-880d-a166a5e50f1&title=&width=973#crop=0&crop=0&crop=1&crop=1&id=Bk8N5&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\nspring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n    publisher-confirm-type: correlated    # 消息确认机制\n```\n\n5. 发送请求 : http://localhost:8080/confirm/sendMessage/大家好 1\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638537854600-e11783cd-28be-4b75-8f36-434ecab3f990.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=190&id=ue332f12f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=190&originWidth=1135&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51915&status=done&style=none&taskId=uba52e997-898f-49e3-9067-645cfb69f68&title=&width=1135#crop=0&crop=0&crop=1&crop=1&id=Emijw&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n6. 测试交换机收不到消息：在发送消息中，将交换机名字后面拼接上\"123\"，再次启动，发送请求： http://localhost:8080/confirm/sendMessage/大家好 1\n\n会得到：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638538268620-8dcbc2ae-eaa1-4b60-8822-9cd20f509c52.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=222&id=u3e470d69&margin=%5Bobject%20Object%5D&name=image.png&originHeight=222&originWidth=1872&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66288&status=done&style=none&taskId=u7f0330f7-a846-488e-8b25-71c1f3cf0a7&title=&width=1872#crop=0&crop=0&crop=1&crop=1&id=J3ZRH&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n7. 测试队列收不到消息\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:27\n * 开始发消息  生产者\n */\n@Slf4j\n@RestController\n@RequestMapping(\"/confirm\")\npublic class ProducerController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //发消息\n    @GetMapping(\"/sendMessage/{message}\")\n    public void sendMessage(@PathVariable String message) {\n        CorrelationData correlationData1 = new CorrelationData(\"1\");\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,\n                ConfirmConfig.CONFIRM_ROUTING_KEY, message, correlationData1);\n        log.info(\"发送消息内容为：{}\", message);\n\n        CorrelationData correlationData2 = new CorrelationData(\"2\");\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,\n                ConfirmConfig.CONFIRM_ROUTING_KEY+\"2\", message, correlationData2);\n        log.info(\"发送消息内容为：{}\", message);\n    }\n}\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638538743381-bfc4680e-692b-4303-a0f3-87cd9425978d.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=247&id=u241a2996&margin=%5Bobject%20Object%5D&name=image.png&originHeight=247&originWidth=1157&originalType=binary&ratio=1&rotation=0&showTitle=false&size=67266&status=done&style=none&taskId=u3edf7078-e740-4b0a-866c-03de3cfb9db&title=&width=1157#crop=0&crop=0&crop=1&crop=1&id=SGy2Z&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />可见，队列没有收到消息，也没有应答和确认。\n\n<a name=\"9a49228a\"></a>\n### 若队列收不到消息\n\n\n\n<a name=\"7df88dac\"></a>\n#### 回退消息\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638539584832-557a9bbc-89d4-4162-a0d4-599eb7f3df21.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=210&id=u40b5093d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=210&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=298616&status=done&style=none&taskId=u13a46749-be43-4430-beb2-483ea013efc&title=&width=976#crop=0&crop=0&crop=1&crop=1&id=thCkG&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n```java\nspring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n    publisher-confirm-type: correlated   # 消息确认机制\n    publisher-returns: true       # 发布确认机制（消息在交换机那若路由失败，则会回退消息给生产者）\n```\n\n回退接口：\n\n```java\n//注入\n@PostConstruct\n    public void init() {\n        //注入 （需要将当前实现类注入到RabbitTemplate的ConfirmCallback函数式接口中）\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setReturnsCallback(this);\n    }\n/**\n     * 可以在当消息传递过程中，不可达目的地时将消息返回给生产者\n     * 只有不可到目的地时，才进行回退\n     *\n     * @param returnedMessage\n     */\n    @Override\n    public void returnedMessage(ReturnedMessage returnedMessage) {\n        log.error(\"消息{}，被交换机{}退回，退回原因：{},路由key:{}\",\n                new String(returnedMessage.getMessage().getBody()),\n                returnedMessage.getExchange(),\n                returnedMessage.getReplyText(),\n                returnedMessage.getRoutingKey());\n    }\n```\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638542234889-03b41ef6-8fc5-4ffb-9f36-7287d4ff9476.png#clientId=u44e4b0cf-fc9d-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=267&id=uddd5e8ec&margin=%5Bobject%20Object%5D&name=image.png&originHeight=267&originWidth=1293&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78730&status=done&style=none&taskId=u4c513758-cf34-415c-a9f3-845a33faec5&title=&width=1293#crop=0&crop=0&crop=1&crop=1&id=tOHQ4&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"2d534732\"></a>\n#### 备份交换机\n\n添加一个交换机和两个队列。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638578627259-759238ba-aac5-42f9-b645-401c5c9a05d2.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=328&id=ud35a1613&margin=%5Bobject%20Object%5D&name=image.png&originHeight=328&originWidth=930&originalType=binary&ratio=1&rotation=0&showTitle=false&size=197049&status=done&style=none&taskId=u04e4ef45-34c3-49a8-84c0-93d70b4ebb6&title=&width=930#crop=0&crop=0&crop=1&crop=1&id=j2ALj&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n1. 配置类\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:15\n * 配置类  发布确认 （高级）\n */\n@Configuration\npublic class ConfirmConfig {\n    //交换机\n    public static final String CONFIRM_EXCHANGE_NAME = \"confirm_exchange\";\n    //队列\n    public static final String CONFIRM_QUEUE_NAME = \"confirm_queue\";\n    //routing-key\n    public static final String CONFIRM_ROUTING_KEY = \"key1\";\n    // --------------------------备份交换机---------------------------------\n    //备份交换机\n    public static final String BACKUP_EXCHANGE_NAME = \"backup_exchange\";\n\n    //备份队列\n    public static final String BACKUP_QUEUE_NAME = \"backup_queue\";\n\n    //报警队列\n    public static final String WARNING_QUEUE_NAME = \"warning_queue\";\n\n    //--------------------------------------------------------------------\n    //声明确认交换机（要转发到备份交换机）\n    @Bean\n    public DirectExchange confirmExchange() {\n        return ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(true)\n                .withArgument(\"alternate-exchange\", BACKUP_EXCHANGE_NAME).build();\n    }\n\n    //声明队列\n    @Bean\n    public Queue confirmQueue() {\n        return QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueBindingExchange(@Qualifier(\"confirmQueue\") Queue confirmQueue,\n                                        @Qualifier(\"confirmExchange\") DirectExchange confirmExchange) {\n        return BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);\n    }\n\n    //备份交换机\n    @Bean\n    public FanoutExchange backupExchange() {\n        return new FanoutExchange(BACKUP_EXCHANGE_NAME);\n    }\n\n    //备份队列\n    @Bean\n    public Queue backupQueue() {\n        return QueueBuilder.durable(BACKUP_QUEUE_NAME).build();\n    }\n\n    //报警队列\n    @Bean\n    public Queue warningQueue() {\n        return QueueBuilder.durable(WARNING_QUEUE_NAME).build();\n    }\n\n    //绑定（备份交换机和备份队列）\n    @Bean\n    public Binding backupQueueBindingBackupExchange(@Qualifier(\"backupExchange\") FanoutExchange backupExchange, @Qualifier(\"backupQueue\") Queue backupQueue) {\n        return BindingBuilder.bind(backupQueue).to(backupExchange);\n    }\n\n    //绑定（备份交换机和报警队列）\n    @Bean\n    public Binding warningQueueBindingBackupExchange(@Qualifier(\"backupExchange\") FanoutExchange backupExchange, @Qualifier(\"warningQueue\") Queue warningQueue) {\n        return BindingBuilder.bind(warningQueue).to(backupExchange);\n    }\n}\n```\n\n2. 消费者（报警消费者）\n\n```java\npackage com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/4 9:10\n * 报警消费者\n */\n@Component\n@Slf4j\npublic class WarningConsumer {\n    //接收报警消息\n    @RabbitListener(queues = ConfirmConfig.WARNING_QUEUE_NAME)\n    public void receiveWarningMsg(Message message) {\n        String msg = new String(message.getBody());\n        log.error(\"报警发现不可路由消息：{}\", msg);\n    }\n}\n```\n\n发送请求：http://localhost:8080/confirm/sendMessage/大家好 1<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638581402507-07326d95-5109-4750-b3ab-c4751b23d55d.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=263&id=udc9907e1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=263&originWidth=1171&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75848&status=done&style=none&taskId=u7fb8b716-7979-4acf-b11c-fe1cb99bebd&title=&width=1171#crop=0&crop=0&crop=1&crop=1&id=Lep12&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n> **备份交换机的优先级高于回退消息、**\n\n\n\n\n<a name=\"c06ec42e\"></a>\n## 其他知识点\n\n\n\n<a name=\"71a92fdf\"></a>\n### 幂等性\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638581856478-4611604a-34c1-486b-a3b7-c809f3d94f0e.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=620&id=ua03a1a2a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=620&originWidth=977&originalType=binary&ratio=1&rotation=0&showTitle=false&size=628166&status=done&style=none&taskId=u3bbefde1-d01a-481e-b831-abe2598835f&title=&width=977#crop=0&crop=0&crop=1&crop=1&id=pWlKw&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582165848-9189cc73-c68b-4631-b30d-dad30387a032.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=523&id=u37f187c9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=523&originWidth=1001&originalType=binary&ratio=1&rotation=0&showTitle=false&size=609037&status=done&style=none&taskId=udd6ff171-0753-4d6f-a510-a8761c65fcb&title=&width=1001#crop=0&crop=0&crop=1&crop=1&id=o6DXP&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n\n\n<a name=\"507580b5\"></a>\n### 优先级队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582363595-025332ba-94e1-4485-b6ab-e0542d69fab7.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=326&id=u83200fbd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=326&originWidth=987&originalType=binary&ratio=1&rotation=0&showTitle=false&size=447217&status=done&style=none&taskId=ueea7db03-7906-4cef-baef-0ebe50a0185&title=&width=987#crop=0&crop=0&crop=1&crop=1&id=h3cca&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582579936-dd221c3d-efc6-4e4b-b854-6667d27682a1.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=343&id=u3930b1c7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=402&originWidth=1186&originalType=binary&ratio=1&rotation=0&showTitle=false&size=288467&status=done&style=none&taskId=u70a2eadf-0b86-470c-a5a8-b7d8f612ad3&title=&width=1010.9896240234375#crop=0&crop=0&crop=1&crop=1&id=WVQYU&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />实现优先级:\n\n1. 生产者：\n\n```java\npackage com.atguigu.rabbitmq.one;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport java.io.IOException;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/28 22:15\n * 生产者 ：发消息\n */\npublic class Producer {\n    //队列名称\n    private static final String QUEUE_NAME = \"hello1\";\n\n    //发消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建一个连接工厂\n//        ConnectionFactory factory = new ConnectionFactory();\n//        //设置工厂ip  连接rabbitmq的队列\n//        factory.setHost(\"59.110.171.189\");\n//        //用户名\n//        factory.setUsername(\"admin\");\n//        //密码\n//        factory.setPassword(\"123\");\n//        //创建连接\n//        Connection connection = factory.newConnection();\n//        //获取信道\n//        Channel channel = connection.createChannel();\n        Channel channel = RabbitMqUtils.getChannel();\n        /**\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n         4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n         5.其他参数（延迟消息......）\n         */\n        Map<String, Object> arguments = new HashMap<>();\n        //官方允许是0-255之间。此处设置10. 允许优先级范围为0-10   不要设置过大   浪费CPU与内存\n        arguments.put(\"x-max-priority\", 10);\n        channel.queueDeclare(QUEUE_NAME, true, false, false, arguments);\n        //发消息\n        for (int i = 0; i < 11; i++) {\n            String message = \"info\" + i;\n            if (i == 5) {\n                //设置优先级\n                AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().priority(5).build();\n                channel.basicPublish(\"\", QUEUE_NAME, properties, message.getBytes());\n            } else {\n                channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes());\n            }\n        }\n        /*\n         * 发送一个消息\n         * 1. 发送到哪个交换机\n         * 2. 路由的key值是哪个，本次是队列的名称\n         * 3. 其他参数信息\n         * 4. 发送消息的消息体\n         */\n        System.out.println(\"消息发送完毕\");\n    }\n}\n```\n\n启动生产者：<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584428018-a99005d9-2193-463c-9f45-3f72656510ca.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=245&id=u9109bfc5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=245&originWidth=673&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24479&status=done&style=none&taskId=u0a4a6f5a-f03f-4ab3-8fcc-d9bdc327aad&title=&width=673#crop=0&crop=0&crop=1&crop=1&id=shKB3&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"07eab7c1\"></a>\n### ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584267331-0bf02c8d-6536-43a8-aa18-ee5f4ed82255.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=500&id=AvLAP&margin=%5Bobject%20Object%5D&name=image.png&originHeight=500&originWidth=1065&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74831&status=done&style=none&taskId=u77c77f80-cfec-453b-bc9f-f82bf26b07c&title=&width=1065#crop=0&crop=0&crop=1&crop=1&id=cIQXz&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n2. 消费者 :\n\n```java\npackage com.atguigu.rabbitmq.one;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.*;\n\nimport java.io.IOException;\nimport java.util.Arrays;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 15:04\n * 消费者:接收消息\n */\npublic class Consumer {\n    //队列名称\n    public static final String QUEUE_NAME = \"hello1\";\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建连接工厂\n//        ConnectionFactory factory = new ConnectionFactory();\n//        factory.setHost(\"59.110.171.189\");\n//        factory.setUsername(\"admin\");\n//        factory.setPassword(\"123\");\n//        Connection connection = factory.newConnection();\n//        Channel channel = connection.createChannel();\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明 接收消息(成功后的回调)\n        DeliverCallback deliverCallback = (consumerTag, message) -> {\n            System.out.println(new String(message.getBody()));\n        };\n        //取消消息时的回调\n        CancelCallback cancelCallback = consumerTag -> {\n            System.out.println(\"消息消费被中断\");\n        };\n        /*\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, cancelCallback);\n    }\n}\n```\n\n启动消费者，<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584610103-d784c402-b9b7-4321-80d9-c4b95990f410.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=346&id=u91a8ee8e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=346&originWidth=652&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36450&status=done&style=none&taskId=u90a3da53-d612-4152-b8b6-157c3e789ca&title=&width=652#crop=0&crop=0&crop=1&crop=1&id=UEHzd&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"8508a884\"></a>\n### 惰性队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584657059-9bf42f28-e7a0-4c4f-8a39-c56038bd0071.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=425&id=ud4e3da7e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=425&originWidth=993&originalType=binary&ratio=1&rotation=0&showTitle=false&size=597255&status=done&style=none&taskId=u2ff8ea80-3715-4c63-a718-4d71e1b8488&title=&width=993#crop=0&crop=0&crop=1&crop=1&id=wMAkZ&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584904322-348e89b5-e2f2-4df0-ba11-7540a061f849.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=613&id=u9cab5578&margin=%5Bobject%20Object%5D&name=image.png&originHeight=613&originWidth=1175&originalType=binary&ratio=1&rotation=0&showTitle=false&size=404748&status=done&style=none&taskId=uc0905b86-a7ec-4a0f-8a69-356a47ad688&title=&width=1175#crop=0&crop=0&crop=1&crop=1&id=NaNR3&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />惰性队列执行性能不太好，因此默认情况下不使用惰性队列，而使用正常队列。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638585096408-ecb74216-dfa9-41e3-b7bd-bd5236b2c1da.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=431&id=u4ab29e59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=431&originWidth=967&originalType=binary&ratio=1&rotation=0&showTitle=false&size=466179&status=done&style=none&taskId=ub1da4c7a-e46a-44f7-9b2f-e5129f4a839&title=&width=967#crop=0&crop=0&crop=1&crop=1&id=ZtuGu&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638585305462-e73859d4-5121-406a-b308-57cede7f1bac.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=413&id=uf8c1b8a8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=413&originWidth=966&originalType=binary&ratio=1&rotation=0&showTitle=false&size=247424&status=done&style=none&taskId=ua29dd158-1851-4974-bd9b-3c01a9c0ea5&title=&width=966#crop=0&crop=0&crop=1&crop=1&id=wFSJu&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n- 惰性队列从**磁盘**上读取消息，因此消费消息比较慢，但是内存消耗较小，在内存中只存储一些索引。一旦需要消费这些消息时，惰性队列会通过内存中的索引，去读取磁盘中相应的消息，到内存，再消费消息。\n- 正常队列从**内存**中读取消息，因此消费消息比较快，但是内存消耗较大。\n\n<a name=\"23eaf825\"></a>\n## rabbitmq 集群\n\n\n\n<a name=\"c0131d2a\"></a>\n### 集群原理\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638586666884-b99e8e77-81ef-4547-a9cd-1dcd00e86009.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=501&id=u84ce9d05&margin=%5Bobject%20Object%5D&name=image.png&originHeight=501&originWidth=1025&originalType=binary&ratio=1&rotation=0&showTitle=false&size=171726&status=done&style=none&taskId=ud7aa0990-8e0c-4e31-9dd1-c6d20007401&title=&width=1025#crop=0&crop=0&crop=1&crop=1&id=hjXVB&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"b80e581a\"></a>\n### 镜像队列（备份）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638587610363-c97ef89e-768e-4278-a087-89f20e211145.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=348&id=ue8695270&margin=%5Bobject%20Object%5D&name=image.png&originHeight=348&originWidth=981&originalType=binary&ratio=1&rotation=0&showTitle=false&size=453959&status=done&style=none&taskId=ue9f78068-c45e-4cc9-a3e0-595ae6c7337&title=&width=981#crop=0&crop=0&crop=1&crop=1&id=FTNYI&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"3702723f\"></a>\n### 高可用负载均衡\n\n若节点 1 宕机了，生产者需要连接节点 2 或节点 3。<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588031855-ab97c0f3-9861-4222-b593-0a4dbfbf566d.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=754&id=u0c60fb59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=754&originWidth=1028&originalType=binary&ratio=1&rotation=0&showTitle=false&size=344345&status=done&style=none&taskId=uaef85042-099b-42a3-8caf-268a89b7438&title=&width=1028#crop=0&crop=0&crop=1&crop=1&id=XmCHx&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />出现问题：生产者无法变更 rabbitmq 的 ip，此时需要借助外力 Haproxy。\n\n<a name=\"ea97af39\"></a>\n#### Haproxy 实现高可用 负载均衡（高并发）\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588332155-384a9066-f6ed-434c-bd8d-a08678795b99.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=177&id=u91155287&margin=%5Bobject%20Object%5D&name=image.png&originHeight=177&originWidth=973&originalType=binary&ratio=1&rotation=0&showTitle=false&size=240431&status=done&style=none&taskId=u9a4dff8d-f824-447c-b845-2962ddc0650&title=&width=973#crop=0&crop=0&crop=1&crop=1&id=BHuXj&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588403571-837d2496-d169-4b00-aa3c-4459e5dfd616.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=644&id=u63b0c105&margin=%5Bobject%20Object%5D&name=image.png&originHeight=644&originWidth=740&originalType=binary&ratio=1&rotation=0&showTitle=false&size=224363&status=done&style=none&taskId=u400f5630-901e-4db7-8556-6d72a1f206a&title=&width=740#crop=0&crop=0&crop=1&crop=1&id=FRrD8&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588495639-57e1823e-e317-48f1-bd99-4a64ab26b8b3.png#clientId=ueb126df1-e3fc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=711&id=uefaa64c3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=711&originWidth=860&originalType=binary&ratio=1&rotation=0&showTitle=false&size=371827&status=done&style=none&taskId=u8f30ca6f-4949-4c9d-899d-b31600baa56&title=&width=860#crop=0&crop=0&crop=1&crop=1&id=K5Fpn&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"80fc5d12\"></a>\n## 联合交换机\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638600972390-f8eabb13-fdba-432b-8b93-c4798757e13e.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=660&id=u1565c7a2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=660&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=882067&status=done&style=none&taskId=u40ae3ed4-1bbc-4baa-b912-40f55e8b353&title=&width=1136#crop=0&crop=0&crop=1&crop=1&id=FkHCS&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638601768985-91857261-fe17-4687-bc9f-f8d9daf1a364.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=524&id=uafeaba48&margin=%5Bobject%20Object%5D&name=image.png&originHeight=524&originWidth=1115&originalType=binary&ratio=1&rotation=0&showTitle=false&size=307899&status=done&style=none&taskId=u4499a665-a618-4138-a2f2-5bdf1dbaca0&title=&width=1115#crop=0&crop=0&crop=1&crop=1&id=FgJli&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638601930969-0c445ecb-7e66-43cd-a7d1-3aa8c76f884d.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=581&id=u6d4c749b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=581&originWidth=505&originalType=binary&ratio=1&rotation=0&showTitle=false&size=221677&status=done&style=none&taskId=uf8d981fd-837f-4eb6-83f6-a7deba0a018&title=&width=505#crop=0&crop=0&crop=1&crop=1&id=NxTl9&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602088334-f76d8ba1-5c6d-4280-87c8-b7d58d42f902.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=506&id=u4b7146f5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=506&originWidth=976&originalType=binary&ratio=1&rotation=0&showTitle=false&size=158537&status=done&style=none&taskId=u64d80530-7388-4c12-9d3b-48d90765e0b&title=&width=976#crop=0&crop=0&crop=1&crop=1&id=oVYwK&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602110103-8ee2df46-7982-4b08-a6c8-e4d9c701b69f.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=666&id=u65df8122&margin=%5Bobject%20Object%5D&name=image.png&originHeight=666&originWidth=933&originalType=binary&ratio=1&rotation=0&showTitle=false&size=302115&status=done&style=none&taskId=u970ef30c-4b50-4327-928e-6bf0cdbc242&title=&width=933#crop=0&crop=0&crop=1&crop=1&id=A9wRm&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"997a4ba0\"></a>\n## 联邦队列\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602602857-2efc1842-e9c7-409e-a302-2b4c63e92027.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=833&id=u3d500d40&margin=%5Bobject%20Object%5D&name=image.png&originHeight=833&originWidth=1312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=553687&status=done&style=none&taskId=u77ecfe28-0a6d-4318-bc8e-c80d6183ecc&title=&width=1312#crop=0&crop=0&crop=1&crop=1&id=qvMwP&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />两个不同地区数据同步。<br /> ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603240478-ba4a3a39-d3dc-41b3-9ee9-c8d9f2718ff9.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=551&id=u0dc6d91b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=551&originWidth=1149&originalType=binary&ratio=1&rotation=0&showTitle=false&size=244288&status=done&style=none&taskId=u65c1251d-b002-4909-ae1d-f27aa9d85ee&title=&width=1149#crop=0&crop=0&crop=1&crop=1&id=Rmak1&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n\n<a name=\"Shovel\"></a>\n## Shovel\n\n![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603352779-28d006e0-d330-4802-935c-040341c1ca8d.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=324&id=uc852da4a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=1287&originalType=binary&ratio=1&rotation=0&showTitle=false&size=568699&status=done&style=none&taskId=u2b770501-53fa-4cbc-a428-000590e2c17&title=&width=1287#crop=0&crop=0&crop=1&crop=1&id=fxL0i&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603460089-03466d04-df20-4ab2-8968-f1b5ef5905ca.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=409&id=ua502f49e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=409&originWidth=871&originalType=binary&ratio=1&rotation=0&showTitle=false&size=188661&status=done&style=none&taskId=u48a08d45-4dad-40e0-9723-55db3e3ef79&title=&width=871#crop=0&crop=0&crop=1&crop=1&id=lh1tz&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603378352-15aca4d9-af9b-48c1-b796-60a86b637ebd.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=667&id=uec9ad770&margin=%5Bobject%20Object%5D&name=image.png&originHeight=667&originWidth=864&originalType=binary&ratio=1&rotation=0&showTitle=false&size=266940&status=done&style=none&taskId=u8acd6a6e-3ed2-4306-8639-2eeb16612c3&title=&width=864#crop=0&crop=0&crop=1&crop=1&id=jpTqS&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br /> ![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603594801-6bd296a5-c23b-418f-a94e-5261833d5605.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=592&id=u903663bb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=592&originWidth=994&originalType=binary&ratio=1&rotation=0&showTitle=false&size=194438&status=done&style=none&taskId=ud10d2c55-8f5b-4b88-b096-8942402c361&title=&width=994#crop=0&crop=0&crop=1&crop=1&id=oSJ3T&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)<br />![image.png](https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603639753-9ae10564-7bad-4528-afd2-867c58d1f413.png#clientId=u1823549f-f362-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=121&id=u71e6fa9c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=121&originWidth=1169&originalType=binary&ratio=1&rotation=0&showTitle=false&size=88867&status=done&style=none&taskId=u55070310-f786-4b38-98ce-55db2f75ca1&title=&width=1169#crop=0&crop=0&crop=1&crop=1&id=Gjcgc&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=)\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"u0d7e0fb8\" class=\"ne-p\"><span class=\"ne-text\">---</span></p><p id=\"uc679db55\" class=\"ne-p\"><span class=\"ne-text\">title: RabbitMQ学习笔记<br /></span><span class=\"ne-text\">categories: 知识<br /></span><span class=\"ne-text\">tags: [RabbitMQ, 消息中间件]</span></p><p id=\"uaca5ecf0\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><p id=\"u34c88f82\" class=\"ne-p\"><span class=\"ne-text\"></span></p><p id=\"u5a3553e0\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1630671540955-650bc67f-569a-4cef-a095-ec73a3b34897.png#clientId=uc20dad1f-a2b4-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=740&amp;id=u64b4ea35&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=740&amp;originWidth=1340&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=584856&amp;status=done&amp;style=none&amp;taskId=u20a11e76-4e9c-49b4-8ca4-cc25eac0808&amp;title=&amp;width=1340\" width=\"1340\" id=\"FmDdj\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1630672453989-c5f9d3cf-e77f-4c3e-8a9d-173b49f0aa4c.png#clientId=uc20dad1f-a2b4-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=473&amp;id=ub505e50f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=473&amp;originWidth=1544&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=451836&amp;status=done&amp;style=none&amp;taskId=u973d9d93-5ee4-44e2-9f50-b28d8e8f15e&amp;title=&amp;width=1544\" width=\"1544\" id=\"N1Vbj\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1630673109375-2f65953f-32f5-4be8-9353-9d08abb6587f.png#clientId=uc20dad1f-a2b4-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=794&amp;id=uce851ada&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=794&amp;originWidth=1520&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=669042&amp;status=done&amp;style=none&amp;taskId=u1e0c19d3-9eae-4ab1-9e35-b33c4bbbcd6&amp;title=&amp;width=1520\" width=\"1520\" id=\"zGC4d\" class=\"ne-image\"></p><p id=\"u329797e5\" class=\"ne-p\"><br></p><h2 id=\"9c0cd8ed\"><span class=\"ne-text\">为什么要用 rabbitMQ？</span></h2><h3 id=\"81220e89\"><span class=\"ne-text\">1. 流量削峰</span></h3><p id=\"u034d5ee5\" class=\"ne-p\"><br></p><p id=\"u03a10fc5\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1637998719062-ee3b7961-8606-40b9-9bd6-139143630402.png#clientId=udb8aea13-24db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=91&amp;id=u7a7d8c10&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=182&amp;originWidth=990&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=78126&amp;status=done&amp;style=none&amp;taskId=u903bdc4d-2ce4-4ac8-97d1-9cf8226327b&amp;title=&amp;width=495\" width=\"990\" id=\"Ds1E5\" class=\"ne-image\"></p><p id=\"u874b8d44\" class=\"ne-p\"><br></p><h3 id=\"c491023f\"><span class=\"ne-text\">2. 应用解耦</span></h3><p id=\"ue8c60717\" class=\"ne-p\"><br></p><p id=\"u4ba4ff6a\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1637998760193-a4f14c2c-a22b-4c92-b207-ae58a962577a.png#clientId=udb8aea13-24db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=182&amp;id=u8f01ca2b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=363&amp;originWidth=1085&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=190648&amp;status=done&amp;style=none&amp;taskId=u30e77d52-0f3b-4d69-b06f-8229a9c232f&amp;title=&amp;width=542.5&amp;referrerpolicy=no-referrer\" width=\"1085\" id=\"hMEcn\" class=\"ne-image\"></p><p id=\"u6d37b294\" class=\"ne-p\"><br></p><h3 id=\"d4ef8fda\"><span class=\"ne-text\">3. 异步处理</span></h3><p id=\"ufa9eb4bc\" class=\"ne-p\"><br></p><p id=\"u20a06663\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009293978-1fde3fa6-5de6-476b-bc8f-4381749e748c.png#clientId=udb8aea13-24db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=315&amp;id=u2602b5b4&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=630&amp;originWidth=1167&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=283589&amp;status=done&amp;style=none&amp;taskId=uf5236049-2c88-4e12-b15e-7d99585efad&amp;title=&amp;width=583.5\" width=\"1167\" id=\"EqXpn\" class=\"ne-image\"></p><p id=\"u0a94a1a3\" class=\"ne-p\"><br></p><h2 id=\"753ccaa2\"><span class=\"ne-text\">RabbitMQ 核心部分</span></h2><p id=\"u29bdd22c\" class=\"ne-p\"><br></p><p id=\"uab230d58\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009378104-cb162a2f-4170-4d24-99c1-4e3ee09087ae.png#clientId=udb8aea13-24db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=284&amp;id=u45cac300&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=568&amp;originWidth=1077&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=305514&amp;status=done&amp;style=none&amp;taskId=u95a38925-5c34-45dd-bfca-d140d73dc3f&amp;title=&amp;width=538.5\" width=\"1077\" id=\"TB3Zf\" class=\"ne-image\"></p><p id=\"u0943ec06\" class=\"ne-p\"><br></p><h2 id=\"a260da3a\"><span class=\"ne-text\">各个名词介绍</span></h2><p id=\"u9ab39537\" class=\"ne-p\"><br></p><p id=\"ub76612d7\" class=\"ne-p\"><br></p><p id=\"u698e3664\" class=\"ne-p\"><br></p><h3 id=\"c83a4ba0\"><span class=\"ne-text\">RabbitMQ 工作原理</span></h3><p id=\"u21effb62\" class=\"ne-p\"><br></p><p id=\"ua7741f7e\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009501957-eb0902f3-1fa1-47d5-9bc7-8d03f6e12de0.png#clientId=udb8aea13-24db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=257&amp;id=u79c375f5&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=514&amp;originWidth=1060&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=210068&amp;status=done&amp;style=none&amp;taskId=ue02a7c50-c563-46af-a784-5ae4c1dcdfe&amp;title=&amp;width=530\" width=\"1060\" id=\"sf1J3\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009567915-6084eb1d-d428-47ec-844f-b3b48c6c6d0c.png#clientId=udb8aea13-24db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=310&amp;id=u9337433a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=619&amp;originWidth=1135&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=776522&amp;status=done&amp;style=none&amp;taskId=uced2ac5e-e117-4050-8e39-087f63ff410&amp;title=&amp;width=567.5\" width=\"1135\" id=\"ft4q6\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638009610891-4a5dba18-6006-41bf-a068-b2f33ed7df48.png#clientId=udb8aea13-24db-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=63&amp;id=u38d6f233&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=126&amp;originWidth=1128&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=136646&amp;status=done&amp;style=none&amp;taskId=u3dada18e-9ab8-40c9-8042-2e2f9f40306&amp;title=&amp;width=564\" width=\"1128\" id=\"rJuNv\" class=\"ne-image\"></p><p id=\"u1525aa57\" class=\"ne-p\"><br></p><h2 id=\"e655a410\"><span class=\"ne-text\">安装</span></h2><p id=\"u05de2581\" class=\"ne-p\"><br></p><p id=\"uf6aced4d\" class=\"ne-p\"><a href=\"https://www.rabbitmq.com/download.html\" data-href=\"https://www.rabbitmq.com/download.html\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">rabbitmq.com/download.html</span></a><span class=\"ne-text\"><br /></span><span class=\"ne-text\">erlang 和 rabbitMQ 版本匹配：<br /></span><a href=\"https://www.cnblogs.com/gne-hwz/p/10714013.html\" data-href=\"https://www.cnblogs.com/gne-hwz/p/10714013.html\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://www.cnblogs.com/gne-hwz/p/10714013.html</span></a><span class=\"ne-text\"><br /></span><span class=\"ne-text\">安装：</span><a href=\"https://blog.csdn.net/almahehe/article/details/75390572\" data-href=\"https://blog.csdn.net/almahehe/article/details/75390572\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://blog.csdn.net/almahehe/article/details/75390572</span></a><span class=\"ne-text\"><br /></span><span class=\"ne-text\">（建议看尚硅谷视频进行快速安装）<br /></span><span class=\"ne-text\">安装之后，可以访问 ip:15672 ，查看发送消息的端口（5672）和用户。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638169386681-e382c30c-baba-4fbb-bd40-aaa7b0a1eac6.png#clientId=uc4bbfa15-6ab6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=173&amp;id=u1a771f9c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=102&amp;originWidth=450&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=28980&amp;status=done&amp;style=none&amp;taskId=ua13bea1f-438b-4ef8-8913-b4ccb9fa78c&amp;title=&amp;width=761.9931030273438\" width=\"450\" id=\"pNXMC\" class=\"ne-image\"></p><p id=\"u9691fe71\" class=\"ne-p\"><br></p><h2 id=\"c729f8ef\"><span class=\"ne-text\">简单队列模式</span></h2><h3 id=\"f5abe6f8\"><span class=\"ne-text\">生产者代码</span></h3><p id=\"u9247b990\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"ua2bec32f\"><span class=\"ne-text\">项目依赖：</span></li></ol><p id=\"ua99c915f\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"0859d073\" class=\"ne-codeblock language-xml\">&lt;dependencies&gt;\n        &lt;!--指定jdk编译版本--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n            &lt;version&gt;3.8.1&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client --&gt;\n        &lt;!--rabbitmq依赖客户端--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;\n            &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;\n            &lt;version&gt;5.8.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/commons-io/commons-io --&gt;\n        &lt;!--操作文件流的依赖--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;commons-io&lt;/groupId&gt;\n            &lt;artifactId&gt;commons-io&lt;/artifactId&gt;\n            &lt;version&gt;2.6&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;\n            &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt;\n            &lt;version&gt;1.7.25&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;</pre><p id=\"ud6903308\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"uadcc7a78\"><span class=\"ne-text\">生产者代码：</span></li></ol><p id=\"u087456f1\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"551912bc\" class=\"ne-codeblock language-java\">japackage com.atguigu.rabbitmq.one;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/28 22:15\n * 生产者 ：发消息\n */\npublic class Producer {\n    //队列名称\n    private static final String QUEUE_NAME = &quot;hello&quot;;\n\n    //发消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建一个连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        //设置工厂ip  连接rabbitmq的队列\n        factory.setHost(&quot;59.110.171.189&quot;);\n        //用户名\n        factory.setUsername(&quot;admin&quot;);\n        //密码\n        factory.setPassword(&quot;123&quot;);\n        //创建连接\n        Connection connection = factory.newConnection();\n        //获取信道\n        Channel channel = connection.createChannel();\n        /**\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n                4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n                5.其他参数（延迟消息......）\n         */\n\n        channel.queueDeclare(QUEUE_NAME,false,false,false,null);\n        //发消息\n        String message = &quot;hello world&quot;;\n        /**\n         * 发送一个消息\n         * 1. 发送到哪个交换机\n         * 2. 路由的key值是哪个，本次是队列的名称\n         * 3. 其他参数信息\n         * 4. 发送消息的消息体\n         */\n        channel.basicPublish(&quot;&quot;,QUEUE_NAME,null,message.getBytes());\n        System.out.println(&quot;消息发送完毕&quot;);\n    }\n}</pre><p id=\"ua3657b02\" class=\"ne-p\"><br></p><p id=\"u11483b33\" class=\"ne-p\"><span class=\"ne-text\">如果运行报超时错误，需要打开云服务器的安全组 5672 端口。<br />（参考博客：</span><a href=\"https://www.cnblogs.com/jxearlier/p/11920825.html\" data-href=\"https://www.cnblogs.com/jxearlier/p/11920825.html\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://www.cnblogs.com/jxearlier/p/11920825.html</span></a><span class=\"ne-text\">）</span></p><h3 id=\"3b753fe7\"><span class=\"ne-text\">消费者代码</span></h3><p id=\"ud87a77a1\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"d7bd0f8f\" class=\"ne-codeblock language-xml\">package com.atguigu.rabbitmq.one;\n\nimport com.rabbitmq.client.*;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 15:04\n * 消费者:接收消息\n */\npublic class Consumer {\n    //队列名称\n    public static final String QUEUE_NAME = &quot;hello&quot;;\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(&quot;59.110.171.189&quot;);\n        factory.setUsername(&quot;admin&quot;);\n        factory.setPassword(&quot;123&quot;);\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        //声明 接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(message);\n        };\n        //取消消息时的回调\n        CancelCallback cancelCallback = consumerTag -&gt; {\n            System.out.println(&quot;消息消费被中断&quot;);\n        };\n        /**\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true,deliverCallback,cancelCallback);\n    }\n}</pre><p id=\"u161ab880\" class=\"ne-p\"><br></p><p id=\"u2f7061dc\" class=\"ne-p\"><span class=\"ne-text\">运行结果：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638172828992-073b0df6-a480-4260-a724-e17e9191a44c.png#clientId=uc4bbfa15-6ab6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=20&amp;id=u3ee077b2&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=20&amp;originWidth=296&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=2932&amp;status=done&amp;style=none&amp;taskId=ud645c173-0157-49f2-89fb-5d58c2cd89a&amp;title=&amp;width=296\" width=\"296\" id=\"kWU4Y\" class=\"ne-image\"></p><p id=\"u0b7711d3\" class=\"ne-p\"><br></p><h3 id=\"56a70cf7\"><span class=\"ne-text\">测试生产者和消费者代码：</span></h3><p id=\"uac0eac74\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"u4916faee\"><span class=\"ne-text\">先运行消费者代码，发现没有消息，再运行生产者代码，发送消息，再看消费者代码控制台，此时已经接收到消息。</span></li></ol><p id=\"ua57feed9\" class=\"ne-p\"><br></p><h2 id=\"3d1bae02\"><span class=\"ne-text\">工作队列模式</span></h2><p id=\"u8a14f32f\" class=\"ne-p\"><br></p><p id=\"u924e23c9\" class=\"ne-p\"><br></p><p id=\"ub993060c\" class=\"ne-p\"><br></p><h3 id=\"d9addd15\"><span class=\"ne-text\">轮训分发消息</span></h3><p id=\"u0a21536f\" class=\"ne-p\"><br></p><p id=\"u1c457a9d\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638191830547-a43bbaa1-a524-4603-b6a9-0824e943cf9c.png#clientId=u43ded51d-0244-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=546&amp;id=ucf96c5e0&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=546&amp;originWidth=1278&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=220503&amp;status=done&amp;style=none&amp;taskId=ub030755f-49df-4184-9d0d-65bfa0e561e&amp;title=&amp;width=1278\" width=\"1278\" id=\"kyxCV\" class=\"ne-image\"></p><p id=\"ubbe06130\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"ua4977f19\"><span class=\"ne-text\">抽取连接工厂工具类：</span></li></ol><p id=\"u1321a065\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"d79993aa\" class=\"ne-codeblock language-xml\">package com.atguigu.rabbitmq.utils;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.ConnectionFactory;\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 19:48\n * 连接工厂创建信道的工具类\n */\npublic class RabbitMqUtils {\n    public static Channel getChannel() throws IOException, TimeoutException {\n        //创建连接工厂\n        ConnectionFactory factory = new ConnectionFactory();\n        factory.setHost(&quot;59.110.171.189&quot;);\n        factory.setUsername(&quot;admin&quot;);\n        factory.setPassword(&quot;123&quot;);\n        Connection connection = factory.newConnection();\n        Channel channel = connection.createChannel();\n        return channel;\n    }\n}</pre><p id=\"u63f36183\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"u07f51501\"><span class=\"ne-text\">工作线程代码：（消费者）</span></li></ol><p id=\"ud95a0f1f\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"9d76e763\" class=\"ne-codeblock language-xml\">package com.atguigu.rabbitmq.two;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.CancelCallback;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\nimport com.rabbitmq.client.Delivery;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 19:55\n * 这是一个工作线程（相当于之前的消费者）\n */\npublic class Worker01 {\n    //队列名称\n    public static final String QUEUE_NAME = &quot;hello&quot;;\n\n    //接收消息 的工作线程\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //消息的接收\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(&quot;接收到的消息：&quot; + new String(message.getBody()));\n        };\n        //消息接收被取消时 执行\n        CancelCallback cancelCallback = (consumerTag) -&gt; {\n            System.out.println(consumerTag + &quot;消费者取消消费接口回调逻辑&quot;);\n        };\n        /*\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, cancelCallback);\n    }\n}</pre><p id=\"u3c81ab45\" class=\"ne-p\"><br></p><ol start=\"3\" class=\"ne-ol\"><li id=\"u3d36e889\"><span class=\"ne-text\">启动两个工作线程（消费者）</span></li></ol><p id=\"ub9bad24a\" class=\"ne-p\"><br></p><p id=\"u880b1412\" class=\"ne-p\"><span class=\"ne-text\">前提是在 idea 设置允许方法多个并行运行：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638188489814-b081e679-bc7f-4cad-964e-bfb80575820c.png#clientId=u43ded51d-0244-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=636&amp;id=uf61f07dc&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=869&amp;originWidth=1143&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=94819&amp;status=done&amp;style=none&amp;taskId=u4472c929-c48f-4a7d-ab7d-ec2994b75e5&amp;title=&amp;width=836.9862060546875\" width=\"1143\" id=\"zVInE\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638188418807-97ce766a-47ef-458c-8413-d496cbcddbed.png#clientId=u43ded51d-0244-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=172&amp;id=u35f12aab&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=172&amp;originWidth=669&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=20804&amp;status=done&amp;style=none&amp;taskId=uf688cf36-6dc9-43f1-be3d-946b8a45d78&amp;title=&amp;width=669\" width=\"669\" id=\"yNG1N\" class=\"ne-image\"></p><p id=\"ub776168d\" class=\"ne-p\"><br></p><ol start=\"4\" class=\"ne-ol\"><li id=\"ud4caf9e9\"><span class=\"ne-text\">生产者代码：</span></li></ol><p id=\"u09bb0f44\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"5346bd81\" class=\"ne-codeblock language-xml\">package com.atguigu.rabbitmq.two;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 21:04\n * 生产者 发送大量消息\n */\npublic class Task01 {\n    public static final String QUEUE_NAME = &quot;hello&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        /*\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n         4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n         5.其他参数（延迟消息......）\n         */\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes());\n            System.out.println(&quot;发送消息完成：&quot; + message);\n        }\n    }\n}</pre><p id=\"u0c3323ed\" class=\"ne-p\"><br></p><ol start=\"5\" class=\"ne-ol\"><li id=\"u5fbb9819\"><span class=\"ne-text\">测试：启动生产者</span></li></ol><p id=\"u647c8fbd\" class=\"ne-p\"><br></p><p id=\"ud09fcf35\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192109706-2649384b-8559-4d7e-8609-220f576c3e25.png#clientId=u43ded51d-0244-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=275&amp;id=u4261e57f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=275&amp;originWidth=591&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25224&amp;status=done&amp;style=none&amp;taskId=ue3dff20d-583f-4d0b-bb12-94ccae95bc1&amp;title=&amp;width=591\" width=\"591\" id=\"PuJou\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">可以看见消费者轮循接收消息：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192164342-16d183be-bbe5-4de9-bac4-d87bd87a746b.png#clientId=u43ded51d-0244-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=179&amp;id=ue97a7cdb&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=179&amp;originWidth=591&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23018&amp;status=done&amp;style=none&amp;taskId=u7cff6d1a-b142-4d52-a1c5-1cca6fd241e&amp;title=&amp;width=591\" width=\"591\" id=\"Upfv4\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638192176544-d380de90-ff7a-48a7-a080-c4a1ac193460.png#clientId=u43ded51d-0244-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=198&amp;id=ubb73d589&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=198&amp;originWidth=598&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23978&amp;status=done&amp;style=none&amp;taskId=u3ac63e3a-6d82-4340-9fed-c68c8fbf564&amp;title=&amp;width=598\" width=\"598\" id=\"xLv8Q\" class=\"ne-image\"></p><p id=\"u9b4baf19\" class=\"ne-p\"><br></p><h2 id=\"269fc561\"><span class=\"ne-text\">消息应答</span></h2><p id=\"u6a6463c8\" class=\"ne-p\"><br></p><p id=\"uce771e06\" class=\"ne-p\"><br></p><p id=\"u4921363f\" class=\"ne-p\"><br></p><h3 id=\"398e8d91\"><span class=\"ne-text\">自动应答</span></h3><p id=\"u375825be\" class=\"ne-p\"><br></p><p id=\"ua916566e\" class=\"ne-p\"><span class=\"ne-text\">不建议使用，仅适用在消费者可以高效并以某种速率能够处理这些消息的情况。</span></p><p id=\"u5267e3be\" class=\"ne-p\"><br></p><h3 id=\"a7945bf1\"><span class=\"ne-text\">手动应答</span></h3><p id=\"uc5fde435\" class=\"ne-p\"><br></p><p id=\"ud58827d8\" class=\"ne-p\"><br></p><p id=\"u5b06088a\" class=\"ne-p\"><br></p><h4 id=\"bdff53ca\"><span class=\"ne-text\">消息应答的方法：</span></h4><p id=\"u91742edc\" class=\"ne-p\"><br></p><p id=\"u50ffcea8\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638193415623-6b7ff26f-8cc3-4abd-b1c6-41f79897f0cf.png#clientId=u43ded51d-0244-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=312&amp;id=ud16b0385&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=312&amp;originWidth=737&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=100867&amp;status=done&amp;style=none&amp;taskId=u39cf8244-b605-4c5d-baca-fe2103cd9d3&amp;title=&amp;width=737\" width=\"737\" id=\"S2b1y\" class=\"ne-image\"></p><p id=\"u9dec6f82\" class=\"ne-p\"><br></p><h4 id=\"70c2cd3d\"><span class=\"ne-text\">批量处理 Multiple</span></h4><p id=\"ubcb490e9\" class=\"ne-p\"><br></p><p id=\"u50a423cf\" class=\"ne-p\"><span class=\"ne-text\">手动应答的好处：可以批量应答，并减少网络拥堵。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638282925466-4d3081e6-809c-4a5f-9472-741dacb0cc7c.png#clientId=ub82069db-0272-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=588&amp;id=u97ebb457&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=811&amp;originWidth=1024&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=292383&amp;status=done&amp;style=none&amp;taskId=uf04a703e-97b1-4fe2-b58f-33d8b0dff4d&amp;title=&amp;width=741.9931030273438\" width=\"1024\" id=\"rUzZh\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">但是批量应答可能会丢失消息。所以尽量不要批量应答，将 multiple 设置为 false。</span></p><p id=\"ue797ecdd\" class=\"ne-p\"><br></p><h3 id=\"8f744d87\"><span class=\"ne-text\">消息自动重新入队</span></h3><p id=\"ub78af706\" class=\"ne-p\"><br></p><p id=\"u48684c84\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638317239422-ab1bab41-ac6f-4a05-b3c5-c539d9e6dcd1.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=85&amp;id=u97c18f3b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=79&amp;originWidth=665&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57746&amp;status=done&amp;style=none&amp;taskId=u14e494b5-3291-4daf-ada5-47aafa5eab0&amp;title=&amp;width=715.0000610351562\" width=\"665\" id=\"qAYOD\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638317701734-1133a417-ebbe-4ad9-8453-f0803583491a.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=308&amp;id=u7be19416&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=469&amp;originWidth=1088&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=306122&amp;status=done&amp;style=none&amp;taskId=u7d90ec89-bd9a-4090-bda5-c09c6014c27&amp;title=&amp;width=714.9862060546875\" width=\"1088\" id=\"o9cFt\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">测试：<br /></span><span class=\"ne-text\"> 1. 生产者：</span></p><p id=\"uf22d07da\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"07cf3bd5\" class=\"ne-codeblock language-xml\">package com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:46\n * 消息在手动应答时不丢失,放回队列中重新消费\n */\npublic class Task2 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = &quot;ack_queue&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明队列\n        channel.queueDeclare(TASK_QUEUE_NAME, false, false, false, null);\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(&quot;&quot;, TASK_QUEUE_NAME, null, message.getBytes());\n            System.out.println(&quot;生产者发出消息：&quot; + message);\n        }\n    }\n}</pre><p id=\"u7a59e1ef\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"ua5680886\"><span class=\"ne-text\">两个消费者（消息手动应答）：</span></li></ol><p id=\"u9ced89cf\" class=\"ne-p\"><br></p><p id=\"udf412596\" class=\"ne-p\"><span class=\"ne-text\">消费者一：</span></p><p id=\"ueae64f29\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"7fa74098\" class=\"ne-codeblock language-xml\">package com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.atguigu.rabbitmq.utils.SleepUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:58\n * 消息在手动应答时不丢失，放回队列中重新消费\n */\npublic class Work03 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = &quot;ack_queue&quot;;\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(&quot;C1等待接收消息处理时间较短&quot;);\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            //沉睡1s\n            SleepUtils.sleep(1);\n            System.out.println(&quot;接收到的消息：&quot; + new String(message.getBody(), StandardCharsets.UTF_8));\n            //手动应答（通过信道）\n            /*参数：\n            1. 消息的标记 tag\n            2. 是否批量应答  false:不批量应答信道中的消息，true:批量\n             */\n            channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n        };\n        //采用手动应答\n        boolean autoAck = false;\n        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -&gt; {\n            System.out.println(consumerTag + &quot;消费者取消消费接口的回调逻辑&quot;);\n        }));\n    }\n}</pre><p id=\"u510b8aea\" class=\"ne-p\"><br></p><p id=\"u13871e3e\" class=\"ne-p\"><span class=\"ne-text\">消费者二：</span></p><p id=\"ufa927a3f\" class=\"ne-p\"><br></p><pre data-language=\"xml\" id=\"f6acdd41\" class=\"ne-codeblock language-xml\">package com.atguigu.rabbitmq.three;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.atguigu.rabbitmq.utils.SleepUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 14:58\n * 消息在手动应答时不丢失，放回队列中重新消费\n */\npublic class Work04 {\n    //队列名称\n    public static final String TASK_QUEUE_NAME = &quot;ack_queue&quot;;\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(&quot;C2等待接收消息处理时间较短&quot;);\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            //沉睡1s\n            SleepUtils.sleep(30);\n            System.out.println(&quot;接收到的消息：&quot; + new String(message.getBody(), StandardCharsets.UTF_8));\n            //手动应答（通过信道）\n            /*参数：\n            1. 消息的标记 tag\n            2. 是否批量应答  false:不批量应答信道中的消息，true:批量\n             */\n            channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n        };\n        //采用手动应答\n        boolean autoAck = false;\n        channel.basicConsume(TASK_QUEUE_NAME, autoAck, deliverCallback, (consumerTag -&gt; {\n            System.out.println(consumerTag + &quot;消费者取消消费接口的回调逻辑&quot;);\n        }));\n    }\n}</pre><p id=\"ucab58ba8\" class=\"ne-p\"><br></p><p id=\"u3fb35c0e\" class=\"ne-p\"><span class=\"ne-text\">测试步骤：<br /></span><span class=\"ne-text\">① 先启动 task2，创建 ack_queue 队列；（在 ip:15672 的 queue 列表中可以看到目前拥有的队列）<br /></span><span class=\"ne-text\">② 启动 work02，work03 接收消息（消费者）；<br /></span><span class=\"ne-text\">③ 发消息：在 task2 控制台输入 aa,bb,cc,dd,ee,ff，可以看到 work2 和 work3 是轮训接收消息；如果到 work03 应该接收消息 ee 时，work03 突然挂掉，此时 ee 会被转发给 work02 中的 C1，这时 C1 会接收到 ee，因此消息不会丢失，这说明了 rabbitmq 有手动应答的能力，只要没有收到消息，就不会手动应答，从而将消息放回队列。而队列又再次将消息传递给 C1 进行重新消费，从而导致 ee 并没有丢失。</span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638348662336-051f5011-f512-44d1-bb05-053e49ba050c.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=499&amp;id=u60c5aa9e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=499&amp;originWidth=1092&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=254728&amp;status=done&amp;style=none&amp;taskId=u6c03afcd-9d58-4d4b-b839-5e4801e20e0&amp;title=&amp;width=1092\" width=\"1092\" id=\"Rq0q6\" class=\"ne-image\"></p><p id=\"ub25bd699\" class=\"ne-p\"><br></p><h2 id=\"274a6bb3\"><span class=\"ne-text\">队列持久化</span></h2><p id=\"u65611189\" class=\"ne-p\"><br></p><p id=\"ue951fa0d\" class=\"ne-p\"><span class=\"ne-text\">如果存在同名未被持久化的队列，则需要先删除原先的未被持久化的队列，再重新生成一个持久化队列。</span></p><p id=\"u9565990f\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"1a197cbd\" class=\"ne-codeblock language-java\">//声明队列\nboolean durable = true; //在生产者中，需要让queue进行持久化\nchannel.queueDeclare(TASK_QUEUE_NAME, durable, false, false, null);</pre><p id=\"ua4a455e1\" class=\"ne-p\"><br></p><p id=\"u003d6059\" class=\"ne-p\"><span class=\"ne-text\">生成一个持久化队列之后，在 rabbitmq 控制台中这个队列的 features 属性会出现 D（代表持久化）。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638359722330-59d15b49-1b8d-4d93-85aa-ecd40227bd45.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=129&amp;id=ufd6f763b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=129&amp;originWidth=781&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=13881&amp;status=done&amp;style=none&amp;taskId=uab54d6ef-4036-4edf-bca6-ba4a9dcac1d&amp;title=&amp;width=781\" width=\"781\" id=\"iMXeX\" class=\"ne-image\"></p><p id=\"u3e80b572\" class=\"ne-p\"><br></p><h2 id=\"f1739dad\"><span class=\"ne-text\">消息持久化</span></h2><p id=\"uc661f556\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"2ac9ced1\" class=\"ne-codeblock language-java\">//设置生产者发送消息为持久化消息（要求保存到磁盘上MessageProperties.PERSISTENT_TEXT_PLAIN）\nchannel.basicPublish(&quot;&quot;, TASK_QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());</pre><p id=\"u478658c1\" class=\"ne-p\"><br></p><p id=\"u88b0d835\" class=\"ne-p\"><br></p><p id=\"u2a1a3ee8\" class=\"ne-p\"><br></p><h2 id=\"afba844e\"><span class=\"ne-text\">不公平分发</span></h2><p id=\"ubf424800\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"b23fdf5a\" class=\"ne-codeblock language-java\">//在消费者中接收消息之前设置不公平分发\nint prefetchCount = 1;\nchannel.basicQos(prefetchCount);</pre><p id=\"u6ed41d59\" class=\"ne-p\"><br></p><p id=\"u828c250f\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361240814-a1349c7f-2e3e-410a-ba3b-f2f872fab0bb.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=232&amp;id=u1ff04a34&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=232&amp;originWidth=385&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=20173&amp;status=done&amp;style=none&amp;taskId=ub1b60899-802e-4d67-9aed-a99c48b5db3&amp;title=&amp;width=385\" width=\"385\" id=\"vTMLG\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361251165-68b13d22-fe49-4fd8-9471-26161051c180.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=177&amp;id=u477bebf6&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=177&amp;originWidth=431&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=18613&amp;status=done&amp;style=none&amp;taskId=ue60522ee-50ed-46f9-ae69-472369ce4b6&amp;title=&amp;width=431\" width=\"431\" id=\"zGQk4\" class=\"ne-image\"></p><p id=\"u606a7603\" class=\"ne-p\"><br></p><h2 id=\"e7e8ffe0\"><span class=\"ne-text\">预取值</span></h2><p id=\"uc821be09\" class=\"ne-p\"><br></p><p id=\"uf28a9818\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638361857297-fa168e46-191d-44b2-8ce2-df2cb52a382d.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=282&amp;id=ue1e2c233&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=453&amp;originWidth=1130&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=347909&amp;status=done&amp;style=none&amp;taskId=ue241edd5-d375-46cb-9668-4a4eb4d7c9c&amp;title=&amp;width=703.0000610351562\" width=\"1130\" id=\"mwjn3\" class=\"ne-image\"></p><p id=\"u85729c36\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"1f902658\" class=\"ne-codeblock language-java\">int prefetchCount = 5;\nchannel.basicQos(prefetchCount);</pre><p id=\"uac932245\" class=\"ne-p\"><br></p><p id=\"ucf3fd997\" class=\"ne-p\"><br></p><p id=\"u92071e4b\" class=\"ne-p\"><br></p><h2 id=\"1e9c309f\"><span class=\"ne-text\">发布确认原理</span></h2><p id=\"ua7b44864\" class=\"ne-p\"><br></p><p id=\"uf9cf497a\" class=\"ne-p\"><br></p><p id=\"uc237fdfc\" class=\"ne-p\"><br></p><h2 id=\"e61fd426\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638364988019-b29d7c44-ebca-4978-95fd-034500d1bd7b.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=369&amp;id=u98ff6bb0&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=369&amp;originWidth=930&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=222643&amp;status=done&amp;style=none&amp;taskId=ua25c2547-8233-4893-8d5b-4406b84e85f&amp;title=&amp;width=930\" width=\"930\" id=\"Xek0V\" class=\"ne-image\"></h2><p id=\"ub971425a\" class=\"ne-p\"><br></p><p id=\"uff8b9cca\" class=\"ne-p\"><span class=\"ne-text\">在信道之后开启发布确认：</span></p><p id=\"u0e87e7d9\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"ad539932\" class=\"ne-codeblock language-java\">//信道开启发布确认\nchannel.confirmSelect();</pre><p id=\"u240d4823\" class=\"ne-p\"><br></p><p id=\"uda74d6f1\" class=\"ne-p\"><br></p><p id=\"u11342da4\" class=\"ne-p\"><br></p><h2 id=\"f1ad8c9b\"><span class=\"ne-text\">单个发布确认</span></h2><p id=\"u3cbeb3a0\" class=\"ne-p\"><br></p><p id=\"uc4d6c015\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638365489548-64267da5-f60d-4b88-98af-bdf5806d5038.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=203&amp;id=ub1148f56&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=203&amp;originWidth=993&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=342872&amp;status=done&amp;style=none&amp;taskId=u2df32a3e-4c69-4599-868a-d81e33495ec&amp;title=&amp;width=993\" width=\"993\" id=\"qVQAu\" class=\"ne-image\"></p><p id=\"u6734b8e1\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"e9bbaca4\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.four;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.UUID;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/1 21:32\n * 发布确认模式：\n * 使用的时间  比较哪种确认方式是最好的\n * 1.单个确认\n * 2.批量确认\n * 3.异步批量确认\n */\npublic class ConfireMessage {\n    //批量发消息的个数\n    public static final int MESSAGE_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException, TimeoutException, IOException {\n        //1. 单个确认\n        ConfireMessage.publicMessageIndividually(); //发布1000个单独确认消息，耗时29726ms\n    }\n\n    //单个确认\n    public static void publicMessageIndividually() throws IOException, TimeoutException, InterruptedException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量发消息\n        for (int i = 0; i &lt; MESSAGE_COUNT; i++) {\n            String massage = i + &quot;&quot;;\n            channel.basicPublish(&quot;&quot;, queueName, null, massage.getBytes());\n            //单个消息就马上进行发布确认\n            boolean flag = channel.waitForConfirms();\n            if (flag) {\n                System.out.println(&quot;消息发送成功&quot;);\n            }\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(&quot;发布&quot;+MESSAGE_COUNT+&quot;个单独确认消息，耗时&quot;+(end - begin)+&quot;ms&quot;);\n    }\n}</pre><p id=\"u662ff4b5\" class=\"ne-p\"><br></p><p id=\"u9a18410d\" class=\"ne-p\"><br></p><p id=\"ud961b543\" class=\"ne-p\"><br></p><h2 id=\"498cf9b3\"><span class=\"ne-text\">批量发布确认</span></h2><p id=\"ue56ad038\" class=\"ne-p\"><br></p><p id=\"ub790e1b8\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638366964213-10397181-357d-4896-9e91-84690b69c982.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=137&amp;id=ude627a73&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=137&amp;originWidth=968&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=206130&amp;status=done&amp;style=none&amp;taskId=u0c3dafe3-1f66-4cc1-83ba-f5e8edae8b3&amp;title=&amp;width=968\" width=\"968\" id=\"tMsLz\" class=\"ne-image\"></p><p id=\"u31587570\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"2f62025c\" class=\"ne-codeblock language-java\">//批量发布确认\n    public static void publicMessageBatch() throws IOException, TimeoutException, InterruptedException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量确认消息大小\n        int batchSize = 100;\n        //批量发布消息， 批量发布确认\n        for (int i = 0; i &lt; MESSAGE_COUNT; i++) {\n            String message = i + &quot;&quot;;\n            channel.basicPublish(&quot;&quot;, queueName, null, message.getBytes());\n            //发布确认\n            if (i % batchSize == 0) {\n                channel.waitForConfirms();\n            }\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(&quot;发布&quot; + MESSAGE_COUNT + &quot;个批量确认消息，耗时&quot; + (end - begin) + &quot;ms&quot;);\n    }</pre><p id=\"uf3e134d2\" class=\"ne-p\"><br></p><p id=\"u47f2cb22\" class=\"ne-p\"><br></p><p id=\"u6d154a3b\" class=\"ne-p\"><br></p><h2 id=\"836eb661\"><span class=\"ne-text\">异步发布确认</span></h2><p id=\"u0f0edc87\" class=\"ne-p\"><br></p><p id=\"u494d78ca\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638368249755-46e1c3b8-f891-48b0-a77b-21b9a80f4e5e.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=119&amp;id=u5fcd19f7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=119&amp;originWidth=1189&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=231115&amp;status=done&amp;style=none&amp;taskId=u473c99f9-e088-4ad3-84e3-82e606c7d63&amp;title=&amp;width=1189\" width=\"1189\" id=\"Jwh7I\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638368124379-5cdb8cbd-707a-4a1f-92f4-3dc511a9ec11.png#clientId=u446e2507-b64d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=571&amp;id=u4b5d988b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=441&amp;originWidth=964&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=239080&amp;status=done&amp;style=none&amp;taskId=ua0b85de0-7119-4e3a-a0be-75854b9aaac&amp;title=&amp;width=1248.9931030273438\" width=\"964\" id=\"T1TVR\" class=\"ne-image\"></p><p id=\"u52c10243\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"d6247f11\" class=\"ne-codeblock language-java\">//批量发消息的个数\n    public static final int MESSAGE_COUNT = 1000;\n\n    public static void main(String[] args) throws InterruptedException, TimeoutException, IOException {\n        //1. 单个确认\n//        ConfireMessage.publicMessageIndividually(); //发布1000个单独确认消息，耗时29726ms\n//        2. 批量确认\n//        ConfireMessage.publicMessageBatch();  //发布1000个批量确认消息，耗时761ms（弊端：无法确认哪个消息未被确认）\n//        3. 异步确认\n        ConfireMessage.publicMessageAsync(); //发布1000个异步确认消息，耗时181ms\n    }\n//异步发布确认\n    public static void publicMessageAsync() throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //消息确认成功，回调函数\n        ConfirmCallback ackCallback = (deliveryTag, multiple) -&gt; {\n            System.out.println(&quot;确认的消息&quot; + deliveryTag);\n        };\n        //消息确认失败，回调函数\n        ConfirmCallback nackCallback = (deliveryTag, multiple) -&gt; {\n            System.out.println(&quot;未确认的消息&quot; + deliveryTag);\n        };\n        //准备消息的监听器，监听哪些消息成功了，哪些消息失败了\n        channel.addConfirmListener(ackCallback, nackCallback);  //异步通知\n        //异步发布确认\n        for (int i = 0; i &lt; MESSAGE_COUNT; i++) {\n            String massage = &quot;消息&quot; + i;\n            channel.basicPublish(&quot;&quot;, queueName, null, massage.getBytes());\n\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(&quot;发布&quot; + MESSAGE_COUNT + &quot;个异步确认消息，耗时&quot; + (end - begin) + &quot;ms&quot;);\n    }</pre><p id=\"uc4a48e34\" class=\"ne-p\"><br></p><p id=\"u32eb914f\" class=\"ne-p\"><br></p><p id=\"u776a938a\" class=\"ne-p\"><br></p><h2 id=\"e8b363bb\"><span class=\"ne-text\">如何处理异步未确认消息</span></h2><p id=\"ucecfe414\" class=\"ne-p\"><br></p><p id=\"uf632b3ef\" class=\"ne-p\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638404469016-06a08296-9aa6-4d65-8d1c-4c70fb4cd5b8.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=97&amp;id=u0927e367&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=97&amp;originWidth=1033&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=122865&amp;status=done&amp;style=none&amp;taskId=u67d3a3c6-2f1a-4be9-9c0c-f7d2e743935&amp;title=&amp;width=1033\" id=\"frSPr\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">上述异步确认有两个线程：</span></p><p id=\"uf8bfc172\" class=\"ne-p\"><br></p><ul class=\"ne-ul\"><li id=\"ueacc7571\"><span class=\"ne-text\">发消息的线程</span></li></ul><ul class=\"ne-ul\"><li id=\"u5e95d849\"><span class=\"ne-text\">监听器的线程</span></li></ul><p id=\"u51d043a1\" class=\"ne-p\"><br></p><p id=\"u969efa72\" class=\"ne-p\"><span class=\"ne-text\">两个线程之间交互，只能用</span><strong><span class=\"ne-text\">并发链路式队列（可以在确认发布与发布线程之间进行消息传递）</span></strong><span class=\"ne-text\">。</span></p><p id=\"u60c1e577\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"0a036573\" class=\"ne-codeblock language-java\">//异步发布确认\n    public static void publicMessageAsync() throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        String queueName = UUID.randomUUID().toString();\n        //用信道声明队列\n        channel.queueDeclare(queueName, true, false, false, null);\n        //开启发布确认\n        channel.confirmSelect();\n        /*\n        线程安全有序的哈希表，适用于高并发的情况\n        1. 轻松的将序号与消息进行关联\n        2. 轻松批量删除条目，只要给序号\n        3.支持高并发(多线程)\n         */\n        ConcurrentSkipListMap&lt;Long,String&gt; outstandingConfirms = new ConcurrentSkipListMap&lt;&gt;();\n\n        //消息确认成功，回调函数\n        ConfirmCallback ackCallback = (deliveryTag, multiple) -&gt; {\n            //2. 删除已经确认的消息   剩下的就是未确认的消息\n            if(multiple){\n                //如果是批量确认，就去批量删除\n                ConcurrentNavigableMap&lt;Long,String&gt; confirmed = outstandingConfirms.headMap(deliveryTag);\n                confirmed.clear();\n            }else{\n                //如果是单个确认，就去单个删除\n                outstandingConfirms.remove(deliveryTag);\n            }\n            System.out.println(&quot;确认的消息&quot; + deliveryTag);\n        };\n        //消息确认失败，回调函数\n        ConfirmCallback nackCallback = (deliveryTag, multiple) -&gt; {\n            //3. 打印未确认的消息有哪些\n            String message = outstandingConfirms.get(deliveryTag);\n            System.out.println(&quot;未确认的消息是：&quot;+message+&quot;:::::未确认的消息tag:&quot; + deliveryTag);\n        };\n        //准备消息的监听器，监听哪些消息成功了，哪些消息失败了\n        channel.addConfirmListener(ackCallback, nackCallback);  //异步通知\n        //开始时间\n        long begin = System.currentTimeMillis();\n        //批量发送消息\n        for (int i = 0; i &lt; MESSAGE_COUNT; i++) {\n            String message = &quot;消息&quot; + i;\n            // 1. 此处记录下所有要发送的消息  消息的总和(每发一次消息就记录一次)\n            outstandingConfirms.put(channel.getNextPublishSeqNo(),message);\n            channel.basicPublish(&quot;&quot;, queueName, null, message.getBytes());\n\n        }\n        long end = System.currentTimeMillis();\n        System.out.println(&quot;发布&quot; + MESSAGE_COUNT + &quot;个异步确认消息，耗时&quot; + (end - begin) + &quot;ms&quot;);\n    }</pre><p id=\"u24ef3936\" class=\"ne-p\"><br></p><div class=\"ne-quote\"><p id=\"u6e59d7fb\" class=\"ne-p\"><span class=\"ne-text\">以上三种发布确认速度对比：</span></p></div><p id=\"u53e9db23\" class=\"ne-p\"><br></p><ul class=\"ne-ul\"><li id=\"uafded0e5\"><span class=\"ne-text\">单独发布消息：同步等待确认，简单，但吞吐量非常有限。</span></li></ul><ul class=\"ne-ul\"><li id=\"u94b38ace\"><span class=\"ne-text\">批量发布消息：批量同步等待确认，简单，合理的吞吐量，一旦出现问题，很难推断出是哪条出现了问题</span></li></ul><ul class=\"ne-ul\"><li id=\"uc70e4029\"><span class=\"ne-text\">异步处理：最佳性能和资源利用，在出现错误的情况下，可以很好的控制，但是实现起来稍微难些。</span></li></ul><p id=\"u9569dffd\" class=\"ne-p\"><br></p><h2 id=\"04596875\"><span class=\"ne-text\">交换机</span></h2><p id=\"u2d479111\" class=\"ne-p\"><br></p><p id=\"u97889cc2\" class=\"ne-p\"><br></p><p id=\"u80d50401\" class=\"ne-p\"><br></p><h3 id=\"a3034a5f\"><span class=\"ne-text\">交换机的作用</span></h3><p id=\"u03675e5f\" class=\"ne-p\"><br></p><p id=\"u10101ef7\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638406810806-e429e00e-78d1-42e2-ab92-c3a53f8c2fa9.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=270&amp;id=uc3415ba1&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=387&amp;originWidth=1291&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=191628&amp;status=done&amp;style=none&amp;taskId=uee2f50b0-7b80-4d38-9c1b-25806445f5f&amp;title=&amp;width=900.9896240234375\" id=\"tFgNi\" class=\"ne-image\"></p><p id=\"u73fbd331\" class=\"ne-p\"><br></p><h3 id=\"f71f343d\"><span class=\"ne-text\">交换机的类型</span></h3><p id=\"ufcff41c1\" class=\"ne-p\"><br></p><ul class=\"ne-ul\"><li id=\"ud837129c\"><span class=\"ne-text\">直接（direct）== 路由类型</span></li></ul><ul class=\"ne-ul\"><li id=\"u3a192338\"><span class=\"ne-text\">主题（topic）</span></li></ul><ul class=\"ne-ul\"><li id=\"u181beacc\"><span class=\"ne-text\">标题（headers）（企业不常用）</span></li></ul><ul class=\"ne-ul\"><li id=\"ude1c64c5\"><span class=\"ne-text\">扇出（fanout）== 发布订阅类型</span></li></ul><ul class=\"ne-ul\"><li id=\"ubc65d5ac\"><span class=\"ne-text\">无名类型（默认类型），通常用空串进行识别</span></li></ul><p id=\"u7841bf48\" class=\"ne-p\"><br></p><p id=\"uabda8adb\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638407294007-f1bd9624-be98-4b90-ba72-9c29d88c326d.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=76&amp;id=u21ac6756&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=76&amp;originWidth=987&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=103665&amp;status=done&amp;style=none&amp;taskId=u47150f74-3b3b-4cc4-befe-f25d9650214&amp;title=&amp;width=987\" id=\"KlfHY\" class=\"ne-image\"></p><p id=\"uefca42b0\" class=\"ne-p\"><br></p><h3 id=\"192ebf07\"><span class=\"ne-text\">临时队列</span></h3><p id=\"u759723a3\" class=\"ne-p\"><br></p><p id=\"ua828dd89\" class=\"ne-p\"><span class=\"ne-text\">不带有持久化，一旦断开消费者的连接，队列将被自动删除。<br /></span><span class=\"ne-text\"></span></p><p id=\"u117c1c40\" class=\"ne-p\"><br></p><p id=\"udc7c1eb9\" class=\"ne-p\"><span class=\"ne-text\">创建临时队列：</span></p><p id=\"uc7d27537\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"493f5cb2\" class=\"ne-codeblock language-java\">String queueName = channel.queueDeclare().getQueue();</pre><p id=\"uf4a72fb6\" class=\"ne-p\"><br></p><p id=\"u0810dd91\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638407906977-786b78e8-bfba-4cab-9aee-9ac7ec38a884.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=278&amp;id=u31ce7deb&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=410&amp;originWidth=1086&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=55531&amp;status=done&amp;style=none&amp;taskId=ub3aa0ca4-c823-418b-b8c7-0b7fbd67333&amp;title=&amp;width=736.9896240234375\" id=\"T0K86\" class=\"ne-image\"></p><p id=\"u186f5254\" class=\"ne-p\"><br></p><h3 id=\"f4f12c7a\"><span class=\"ne-text\">绑定</span></h3><p id=\"u3f311869\" class=\"ne-p\"><br></p><p id=\"u06749896\" class=\"ne-p\"><span class=\"ne-text\">就是交换机与队列之间的捆绑关系。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638408143523-d4c904d9-33e5-46bd-ad67-885e78b4c34b.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=637&amp;id=u8140e36d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=637&amp;originWidth=487&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=26522&amp;status=done&amp;style=none&amp;taskId=ua5ea4c46-36c5-4183-aefe-f6a3f676385&amp;title=&amp;width=487\" id=\"fwITJ\" class=\"ne-image\"></p><p id=\"u2f756d95\" class=\"ne-p\"><br></p><h3 id=\"b3f97d74\"><span class=\"ne-text\">发布订阅模式（扇出模式 fanout）</span></h3><p id=\"u60ac1fb4\" class=\"ne-p\"><br></p><p id=\"u47c5c857\" class=\"ne-p\"><span class=\"ne-text\">类似广播，两个 routingkey 相同<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638408427104-577b627a-521a-4d94-89be-5bf0102440ea.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=218&amp;id=u3ae99c2f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=292&amp;originWidth=1200&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=205919&amp;status=done&amp;style=none&amp;taskId=ufe252eb8-02f2-410e-8b74-b8d091c0d4a&amp;title=&amp;width=894\" id=\"PeGnm\" class=\"ne-image\"></p><p id=\"u34a7c050\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"ua058bafa\"><span class=\"ne-text\">生产者</span></li></ol><p id=\"u527d2fcd\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"064b8440\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:59\n * 发消息：交换机\n */\npublic class EmitLog {\n    public static final String EXCHANGE_NAME = &quot;logs&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        channel.exchangeDeclare(EXCHANGE_NAME, &quot;fanout&quot;);\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(EXCHANGE_NAME, &quot;&quot;, null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(&quot;生产者发出消息：&quot; + message);\n        }\n    }\n}</pre><p id=\"ube6bfff0\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"u9725dfb0\"><span class=\"ne-text\">两个消费者</span></li></ol><p id=\"u2a01f03c\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"4ebe62a0\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:35\n */\npublic class ReceiveLogs01 {\n    //交换机的名称\n    public static final String EXCHANGE_NAME = &quot;logs&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, &quot;fanout&quot;);\n        //声明一个队列  临时队列 (生成一个临时队列，队列的名称是随机的，当消费者断开与队列的连接的时候，队列就自动删除)\n        String queueName = channel.queueDeclare().getQueue();\n        //绑定交换机与队列\n        channel.queueBind(queueName, EXCHANGE_NAME, &quot;&quot;);\n        System.out.println(&quot;等待接收消息，把接收的消息打印在屏幕上。。。。&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(&quot;ReceiveLogs01控制台接收到消息：&quot; + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(queueName, true,  deliverCallback,consumerTag-&gt;{});\n    }\n}</pre><p id=\"u7d8e0aa1\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"bd022965\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.five;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:35\n */\npublic class ReceiveLogs02 {\n    //交换机的名称\n    public static final String EXCHANGE_NAME = &quot;logs&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, &quot;fanout&quot;);\n        //声明一个队列  临时队列 (生成一个临时队列，队列的名称是随机的，当消费者断开与队列的连接的时候，队列就自动删除)\n        String queueName = channel.queueDeclare().getQueue();\n        //绑定交换机与队列\n        channel.queueBind(queueName, EXCHANGE_NAME, &quot;&quot;);\n        System.out.println(&quot;等待接收消息，把接收的消息打印在屏幕上。。。。&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(&quot;ReceiveLogs02控制台接收到消息：&quot; + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(queueName, true,  deliverCallback,consumerTag-&gt;{});\n    }\n}</pre><p id=\"ub0920585\" class=\"ne-p\"><br></p><p id=\"u9415957b\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410904168-80b297c1-26ef-4ee4-815c-065abea79bd2.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=328&amp;id=u29891926&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=328&amp;originWidth=580&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=28269&amp;status=done&amp;style=none&amp;taskId=u6700fa8b-9b2f-4717-91cf-0dfb20b528b&amp;title=&amp;width=580\" id=\"Jf7Cl\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410913426-c4d1faa3-7b8b-478c-ba35-665d73e98e8b.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=248&amp;id=ua55ed718&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=248&amp;originWidth=528&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=34020&amp;status=done&amp;style=none&amp;taskId=u415b65a3-7d21-4e16-a1a0-a15d7f3c4ca&amp;title=&amp;width=528\" id=\"HNmyl\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638410920504-2f4c6248-02a0-4765-8647-4c8ab63551e1.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=255&amp;id=u9c537a4f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=255&amp;originWidth=517&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=35282&amp;status=done&amp;style=none&amp;taskId=u97bfb701-f8bd-45ca-ac41-6f8259d9775&amp;title=&amp;width=517\" id=\"BBNfG\" class=\"ne-image\"></p><p id=\"u64f3af66\" class=\"ne-p\"><br></p><h3 id=\"a7c987c4\"><span class=\"ne-text\">直接交换机（路由模式 direct）</span></h3><p id=\"u6628277e\" class=\"ne-p\"><br></p><p id=\"uc914fe9f\" class=\"ne-p\"><span class=\"ne-text\">两个 routingkey 不相同<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638411099834-bf80fb1d-473a-4a01-8553-e47ee2cd3670.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=303&amp;id=ueba6aa41&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=303&amp;originWidth=874&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=98369&amp;status=done&amp;style=none&amp;taskId=u2145da18-8429-4959-ab30-43bcc28bb61&amp;title=&amp;width=874\" id=\"t5eGH\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">可以多重绑定。<br /></span><strong><span class=\"ne-text\">生产者发消息给队列，直接交换机通过不同 routingkey 路由到相应的队列，然后消费者接收指定日志。</span></strong></p><p id=\"u3ab1ef95\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"uf3812b97\"><span class=\"ne-text\">发消息</span></li></ol><p id=\"u7dffc5fc\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"2a901417\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Scanner;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 9:59\n * 发消息：交换机\n */\npublic class DirectLogs {\n    public static final String EXCHANGE_NAME = &quot;direct_logs&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()) {\n            String message = scanner.next();\n            channel.basicPublish(EXCHANGE_NAME, &quot;error&quot;, null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(&quot;生产者发出消息：&quot; + message);\n        }\n    }\n}</pre><p id=\"uf9ac8eab\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"ufe981695\"><span class=\"ne-text\">接收消息</span></li></ol><p id=\"uca90e43f\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"fc2f4488\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 10:15\n */\npublic class ReceiveLogsDirect01 {\n    public static final String EXCHANGE_NAME = &quot;direct_logs&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n        //声明一个队列\n        channel.queueDeclare(&quot;console&quot;,false,false,false,null);\n        channel.queueBind(&quot;console&quot;,EXCHANGE_NAME,&quot;info&quot;);\n        channel.queueBind(&quot;console&quot;,EXCHANGE_NAME,&quot;warning&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(&quot;ReceiveLogs01控制台接收到消息：&quot; + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(&quot;console&quot;, true,  deliverCallback,consumerTag-&gt;{});\n\n    }\n}</pre><p id=\"u1cc8d4b5\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"d5727d5b\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.six;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 10:15\n */\npublic class ReceiveLogsDirect02 {\n    public static final String EXCHANGE_NAME = &quot;direct_logs&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明一个交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);\n        //声明一个队列\n        channel.queueDeclare(&quot;disk&quot;,false,false,false,null);\n        channel.queueBind(&quot;disk&quot;,EXCHANGE_NAME,&quot;error&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(&quot;ReceiveLogs02控制台接收到消息：&quot; + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(&quot;disk&quot;, true,  deliverCallback,consumerTag-&gt;{});\n\n    }\n}</pre><p id=\"uab85209b\" class=\"ne-p\"><br></p><p id=\"u1a362bc4\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638413931242-2c3ef4c2-f3e6-4e6e-ba39-5437dad24d40.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=182&amp;id=u9de2b784&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=182&amp;originWidth=630&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=21691&amp;status=done&amp;style=none&amp;taskId=u7cd93b89-df35-4f94-aa33-6626b0dc70b&amp;title=&amp;width=630\" id=\"eyPPs\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638413948375-568b73ae-0203-4f53-9a9b-528667192aa2.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=182&amp;id=uc8400be0&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=182&amp;originWidth=683&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24900&amp;status=done&amp;style=none&amp;taskId=u38d71d59-3dd8-4324-9fae-335fd043524&amp;title=&amp;width=683\" id=\"U0kJT\" class=\"ne-image\"></p><p id=\"u154435a1\" class=\"ne-p\"><br></p><h3 id=\"c4e17e43\"><span class=\"ne-text\">主题交换机（Topic）</span></h3><p id=\"ubdbf1ba0\" class=\"ne-p\"><br></p><p id=\"ucae3280a\" class=\"ne-p\"><span class=\"ne-text\">规范：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638414479059-98f3dc8e-ee99-4093-b2cb-81eaecec9acb.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=226&amp;id=u34e92b6a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=226&amp;originWidth=834&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=170475&amp;status=done&amp;style=none&amp;taskId=ue217ff8b-9da9-493e-9a4b-07c6ab22bab&amp;title=&amp;width=834\" id=\"KCIOt\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415621949-8c1e4089-881d-482e-a377-ab7f224a2c92.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=257&amp;id=u76cf3ab8&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=257&amp;originWidth=801&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=151366&amp;status=done&amp;style=none&amp;taskId=u98d7748e-2fc6-4df3-a740-cae3ba06db9&amp;title=&amp;width=801\" id=\"HeQJL\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415680787-e95ef7a6-bec4-44b3-8e45-1e0c4adac6f7.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=350&amp;id=u280d2c9d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=350&amp;originWidth=829&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=181864&amp;status=done&amp;style=none&amp;taskId=u67807a72-c793-4b0b-a14e-e6270164016&amp;title=&amp;width=829\" id=\"ZuvJl\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638415855921-8e2750b0-e5df-4b1c-90a3-7e3f696543d6.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=188&amp;id=uf97e55b4&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=188&amp;originWidth=920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=178229&amp;status=done&amp;style=none&amp;taskId=ufb1118a1-0b9d-4a97-bd09-0ff626585f5&amp;title=&amp;width=920\" id=\"iZC7I\" class=\"ne-image\"></p><p id=\"u5bf7d3d8\" class=\"ne-p\"><br></p><h3 id=\"36d4697d\"><span class=\"ne-text\">主题交换机（实战）</span></h3><p id=\"ub70d80a5\" class=\"ne-p\"><br></p><p id=\"uca5a3ec7\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638416303199-5f9e655c-c5c2-4a16-9d12-ba873c31c8e6.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=331&amp;id=u07108cc7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=331&amp;originWidth=1114&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=231103&amp;status=done&amp;style=none&amp;taskId=ud57ef875-e371-4fa6-980a-20a29a7366e&amp;title=&amp;width=1114\" id=\"zgYBJ\" class=\"ne-image\"></p><p id=\"u71bf4d07\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"ub54f7556\"><span class=\"ne-text\">消费者</span></li></ol><p id=\"u39a550d2\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"1860808d\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 11:37\n * 声明主题交换机  及相关队列\n * &lt;p&gt;\n * 消费者 C2\n */\npublic class ReceiveLogsTopic01 {\n    //交换机名称\n    public static final String EXCHANGE_NAME = &quot;topic_logs&quot;;\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, &quot;topic&quot;);\n        //声明队列\n        String queueName = &quot;Q1&quot;;\n        channel.queueDeclare(queueName, false, false, false, null);\n        //交换机绑定 routingkey\n        channel.queueBind(queueName, EXCHANGE_NAME, &quot;*.orange.*&quot;);\n        System.out.println(&quot;等待接收消息。。。。。&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(new String(message.getBody(), StandardCharsets.UTF_8));\n            System.out.println(&quot;接收队列：&quot; + queueName + &quot;绑定键：&quot; + message.getEnvelope().getRoutingKey());\n        };\n        //接收消息\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -&gt; {\n        });\n    }\n\n}</pre><p id=\"ucf8d429e\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"6972b59b\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 11:37\n * 声明主题交换机  及相关队列\n * &lt;p&gt;\n * 消费者 C2\n */\npublic class ReceiveLogsTopic02 {\n    //交换机名称\n    public static final String EXCHANGE_NAME = &quot;topic_logs&quot;;\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明交换机\n        channel.exchangeDeclare(EXCHANGE_NAME, &quot;topic&quot;);\n        //声明队列\n        String queueName = &quot;Q2&quot;;\n        channel.queueDeclare(queueName, false, false, false, null);\n        //交换机绑定 routingkey\n        channel.queueBind(queueName, EXCHANGE_NAME, &quot;*.*.rabbit&quot;);\n        channel.queueBind(queueName, EXCHANGE_NAME, &quot;lazy.#&quot;);\n        System.out.println(&quot;等待接收消息。。。。。&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(new String(message.getBody(), StandardCharsets.UTF_8));\n            System.out.println(&quot;接收队列：&quot; + queueName + &quot;绑定键：&quot; + message.getEnvelope().getRoutingKey());\n        };\n        //接收消息\n        channel.basicConsume(queueName, true, deliverCallback, consumerTag -&gt; {\n        });\n    }\n\n}</pre><p id=\"ubd93dfb6\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"u9e924b7c\"><span class=\"ne-text\">生产者</span></li></ol><p id=\"u9a490197\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"56e802f3\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.seven;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.security.spec.ECField;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 14:45\n * 生产者\n */\npublic class EmitLogTopic {\n    public static final String EXCHANGE_NAME = &quot;topic_logs&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        /**\n         * 下图绑定关系如下：\n         * Q1--&gt; 绑定的是： 中间带3个单词的字符串（*.orange*）\n         * Q2--&gt; 绑定的是： 最后一个单词是rabbit的3个单词（*.*.rabbit）\n         *                第一个单词是lazy的多个单词（lazy.#）\n         */\n        Map&lt;String, String&gt; bindingKeyMap = new HashMap&lt;&gt;();\n        bindingKeyMap.put(&quot;quick.orange.rabbit&quot;, &quot;被队列Q1Q2接收到&quot;);\n        bindingKeyMap.put(&quot;lazy.orange.elephant&quot;, &quot;被队列Q1Q2接收到&quot;);\n        bindingKeyMap.put(&quot;lazy.pink.rabbit&quot;, &quot;被队列Q1接收到&quot;);\n        bindingKeyMap.put(&quot;quick.brown.fox&quot;, &quot;被队列Q2接收到&quot;);\n        bindingKeyMap.put(&quot;quick.orange.male.rabbit&quot;, &quot;虽然满足两个绑定但只被队列Q2接收一次&quot;);\n        bindingKeyMap.put(&quot;quick.brown.fox&quot;, &quot;不匹配任何绑定不会被任何队列接收到会被丢弃&quot;);\n        bindingKeyMap.put(&quot;lazy.orange.male.rabbit&quot;, &quot;是四个单词不匹配任何绑定定会丢弃&quot;);\n        bindingKeyMap.put(&quot;lazy.orange.male.rabbit&quot;, &quot;是四个单词但匹配Q2&quot;);\n\n        for (Map.Entry&lt;String, String&gt; bindingKeyEntry : bindingKeyMap.entrySet()) {\n            String routingKey = bindingKeyEntry.getKey();\n            String message = bindingKeyEntry.getValue();\n            channel.basicPublish(EXCHANGE_NAME, routingKey, null, message.getBytes(StandardCharsets.UTF_8));\n            System.out.println(&quot;生产者发出消息&quot; + message);\n        }\n    }\n}</pre><p id=\"u2545c488\" class=\"ne-p\"><br></p><p id=\"u8f7b2119\" class=\"ne-p\"><span class=\"ne-text\">先启动消费者，再启动生产者。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430253833-e55a9ffe-37a0-4c04-b7b7-093a65480f71.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=540&amp;id=u94f62b22&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=540&amp;originWidth=683&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=63817&amp;status=done&amp;style=none&amp;taskId=u846aee7e-23e7-429c-8c68-098657667fa&amp;title=&amp;width=683\" id=\"r1tul\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430292235-0a8fd8ca-fdd9-4f2e-9a52-de2398da4db4.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=548&amp;id=u5b1d2810&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=548&amp;originWidth=649&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=60902&amp;status=done&amp;style=none&amp;taskId=uf769df3d-232c-4803-866e-9b789b65799&amp;title=&amp;width=649\" id=\"p0vbD\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430299720-f401248d-7efc-425f-aff1-59f8cda3349d.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=257&amp;id=u7c6af404&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=257&amp;originWidth=674&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=33728&amp;status=done&amp;style=none&amp;taskId=u0e4568aa-d243-4696-a1eb-02eebf586cf&amp;title=&amp;width=674\" id=\"Axrk6\" class=\"ne-image\"></p><p id=\"u8c98ba91\" class=\"ne-p\"><br></p><h2 id=\"3dead64c\"><span class=\"ne-text\">死信队列</span></h2><p id=\"u1870ddac\" class=\"ne-p\"><br></p><p id=\"ub7284874\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430356782-4196f6b8-209f-489a-a5e5-e61974e711ef.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=299&amp;id=ud95905f1&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=299&amp;originWidth=1069&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=430772&amp;status=done&amp;style=none&amp;taskId=ue469e4ea-c3e9-44f2-a5e6-4ac2443deba&amp;title=&amp;width=1069\" id=\"ZL2Da\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430504276-84f3e02c-d80f-4fe9-9b9a-b8d9ac3b8290.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=298&amp;id=u8670c10d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=298&amp;originWidth=643&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=162345&amp;status=done&amp;style=none&amp;taskId=ue72cf50e-a8d2-4f86-8a8f-e35ebf10e89&amp;title=&amp;width=643\" id=\"rBdXQ\" class=\"ne-image\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638430601814-eb3112b8-d77b-4213-ad2c-df3c394a36b7.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=553&amp;id=ufda1712c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=553&amp;originWidth=1136&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=162361&amp;status=done&amp;style=none&amp;taskId=u55e88e2a-dc14-44b5-9eb9-8663773f317&amp;title=&amp;width=1136\" id=\"pQqf7\" class=\"ne-image\"></p><p id=\"uad6c0443\" class=\"ne-p\"><br></p><ul class=\"ne-ul\"><li id=\"uc3ccb3d3\"><span class=\"ne-text\">消费者 1：</span></li></ul><p id=\"u3530fd70\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"6b32ccf8\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 15:40\n * 死信队列\n * 消费者1\n */\npublic class Consumer01 {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = &quot;normal_exchange&quot;;\n    //死信队列的名称\n    public static final String DEAD_EXCHANGE = &quot;dead_exchange&quot;;\n    //普通队列的名称\n    public static final String NORMAL_QUEUE = &quot;normal_queue&quot;;\n    //死信队列的名称\n    public static final String DEAD_QUEUE = &quot;dead_queue&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明死信和普通交换机， 类型为direct\n        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);\n        channel.exchangeDeclare(DEAD_EXCHANGE, BuiltinExchangeType.DIRECT);\n        //声明普通队列\n        Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();\n        //过期时间\n//        arguments.put(&quot;x-message-ttl&quot;,10000);\n        //正常队列设置死信交换机\n        arguments.put(&quot;x-dead-letter-exchange&quot;, DEAD_EXCHANGE);\n        //设置死信RoutingKey\n        arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;lisi&quot;);\n        //设置正常队列的长度的限制\n//        arguments.put(&quot;x-max-length&quot;, 19);\n        channel.queueDeclare(NORMAL_QUEUE, false, false, false, arguments);\n        ///////////////////////////////////////////////////\n        //声明死信队列\n        channel.queueDeclare(DEAD_QUEUE, false, false, false, null);\n        //交换机与队列绑定\n        //绑定普通交换机与普通队列\n        channel.queueBind(NORMAL_QUEUE, NORMAL_EXCHANGE, &quot;zhangsan&quot;);\n        //绑定死信交换机与死信队列\n        channel.queueBind(DEAD_QUEUE, DEAD_EXCHANGE, &quot;lisi&quot;);\n        System.out.println(&quot;等待接收消息.........&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            String msg = new String(message.getBody(), StandardCharsets.UTF_8);\n            if (msg.equals(&quot;info5&quot;)) {\n                System.out.println(&quot;此消息被C1拒绝的&quot; + msg);\n                //拒绝此消息，并且不放回队列中。因此成为死信\n                channel.basicReject(message.getEnvelope().getDeliveryTag(), false);\n            } else {\n                System.out.println(&quot;Consumer01接收的消息&quot; + msg);\n                //不批量应答\n                channel.basicAck(message.getEnvelope().getDeliveryTag(), false);\n            }\n        };\n        //开启手动应答（如果不开启手动应答，就不存在拒绝了）\n        channel.basicConsume(NORMAL_QUEUE, false, deliverCallback, consumerTag -&gt; {\n        });\n    }\n}</pre><p id=\"u435ef8b3\" class=\"ne-p\"><br></p><ul class=\"ne-ul\"><li id=\"u991e0c89\"><span class=\"ne-text\">消费者 2：</span></li></ul><p id=\"ufa7c436f\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"0aee91a1\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.DeliverCallback;\n\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 15:40\n * 死信队列\n * 消费者2\n */\npublic class Consumer02 {\n    //死信队列的名称\n    public static final String DEAD_QUEUE = &quot;dead_queue&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        System.out.println(&quot;等待接收消息.........&quot;);\n        //接收消息\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(&quot;Consumer02接收的消息&quot; + new String(message.getBody(), StandardCharsets.UTF_8));\n        };\n        channel.basicConsume(DEAD_QUEUE, false, deliverCallback, consumerTag -&gt; {\n\n        });\n    }\n}</pre><p id=\"ud595d97e\" class=\"ne-p\"><br></p><ul class=\"ne-ul\"><li id=\"u2bd56aa9\"><span class=\"ne-text\">生产者：</span></li></ul><p id=\"u44801151\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"1656143b\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 16:13\n * 死信队列-生产者\n */\npublic class Producer {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = &quot;normal_exchange&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //死信时间  设置ttl时间\n        AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().expiration(&quot;10000&quot;).build();\n        for (int i = 1; i &lt; 11; i++) {\n            String message = &quot;info&quot; + i;\n            channel.basicPublish(NORMAL_EXCHANGE, &quot;zhangsan&quot;, properties, message.getBytes());\n        }\n    }\n}</pre><p id=\"u6e029386\" class=\"ne-p\"><br></p><p id=\"u5a3eb9d2\" class=\"ne-p\"><span class=\"ne-text\">测试步骤：</span></p><p id=\"uba408812\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"u835dcc9d\"><span class=\"ne-text\">运行消费者：会发现普通和死信交换机已经绑定各自的队列。</span></li></ol><p id=\"u058f5168\" class=\"ne-p\"><br></p><p id=\"u9ebcebd9\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638445377947-e4a087d0-b755-4178-aa6d-7ae082107bb0.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=495&amp;id=ud91030e8&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=495&amp;originWidth=541&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23775&amp;status=done&amp;style=none&amp;taskId=u8f85c23d-a811-41b4-a478-a20609fc50a&amp;title=&amp;width=541\" id=\"xwjE9\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638445475857-ba40932b-588f-43d3-b3a6-5f2660bcd241.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=498&amp;id=ub28b2410&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=498&amp;originWidth=601&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=25129&amp;status=done&amp;style=none&amp;taskId=u8de3a461-08ce-49b9-9936-e0cf7fa1363&amp;title=&amp;width=601\" id=\"Jcymv\" class=\"ne-image\"></p><p id=\"u62f48d77\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"u09f241e0\"><span class=\"ne-text\">测试</span><strong><span class=\"ne-text\">队列达到最大长度</span></strong><span class=\"ne-text\">，关闭消费者 1 和 2，开启生产者：消息会积压在队列中，消费者 1 所在的普通队列消息限制有 6 条，剩下的 4 条会进入消费者 2 所在的死信队列。如下图所示：</span></li></ol><p id=\"u9dbb6efd\" class=\"ne-p\"><br></p><p id=\"ud3960aab\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638448087379-8c4e5c46-39ca-49fd-8024-4111b0a5d431.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=571&amp;id=u9eb9c88a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=571&amp;originWidth=1083&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=79389&amp;status=done&amp;style=none&amp;taskId=ua5f78b60-fd26-4cb8-9cf8-f0e0f17270b&amp;title=&amp;width=1083\" id=\"s5bzi\" class=\"ne-image\"></p><p id=\"ue98b05db\" class=\"ne-p\"><br></p><ol start=\"3\" class=\"ne-ol\"><li id=\"uc5b05a1e\"><span class=\"ne-text\">取消普通队列的最大长度限制，测试</span><strong><span class=\"ne-text\">消息 ttl 过期</span></strong><span class=\"ne-text\">：关闭消费者 1 和 2，开启生产者发送消息。（消息会因为没人接收，会在 ttl 时间内积压在普通队列中， ttl 过期后，消息会进入死信队列中。）</span></li></ol><p id=\"u66bade46\" class=\"ne-p\"><br></p><p id=\"u12585112\" class=\"ne-p\"><span class=\"ne-text\">生产者：</span></p><p id=\"u60d2c488\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"1656143b-1\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.eight;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\n\nimport java.io.IOException;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 16:13\n * 死信队列-生产者\n */\npublic class Producer {\n    //普通交换机的名称\n    public static final String NORMAL_EXCHANGE = &quot;normal_exchange&quot;;\n\n    public static void main(String[] args) throws IOException, TimeoutException {\n        Channel channel = RabbitMqUtils.getChannel();\n        //死信时间  设置ttl时间\n        AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().expiration(&quot;10000&quot;).build();\n        for (int i = 1; i &lt; 11; i++) {\n            String message = &quot;info&quot; + i;\n            channel.basicPublish(NORMAL_EXCHANGE, &quot;zhangsan&quot;, properties, message.getBytes());\n        }\n    }\n}</pre><p id=\"ufcc5276d\" class=\"ne-p\"><br></p><ol start=\"4\" class=\"ne-ol\"><li id=\"u3643f27c\"><span class=\"ne-text\">测试</span><strong><span class=\"ne-text\">消息被拒</span></strong><span class=\"ne-text\">：</span></li></ol><p id=\"u1325a418\" class=\"ne-p\"><br></p><p id=\"u1e4cfe0d\" class=\"ne-p\"><span class=\"ne-text\">开启消费者 1 和 2，再开启生产者。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450659287-e191b69a-07c6-4d5e-8f54-05d22263a235.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=274&amp;id=u03d42d3b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=274&amp;originWidth=642&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32103&amp;status=done&amp;style=none&amp;taskId=uf69d66f1-feae-4ff6-83ca-af7f8a83127&amp;title=&amp;width=642\" id=\"jR4qW\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450668535-06aa1842-3563-455e-bb20-6376694fae1f.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=202&amp;id=u33f7f3ac&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=202&amp;originWidth=616&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=23460&amp;status=done&amp;style=none&amp;taskId=ua7a303f7-25d6-4fc0-8d46-d522a51ded6&amp;title=&amp;width=616\" id=\"vAYSS\" class=\"ne-image\"></p><p id=\"u56fa6a3a\" class=\"ne-p\"><br></p><h2 id=\"38e2258c\"><span class=\"ne-text\">延迟队列（基于死信队列）</span></h2><p id=\"uaeb50e00\" class=\"ne-p\"><br></p><p id=\"uce6f04f4\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638450862631-363c8d24-6a72-463a-b827-201e6f79cb79.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=128&amp;id=u8aa7212b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=128&amp;originWidth=1081&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=190603&amp;status=done&amp;style=none&amp;taskId=ue97c71c8-4947-4c82-be00-e98e36ba920&amp;title=&amp;width=1081\" id=\"xrjpE\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638451047144-5f4983f1-3a0e-472b-95f3-26635a911749.png#clientId=u268c19fe-902d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=399&amp;id=ud5620b6f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=399&amp;originWidth=869&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=265988&amp;status=done&amp;style=none&amp;taskId=ub1f53a1e-1377-4e43-ab1d-13e29cf4118&amp;title=&amp;width=869\" id=\"O4W2R\" class=\"ne-image\"></p><p id=\"u003e5655\" class=\"ne-p\"><br></p><h3 id=\"5bff6472\"><span class=\"ne-text\">整合 SpringBoot</span></h3><p id=\"ua9246d88\" class=\"ne-p\"><br></p><p id=\"u17c7855e\" class=\"ne-p\"><br></p><p id=\"u37d8ad14\" class=\"ne-p\"><br></p><h4 id=\"73ad366e\"><span class=\"ne-text\">实现延迟队列：</span></h4><p id=\"u50e8e4bb\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"ue7753788\"><span class=\"ne-text\">依赖：</span></li></ol><p id=\"u3122c714\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"73700fd7\" class=\"ne-codeblock language-java\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;\n         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;parent&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;\n        &lt;version&gt;2.6.1&lt;/version&gt;\n        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;\n    &lt;/parent&gt;\n    &lt;groupId&gt;com.atguigu.rabbitmq&lt;/groupId&gt;\n    &lt;artifactId&gt;springboot-rabbitmq&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;springboot-rabbitmq&lt;/name&gt;\n    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;\n    &lt;properties&gt;\n        &lt;java.version&gt;1.8&lt;/java.version&gt;\n    &lt;/properties&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;\n            &lt;version&gt;2.6.1&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;\n        &lt;!--web服务器，可以自启动--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n            &lt;version&gt;2.6.1&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!--快速进行json转换--&gt;\n        &lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;\n            &lt;version&gt;1.2.78&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.springfox&lt;/groupId&gt;\n            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;\n            &lt;version&gt;3.0.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;io.springfox&lt;/groupId&gt;\n            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;\n            &lt;version&gt;3.0.0&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/org.springframework.amqp/spring-rabbit-test --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.amqp&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-rabbit-test&lt;/artifactId&gt;\n            &lt;version&gt;2.4.0&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n        &lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;version&gt;1.18.22&lt;/version&gt;\n            &lt;scope&gt;provided&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n\n    &lt;build&gt;\n        &lt;plugins&gt;\n            &lt;plugin&gt;\n                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;\n            &lt;/plugin&gt;\n        &lt;/plugins&gt;\n    &lt;/build&gt;\n\n&lt;/project&gt;</pre><p id=\"uc2b4899d\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"u1245e541\"><span class=\"ne-text\">yml 配置文件：</span></li></ol><p id=\"u73830d88\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"c4ed4d31\" class=\"ne-codeblock language-java\">spring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123</pre><p id=\"uc99c78c6\" class=\"ne-p\"><br></p><ol start=\"3\" class=\"ne-ol\"><li id=\"u7aebac69\"><span class=\"ne-text\">swagger 配置类：</span></li></ol><p id=\"u0ccd9e4c\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"e6248552\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.context.annotation.Bean;\nimport springfox.documentation.builders.ApiInfoBuilder;\nimport springfox.documentation.service.ApiInfo;\nimport springfox.documentation.service.Contact;\nimport springfox.documentation.spi.DocumentationType;\nimport springfox.documentation.spring.web.plugins.Docket;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/2 22:34\n */\npublic class SwaggerConfig {\n    @Bean\n    public Docket webApiConfig() {\n        return new Docket(DocumentationType.SWAGGER_2)\n                .groupName(&quot;webApi&quot;)\n                .apiInfo(webApiInfo())\n                .select()\n                .build();\n    }\n\n    private ApiInfo webApiInfo() {\n        return new ApiInfoBuilder()\n                .title(&quot;rabbitmq  接口文档&quot;)\n                .description(&quot; 本文档描述了 rabbitmq  微服务接口定义&quot;)\n                .version(&quot;1.0&quot;)\n                .contact(new Contact(&quot;enjoy6288&quot;, &quot;http://atguigu.com&quot;,\n                        &quot;1846015350@qq.com&quot;))\n                .build();\n    }\n}</pre><p id=\"u5da333d3\" class=\"ne-p\"><br></p><p id=\"u737ba50b\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638490298754-a2b1ced5-676b-4f68-86e0-31f05266088f.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=215&amp;id=u8ba627f6&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=215&amp;originWidth=1100&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=132048&amp;status=done&amp;style=none&amp;taskId=ud9c3f28a-b8df-44d1-b9df-dc90c70e046&amp;title=&amp;width=1100\" id=\"Iv7m8\" class=\"ne-image\"></p><p id=\"u13d19082\" class=\"ne-p\"><br></p><ol start=\"4\" class=\"ne-ol\"><li id=\"uce104d61\"><span class=\"ne-text\">声明队列配置文件：</span></li></ol><p id=\"u0de2ea78\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"34c7bc48\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 8:15\n * TTL队列，  配置文件类代码\n */\n@Configuration\npublic class TtlQueueConfig {\n    //普通交换机的名称\n    public static final String X_EXCHANGE = &quot;X&quot;;\n    //死信交换机的名称\n    public static final String Y_DEAD_LETTER_EXCHANGE = &quot;Y&quot;;\n    //普通队列的名称\n    public static final String QUEUE_A = &quot;QA&quot;;\n    public static final String QUEUE_B = &quot;QB&quot;;\n    //死信队列的名称\n    public static final String DEAD_LETTER_QUEUE = &quot;QD&quot;;\n\n    //声明xExchange 别名\n    @Bean(&quot;xExchange&quot;)\n    public DirectExchange xExchange() {\n        return new DirectExchange(X_EXCHANGE);\n    }\n\n    @Bean(&quot;yExchange&quot;)\n    public DirectExchange yExchange() {\n        return new DirectExchange(Y_DEAD_LETTER_EXCHANGE);\n    }\n\n    //声明普通队列  ttl为10s\n    @Bean(&quot;queueA&quot;)\n    public Queue queueA() {\n        Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;(3);\n        //设置死信交换机\n        arguments.put(&quot;x-dead-letter-exchange&quot;, Y_DEAD_LETTER_EXCHANGE);\n        //设置死信 routing-key\n        arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;YD&quot;);\n        //设置ttl  单位为ms\n        arguments.put(&quot;x-message-ttl&quot;, 10000);\n        return QueueBuilder.durable(QUEUE_A).withArguments(arguments).build();\n    }\n\n    //声明普通队列  ttl为40s\n    @Bean(&quot;queueB&quot;)\n    public Queue queueB() {\n        Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;(3);\n        //设置死信交换机\n        arguments.put(&quot;x-dead-letter-exchange&quot;, Y_DEAD_LETTER_EXCHANGE);\n        //设置死信 routing-key\n        arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;YD&quot;);\n        //设置ttl  单位为ms\n        arguments.put(&quot;x-message-ttl&quot;, 40000);\n        return QueueBuilder.durable(QUEUE_B).withArguments(arguments).build();\n    }\n\n    //死信队列\n    @Bean(&quot;queueD&quot;)\n    public Queue queueD() {\n        return QueueBuilder.durable(DEAD_LETTER_QUEUE).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueABindingX(@Qualifier(&quot;queueA&quot;) Queue queueA, @Qualifier(&quot;xExchange&quot;) DirectExchange xExchange) {\n        return BindingBuilder.bind(queueA).to(xExchange).with(&quot;XA&quot;);\n    }\n\n    @Bean\n    public Binding queueBBindingX(@Qualifier(&quot;queueB&quot;) Queue queueB, @Qualifier(&quot;xExchange&quot;) DirectExchange xExchange) {\n        return BindingBuilder.bind(queueB).to(xExchange).with(&quot;XB&quot;);\n    }\n\n    @Bean\n    public Binding queueDBindingY(@Qualifier(&quot;queueD&quot;) Queue queueD, @Qualifier(&quot;yExchange&quot;) DirectExchange yExchange) {\n        return BindingBuilder.bind(queueD).to(yExchange).with(&quot;YD&quot;);\n    }\n}</pre><p id=\"u7e4c585b\" class=\"ne-p\"><br></p><ol start=\"5\" class=\"ne-ol\"><li id=\"u9edbfaeb\"><span class=\"ne-text\">消费者：接收消息</span></li></ol><p id=\"u938e6661\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"2d9d521e\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.rabbitmq.client.Channel;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 9:01\n * 队列ttl 消费者\n */\n@Slf4j\n@Component\npublic class DeadLetterQueueConsumer {\n\n    //接收消息\n    @RabbitListener(queues = &quot;QD&quot;)\n    public void receiveD(Message message, Channel channel) {\n        String msg = new String(message.getBody());\n        log.info(&quot;当前时间：{}，收到死信队列的消息：{}&quot;, new Date().toString(), msg);\n    }\n}</pre><p id=\"u5ff8aeb7\" class=\"ne-p\"><br></p><ol start=\"6\" class=\"ne-ol\"><li id=\"uf7ea6cd6\"><span class=\"ne-text\">发送消息：Controller</span></li></ol><p id=\"u4710b98f\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"acb0bddc\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 8:47\n * 发送延迟消息\n * &lt;p&gt;\n * http://localhost:8080/ttl/sendMsg/嘻嘻嘻\n */\n@Slf4j\n@RestController\n@RequestMapping(&quot;/ttl&quot;)\npublic class SendMsgController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //开始发消息\n    @GetMapping(&quot;/sendMsg/{message}&quot;)\n    public void sendMsg(@PathVariable String message) {\n        log.info(&quot;当前时间：{}，发送一条消息给两个ttl队列:{}&quot;, new Date().toString(), message);\n        rabbitTemplate.convertAndSend(&quot;X&quot;, &quot;XA&quot;, &quot;消息来自ttl为10s的队列&quot; + message);\n        rabbitTemplate.convertAndSend(&quot;X&quot;, &quot;XB&quot;, &quot;消息来自ttl为40s的队列&quot; + message);\n    }\n}</pre><p id=\"uca8b3875\" class=\"ne-p\"><br></p><p id=\"u436ca17c\" class=\"ne-p\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">访问：</span><a href=\"http://localhost:8080/ttl/sendMsg/\" data-href=\"http://localhost:8080/ttl/sendMsg/\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">http://localhost:8080/ttl/sendMsg/</span></a><span class=\"ne-text\">嘻嘻嘻<br /></span><span class=\"ne-text\">控制台打印结果：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638494307481-a59aaddb-4efb-4200-9e05-0e34602ded36.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=202&amp;id=u66541ef9&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=202&amp;originWidth=1365&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=62756&amp;status=done&amp;style=none&amp;taskId=ua128108f-eaa5-47fc-ab0d-e56fe3f57f4&amp;title=&amp;width=1365\" id=\"tO8el\" class=\"ne-image\"></p><p id=\"uafa127ba\" class=\"ne-p\"><br></p><h4 id=\"5d575387\"><span class=\"ne-text\">延迟队列优化：</span></h4><p id=\"u6257e7bc\" class=\"ne-p\"><br></p><p id=\"uf1945132\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638494906968-c2a2e16a-a5b3-4c44-83bc-5846e35977d0.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=333&amp;id=u5def25ea&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=333&amp;originWidth=1070&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=169463&amp;status=done&amp;style=none&amp;taskId=uede9888d-c22a-46c9-a810-c9c1899d23a&amp;title=&amp;width=1070\" id=\"PCbH9\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">增加一个 QC 普通队列声明后并绑定交换机 XC。<br /></span><span class=\"ne-text\">队列配置 中添加：</span></p><p id=\"u1c33e394\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"a7ebc7ee\" class=\"ne-codeblock language-java\">//--------------------------------优化延迟队列-------------------------------------\n    //普通队列的名称（为了优化延迟队列）\n    public static final String QUEUE_C = &quot;QC&quot;;\n\n    //声明QC\n    @Bean(&quot;queueC&quot;)\n    public Queue queueC() {\n        Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;(2);\n        //设置死信交换机\n        arguments.put(&quot;x-dead-letter-exchange&quot;, Y_DEAD_LETTER_EXCHANGE);\n        //设置死信routing-key\n        arguments.put(&quot;x-dead-letter-routing-key&quot;, &quot;YD&quot;);\n        return QueueBuilder.durable(QUEUE_C).withArguments(arguments).build();\n    }\n\n    //绑定普通队列QC和交换机\n    @Bean\n    public Binding queueCBindingX(@Qualifier(&quot;queueC&quot;) Queue queueC,\n                                  @Qualifier(&quot;xExchange&quot;) DirectExchange xExchange) {\n        return BindingBuilder.bind(queueC).to(xExchange).with(&quot;XC&quot;);\n    }\n    //-----------------------------------优化延迟队列----------------------------------</pre><p id=\"u9bde3c53\" class=\"ne-p\"><br></p><p id=\"u6870970c\" class=\"ne-p\"><span class=\"ne-text\">添加 Controller 发消息控制器：</span></p><p id=\"u69dff3a4\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"37e62688\" class=\"ne-codeblock language-java\">//开始发消息  消息ttl\n    @GetMapping(&quot;/sendExpireMsg/{message}/{ttlTime}&quot;)\n    public void sendMsg(@PathVariable String message, @PathVariable String ttlTime) {\n        log.info(&quot;当前时间：{}，发送一条时长{}毫秒，ttl信息给队列QC:{}&quot;, new Date().toString(), ttlTime, message);\n        rabbitTemplate.convertAndSend(&quot;X&quot;, &quot;XC&quot;, message, msg -&gt; {\n            //发送消息的时候  延迟时长\n            msg.getMessageProperties().setExpiration(ttlTime);\n            return msg;\n        });\n    }</pre><p id=\"uba0c942f\" class=\"ne-p\"><br></p><p id=\"u44e0ad88\" class=\"ne-p\"><span class=\"ne-text\">测试：</span></p><p id=\"u8f450987\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"ub256f62c\"><span class=\"ne-text\">http://localhost:8080/ttl/sendExpireMsg/你好 1/20000</span></li></ol><ol start=\"2\" class=\"ne-ol\"><li id=\"u25a98c39\"><span class=\"ne-text\">http://localhost:8080/ttl/sendExpireMsg/你好 2/2000</span></li></ol><p id=\"u0b67b6a7\" class=\"ne-p\"><br></p><p id=\"ub6ce48d7\" class=\"ne-p\"><span class=\"ne-text\">结果：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638517312025-dfbbfd0b-a82c-4432-a395-2e7cc7c6e48f.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=149&amp;id=u18e59259&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=149&amp;originWidth=1285&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=42107&amp;status=done&amp;style=none&amp;taskId=uff6fb06a-df03-451f-b886-52364055048&amp;title=&amp;width=1285\" id=\"efjYm\" class=\"ne-image\"></p><p id=\"u23f2f74f\" class=\"ne-p\"><br></p><h2 id=\"d0cad89d\"><span class=\"ne-text\">延迟队列（基于插件）</span></h2><p id=\"u81531559\" class=\"ne-p\"><br></p><p id=\"ufd1c2e21\" class=\"ne-p\"><span class=\"ne-text\">进入 rabbitmq 安装目录下的 plugins 目录 ，cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins<br /></span><span class=\"ne-text\">执行命令让该插件生效：rabbitmq-plugins enable rabbitmq_delayed_message_exchange<br /></span><span class=\"ne-text\">然后重启 rabbitmq：systemctl restart rabbitmq-server<br /></span><span class=\"ne-text\">会发现交换机多了一个新类型，意味着延迟消息将由交换机来完成，而不是队列。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638519642120-f3258006-3639-4551-805e-26bbd1e67c85.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=530&amp;id=u66b7d498&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=767&amp;originWidth=690&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=56472&amp;status=done&amp;style=none&amp;taskId=u707609ca-e368-4b6c-9833-ec8cc57ca15&amp;title=&amp;width=477.00006103515625\" id=\"PD1AH\" class=\"ne-image\"><span class=\"ne-text\"><br /><br /><br /></span><span class=\"ne-text\">原来的情况：基于死信<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520455616-cfcde47e-bee3-4ef6-83b6-6630dbe54d9a.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=443&amp;id=ua9957719&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=601&amp;originWidth=1033&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=226301&amp;status=done&amp;style=none&amp;taskId=ua95f3b09-635a-4782-abfd-57901f34a8b&amp;title=&amp;width=760.9862060546875\" id=\"UOPGa\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">现在：基于延迟插件<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520591056-7591eaf6-b99f-4059-8cbb-6a6ee0ea64f2.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=177&amp;id=u11577081&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=224&amp;originWidth=976&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=94107&amp;status=done&amp;style=none&amp;taskId=u47b17a31-4f94-4f3c-a75f-2014f181765&amp;title=&amp;width=770.9896240234375\" id=\"a4gyh\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">代码架构：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638520764180-7b9e927e-1166-470d-ac32-dda16bb87ae1.png#clientId=u7522214d-0203-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=188&amp;id=ud9b4ba5b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=188&amp;originWidth=1062&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=84300&amp;status=done&amp;style=none&amp;taskId=u12c568cb-6151-4b2f-8f49-3f721530b6d&amp;title=&amp;width=1062\" id=\"cPAio\" class=\"ne-image\"></p><p id=\"u2537b866\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"u54cbff16\"><span class=\"ne-text\">配置类</span></li></ol><p id=\"ucf6f84e6\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"576e3b9e\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 16:41\n */\n@Configuration\npublic class DelayedQueueConfig {\n    //队列\n    public static final String DELAYED_QUEUE_NAME = &quot;delayed.name&quot;;\n    //交换机\n    public static final String DELAYED_EXCHANGE_NAME = &quot;delayed.exchange&quot;;\n    //routing-key\n    public static final String DELAYED_ROUTING_KEY = &quot;delayed.routingkey&quot;;\n\n    //声明队列\n    @Bean\n    public Queue delayedQueue() {\n        return QueueBuilder.durable(DELAYED_QUEUE_NAME).build();\n    }\n\n    //声明交换机 基于插件\n    @Bean\n    public CustomExchange delayedExchange() {\n        Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();\n        arguments.put(&quot;x-delayed-type&quot;, &quot;direct&quot;);\n        /**\n         * 1. 交换机的名称\n         * 2. 交换机的类型\n         * 3. 是否需要持久化\n         * 4. 是否需要自动删除\n         * 5. 其他的参数\n         */\n        return new CustomExchange(DELAYED_EXCHANGE_NAME, &quot;x-delayed-message&quot;, true, false, arguments);\n    }\n\n    //绑定\n    @Bean\n    public Binding delayedQueueBindingDelayedExchange(@Qualifier(&quot;delayedQueue&quot;) Queue delayedQueue,\n                                                      @Qualifier(&quot;delayedExchange&quot;) CustomExchange delayedExchange) {\n        return BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();\n    }\n}</pre><p id=\"u88264fd1\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"ue3e31a7b\"><span class=\"ne-text\">Controller 生产者：</span></li></ol><p id=\"u4fdb5ab5\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"eb8d3858\" class=\"ne-codeblock language-java\">//发消息  基于延迟插件\n    @GetMapping(&quot;/sendDelayMsg/{message}/{delayTime}&quot;)\n    public void sendMsg(@PathVariable String message, @PathVariable Integer delayTime) {\n        log.info(&quot;当前时间:{},发送一条时长{}毫秒信息给延迟队列delayed.queue:{}&quot;, new Date().toString(), delayTime, message);\n        rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME, DelayedQueueConfig.DELAYED_ROUTING_KEY, message, msg -&gt; {\n            //发送消息的时候   延迟时长  单位：ms\n            msg.getMessageProperties().setDelay(delayTime);\n            return msg;\n        });\n    }</pre><p id=\"uaa1f405b\" class=\"ne-p\"><br></p><ol start=\"3\" class=\"ne-ol\"><li id=\"u4e37ad14\"><span class=\"ne-text\">消费者：</span></li></ol><p id=\"u8e368a72\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"20ede713\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.DelayedQueueConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Date;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 19:36\n * 消费者 基于插件的延迟消息\n */\n@Slf4j\n@Component\npublic class DelayQueueConsumer {\n    //监听消息\n    @RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE_NAME)\n    public void receiveDelayQueue(Message message) {\n        String msg = new String(message.getBody());\n        log.info(&quot;当前时间:{},收到延迟队列的消息：{}&quot;, new Date().toString(), msg);\n    }\n}</pre><p id=\"uc629c46a\" class=\"ne-p\"><br></p><p id=\"u7f843083\" class=\"ne-p\"><span class=\"ne-text\">测试：<br /></span><span class=\"ne-text\">发起请求：</span><a href=\"http://localhost:8080/ttl/sendDelayMsg/com\" data-href=\"http://localhost:8080/ttl/sendDelayMsg/com\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">http://localhost:8080/ttl/sendDelayMsg/com</span></a><span class=\"ne-text\"> on baby1/20000<br /></span><span class=\"ne-text\"> </span><a href=\"http://localhost:8080/ttl/sendDelayMsg/com\" data-href=\"http://localhost:8080/ttl/sendDelayMsg/com\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">http://localhost:8080/ttl/sendDelayMsg/com</span></a><span class=\"ne-text\"> on baby2/2000<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638532349237-315b969f-d021-4448-8aa8-d5a1d41950a0.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=208&amp;id=uf33e7fe7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=208&amp;originWidth=1432&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=71640&amp;status=done&amp;style=none&amp;taskId=ue722c22b-16d9-40a2-9a28-e95348df5d0&amp;title=&amp;width=1432\" id=\"P79jF\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638532663153-40afab72-d363-4536-94fc-4889e40d764b.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=224&amp;id=u7813c3ed&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=266&amp;originWidth=1121&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=457006&amp;status=done&amp;style=none&amp;taskId=u0e4002d8-2179-43cc-bcfd-7c69cd127b5&amp;title=&amp;width=941.9896240234375\" id=\"aEVGf\" class=\"ne-image\"></p><p id=\"u816be002\" class=\"ne-p\"><br></p><h2 id=\"d338501f\"><span class=\"ne-text\">发布确认高级</span></h2><p id=\"u78a1b073\" class=\"ne-p\"><br></p><p id=\"ue1d328fd\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638533419869-3aa9b7ad-ee4e-4fd8-9e42-fd6af4aafe70.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=225&amp;id=u7ed4e098&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=341&amp;originWidth=945&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=186643&amp;status=done&amp;style=none&amp;taskId=uc65852ff-c2a9-416e-bef6-2991c80fa8b&amp;title=&amp;width=623.0000610351562\" id=\"OAmnb\" class=\"ne-image\"><span class=\"ne-text\"> <br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638533456413-9ead4e1d-f118-4a55-8d05-bcdd4d5fc47f.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=131&amp;id=u954992f9&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=144&amp;originWidth=839&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=73103&amp;status=done&amp;style=none&amp;taskId=u9819bc42-f398-487a-b319-358e2acd1ba&amp;title=&amp;width=762.9931030273438\" id=\"sjopK\" class=\"ne-image\"></p><p id=\"ua0b992e2\" class=\"ne-p\"><br></p><h3 id=\"3f64dd13\"><span class=\"ne-text\">回调接口 : (若交换机收不到消息)</span></h3><p id=\"uc0c6652d\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"uf961977a\"><span class=\"ne-text\">配置类</span></li></ol><p id=\"u1415f6ed\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"2a45d705\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:15\n * 配置类  发布确认 （高级）\n */\n@Configuration\npublic class ConfirmConfig {\n    //交换机\n    public static final String CONFIRM_EXCHANGE_NAME = &quot;confirm_exchange&quot;;\n    //队列\n    public static final String CONFIRM_QUEUE_NAME = &quot;confirm_queue&quot;;\n    //routing-key\n    public static final String CONFIRM_ROUTING_KEY = &quot;key1&quot;;\n\n    //声明交换机\n    @Bean\n    public DirectExchange confirmExchange() {\n        return new DirectExchange(CONFIRM_EXCHANGE_NAME);\n    }\n\n    //声明队列\n    @Bean\n    public Queue confirmQueue() {\n        return QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueBindingExchange(@Qualifier(&quot;confirmQueue&quot;) Queue confirmQueue,\n                                        @Qualifier(&quot;confirmExchange&quot;) DirectExchange confirmExchange) {\n        return BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);\n    }\n}</pre><p id=\"u4ecde0f6\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"ua5227561\"><span class=\"ne-text\">生产者：发消息</span></li></ol><p id=\"ub699d97d\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"7ba8c971\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:27\n * 开始发消息\n */\n@Slf4j\n@RestController\n@RequestMapping(&quot;/confirm&quot;)\npublic class ProducerController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //发消息\n    @GetMapping(&quot;/sendMessage/{message}&quot;)\n    public void sendMessage(@PathVariable String message) {\n        CorrelationData correlationData = new CorrelationData(&quot;1&quot;);\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME, ConfirmConfig.CONFIRM_ROUTING_KEY, message, correlationData);\n        log.info(&quot;发送消息内容为：{}&quot;, message);\n    }\n}</pre><p id=\"ua928c4f5\" class=\"ne-p\"><br></p><ol start=\"3\" class=\"ne-ol\"><li id=\"u7b775a6c\"><span class=\"ne-text\">消费者：</span></li></ol><p id=\"ud61ac3f3\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"ee5ae00f\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:33\n * 接收消息\n */\n@Slf4j\n@Component\npublic class Consumer {\n    @RabbitListener(queues = ConfirmConfig.CONFIRM_QUEUE_NAME)\n    public void receiveConfirmMessage(Message message) {\n        String msg = new String(message.getBody());\n        log.info(&quot;接收到的队列confirm.queue消息：{}&quot;, msg);\n    }\n}</pre><p id=\"u04196b83\" class=\"ne-p\"><br></p><ol start=\"4\" class=\"ne-ol\"><li id=\"u60a6d2ac\"><span class=\"ne-text\">回调接口</span></li></ol><p id=\"u706addb6\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"b57f810e\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\nimport javax.annotation.PostConstruct;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:50\n * 回调接口\n */\n@Slf4j\n@Component\npublic class MyCallBack implements RabbitTemplate.ConfirmCallback {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    public void init() {\n        //注入 （需要将当前实现类注入到RabbitTemplate的ConfirmCallback函数式接口中）\n        rabbitTemplate.setConfirmCallback(this);\n    }\n\n    /**\n     * 交换机确认回调方法\n     * 1. 发消息  交换机接收到了  回调\n     * 1.1 correlationData 保存回调消息的id及相关信息\n     * 1.2 交换机收到消息  ack = true\n     * 1.3 cause  null\n     * 2. 发消息 交换机接收失败 回调\n     * 2.1 correlationData 保存回调消息的id及相关信息\n     * 2.2 交换机收到消息 ack = false\n     * 2.3 cause  失败的原因\n     *\n     * @param correlationData\n     * @param ack\n     * @param cause\n     */\n    @Override\n    public void confirm(CorrelationData correlationData, boolean ack, String cause) {\n        String id = correlationData != null ? correlationData.getId() : &quot;&quot;;\n        if (ack) {\n            log.info(&quot;交换机已经收到id为：{}的消息&quot;, id);\n        } else {\n            log.error(&quot;交换机还未收到id为:{}的消息，由于原因：{}&quot;, id, cause);\n        }\n    }\n}</pre><p id=\"uef78c20d\" class=\"ne-p\"><br></p><p id=\"ua5e09f93\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638537772169-a45dc229-e5ed-410a-8e46-69f3fb39f21e.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=518&amp;id=u396acbb1&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=518&amp;originWidth=973&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=369736&amp;status=done&amp;style=none&amp;taskId=u8a93ee99-1d87-4fd1-880d-a166a5e50f1&amp;title=&amp;width=973\" id=\"Bk8N5\" class=\"ne-image\"></p><p id=\"u67dd6b93\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"ab4a519d\" class=\"ne-codeblock language-java\">spring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n    publisher-confirm-type: correlated    # 消息确认机制</pre><p id=\"ub25474b6\" class=\"ne-p\"><br></p><ol start=\"5\" class=\"ne-ol\"><li id=\"ud16eafd0\"><span class=\"ne-text\">发送请求 : http://localhost:8080/confirm/sendMessage/大家好 1</span></li></ol><p id=\"u38416d74\" class=\"ne-p\"><br></p><p id=\"u78e4294b\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638537854600-e11783cd-28be-4b75-8f36-434ecab3f990.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=190&amp;id=ue332f12f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=190&amp;originWidth=1135&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=51915&amp;status=done&amp;style=none&amp;taskId=uba52e997-898f-49e3-9067-645cfb69f68&amp;title=&amp;width=1135\" id=\"Emijw\" class=\"ne-image\"></p><p id=\"u7221df5d\" class=\"ne-p\"><br></p><ol start=\"6\" class=\"ne-ol\"><li id=\"u9c66e047\"><span class=\"ne-text\">测试交换机收不到消息：在发送消息中，将交换机名字后面拼接上&quot;123&quot;，再次启动，发送请求： http://localhost:8080/confirm/sendMessage/大家好 1</span></li></ol><p id=\"ubcb758d6\" class=\"ne-p\"><br></p><p id=\"u22d07271\" class=\"ne-p\"><span class=\"ne-text\">会得到：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638538268620-8dcbc2ae-eaa1-4b60-8822-9cd20f509c52.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=222&amp;id=u3e470d69&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=222&amp;originWidth=1872&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=66288&amp;status=done&amp;style=none&amp;taskId=u7f0330f7-a846-488e-8b25-71c1f3cf0a7&amp;title=&amp;width=1872\" id=\"J3ZRH\" class=\"ne-image\"></p><p id=\"uc7e4f269\" class=\"ne-p\"><br></p><ol start=\"7\" class=\"ne-ol\"><li id=\"u8c7d1937\"><span class=\"ne-text\">测试队列收不到消息</span></li></ol><p id=\"u108dd925\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"8e842df0\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.controller;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.rabbit.connection.CorrelationData;\nimport org.springframework.amqp.rabbit.core.RabbitTemplate;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PathVariable;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:27\n * 开始发消息  生产者\n */\n@Slf4j\n@RestController\n@RequestMapping(&quot;/confirm&quot;)\npublic class ProducerController {\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    //发消息\n    @GetMapping(&quot;/sendMessage/{message}&quot;)\n    public void sendMessage(@PathVariable String message) {\n        CorrelationData correlationData1 = new CorrelationData(&quot;1&quot;);\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,\n                ConfirmConfig.CONFIRM_ROUTING_KEY, message, correlationData1);\n        log.info(&quot;发送消息内容为：{}&quot;, message);\n\n        CorrelationData correlationData2 = new CorrelationData(&quot;2&quot;);\n        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,\n                ConfirmConfig.CONFIRM_ROUTING_KEY+&quot;2&quot;, message, correlationData2);\n        log.info(&quot;发送消息内容为：{}&quot;, message);\n    }\n}</pre><p id=\"u1b20db2a\" class=\"ne-p\"><br></p><p id=\"uce701b63\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638538743381-bfc4680e-692b-4303-a0f3-87cd9425978d.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=247&amp;id=u241a2996&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=247&amp;originWidth=1157&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=67266&amp;status=done&amp;style=none&amp;taskId=u3edf7078-e740-4b0a-866c-03de3cfb9db&amp;title=&amp;width=1157\" id=\"SGy2Z\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">可见，队列没有收到消息，也没有应答和确认。</span></p><p id=\"ubbd10bfa\" class=\"ne-p\"><br></p><h3 id=\"9a49228a\"><span class=\"ne-text\">若队列收不到消息</span></h3><p id=\"uf0412cea\" class=\"ne-p\"><br></p><p id=\"u17a29e6c\" class=\"ne-p\"><br></p><p id=\"u18410005\" class=\"ne-p\"><br></p><h4 id=\"7df88dac\"><span class=\"ne-text\">回退消息</span></h4><p id=\"u6d37cd3e\" class=\"ne-p\"><br></p><p id=\"u9d159a4e\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638539584832-557a9bbc-89d4-4162-a0d4-599eb7f3df21.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=210&amp;id=u40b5093d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=210&amp;originWidth=976&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=298616&amp;status=done&amp;style=none&amp;taskId=u13a46749-be43-4430-beb2-483ea013efc&amp;title=&amp;width=976\" id=\"thCkG\" class=\"ne-image\"></p><p id=\"uf348cbd9\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"9bc2e551\" class=\"ne-codeblock language-java\">spring:\n  rabbitmq:\n    host: 59.110.171.189\n    port: 5672\n    username: admin\n    password: 123\n    publisher-confirm-type: correlated   # 消息确认机制\n    publisher-returns: true       # 发布确认机制（消息在交换机那若路由失败，则会回退消息给生产者）</pre><p id=\"ude0471d2\" class=\"ne-p\"><br></p><p id=\"u4ecdba54\" class=\"ne-p\"><span class=\"ne-text\">回退接口：</span></p><p id=\"ub365cc32\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"0cc635d1\" class=\"ne-codeblock language-java\">//注入\n@PostConstruct\n    public void init() {\n        //注入 （需要将当前实现类注入到RabbitTemplate的ConfirmCallback函数式接口中）\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setReturnsCallback(this);\n    }\n/**\n     * 可以在当消息传递过程中，不可达目的地时将消息返回给生产者\n     * 只有不可到目的地时，才进行回退\n     *\n     * @param returnedMessage\n     */\n    @Override\n    public void returnedMessage(ReturnedMessage returnedMessage) {\n        log.error(&quot;消息{}，被交换机{}退回，退回原因：{},路由key:{}&quot;,\n                new String(returnedMessage.getMessage().getBody()),\n                returnedMessage.getExchange(),\n                returnedMessage.getReplyText(),\n                returnedMessage.getRoutingKey());\n    }</pre><p id=\"u2654fc7c\" class=\"ne-p\"><br></p><p id=\"uf86bf68a\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638542234889-03b41ef6-8fc5-4ffb-9f36-7287d4ff9476.png#clientId=u44e4b0cf-fc9d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=267&amp;id=uddd5e8ec&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=267&amp;originWidth=1293&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=78730&amp;status=done&amp;style=none&amp;taskId=u4c513758-cf34-415c-a9f3-845a33faec5&amp;title=&amp;width=1293\" id=\"tOHQ4\" class=\"ne-image\"></p><p id=\"uc53a419f\" class=\"ne-p\"><br></p><h4 id=\"2d534732\"><span class=\"ne-text\">备份交换机</span></h4><p id=\"uabcf7a93\" class=\"ne-p\"><br></p><p id=\"u73453e3c\" class=\"ne-p\"><span class=\"ne-text\">添加一个交换机和两个队列。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638578627259-759238ba-aac5-42f9-b645-401c5c9a05d2.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=328&amp;id=ud35a1613&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=328&amp;originWidth=930&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=197049&amp;status=done&amp;style=none&amp;taskId=u04e4ef45-34c3-49a8-84c0-93d70b4ebb6&amp;title=&amp;width=930\" id=\"j2ALj\" class=\"ne-image\"></p><p id=\"udb3c78de\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"u2c143d03\"><span class=\"ne-text\">配置类</span></li></ol><p id=\"u7df36999\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"7e31c035\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.config;\n\nimport org.springframework.amqp.core.*;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/3 20:15\n * 配置类  发布确认 （高级）\n */\n@Configuration\npublic class ConfirmConfig {\n    //交换机\n    public static final String CONFIRM_EXCHANGE_NAME = &quot;confirm_exchange&quot;;\n    //队列\n    public static final String CONFIRM_QUEUE_NAME = &quot;confirm_queue&quot;;\n    //routing-key\n    public static final String CONFIRM_ROUTING_KEY = &quot;key1&quot;;\n    // --------------------------备份交换机---------------------------------\n    //备份交换机\n    public static final String BACKUP_EXCHANGE_NAME = &quot;backup_exchange&quot;;\n\n    //备份队列\n    public static final String BACKUP_QUEUE_NAME = &quot;backup_queue&quot;;\n\n    //报警队列\n    public static final String WARNING_QUEUE_NAME = &quot;warning_queue&quot;;\n\n    //--------------------------------------------------------------------\n    //声明确认交换机（要转发到备份交换机）\n    @Bean\n    public DirectExchange confirmExchange() {\n        return ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(true)\n                .withArgument(&quot;alternate-exchange&quot;, BACKUP_EXCHANGE_NAME).build();\n    }\n\n    //声明队列\n    @Bean\n    public Queue confirmQueue() {\n        return QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();\n    }\n\n    //绑定交换机和队列\n    @Bean\n    public Binding queueBindingExchange(@Qualifier(&quot;confirmQueue&quot;) Queue confirmQueue,\n                                        @Qualifier(&quot;confirmExchange&quot;) DirectExchange confirmExchange) {\n        return BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);\n    }\n\n    //备份交换机\n    @Bean\n    public FanoutExchange backupExchange() {\n        return new FanoutExchange(BACKUP_EXCHANGE_NAME);\n    }\n\n    //备份队列\n    @Bean\n    public Queue backupQueue() {\n        return QueueBuilder.durable(BACKUP_QUEUE_NAME).build();\n    }\n\n    //报警队列\n    @Bean\n    public Queue warningQueue() {\n        return QueueBuilder.durable(WARNING_QUEUE_NAME).build();\n    }\n\n    //绑定（备份交换机和备份队列）\n    @Bean\n    public Binding backupQueueBindingBackupExchange(@Qualifier(&quot;backupExchange&quot;) FanoutExchange backupExchange, @Qualifier(&quot;backupQueue&quot;) Queue backupQueue) {\n        return BindingBuilder.bind(backupQueue).to(backupExchange);\n    }\n\n    //绑定（备份交换机和报警队列）\n    @Bean\n    public Binding warningQueueBindingBackupExchange(@Qualifier(&quot;backupExchange&quot;) FanoutExchange backupExchange, @Qualifier(&quot;warningQueue&quot;) Queue warningQueue) {\n        return BindingBuilder.bind(warningQueue).to(backupExchange);\n    }\n}</pre><p id=\"u2d96580e\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"ub0f9ce9a\"><span class=\"ne-text\">消费者（报警消费者）</span></li></ol><p id=\"u699010ce\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"35bc7912\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.springbootrabbitmq.consumer;\n\nimport com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.amqp.core.Message;\nimport org.springframework.amqp.rabbit.annotation.RabbitListener;\nimport org.springframework.stereotype.Component;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/12/4 9:10\n * 报警消费者\n */\n@Component\n@Slf4j\npublic class WarningConsumer {\n    //接收报警消息\n    @RabbitListener(queues = ConfirmConfig.WARNING_QUEUE_NAME)\n    public void receiveWarningMsg(Message message) {\n        String msg = new String(message.getBody());\n        log.error(&quot;报警发现不可路由消息：{}&quot;, msg);\n    }\n}</pre><p id=\"ud84928fa\" class=\"ne-p\"><br></p><p id=\"ue7878fb1\" class=\"ne-p\"><span class=\"ne-text\">发送请求：http://localhost:8080/confirm/sendMessage/大家好 1<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638581402507-07326d95-5109-4750-b3ab-c4751b23d55d.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=263&amp;id=udc9907e1&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=263&amp;originWidth=1171&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=75848&amp;status=done&amp;style=none&amp;taskId=u7fb8b716-7979-4acf-b11c-fe1cb99bebd&amp;title=&amp;width=1171\" id=\"Lep12\" class=\"ne-image\"></p><p id=\"uc9ac1a25\" class=\"ne-p\"><br></p><div class=\"ne-quote\"><p id=\"ud9d05a36\" class=\"ne-p\"><strong><span class=\"ne-text\">备份交换机的优先级高于回退消息、</span></strong></p></div><p id=\"ua078c614\" class=\"ne-p\"><br></p><p id=\"uab27aa2a\" class=\"ne-p\"><br></p><p id=\"ud02d49fe\" class=\"ne-p\"><br></p><h2 id=\"c06ec42e\"><span class=\"ne-text\">其他知识点</span></h2><p id=\"u4f098a02\" class=\"ne-p\"><br></p><p id=\"u3abc395c\" class=\"ne-p\"><br></p><p id=\"u471eac83\" class=\"ne-p\"><br></p><h3 id=\"71a92fdf\"><span class=\"ne-text\">幂等性</span></h3><p id=\"u648dd420\" class=\"ne-p\"><br></p><p id=\"u8e5b1edb\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638581856478-4611604a-34c1-486b-a3b7-c809f3d94f0e.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=620&amp;id=ua03a1a2a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=620&amp;originWidth=977&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=628166&amp;status=done&amp;style=none&amp;taskId=u3bbefde1-d01a-481e-b831-abe2598835f&amp;title=&amp;width=977\" id=\"pWlKw\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582165848-9189cc73-c68b-4631-b30d-dad30387a032.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=523&amp;id=u37f187c9&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=523&amp;originWidth=1001&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=609037&amp;status=done&amp;style=none&amp;taskId=udd6ff171-0753-4d6f-a510-a8761c65fcb&amp;title=&amp;width=1001\" id=\"o6DXP\" class=\"ne-image\"></p><p id=\"u2dbfadbc\" class=\"ne-p\"><br></p><p id=\"ubcb1ea0b\" class=\"ne-p\"><br></p><p id=\"u62eecae6\" class=\"ne-p\"><br></p><h3 id=\"507580b5\"><span class=\"ne-text\">优先级队列</span></h3><p id=\"u7da11996\" class=\"ne-p\"><br></p><p id=\"u3cc63c54\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582363595-025332ba-94e1-4485-b6ab-e0542d69fab7.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=326&amp;id=u83200fbd&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=326&amp;originWidth=987&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=447217&amp;status=done&amp;style=none&amp;taskId=ueea7db03-7906-4cef-baef-0ebe50a0185&amp;title=&amp;width=987\" id=\"h3cca\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638582579936-dd221c3d-efc6-4e4b-b854-6667d27682a1.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=343&amp;id=u3930b1c7&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=402&amp;originWidth=1186&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=288467&amp;status=done&amp;style=none&amp;taskId=u70a2eadf-0b86-470c-a5a8-b7d8f612ad3&amp;title=&amp;width=1010.9896240234375\" id=\"WVQYU\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">实现优先级:</span></p><p id=\"u6cc05b3e\" class=\"ne-p\"><br></p><ol class=\"ne-ol\"><li id=\"ua6331a27\"><span class=\"ne-text\">生产者：</span></li></ol><p id=\"ua01e5a8f\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"e42f278b\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.one;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport java.io.IOException;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/28 22:15\n * 生产者 ：发消息\n */\npublic class Producer {\n    //队列名称\n    private static final String QUEUE_NAME = &quot;hello1&quot;;\n\n    //发消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建一个连接工厂\n//        ConnectionFactory factory = new ConnectionFactory();\n//        //设置工厂ip  连接rabbitmq的队列\n//        factory.setHost(&quot;59.110.171.189&quot;);\n//        //用户名\n//        factory.setUsername(&quot;admin&quot;);\n//        //密码\n//        factory.setPassword(&quot;123&quot;);\n//        //创建连接\n//        Connection connection = factory.newConnection();\n//        //获取信道\n//        Channel channel = connection.createChannel();\n        Channel channel = RabbitMqUtils.getChannel();\n        /**\n         * 生成一个队列\n         * 参数；1.队列名称\n         *      2.队列里面的消息是否持久化（磁盘），默认消息存储在内存中（不持久化false）\n         *      3.该队列是否只供一个消费者进行消费，是否消息独有，true只允许一个消费者进行消费，默认是false（可以多个消费者消费）\n         4. 是否自动删除，最后一个消费者断开连接后，该队列是否自动删除，true自动删除，false不自动删除\n         5.其他参数（延迟消息......）\n         */\n        Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;();\n        //官方允许是0-255之间。此处设置10. 允许优先级范围为0-10   不要设置过大   浪费CPU与内存\n        arguments.put(&quot;x-max-priority&quot;, 10);\n        channel.queueDeclare(QUEUE_NAME, true, false, false, arguments);\n        //发消息\n        for (int i = 0; i &lt; 11; i++) {\n            String message = &quot;info&quot; + i;\n            if (i == 5) {\n                //设置优先级\n                AMQP.BasicProperties properties = new AMQP.BasicProperties().builder().priority(5).build();\n                channel.basicPublish(&quot;&quot;, QUEUE_NAME, properties, message.getBytes());\n            } else {\n                channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes());\n            }\n        }\n        /*\n         * 发送一个消息\n         * 1. 发送到哪个交换机\n         * 2. 路由的key值是哪个，本次是队列的名称\n         * 3. 其他参数信息\n         * 4. 发送消息的消息体\n         */\n        System.out.println(&quot;消息发送完毕&quot;);\n    }\n}</pre><p id=\"uc6f9bdd8\" class=\"ne-p\"><br></p><p id=\"ue80f4739\" class=\"ne-p\"><span class=\"ne-text\">启动生产者：<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584428018-a99005d9-2193-463c-9f45-3f72656510ca.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=245&amp;id=u9109bfc5&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=245&amp;originWidth=673&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24479&amp;status=done&amp;style=none&amp;taskId=u0a4a6f5a-f03f-4ab3-8fcc-d9bdc327aad&amp;title=&amp;width=673\" id=\"shKB3\" class=\"ne-image\"></p><p id=\"u291a7eb3\" class=\"ne-p\"><br></p><h3 id=\"07eab7c1\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584267331-0bf02c8d-6536-43a8-aa18-ee5f4ed82255.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=500&amp;id=AvLAP&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=500&amp;originWidth=1065&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=74831&amp;status=done&amp;style=none&amp;taskId=u77c77f80-cfec-453b-bc9f-f82bf26b07c&amp;title=&amp;width=1065\" id=\"cIQXz\" class=\"ne-image\"></h3><p id=\"ucb9b4527\" class=\"ne-p\"><br></p><ol start=\"2\" class=\"ne-ol\"><li id=\"u5b439607\"><span class=\"ne-text\">消费者 :</span></li></ol><p id=\"u293cdbaa\" class=\"ne-p\"><br></p><pre data-language=\"java\" id=\"81930e95\" class=\"ne-codeblock language-java\">package com.atguigu.rabbitmq.one;\n\nimport com.atguigu.rabbitmq.utils.RabbitMqUtils;\nimport com.rabbitmq.client.*;\n\nimport java.io.IOException;\nimport java.util.Arrays;\nimport java.util.concurrent.TimeoutException;\n\n/**\n * @author LiFang\n * @version 1.0\n * @since 2021/11/29 15:04\n * 消费者:接收消息\n */\npublic class Consumer {\n    //队列名称\n    public static final String QUEUE_NAME = &quot;hello1&quot;;\n\n    //接收消息\n    public static void main(String[] args) throws IOException, TimeoutException {\n        //创建连接工厂\n//        ConnectionFactory factory = new ConnectionFactory();\n//        factory.setHost(&quot;59.110.171.189&quot;);\n//        factory.setUsername(&quot;admin&quot;);\n//        factory.setPassword(&quot;123&quot;);\n//        Connection connection = factory.newConnection();\n//        Channel channel = connection.createChannel();\n        Channel channel = RabbitMqUtils.getChannel();\n        //声明 接收消息(成功后的回调)\n        DeliverCallback deliverCallback = (consumerTag, message) -&gt; {\n            System.out.println(new String(message.getBody()));\n        };\n        //取消消息时的回调\n        CancelCallback cancelCallback = consumerTag -&gt; {\n            System.out.println(&quot;消息消费被中断&quot;);\n        };\n        /*\n         * 消费者 消费消息\n         * 1.消费哪个队列\n         * 2. 消费成功之后是否要自动应答，true代表自动应答,false代表手动应答。\n         * 3. 消费者未成功消费的回调。\n         * 4. 消费者取消消费的回调\n         */\n        channel.basicConsume(QUEUE_NAME, true, deliverCallback, cancelCallback);\n    }\n}</pre><p id=\"u16cfd581\" class=\"ne-p\"><br></p><p id=\"ud1908c6e\" class=\"ne-p\"><span class=\"ne-text\">启动消费者，<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584610103-d784c402-b9b7-4321-80d9-c4b95990f410.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=346&amp;id=u91a8ee8e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=346&amp;originWidth=652&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=36450&amp;status=done&amp;style=none&amp;taskId=u90a3da53-d612-4152-b8b6-157c3e789ca&amp;title=&amp;width=652\" id=\"UEHzd\" class=\"ne-image\"></p><p id=\"u87611f1d\" class=\"ne-p\"><br></p><h3 id=\"8508a884\"><span class=\"ne-text\">惰性队列</span></h3><p id=\"uc5f84afb\" class=\"ne-p\"><br></p><p id=\"u0b31325e\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584657059-9bf42f28-e7a0-4c4f-8a39-c56038bd0071.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=425&amp;id=ud4e3da7e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=425&amp;originWidth=993&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=597255&amp;status=done&amp;style=none&amp;taskId=u2ff8ea80-3715-4c63-a718-4d71e1b8488&amp;title=&amp;width=993\" id=\"wMAkZ\" class=\"ne-image\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638584904322-348e89b5-e2f2-4df0-ba11-7540a061f849.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=613&amp;id=u9cab5578&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=613&amp;originWidth=1175&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=404748&amp;status=done&amp;style=none&amp;taskId=uc0905b86-a7ec-4a0f-8a69-356a47ad688&amp;title=&amp;width=1175\" id=\"NaNR3\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">惰性队列执行性能不太好，因此默认情况下不使用惰性队列，而使用正常队列。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638585096408-ecb74216-dfa9-41e3-b7bd-bd5236b2c1da.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=431&amp;id=u4ab29e59&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=431&amp;originWidth=967&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=466179&amp;status=done&amp;style=none&amp;taskId=ub1da4c7a-e46a-44f7-9b2f-e5129f4a839&amp;title=&amp;width=967\" id=\"ZtuGu\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638585305462-e73859d4-5121-406a-b308-57cede7f1bac.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=413&amp;id=uf8c1b8a8&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=413&amp;originWidth=966&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=247424&amp;status=done&amp;style=none&amp;taskId=ua29dd158-1851-4974-bd9b-3c01a9c0ea5&amp;title=&amp;width=966\" id=\"wFSJu\" class=\"ne-image\"></p><p id=\"u76b838dd\" class=\"ne-p\"><br></p><ul class=\"ne-ul\"><li id=\"u4d99bf08\"><span class=\"ne-text\">惰性队列从</span><strong><span class=\"ne-text\">磁盘</span></strong><span class=\"ne-text\">上读取消息，因此消费消息比较慢，但是内存消耗较小，在内存中只存储一些索引。一旦需要消费这些消息时，惰性队列会通过内存中的索引，去读取磁盘中相应的消息，到内存，再消费消息。</span></li></ul><ul class=\"ne-ul\"><li id=\"u07689e77\"><span class=\"ne-text\">正常队列从</span><strong><span class=\"ne-text\">内存</span></strong><span class=\"ne-text\">中读取消息，因此消费消息比较快，但是内存消耗较大。</span></li></ul><p id=\"u27df5c54\" class=\"ne-p\"><br></p><h2 id=\"23eaf825\"><span class=\"ne-text\">rabbitmq 集群</span></h2><p id=\"u5557a767\" class=\"ne-p\"><br></p><p id=\"u0ad69f32\" class=\"ne-p\"><br></p><p id=\"u20e292f4\" class=\"ne-p\"><br></p><h3 id=\"c0131d2a\"><span class=\"ne-text\">集群原理</span></h3><p id=\"u5c043ed3\" class=\"ne-p\"><br></p><p id=\"udb2f051a\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638586666884-b99e8e77-81ef-4547-a9cd-1dcd00e86009.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=501&amp;id=u84ce9d05&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=501&amp;originWidth=1025&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=171726&amp;status=done&amp;style=none&amp;taskId=ud7aa0990-8e0c-4e31-9dd1-c6d20007401&amp;title=&amp;width=1025\" id=\"hjXVB\" class=\"ne-image\"></p><p id=\"u13f38595\" class=\"ne-p\"><br></p><h3 id=\"b80e581a\"><span class=\"ne-text\">镜像队列（备份）</span></h3><p id=\"u18d348a8\" class=\"ne-p\"><br></p><p id=\"u638524b5\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638587610363-c97ef89e-768e-4278-a087-89f20e211145.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=348&amp;id=ue8695270&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=348&amp;originWidth=981&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=453959&amp;status=done&amp;style=none&amp;taskId=ue9f78068-c45e-4cc9-a3e0-595ae6c7337&amp;title=&amp;width=981\" id=\"FTNYI\" class=\"ne-image\"></p><p id=\"ube043d14\" class=\"ne-p\"><br></p><h3 id=\"3702723f\"><span class=\"ne-text\">高可用负载均衡</span></h3><p id=\"u442f2d09\" class=\"ne-p\"><br></p><p id=\"u2e5b02e2\" class=\"ne-p\"><span class=\"ne-text\">若节点 1 宕机了，生产者需要连接节点 2 或节点 3。<br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588031855-ab97c0f3-9861-4222-b593-0a4dbfbf566d.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=754&amp;id=u0c60fb59&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=754&amp;originWidth=1028&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=344345&amp;status=done&amp;style=none&amp;taskId=uaef85042-099b-42a3-8caf-268a89b7438&amp;title=&amp;width=1028\" id=\"XmCHx\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">出现问题：生产者无法变更 rabbitmq 的 ip，此时需要借助外力 Haproxy。</span></p><p id=\"u7f61765f\" class=\"ne-p\"><br></p><h4 id=\"ea97af39\"><span class=\"ne-text\">Haproxy 实现高可用 负载均衡（高并发）</span></h4><p id=\"ubf6aa704\" class=\"ne-p\"><br></p><p id=\"ud147c6a9\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588332155-384a9066-f6ed-434c-bd8d-a08678795b99.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=177&amp;id=u91155287&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=177&amp;originWidth=973&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=240431&amp;status=done&amp;style=none&amp;taskId=u9a4dff8d-f824-447c-b845-2962ddc0650&amp;title=&amp;width=973\" id=\"BHuXj\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588403571-837d2496-d169-4b00-aa3c-4459e5dfd616.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=644&amp;id=u63b0c105&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=644&amp;originWidth=740&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=224363&amp;status=done&amp;style=none&amp;taskId=u400f5630-901e-4db7-8556-6d72a1f206a&amp;title=&amp;width=740\" id=\"FRrD8\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638588495639-57e1823e-e317-48f1-bd99-4a64ab26b8b3.png#clientId=ueb126df1-e3fc-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=711&amp;id=uefaa64c3&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=711&amp;originWidth=860&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=371827&amp;status=done&amp;style=none&amp;taskId=u8f30ca6f-4949-4c9d-899d-b31600baa56&amp;title=&amp;width=860\" id=\"K5Fpn\" class=\"ne-image\"></p><p id=\"ub8c1111e\" class=\"ne-p\"><br></p><h2 id=\"80fc5d12\"><span class=\"ne-text\">联合交换机</span></h2><p id=\"uf8765abf\" class=\"ne-p\"><br></p><p id=\"u19f4fde9\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638600972390-f8eabb13-fdba-432b-8b93-c4798757e13e.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=660&amp;id=u1565c7a2&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=660&amp;originWidth=1136&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=882067&amp;status=done&amp;style=none&amp;taskId=u40ae3ed4-1bbc-4baa-b912-40f55e8b353&amp;title=&amp;width=1136\" id=\"FkHCS\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638601768985-91857261-fe17-4687-bc9f-f8d9daf1a364.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=524&amp;id=uafeaba48&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=524&amp;originWidth=1115&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=307899&amp;status=done&amp;style=none&amp;taskId=u4499a665-a618-4138-a2f2-5bdf1dbaca0&amp;title=&amp;width=1115\" id=\"FgJli\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638601930969-0c445ecb-7e66-43cd-a7d1-3aa8c76f884d.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=581&amp;id=u6d4c749b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=581&amp;originWidth=505&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=221677&amp;status=done&amp;style=none&amp;taskId=uf8d981fd-837f-4eb6-83f6-a7deba0a018&amp;title=&amp;width=505\" id=\"NxTl9\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602088334-f76d8ba1-5c6d-4280-87c8-b7d58d42f902.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=506&amp;id=u4b7146f5&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=506&amp;originWidth=976&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=158537&amp;status=done&amp;style=none&amp;taskId=u64d80530-7388-4c12-9d3b-48d90765e0b&amp;title=&amp;width=976\" id=\"oVYwK\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602110103-8ee2df46-7982-4b08-a6c8-e4d9c701b69f.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=666&amp;id=u65df8122&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=666&amp;originWidth=933&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=302115&amp;status=done&amp;style=none&amp;taskId=u970ef30c-4b50-4327-928e-6bf0cdbc242&amp;title=&amp;width=933\" id=\"A9wRm\" class=\"ne-image\"></p><p id=\"u6827fec5\" class=\"ne-p\"><br></p><h2 id=\"997a4ba0\"><span class=\"ne-text\">联邦队列</span></h2><p id=\"ud2dd89e2\" class=\"ne-p\"><br></p><p id=\"ufbf7e7f8\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638602602857-2efc1842-e9c7-409e-a302-2b4c63e92027.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=833&amp;id=u3d500d40&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=833&amp;originWidth=1312&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=553687&amp;status=done&amp;style=none&amp;taskId=u77ecfe28-0a6d-4318-bc8e-c80d6183ecc&amp;title=&amp;width=1312\" id=\"qvMwP\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\">两个不同地区数据同步。<br /></span><span class=\"ne-text\"> </span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603240478-ba4a3a39-d3dc-41b3-9ee9-c8d9f2718ff9.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=551&amp;id=u0dc6d91b&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=551&amp;originWidth=1149&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=244288&amp;status=done&amp;style=none&amp;taskId=u65c1251d-b002-4909-ae1d-f27aa9d85ee&amp;title=&amp;width=1149\" id=\"Rmak1\" class=\"ne-image\"></p><p id=\"u6d139d21\" class=\"ne-p\"><br></p><h2 id=\"Shovel\"><span class=\"ne-text\">Shovel</span></h2><p id=\"u8914465d\" class=\"ne-p\"><br></p><p id=\"ufcf1b723\" class=\"ne-p\"><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603352779-28d006e0-d330-4802-935c-040341c1ca8d.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=324&amp;id=uc852da4a&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=324&amp;originWidth=1287&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=568699&amp;status=done&amp;style=none&amp;taskId=u2b770501-53fa-4cbc-a428-000590e2c17&amp;title=&amp;width=1287\" id=\"fxL0i\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603460089-03466d04-df20-4ab2-8968-f1b5ef5905ca.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=409&amp;id=ua502f49e&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=409&amp;originWidth=871&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=188661&amp;status=done&amp;style=none&amp;taskId=u48a08d45-4dad-40e0-9723-55db3e3ef79&amp;title=&amp;width=871\" id=\"lh1tz\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603378352-15aca4d9-af9b-48c1-b796-60a86b637ebd.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=667&amp;id=uec9ad770&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=667&amp;originWidth=864&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=266940&amp;status=done&amp;style=none&amp;taskId=u8acd6a6e-3ed2-4306-8639-2eeb16612c3&amp;title=&amp;width=864\" id=\"jpTqS\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><span class=\"ne-text\"> </span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603594801-6bd296a5-c23b-418f-a94e-5261833d5605.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=592&amp;id=u903663bb&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=592&amp;originWidth=994&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=194438&amp;status=done&amp;style=none&amp;taskId=ud10d2c55-8f5b-4b88-b096-8942402c361&amp;title=&amp;width=994\" id=\"oSJ3T\" class=\"ne-image\"><span class=\"ne-text\"><br /></span><img src=\"https://cdn.nlark.com/yuque/0/2021/png/2324645/1638603639753-9ae10564-7bad-4528-afd2-867c58d1f413.png#clientId=u1823549f-f362-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=121&amp;id=u71e6fa9c&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=121&amp;originWidth=1169&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=88867&amp;status=done&amp;style=none&amp;taskId=u55070310-f786-4b38-98ce-55db2f75ca1&amp;title=&amp;width=1169\" id=\"Gjcgc\" class=\"ne-image\"></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"u0d7e0fb8\" id=\"u0d7e0fb8\"><span data-lake-id=\"u909f53e3\" id=\"u909f53e3\">---</span></p><p data-lake-id=\"uc679db55\" id=\"uc679db55\"><span data-lake-id=\"u4c1a62fc\" id=\"u4c1a62fc\">title: RabbitMQ学习笔记<br /></span><span data-lake-id=\"u55719a35\" id=\"u55719a35\">categories: 知识<br /></span><span data-lake-id=\"ue4c70803\" id=\"ue4c70803\">tags: [RabbitMQ, 消息中间件]</span></p><p data-lake-id=\"uaca5ecf0\" id=\"uaca5ecf0\"><span data-lake-id=\"udd666371\" id=\"udd666371\">--- </span></p><p data-lake-id=\"u34c88f82\" id=\"u34c88f82\"><span data-lake-id=\"ufccbef48\" id=\"ufccbef48\">​</span><br></p><p data-lake-id=\"u5a3553e0\" id=\"u5a3553e0\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1630671540955-650bc67f-569a-4cef-a095-ec73a3b34897.png%23clientId%3Duc20dad1f-a2b4-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D740%26id%3Du64b4ea35%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D740%26originWidth%3D1340%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D584856%26status%3Ddone%26style%3Dnone%26taskId%3Du20a11e76-4e9c-49b4-8ca4-cc25eac0808%26title%3D%26width%3D1340%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1340%2C%22originHeight%22%3A740%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23efe7e7%22%2C%22id%22%3A%22FmDdj%22%7D\"></card><span data-lake-id=\"uc073c3a2\" id=\"uc073c3a2\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1630672453989-c5f9d3cf-e77f-4c3e-8a9d-173b49f0aa4c.png%23clientId%3Duc20dad1f-a2b4-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D473%26id%3Dub505e50f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D473%26originWidth%3D1544%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D451836%26status%3Ddone%26style%3Dnone%26taskId%3Du973d9d93-5ee4-44e2-9f50-b28d8e8f15e%26title%3D%26width%3D1544%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1544%2C%22originHeight%22%3A473%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f6f6f6%22%2C%22id%22%3A%22N1Vbj%22%7D\"></card><span data-lake-id=\"ufdb92570\" id=\"ufdb92570\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1630673109375-2f65953f-32f5-4be8-9353-9d08abb6587f.png%23clientId%3Duc20dad1f-a2b4-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D794%26id%3Duce851ada%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D794%26originWidth%3D1520%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D669042%26status%3Ddone%26style%3Dnone%26taskId%3Du1e0c19d3-9eae-4ab1-9e35-b33c4bbbcd6%26title%3D%26width%3D1520%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1520%2C%22originHeight%22%3A794%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23b2b1b0%22%2C%22id%22%3A%22zGC4d%22%7D\"></card></p><p data-lake-id=\"u329797e5\" id=\"u329797e5\"><br></p><h2 data-lake-id=\"9c0cd8ed\" id=\"9c0cd8ed\"><span data-lake-id=\"u0c12fd73\" id=\"u0c12fd73\">为什么要用 rabbitMQ？</span></h2><h3 data-lake-id=\"81220e89\" id=\"81220e89\"><span data-lake-id=\"u450596fc\" id=\"u450596fc\">1. 流量削峰</span></h3><p data-lake-id=\"u034d5ee5\" id=\"u034d5ee5\"><br></p><p data-lake-id=\"u03a10fc5\" id=\"u03a10fc5\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1637998719062-ee3b7961-8606-40b9-9bd6-139143630402.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D91%26id%3Du7a7d8c10%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D182%26originWidth%3D990%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D78126%26status%3Ddone%26style%3Dnone%26taskId%3Du903bdc4d-2ce4-4ac8-97d1-9cf8226327b%26title%3D%26width%3D495%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A990%2C%22originHeight%22%3A182%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f3f3f3%22%2C%22id%22%3A%22Ds1E5%22%7D\"></card></p><p data-lake-id=\"u874b8d44\" id=\"u874b8d44\"><br></p><h3 data-lake-id=\"c491023f\" id=\"c491023f\"><span data-lake-id=\"u898d65ad\" id=\"u898d65ad\">2. 应用解耦</span></h3><p data-lake-id=\"ue8c60717\" id=\"ue8c60717\"><br></p><p data-lake-id=\"u4ba4ff6a\" id=\"u4ba4ff6a\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1637998760193-a4f14c2c-a22b-4c92-b207-ae58a962577a.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D182%26id%3Du8f01ca2b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D363%26originWidth%3D1085%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D190648%26status%3Ddone%26style%3Dnone%26taskId%3Du30e77d52-0f3b-4d69-b06f-8229a9c232f%26title%3D%26width%3D542.5%26referrerpolicy%3Dno-referrer%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1085%2C%22originHeight%22%3A363%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f7f7f7%22%2C%22id%22%3A%22hMEcn%22%7D\"></card></p><p data-lake-id=\"u6d37b294\" id=\"u6d37b294\"><br></p><h3 data-lake-id=\"d4ef8fda\" id=\"d4ef8fda\"><span data-lake-id=\"u020e8192\" id=\"u020e8192\">3. 异步处理</span></h3><p data-lake-id=\"ufa9eb4bc\" id=\"ufa9eb4bc\"><br></p><p data-lake-id=\"u20a06663\" id=\"u20a06663\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009293978-1fde3fa6-5de6-476b-bc8f-4381749e748c.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D315%26id%3Du2602b5b4%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D630%26originWidth%3D1167%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D283589%26status%3Ddone%26style%3Dnone%26taskId%3Duf5236049-2c88-4e12-b15e-7d99585efad%26title%3D%26width%3D583.5%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1167%2C%22originHeight%22%3A630%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f6f6f6%22%2C%22id%22%3A%22EqXpn%22%7D\"></card></p><p data-lake-id=\"u0a94a1a3\" id=\"u0a94a1a3\"><br></p><h2 data-lake-id=\"753ccaa2\" id=\"753ccaa2\"><span data-lake-id=\"u4a58fcf4\" id=\"u4a58fcf4\">RabbitMQ 核心部分</span></h2><p data-lake-id=\"u29bdd22c\" id=\"u29bdd22c\"><br></p><p data-lake-id=\"uab230d58\" id=\"uab230d58\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009378104-cb162a2f-4170-4d24-99c1-4e3ee09087ae.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D284%26id%3Du45cac300%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D568%26originWidth%3D1077%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D305514%26status%3Ddone%26style%3Dnone%26taskId%3Du95a38925-5c34-45dd-bfca-d140d73dc3f%26title%3D%26width%3D538.5%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1077%2C%22originHeight%22%3A568%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f8f2f1%22%2C%22id%22%3A%22TB3Zf%22%7D\"></card></p><p data-lake-id=\"u0943ec06\" id=\"u0943ec06\"><br></p><h2 data-lake-id=\"a260da3a\" id=\"a260da3a\"><span data-lake-id=\"u4615632f\" id=\"u4615632f\">各个名词介绍</span></h2><p data-lake-id=\"u9ab39537\" id=\"u9ab39537\"><br></p><p data-lake-id=\"ub76612d7\" id=\"ub76612d7\"><br></p><p data-lake-id=\"u698e3664\" id=\"u698e3664\"><br></p><h3 data-lake-id=\"c83a4ba0\" id=\"c83a4ba0\"><span data-lake-id=\"ud5ce219f\" id=\"ud5ce219f\">RabbitMQ 工作原理</span></h3><p data-lake-id=\"u21effb62\" id=\"u21effb62\"><br></p><p data-lake-id=\"ua7741f7e\" id=\"ua7741f7e\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009501957-eb0902f3-1fa1-47d5-9bc7-8d03f6e12de0.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D257%26id%3Du79c375f5%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D514%26originWidth%3D1060%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D210068%26status%3Ddone%26style%3Dnone%26taskId%3Due02a7c50-c563-46af-a784-5ae4c1dcdfe%26title%3D%26width%3D530%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1060%2C%22originHeight%22%3A514%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23efc150%22%2C%22id%22%3A%22sf1J3%22%7D\"></card><span data-lake-id=\"u0075424c\" id=\"u0075424c\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009567915-6084eb1d-d428-47ec-844f-b3b48c6c6d0c.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D310%26id%3Du9337433a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D619%26originWidth%3D1135%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D776522%26status%3Ddone%26style%3Dnone%26taskId%3Duced2ac5e-e117-4050-8e39-087f63ff410%26title%3D%26width%3D567.5%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1135%2C%22originHeight%22%3A619%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e1dccf%22%2C%22id%22%3A%22ft4q6%22%7D\"></card><span data-lake-id=\"u893d075b\" id=\"u893d075b\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009610891-4a5dba18-6006-41bf-a068-b2f33ed7df48.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D63%26id%3Du38d6f233%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D126%26originWidth%3D1128%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D136646%26status%3Ddone%26style%3Dnone%26taskId%3Du3dada18e-9ab8-40c9-8042-2e2f9f40306%26title%3D%26width%3D564%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1128%2C%22originHeight%22%3A126%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23cdc5b8%22%2C%22id%22%3A%22rJuNv%22%7D\"></card></p><p data-lake-id=\"u1525aa57\" id=\"u1525aa57\"><br></p><h2 data-lake-id=\"e655a410\" id=\"e655a410\"><span data-lake-id=\"u705eb6e6\" id=\"u705eb6e6\">安装</span></h2><p data-lake-id=\"u05de2581\" id=\"u05de2581\"><br></p><p data-lake-id=\"uf6aced4d\" id=\"uf6aced4d\"><a href=\"https://www.rabbitmq.com/download.html\" target=\"_blank\" data-lake-id=\"ue8f1a388\" id=\"ue8f1a388\"><span data-lake-id=\"u33a9052d\" id=\"u33a9052d\">rabbitmq.com/download.html</span></a><span data-lake-id=\"uf625d546\" id=\"uf625d546\"><br /></span><span data-lake-id=\"u097a9a4a\" id=\"u097a9a4a\">erlang 和 rabbitMQ 版本匹配：<br /></span><a href=\"https://www.cnblogs.com/gne-hwz/p/10714013.html\" target=\"_blank\" data-lake-id=\"u79f01256\" id=\"u79f01256\"><span data-lake-id=\"u5287bc87\" id=\"u5287bc87\">https://www.cnblogs.com/gne-hwz/p/10714013.html</span></a><span data-lake-id=\"u1249a5dd\" id=\"u1249a5dd\"><br /></span><span data-lake-id=\"u5969764e\" id=\"u5969764e\">安装：</span><a href=\"https://blog.csdn.net/almahehe/article/details/75390572\" target=\"_blank\" data-lake-id=\"u4866f597\" id=\"u4866f597\"><span data-lake-id=\"uf1b9b81f\" id=\"uf1b9b81f\">https://blog.csdn.net/almahehe/article/details/75390572</span></a><span data-lake-id=\"ua09b2180\" id=\"ua09b2180\"><br /></span><span data-lake-id=\"u9b14d83d\" id=\"u9b14d83d\">（建议看尚硅谷视频进行快速安装）<br /></span><span data-lake-id=\"ue3b0bc72\" id=\"ue3b0bc72\">安装之后，可以访问 ip:15672 ，查看发送消息的端口（5672）和用户。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638169386681-e382c30c-baba-4fbb-bd40-aaa7b0a1eac6.png%23clientId%3Duc4bbfa15-6ab6-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D173%26id%3Du1a771f9c%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D102%26originWidth%3D450%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D28980%26status%3Ddone%26style%3Dnone%26taskId%3Dua13bea1f-438b-4ef8-8913-b4ccb9fa78c%26title%3D%26width%3D761.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A450%2C%22originHeight%22%3A102%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f1f1f1%22%2C%22id%22%3A%22pNXMC%22%7D\"></card></p><p data-lake-id=\"u9691fe71\" id=\"u9691fe71\"><br></p><h2 data-lake-id=\"c729f8ef\" id=\"c729f8ef\"><span data-lake-id=\"ufb9fdbed\" id=\"ufb9fdbed\">简单队列模式</span></h2><h3 data-lake-id=\"f5abe6f8\" id=\"f5abe6f8\"><span data-lake-id=\"ueaf18294\" id=\"ueaf18294\">生产者代码</span></h3><p data-lake-id=\"u9247b990\" id=\"u9247b990\"><br></p><ol list=\"ua5bc81d8\"><li fid=\"ud363da97\" data-lake-id=\"ua2bec32f\" id=\"ua2bec32f\"><span data-lake-id=\"ud39a2801\" id=\"ud39a2801\">项目依赖：</span></li></ol><p data-lake-id=\"ua99c915f\" id=\"ua99c915f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22%3Cdependencies%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%E6%8C%87%E5%AE%9Ajdk%E7%BC%96%E8%AF%91%E7%89%88%E6%9C%AC--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.apache.maven.plugins%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Emaven-compiler-plugin%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E3.8.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fcom.rabbitmq%2Famqp-client%20--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--rabbitmq%E4%BE%9D%E8%B5%96%E5%AE%A2%E6%88%B7%E7%AB%AF--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Ecom.rabbitmq%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Eamqp-client%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E5.8.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fcommons-io%2Fcommons-io%20--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E6%B5%81%E7%9A%84%E4%BE%9D%E8%B5%96--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Ecommons-io%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Ecommons-io%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.6%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.slf4j%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Eslf4j-simple%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E1.7.25%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%3C%2Fdependencies%3E%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220859d073%22%7D\"></card><p data-lake-id=\"ud6903308\" id=\"ud6903308\"><br></p><ol list=\"u6eef3ccd\" start=\"2\"><li fid=\"uc78933dd\" data-lake-id=\"uadcc7a78\" id=\"uadcc7a78\"><span data-lake-id=\"u4718b128\" id=\"u4718b128\">生产者代码：</span></li></ol><p data-lake-id=\"u087456f1\" id=\"u087456f1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22japackage%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.Connection%3B%5Cnimport%20com.rabbitmq.client.ConnectionFactory%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F28%2022%3A15%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%20%EF%BC%9A%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20private%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E5%B7%A5%E5%8E%82ip%20%20%E8%BF%9E%E6%8E%A5rabbitmq%E7%9A%84%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E6%88%B7%E5%90%8D%5Cn%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%AF%86%E7%A0%81%5Cn%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%5Cn%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%8E%B7%E5%8F%96%E4%BF%A1%E9%81%93%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%82%E6%95%B0%EF%BC%9B1.%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%202.%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%E5%90%A6%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%88%E7%A3%81%E7%9B%98%EF%BC%89%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%88%E4%B8%8D%E6%8C%81%E4%B9%85%E5%8C%96false%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%203.%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E5%8F%AA%E4%BE%9B%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E6%98%AF%E5%90%A6%E6%B6%88%E6%81%AF%E7%8B%AC%E6%9C%89%EF%BC%8Ctrue%E5%8F%AA%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AFfalse%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%204.%20%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%90%8E%EF%BC%8C%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Ctrue%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Cfalse%E4%B8%8D%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%205.%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%88%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF......%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(QUEUE_NAME%2Cfalse%2Cfalse%2Cfalse%2Cnull)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22hello%20world%5C%22%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%20%E5%8F%91%E9%80%81%E5%88%B0%E5%93%AA%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E8%B7%AF%E7%94%B1%E7%9A%84key%E5%80%BC%E6%98%AF%E5%93%AA%E4%B8%AA%EF%BC%8C%E6%9C%AC%E6%AC%A1%E6%98%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%B6%88%E6%81%AF%E4%BD%93%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2CQUEUE_NAME%2Cnull%2Cmessage.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%AE%8C%E6%AF%95%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22551912bc%22%7D\"></card><p data-lake-id=\"ua3657b02\" id=\"ua3657b02\"><br></p><p data-lake-id=\"u11483b33\" id=\"u11483b33\"><span data-lake-id=\"uc3608a1d\" id=\"uc3608a1d\">如果运行报超时错误，需要打开云服务器的安全组 5672 端口。<br />（参考博客：</span><a href=\"https://www.cnblogs.com/jxearlier/p/11920825.html\" target=\"_blank\" data-lake-id=\"u7dcde88d\" id=\"u7dcde88d\"><span data-lake-id=\"udec279e8\" id=\"udec279e8\">https://www.cnblogs.com/jxearlier/p/11920825.html</span></a><span data-lake-id=\"u5dae9d38\" id=\"u5dae9d38\">）</span></p><h3 data-lake-id=\"3b753fe7\" id=\"3b753fe7\"><span data-lake-id=\"uae969ae3\" id=\"uae969ae3\">消费者代码</span></h3><p data-lake-id=\"ud87a77a1\" id=\"ud87a77a1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.rabbitmq.client.*%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2015%3A04%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%3A%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Consumer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%20%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%96%E6%B6%88%E6%B6%88%E6%81%AF%E6%97%B6%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20CancelCallback%20cancelCallback%20%3D%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%A2%AB%E4%B8%AD%E6%96%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%E6%B6%88%E8%B4%B9%E5%93%AA%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E6%B6%88%E8%B4%B9%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E6%98%AF%E5%90%A6%E8%A6%81%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8Ctrue%E4%BB%A3%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%2Cfalse%E4%BB%A3%E8%A1%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%B6%88%E8%B4%B9%E8%80%85%E6%9C%AA%E6%88%90%E5%8A%9F%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(QUEUE_NAME%2C%20true%2CdeliverCallback%2CcancelCallback)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d7bd0f8f%22%7D\"></card><p data-lake-id=\"u161ab880\" id=\"u161ab880\"><br></p><p data-lake-id=\"u2f7061dc\" id=\"u2f7061dc\"><span data-lake-id=\"u492a9635\" id=\"u492a9635\">运行结果：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638172828992-073b0df6-a480-4260-a724-e17e9191a44c.png%23clientId%3Duc4bbfa15-6ab6-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D20%26id%3Du3ee077b2%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D20%26originWidth%3D296%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D2932%26status%3Ddone%26style%3Dnone%26taskId%3Dud645c173-0157-49f2-89fb-5d58c2cd89a%26title%3D%26width%3D296%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A296%2C%22originHeight%22%3A20%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3e49%22%2C%22id%22%3A%22kWU4Y%22%7D\"></card></p><p data-lake-id=\"u0b7711d3\" id=\"u0b7711d3\"><br></p><h3 data-lake-id=\"56a70cf7\" id=\"56a70cf7\"><span data-lake-id=\"u6cb3fb74\" id=\"u6cb3fb74\">测试生产者和消费者代码：</span></h3><p data-lake-id=\"uac0eac74\" id=\"uac0eac74\"><br></p><ol list=\"u51f71829\"><li fid=\"ucee08304\" data-lake-id=\"u4916faee\" id=\"u4916faee\"><span data-lake-id=\"u36a54dd5\" id=\"u36a54dd5\">先运行消费者代码，发现没有消息，再运行生产者代码，发送消息，再看消费者代码控制台，此时已经接收到消息。</span></li></ol><p data-lake-id=\"ua57feed9\" id=\"ua57feed9\"><br></p><h2 data-lake-id=\"3d1bae02\" id=\"3d1bae02\"><span data-lake-id=\"u9f020e50\" id=\"u9f020e50\">工作队列模式</span></h2><p data-lake-id=\"u8a14f32f\" id=\"u8a14f32f\"><br></p><p data-lake-id=\"u924e23c9\" id=\"u924e23c9\"><br></p><p data-lake-id=\"ub993060c\" id=\"ub993060c\"><br></p><h3 data-lake-id=\"d9addd15\" id=\"d9addd15\"><span data-lake-id=\"u3ad8ec7f\" id=\"u3ad8ec7f\">轮训分发消息</span></h3><p data-lake-id=\"u0a21536f\" id=\"u0a21536f\"><br></p><p data-lake-id=\"u1c457a9d\" id=\"u1c457a9d\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638191830547-a43bbaa1-a524-4603-b6a9-0824e943cf9c.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D546%26id%3Ducf96c5e0%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D546%26originWidth%3D1278%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D220503%26status%3Ddone%26style%3Dnone%26taskId%3Dub030755f-49df-4184-9d0d-65bfa0e561e%26title%3D%26width%3D1278%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1278%2C%22originHeight%22%3A546%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f7f7f7%22%2C%22id%22%3A%22kyxCV%22%7D\"></card></p><p data-lake-id=\"ubbe06130\" id=\"ubbe06130\"><br></p><ol list=\"u993bcc81\"><li fid=\"ub0e7382c\" data-lake-id=\"ua4977f19\" id=\"ua4977f19\"><span data-lake-id=\"u142ff8d4\" id=\"u142ff8d4\">抽取连接工厂工具类：</span></li></ol><p data-lake-id=\"u1321a065\" id=\"u1321a065\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.utils%3B%5Cn%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.Connection%3B%5Cnimport%20com.rabbitmq.client.ConnectionFactory%3B%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2019%3A48%5Cn%20*%20%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%E5%88%9B%E5%BB%BA%E4%BF%A1%E9%81%93%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB%5Cn%20*%2F%5Cnpublic%20class%20RabbitMqUtils%20%7B%5Cn%20%20%20%20public%20static%20Channel%20getChannel()%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20return%20channel%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d79993aa%22%7D\"></card><p data-lake-id=\"u63f36183\" id=\"u63f36183\"><br></p><ol list=\"u9211bc6e\" start=\"2\"><li fid=\"uaa9721e3\" data-lake-id=\"u07f51501\" id=\"u07f51501\"><span data-lake-id=\"uf408d5cc\" id=\"uf408d5cc\">工作线程代码：（消费者）</span></li></ol><p data-lake-id=\"ud95a0f1f\" id=\"ud95a0f1f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.two%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.CancelCallback%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cnimport%20com.rabbitmq.client.Delivery%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2019%3A55%5Cn%20*%20%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%EF%BC%88%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B9%8B%E5%89%8D%E7%9A%84%E6%B6%88%E8%B4%B9%E8%80%85%EF%BC%89%5Cn%20*%2F%5Cnpublic%20class%20Worker01%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%20%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%9A%84%E6%8E%A5%E6%94%B6%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6%E8%A2%AB%E5%8F%96%E6%B6%88%E6%97%B6%20%E6%89%A7%E8%A1%8C%5Cn%20%20%20%20%20%20%20%20CancelCallback%20cancelCallback%20%3D%20(consumerTag)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(consumerTag%20%2B%20%5C%22%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E6%8E%A5%E5%8F%A3%E5%9B%9E%E8%B0%83%E9%80%BB%E8%BE%91%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%E6%B6%88%E8%B4%B9%E5%93%AA%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E6%B6%88%E8%B4%B9%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E6%98%AF%E5%90%A6%E8%A6%81%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8Ctrue%E4%BB%A3%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%2Cfalse%E4%BB%A3%E8%A1%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%B6%88%E8%B4%B9%E8%80%85%E6%9C%AA%E6%88%90%E5%8A%9F%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(QUEUE_NAME%2C%20true%2C%20deliverCallback%2C%20cancelCallback)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%229d76e763%22%7D\"></card><p data-lake-id=\"u3c81ab45\" id=\"u3c81ab45\"><br></p><ol list=\"u1721a5be\" start=\"3\"><li fid=\"u2f522a92\" data-lake-id=\"u3d36e889\" id=\"u3d36e889\"><span data-lake-id=\"u40d2ed30\" id=\"u40d2ed30\">启动两个工作线程（消费者）</span></li></ol><p data-lake-id=\"ub9bad24a\" id=\"ub9bad24a\"><br></p><p data-lake-id=\"u880b1412\" id=\"u880b1412\"><span data-lake-id=\"ud7746195\" id=\"ud7746195\">前提是在 idea 设置允许方法多个并行运行：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638188489814-b081e679-bc7f-4cad-964e-bfb80575820c.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D636%26id%3Duf61f07dc%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D869%26originWidth%3D1143%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D94819%26status%3Ddone%26style%3Dnone%26taskId%3Du4472c929-c48f-4a7d-ab7d-ec2994b75e5%26title%3D%26width%3D836.9862060546875%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1143%2C%22originHeight%22%3A869%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%233b4043%22%2C%22id%22%3A%22zVInE%22%7D\"></card><span data-lake-id=\"ubfdf41bf\" id=\"ubfdf41bf\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638188418807-97ce766a-47ef-458c-8413-d496cbcddbed.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D172%26id%3Du35f12aab%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D172%26originWidth%3D669%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D20804%26status%3Ddone%26style%3Dnone%26taskId%3Duf688cf36-6dc9-43f1-be3d-946b8a45d78%26title%3D%26width%3D669%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A669%2C%22originHeight%22%3A172%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232a373f%22%2C%22id%22%3A%22yNG1N%22%7D\"></card></p><p data-lake-id=\"ub776168d\" id=\"ub776168d\"><br></p><ol list=\"u8fb16ba1\" start=\"4\"><li fid=\"u324d4ebf\" data-lake-id=\"ud4caf9e9\" id=\"ud4caf9e9\"><span data-lake-id=\"uf8568ee5\" id=\"uf8568ee5\">生产者代码：</span></li></ol><p data-lake-id=\"u09bb0f44\" id=\"u09bb0f44\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.two%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2021%3A04%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%20%E5%8F%91%E9%80%81%E5%A4%A7%E9%87%8F%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Task01%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%82%E6%95%B0%EF%BC%9B1.%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%202.%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%E5%90%A6%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%88%E7%A3%81%E7%9B%98%EF%BC%89%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%88%E4%B8%8D%E6%8C%81%E4%B9%85%E5%8C%96false%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%203.%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E5%8F%AA%E4%BE%9B%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E6%98%AF%E5%90%A6%E6%B6%88%E6%81%AF%E7%8B%AC%E6%9C%89%EF%BC%8Ctrue%E5%8F%AA%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AFfalse%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%204.%20%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%90%8E%EF%BC%8C%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Ctrue%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Cfalse%E4%B8%8D%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%205.%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%88%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF......%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(QUEUE_NAME%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20QUEUE_NAME%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%AE%8C%E6%88%90%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%225346bd81%22%7D\"></card><p data-lake-id=\"u0c3323ed\" id=\"u0c3323ed\"><br></p><ol list=\"u35971760\" start=\"5\"><li fid=\"u07c2ae97\" data-lake-id=\"u5fbb9819\" id=\"u5fbb9819\"><span data-lake-id=\"u5bb71885\" id=\"u5bb71885\">测试：启动生产者</span></li></ol><p data-lake-id=\"u647c8fbd\" id=\"u647c8fbd\"><br></p><p data-lake-id=\"ud09fcf35\" id=\"ud09fcf35\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638192109706-2649384b-8559-4d7e-8609-220f576c3e25.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D275%26id%3Du4261e57f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D275%26originWidth%3D591%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D25224%26status%3Ddone%26style%3Dnone%26taskId%3Due3dff20d-583f-4d0b-bb12-94ccae95bc1%26title%3D%26width%3D591%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A591%2C%22originHeight%22%3A275%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232c373d%22%2C%22id%22%3A%22PuJou%22%7D\"></card><span data-lake-id=\"ud9d3a671\" id=\"ud9d3a671\"><br /></span><span data-lake-id=\"uc8756aef\" id=\"uc8756aef\">可以看见消费者轮循接收消息：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638192164342-16d183be-bbe5-4de9-bac4-d87bd87a746b.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D179%26id%3Due97a7cdb%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D179%26originWidth%3D591%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23018%26status%3Ddone%26style%3Dnone%26taskId%3Du7cff6d1a-b142-4d52-a1c5-1cca6fd241e%26title%3D%26width%3D591%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A591%2C%22originHeight%22%3A179%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3c44%22%2C%22id%22%3A%22Upfv4%22%7D\"></card><span data-lake-id=\"ude7e3baa\" id=\"ude7e3baa\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638192176544-d380de90-ff7a-48a7-a080-c4a1ac193460.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D198%26id%3Dubb73d589%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D198%26originWidth%3D598%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23978%26status%3Ddone%26style%3Dnone%26taskId%3Du3ac63e3a-6d82-4340-9fed-c68c8fbf564%26title%3D%26width%3D598%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A598%2C%22originHeight%22%3A198%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3b43%22%2C%22id%22%3A%22xLv8Q%22%7D\"></card></p><p data-lake-id=\"u9b4baf19\" id=\"u9b4baf19\"><br></p><h2 data-lake-id=\"269fc561\" id=\"269fc561\"><span data-lake-id=\"ucee7fa76\" id=\"ucee7fa76\">消息应答</span></h2><p data-lake-id=\"u6a6463c8\" id=\"u6a6463c8\"><br></p><p data-lake-id=\"uce771e06\" id=\"uce771e06\"><br></p><p data-lake-id=\"u4921363f\" id=\"u4921363f\"><br></p><h3 data-lake-id=\"398e8d91\" id=\"398e8d91\"><span data-lake-id=\"u29d2557e\" id=\"u29d2557e\">自动应答</span></h3><p data-lake-id=\"u375825be\" id=\"u375825be\"><br></p><p data-lake-id=\"ua916566e\" id=\"ua916566e\"><span data-lake-id=\"ue97919fe\" id=\"ue97919fe\">不建议使用，仅适用在消费者可以高效并以某种速率能够处理这些消息的情况。</span></p><p data-lake-id=\"u5267e3be\" id=\"u5267e3be\"><br></p><h3 data-lake-id=\"a7945bf1\" id=\"a7945bf1\"><span data-lake-id=\"uc4459f0a\" id=\"uc4459f0a\">手动应答</span></h3><p data-lake-id=\"uc5fde435\" id=\"uc5fde435\"><br></p><p data-lake-id=\"ud58827d8\" id=\"ud58827d8\"><br></p><p data-lake-id=\"u5b06088a\" id=\"u5b06088a\"><br></p><h4 data-lake-id=\"bdff53ca\" id=\"bdff53ca\"><span data-lake-id=\"u8e89b299\" id=\"u8e89b299\">消息应答的方法：</span></h4><p data-lake-id=\"u91742edc\" id=\"u91742edc\"><br></p><p data-lake-id=\"u50ffcea8\" id=\"u50ffcea8\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638193415623-6b7ff26f-8cc3-4abd-b1c6-41f79897f0cf.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D312%26id%3Dud16b0385%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D312%26originWidth%3D737%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D100867%26status%3Ddone%26style%3Dnone%26taskId%3Du39cf8244-b605-4c5d-baca-fe2103cd9d3%26title%3D%26width%3D737%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A737%2C%22originHeight%22%3A312%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f5f5f5%22%2C%22id%22%3A%22S2b1y%22%7D\"></card></p><p data-lake-id=\"u9dec6f82\" id=\"u9dec6f82\"><br></p><h4 data-lake-id=\"70c2cd3d\" id=\"70c2cd3d\"><span data-lake-id=\"udd5077f9\" id=\"udd5077f9\">批量处理 Multiple</span></h4><p data-lake-id=\"ubcb490e9\" id=\"ubcb490e9\"><br></p><p data-lake-id=\"u50a423cf\" id=\"u50a423cf\"><span data-lake-id=\"u38f6a02d\" id=\"u38f6a02d\">手动应答的好处：可以批量应答，并减少网络拥堵。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638282925466-4d3081e6-809c-4a5f-9472-741dacb0cc7c.png%23clientId%3Dub82069db-0272-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D588%26id%3Du97ebb457%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D811%26originWidth%3D1024%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D292383%26status%3Ddone%26style%3Dnone%26taskId%3Duf04a703e-97b1-4fe2-b58f-33d8b0dff4d%26title%3D%26width%3D741.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1024%2C%22originHeight%22%3A811%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f6f5f5%22%2C%22id%22%3A%22rUzZh%22%7D\"></card><span data-lake-id=\"uccc1f103\" id=\"uccc1f103\"><br /></span><span data-lake-id=\"udcc741b7\" id=\"udcc741b7\">但是批量应答可能会丢失消息。所以尽量不要批量应答，将 multiple 设置为 false。</span></p><p data-lake-id=\"ue797ecdd\" id=\"ue797ecdd\"><br></p><h3 data-lake-id=\"8f744d87\" id=\"8f744d87\"><span data-lake-id=\"u0947adaa\" id=\"u0947adaa\">消息自动重新入队</span></h3><p data-lake-id=\"ub78af706\" id=\"ub78af706\"><br></p><p data-lake-id=\"u48684c84\" id=\"u48684c84\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638317239422-ab1bab41-ac6f-4a05-b3c5-c539d9e6dcd1.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D85%26id%3Du97c18f3b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D79%26originWidth%3D665%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D57746%26status%3Ddone%26style%3Dnone%26taskId%3Du14e494b5-3291-4daf-ada5-47aafa5eab0%26title%3D%26width%3D715.0000610351562%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A665%2C%22originHeight%22%3A79%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23ebeae9%22%2C%22id%22%3A%22qAYOD%22%7D\"></card><span data-lake-id=\"u261fb783\" id=\"u261fb783\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638317701734-1133a417-ebbe-4ad9-8453-f0803583491a.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D308%26id%3Du7be19416%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D469%26originWidth%3D1088%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D306122%26status%3Ddone%26style%3Dnone%26taskId%3Du7d90ec89-bd9a-4090-bda5-c09c6014c27%26title%3D%26width%3D714.9862060546875%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1088%2C%22originHeight%22%3A469%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e5e4df%22%2C%22id%22%3A%22o9cFt%22%7D\"></card><span data-lake-id=\"u63cecd77\" id=\"u63cecd77\"><br /></span><span data-lake-id=\"u3de7e416\" id=\"u3de7e416\">测试：<br /></span><span data-lake-id=\"u4dc11cc9\" id=\"u4dc11cc9\"> 1. 生产者：</span></p><p data-lake-id=\"uf22d07da\" id=\"uf22d07da\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.three%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2014%3A46%5Cn%20*%20%E6%B6%88%E6%81%AF%E5%9C%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E6%97%B6%E4%B8%8D%E4%B8%A2%E5%A4%B1%2C%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E9%87%8D%E6%96%B0%E6%B6%88%E8%B4%B9%5Cn%20*%2F%5Cnpublic%20class%20Task2%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20TASK_QUEUE_NAME%20%3D%20%5C%22ack_queue%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(TASK_QUEUE_NAME%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20TASK_QUEUE_NAME%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2207cf3bd5%22%7D\"></card><p data-lake-id=\"u7a59e1ef\" id=\"u7a59e1ef\"><br></p><ol list=\"u5f697a5a\" start=\"2\"><li fid=\"u2dd03fad\" data-lake-id=\"ua5680886\" id=\"ua5680886\"><span data-lake-id=\"u3013537c\" id=\"u3013537c\">两个消费者（消息手动应答）：</span></li></ol><p data-lake-id=\"u9ced89cf\" id=\"u9ced89cf\"><br></p><p data-lake-id=\"udf412596\" id=\"udf412596\"><span data-lake-id=\"u8c75a599\" id=\"u8c75a599\">消费者一：</span></p><p data-lake-id=\"ueae64f29\" id=\"ueae64f29\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.three%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.atguigu.rabbitmq.utils.SleepUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2014%3A58%5Cn%20*%20%E6%B6%88%E6%81%AF%E5%9C%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E6%97%B6%E4%B8%8D%E4%B8%A2%E5%A4%B1%EF%BC%8C%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E9%87%8D%E6%96%B0%E6%B6%88%E8%B4%B9%5Cn%20*%2F%5Cnpublic%20class%20Work03%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20TASK_QUEUE_NAME%20%3D%20%5C%22ack_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22C1%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%97%B6%E9%97%B4%E8%BE%83%E7%9F%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%B2%89%E7%9D%A11s%5Cn%20%20%20%20%20%20%20%20%20%20%20%20SleepUtils.sleep(1)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%88%E9%80%9A%E8%BF%87%E4%BF%A1%E9%81%93%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F*%E5%8F%82%E6%95%B0%EF%BC%9A%5Cn%20%20%20%20%20%20%20%20%20%20%20%201.%20%E6%B6%88%E6%81%AF%E7%9A%84%E6%A0%87%E8%AE%B0%20tag%5Cn%20%20%20%20%20%20%20%20%20%20%20%202.%20%E6%98%AF%E5%90%A6%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%20%20false%3A%E4%B8%8D%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%E4%BF%A1%E9%81%93%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8Ctrue%3A%E6%89%B9%E9%87%8F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicAck(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E9%87%87%E7%94%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%5Cn%20%20%20%20%20%20%20%20boolean%20autoAck%20%3D%20false%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(TASK_QUEUE_NAME%2C%20autoAck%2C%20deliverCallback%2C%20(consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(consumerTag%20%2B%20%5C%22%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%9B%9E%E8%B0%83%E9%80%BB%E8%BE%91%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D))%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%227fa74098%22%7D\"></card><p data-lake-id=\"u510b8aea\" id=\"u510b8aea\"><br></p><p data-lake-id=\"u13871e3e\" id=\"u13871e3e\"><span data-lake-id=\"u6439174b\" id=\"u6439174b\">消费者二：</span></p><p data-lake-id=\"ufa927a3f\" id=\"ufa927a3f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.three%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.atguigu.rabbitmq.utils.SleepUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2014%3A58%5Cn%20*%20%E6%B6%88%E6%81%AF%E5%9C%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E6%97%B6%E4%B8%8D%E4%B8%A2%E5%A4%B1%EF%BC%8C%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E9%87%8D%E6%96%B0%E6%B6%88%E8%B4%B9%5Cn%20*%2F%5Cnpublic%20class%20Work04%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20TASK_QUEUE_NAME%20%3D%20%5C%22ack_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22C2%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%97%B6%E9%97%B4%E8%BE%83%E7%9F%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%B2%89%E7%9D%A11s%5Cn%20%20%20%20%20%20%20%20%20%20%20%20SleepUtils.sleep(30)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%88%E9%80%9A%E8%BF%87%E4%BF%A1%E9%81%93%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F*%E5%8F%82%E6%95%B0%EF%BC%9A%5Cn%20%20%20%20%20%20%20%20%20%20%20%201.%20%E6%B6%88%E6%81%AF%E7%9A%84%E6%A0%87%E8%AE%B0%20tag%5Cn%20%20%20%20%20%20%20%20%20%20%20%202.%20%E6%98%AF%E5%90%A6%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%20%20false%3A%E4%B8%8D%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%E4%BF%A1%E9%81%93%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8Ctrue%3A%E6%89%B9%E9%87%8F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicAck(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E9%87%87%E7%94%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%5Cn%20%20%20%20%20%20%20%20boolean%20autoAck%20%3D%20false%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(TASK_QUEUE_NAME%2C%20autoAck%2C%20deliverCallback%2C%20(consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(consumerTag%20%2B%20%5C%22%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%9B%9E%E8%B0%83%E9%80%BB%E8%BE%91%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D))%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22f6acdd41%22%7D\"></card><p data-lake-id=\"ucab58ba8\" id=\"ucab58ba8\"><br></p><p data-lake-id=\"u3fb35c0e\" id=\"u3fb35c0e\"><span data-lake-id=\"ub6504087\" id=\"ub6504087\">测试步骤：<br /></span><span data-lake-id=\"uc0861472\" id=\"uc0861472\">① 先启动 task2，创建 ack_queue 队列；（在 ip:15672 的 queue 列表中可以看到目前拥有的队列）<br /></span><span data-lake-id=\"uf95d76a3\" id=\"uf95d76a3\">② 启动 work02，work03 接收消息（消费者）；<br /></span><span data-lake-id=\"ua771a0ff\" id=\"ua771a0ff\">③ 发消息：在 task2 控制台输入 aa,bb,cc,dd,ee,ff，可以看到 work2 和 work3 是轮训接收消息；如果到 work03 应该接收消息 ee 时，work03 突然挂掉，此时 ee 会被转发给 work02 中的 C1，这时 C1 会接收到 ee，因此消息不会丢失，这说明了 rabbitmq 有手动应答的能力，只要没有收到消息，就不会手动应答，从而将消息放回队列。而队列又再次将消息传递给 C1 进行重新消费，从而导致 ee 并没有丢失。</span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638348662336-051f5011-f512-44d1-bb05-053e49ba050c.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D499%26id%3Du60c5aa9e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D499%26originWidth%3D1092%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D254728%26status%3Ddone%26style%3Dnone%26taskId%3Du6c03afcd-9d58-4d4b-b839-5e4801e20e0%26title%3D%26width%3D1092%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1092%2C%22originHeight%22%3A499%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f5f5f5%22%2C%22id%22%3A%22Rq0q6%22%7D\"></card></p><p data-lake-id=\"ub25bd699\" id=\"ub25bd699\"><br></p><h2 data-lake-id=\"274a6bb3\" id=\"274a6bb3\"><span data-lake-id=\"u3b0468ca\" id=\"u3b0468ca\">队列持久化</span></h2><p data-lake-id=\"u65611189\" id=\"u65611189\"><br></p><p data-lake-id=\"ue951fa0d\" id=\"ue951fa0d\"><span data-lake-id=\"u4a41f4f0\" id=\"u4a41f4f0\">如果存在同名未被持久化的队列，则需要先删除原先的未被持久化的队列，再重新生成一个持久化队列。</span></p><p data-lake-id=\"u9565990f\" id=\"u9565990f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cnboolean%20durable%20%3D%20true%3B%20%2F%2F%E5%9C%A8%E7%94%9F%E4%BA%A7%E8%80%85%E4%B8%AD%EF%BC%8C%E9%9C%80%E8%A6%81%E8%AE%A9queue%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96%5Cnchannel.queueDeclare(TASK_QUEUE_NAME%2C%20durable%2C%20false%2C%20false%2C%20null)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221a197cbd%22%7D\"></card><p data-lake-id=\"ua4a455e1\" id=\"ua4a455e1\"><br></p><p data-lake-id=\"u003d6059\" id=\"u003d6059\"><span data-lake-id=\"ub4006d96\" id=\"ub4006d96\">生成一个持久化队列之后，在 rabbitmq 控制台中这个队列的 features 属性会出现 D（代表持久化）。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638359722330-59d15b49-1b8d-4d93-85aa-ecd40227bd45.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D129%26id%3Dufd6f763b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D129%26originWidth%3D781%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D13881%26status%3Ddone%26style%3Dnone%26taskId%3Duab54d6ef-4036-4edf-bca6-ba4a9dcac1d%26title%3D%26width%3D781%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A781%2C%22originHeight%22%3A129%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f3f1f0%22%2C%22id%22%3A%22iMXeX%22%7D\"></card></p><p data-lake-id=\"u3e80b572\" id=\"u3e80b572\"><br></p><h2 data-lake-id=\"f1739dad\" id=\"f1739dad\"><span data-lake-id=\"ufec32f24\" id=\"ufec32f24\">消息持久化</span></h2><p data-lake-id=\"uc661f556\" id=\"uc661f556\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E8%AE%BE%E7%BD%AE%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E4%B8%BA%E6%8C%81%E4%B9%85%E5%8C%96%E6%B6%88%E6%81%AF%EF%BC%88%E8%A6%81%E6%B1%82%E4%BF%9D%E5%AD%98%E5%88%B0%E7%A3%81%E7%9B%98%E4%B8%8AMessageProperties.PERSISTENT_TEXT_PLAIN%EF%BC%89%5Cnchannel.basicPublish(%5C%22%5C%22%2C%20TASK_QUEUE_NAME%2C%20MessageProperties.PERSISTENT_TEXT_PLAIN%2C%20message.getBytes())%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222ac9ced1%22%7D\"></card><p data-lake-id=\"u478658c1\" id=\"u478658c1\"><br></p><p data-lake-id=\"u88b0d835\" id=\"u88b0d835\"><br></p><p data-lake-id=\"u2a1a3ee8\" id=\"u2a1a3ee8\"><br></p><h2 data-lake-id=\"afba844e\" id=\"afba844e\"><span data-lake-id=\"u1e31118a\" id=\"u1e31118a\">不公平分发</span></h2><p data-lake-id=\"ubf424800\" id=\"ubf424800\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%9C%A8%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%AD%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E4%B9%8B%E5%89%8D%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%85%AC%E5%B9%B3%E5%88%86%E5%8F%91%5Cnint%20prefetchCount%20%3D%201%3B%5Cnchannel.basicQos(prefetchCount)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22b23fdf5a%22%7D\"></card><p data-lake-id=\"u6ed41d59\" id=\"u6ed41d59\"><br></p><p data-lake-id=\"u828c250f\" id=\"u828c250f\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638361240814-a1349c7f-2e3e-410a-ba3b-f2f872fab0bb.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D232%26id%3Du1ff04a34%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D232%26originWidth%3D385%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D20173%26status%3Ddone%26style%3Dnone%26taskId%3Dub1b60899-802e-4d67-9aed-a99c48b5db3%26title%3D%26width%3D385%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A385%2C%22originHeight%22%3A232%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23303d45%22%2C%22id%22%3A%22vTMLG%22%7D\"></card><span data-lake-id=\"uac36cfc2\" id=\"uac36cfc2\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638361251165-68b13d22-fe49-4fd8-9471-26161051c180.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D177%26id%3Du477bebf6%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D177%26originWidth%3D431%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D18613%26status%3Ddone%26style%3Dnone%26taskId%3Due60522ee-50ed-46f9-ae69-472369ce4b6%26title%3D%26width%3D431%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A431%2C%22originHeight%22%3A177%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232c3a42%22%2C%22id%22%3A%22zGQk4%22%7D\"></card></p><p data-lake-id=\"u606a7603\" id=\"u606a7603\"><br></p><h2 data-lake-id=\"e7e8ffe0\" id=\"e7e8ffe0\"><span data-lake-id=\"u8c5b6027\" id=\"u8c5b6027\">预取值</span></h2><p data-lake-id=\"uc821be09\" id=\"uc821be09\"><br></p><p data-lake-id=\"uf28a9818\" id=\"uf28a9818\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638361857297-fa168e46-191d-44b2-8ce2-df2cb52a382d.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D282%26id%3Due1e2c233%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D453%26originWidth%3D1130%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D347909%26status%3Ddone%26style%3Dnone%26taskId%3Due241edd5-d375-46cb-9668-4a4eb4d7c9c%26title%3D%26width%3D703.0000610351562%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1130%2C%22originHeight%22%3A453%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e4e4e5%22%2C%22id%22%3A%22mwjn3%22%7D\"></card></p><p data-lake-id=\"u85729c36\" id=\"u85729c36\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22int%20prefetchCount%20%3D%205%3B%5Cnchannel.basicQos(prefetchCount)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221f902658%22%7D\"></card><p data-lake-id=\"uac932245\" id=\"uac932245\"><br></p><p data-lake-id=\"ucf3fd997\" id=\"ucf3fd997\"><br></p><p data-lake-id=\"u92071e4b\" id=\"u92071e4b\"><br></p><h2 data-lake-id=\"1e9c309f\" id=\"1e9c309f\"><span data-lake-id=\"u32130f3f\" id=\"u32130f3f\">发布确认原理</span></h2><p data-lake-id=\"ua7b44864\" id=\"ua7b44864\"><br></p><p data-lake-id=\"uf9cf497a\" id=\"uf9cf497a\"><br></p><p data-lake-id=\"uc237fdfc\" id=\"uc237fdfc\"><br></p><h2 data-lake-id=\"e61fd426\" id=\"e61fd426\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638364988019-b29d7c44-ebca-4978-95fd-034500d1bd7b.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D369%26id%3Du98ff6bb0%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D369%26originWidth%3D930%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D222643%26status%3Ddone%26style%3Dnone%26taskId%3Dua25c2547-8233-4893-8d5b-4406b84e85f%26title%3D%26width%3D930%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A930%2C%22originHeight%22%3A369%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23fafafb%22%2C%22id%22%3A%22Xek0V%22%7D\"></card></h2><p data-lake-id=\"ub971425a\" id=\"ub971425a\"><br></p><p data-lake-id=\"uff8b9cca\" id=\"uff8b9cca\"><span data-lake-id=\"uc353e344\" id=\"uc353e344\">在信道之后开启发布确认：</span></p><p data-lake-id=\"u0e87e7d9\" id=\"u0e87e7d9\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E4%BF%A1%E9%81%93%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cnchannel.confirmSelect()%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22ad539932%22%7D\"></card><p data-lake-id=\"u240d4823\" id=\"u240d4823\"><br></p><p data-lake-id=\"uda74d6f1\" id=\"uda74d6f1\"><br></p><p data-lake-id=\"u11342da4\" id=\"u11342da4\"><br></p><h2 data-lake-id=\"f1ad8c9b\" id=\"f1ad8c9b\"><span data-lake-id=\"uf0e1d45c\" id=\"uf0e1d45c\">单个发布确认</span></h2><p data-lake-id=\"u3cbeb3a0\" id=\"u3cbeb3a0\"><br></p><p data-lake-id=\"uc4d6c015\" id=\"uc4d6c015\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638365489548-64267da5-f60d-4b88-98af-bdf5806d5038.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D203%26id%3Dub1148f56%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D203%26originWidth%3D993%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D342872%26status%3Ddone%26style%3Dnone%26taskId%3Du2df32a3e-4c69-4599-868a-d81e33495ec%26title%3D%26width%3D993%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A993%2C%22originHeight%22%3A203%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23d0dcda%22%2C%22id%22%3A%22qVQAu%22%7D\"></card></p><p data-lake-id=\"u6734b8e1\" id=\"u6734b8e1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.four%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.UUID%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2021%3A32%5Cn%20*%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%E6%A8%A1%E5%BC%8F%EF%BC%9A%5Cn%20*%20%E4%BD%BF%E7%94%A8%E7%9A%84%E6%97%B6%E9%97%B4%20%20%E6%AF%94%E8%BE%83%E5%93%AA%E7%A7%8D%E7%A1%AE%E8%AE%A4%E6%96%B9%E5%BC%8F%E6%98%AF%E6%9C%80%E5%A5%BD%E7%9A%84%5Cn%20*%201.%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%20*%202.%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%5Cn%20*%203.%E5%BC%82%E6%AD%A5%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%5Cn%20*%2F%5Cnpublic%20class%20ConfireMessage%20%7B%5Cn%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%AA%E6%95%B0%5Cn%20%20%20%20public%20static%20final%20int%20MESSAGE_COUNT%20%3D%201000%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20InterruptedException%2C%20TimeoutException%2C%20IOException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F1.%20%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20ConfireMessage.publicMessageIndividually()%3B%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B629726ms%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageIndividually()%20throws%20IOException%2C%20TimeoutException%2C%20InterruptedException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20massage%20%3D%20i%20%2B%20%5C%22%5C%22%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20massage.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8D%95%E4%B8%AA%E6%B6%88%E6%81%AF%E5%B0%B1%E9%A9%AC%E4%B8%8A%E8%BF%9B%E8%A1%8C%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20boolean%20flag%20%3D%20channel.waitForConfirms()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(flag)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E6%88%90%E5%8A%9F%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%2BMESSAGE_COUNT%2B%5C%22%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%2B(end%20-%20begin)%2B%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22e9bbaca4%22%7D\"></card><p data-lake-id=\"u662ff4b5\" id=\"u662ff4b5\"><br></p><p data-lake-id=\"u9a18410d\" id=\"u9a18410d\"><br></p><p data-lake-id=\"ud961b543\" id=\"ud961b543\"><br></p><h2 data-lake-id=\"498cf9b3\" id=\"498cf9b3\"><span data-lake-id=\"u10e0af31\" id=\"u10e0af31\">批量发布确认</span></h2><p data-lake-id=\"ue56ad038\" id=\"ue56ad038\"><br></p><p data-lake-id=\"ub790e1b8\" id=\"ub790e1b8\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638366964213-10397181-357d-4896-9e91-84690b69c982.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D137%26id%3Dude627a73%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D137%26originWidth%3D968%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D206130%26status%3Ddone%26style%3Dnone%26taskId%3Du0c3dafe3-1f66-4cc1-83ba-f5e8edae8b3%26title%3D%26width%3D968%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A968%2C%22originHeight%22%3A137%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23d7d9d8%22%2C%22id%22%3A%22tMsLz%22%7D\"></card></p><p data-lake-id=\"u31587570\" id=\"u31587570\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageBatch()%20throws%20IOException%2C%20TimeoutException%2C%20InterruptedException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%E5%A4%A7%E5%B0%8F%5Cn%20%20%20%20%20%20%20%20int%20batchSize%20%3D%20100%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E5%B8%83%E6%B6%88%E6%81%AF%EF%BC%8C%20%E6%89%B9%E9%87%8F%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20i%20%2B%20%5C%22%5C%22%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20%25%20batchSize%20%3D%3D%200)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.waitForConfirms()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%20%2B%20MESSAGE_COUNT%20%2B%20%5C%22%E4%B8%AA%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%20%2B%20(end%20-%20begin)%20%2B%20%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222f62025c%22%7D\"></card><p data-lake-id=\"uf3e134d2\" id=\"uf3e134d2\"><br></p><p data-lake-id=\"u47f2cb22\" id=\"u47f2cb22\"><br></p><p data-lake-id=\"u6d154a3b\" id=\"u6d154a3b\"><br></p><h2 data-lake-id=\"836eb661\" id=\"836eb661\"><span data-lake-id=\"u4945ac71\" id=\"u4945ac71\">异步发布确认</span></h2><p data-lake-id=\"u0f0edc87\" id=\"u0f0edc87\"><br></p><p data-lake-id=\"u494d78ca\" id=\"u494d78ca\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638368249755-46e1c3b8-f891-48b0-a77b-21b9a80f4e5e.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D119%26id%3Du5fcd19f7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D119%26originWidth%3D1189%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D231115%26status%3Ddone%26style%3Dnone%26taskId%3Du473c99f9-e088-4ad3-84e3-82e606c7d63%26title%3D%26width%3D1189%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1189%2C%22originHeight%22%3A119%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e2dfd4%22%2C%22id%22%3A%22Jwh7I%22%7D\"></card><span data-lake-id=\"uf46f8c96\" id=\"uf46f8c96\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638368124379-5cdb8cbd-707a-4a1f-92f4-3dc511a9ec11.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D571%26id%3Du4b5d988b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D441%26originWidth%3D964%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D239080%26status%3Ddone%26style%3Dnone%26taskId%3Dua0b85de0-7119-4e3a-a0be-75854b9aaac%26title%3D%26width%3D1248.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A964%2C%22originHeight%22%3A441%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f7f7f7%22%2C%22id%22%3A%22T1TVR%22%7D\"></card></p><p data-lake-id=\"u52c10243\" id=\"u52c10243\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%AA%E6%95%B0%5Cn%20%20%20%20public%20static%20final%20int%20MESSAGE_COUNT%20%3D%201000%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20InterruptedException%2C%20TimeoutException%2C%20IOException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F1.%20%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%2F%2F%20%20%20%20%20%20%20%20ConfireMessage.publicMessageIndividually()%3B%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B629726ms%5Cn%2F%2F%20%20%20%20%20%20%20%202.%20%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%5Cn%2F%2F%20%20%20%20%20%20%20%20ConfireMessage.publicMessageBatch()%3B%20%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6761ms%EF%BC%88%E5%BC%8A%E7%AB%AF%EF%BC%9A%E6%97%A0%E6%B3%95%E7%A1%AE%E8%AE%A4%E5%93%AA%E4%B8%AA%E6%B6%88%E6%81%AF%E6%9C%AA%E8%A2%AB%E7%A1%AE%E8%AE%A4%EF%BC%89%5Cn%2F%2F%20%20%20%20%20%20%20%203.%20%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20ConfireMessage.publicMessageAsync()%3B%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6181ms%5Cn%20%20%20%20%7D%5Cn%2F%2F%E5%BC%82%E6%AD%A5%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageAsync()%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%88%90%E5%8A%9F%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20ackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20nackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%87%86%E5%A4%87%E6%B6%88%E6%81%AF%E7%9A%84%E7%9B%91%E5%90%AC%E5%99%A8%EF%BC%8C%E7%9B%91%E5%90%AC%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E6%88%90%E5%8A%9F%E4%BA%86%EF%BC%8C%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E5%A4%B1%E8%B4%A5%E4%BA%86%5Cn%20%20%20%20%20%20%20%20channel.addConfirmListener(ackCallback%2C%20nackCallback)%3B%20%20%2F%2F%E5%BC%82%E6%AD%A5%E9%80%9A%E7%9F%A5%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%82%E6%AD%A5%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20massage%20%3D%20%5C%22%E6%B6%88%E6%81%AF%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20massage.getBytes())%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%20%2B%20MESSAGE_COUNT%20%2B%20%5C%22%E4%B8%AA%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%20%2B%20(end%20-%20begin)%20%2B%20%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d6247f11%22%7D\"></card><p data-lake-id=\"uc4a48e34\" id=\"uc4a48e34\"><br></p><p data-lake-id=\"u32eb914f\" id=\"u32eb914f\"><br></p><p data-lake-id=\"u776a938a\" id=\"u776a938a\"><br></p><h2 data-lake-id=\"e8b363bb\" id=\"e8b363bb\"><span data-lake-id=\"uf8094a1f\" id=\"uf8094a1f\">如何处理异步未确认消息</span></h2><p data-lake-id=\"ucecfe414\" id=\"ucecfe414\"><br></p><p data-lake-id=\"uf632b3ef\" id=\"uf632b3ef\"><span data-lake-id=\"u39a67765\" id=\"u39a67765\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638404469016-06a08296-9aa6-4d65-8d1c-4c70fb4cd5b8.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D97%26id%3Du0927e367%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D97%26originWidth%3D1033%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D122865%26status%3Ddone%26style%3Dnone%26taskId%3Du67d3a3c6-2f1a-4be9-9c0c-f7d2e743935%26title%3D%26width%3D1033%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22frSPr%22%7D\"></card><span data-lake-id=\"u2e30a431\" id=\"u2e30a431\"><br /></span><span data-lake-id=\"u52adf52f\" id=\"u52adf52f\">上述异步确认有两个线程：</span></p><p data-lake-id=\"uf8bfc172\" id=\"uf8bfc172\"><br></p><ul list=\"u45e3622c\"><li fid=\"uc618e51c\" data-lake-id=\"ueacc7571\" id=\"ueacc7571\"><span data-lake-id=\"u97ac8cde\" id=\"u97ac8cde\">发消息的线程</span></li></ul><ul list=\"u70863da8\"><li fid=\"u94e1bd53\" data-lake-id=\"u5e95d849\" id=\"u5e95d849\"><span data-lake-id=\"uf05b2386\" id=\"uf05b2386\">监听器的线程</span></li></ul><p data-lake-id=\"u51d043a1\" id=\"u51d043a1\"><br></p><p data-lake-id=\"u969efa72\" id=\"u969efa72\"><span data-lake-id=\"u56ff6b24\" id=\"u56ff6b24\">两个线程之间交互，只能用</span><strong><span data-lake-id=\"ue97cc8c5\" id=\"ue97cc8c5\">并发链路式队列（可以在确认发布与发布线程之间进行消息传递）</span></strong><span data-lake-id=\"ud94ae86f\" id=\"ud94ae86f\">。</span></p><p data-lake-id=\"u60c1e577\" id=\"u60c1e577\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%BC%82%E6%AD%A5%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageAsync()%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%9C%89%E5%BA%8F%E7%9A%84%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E9%80%82%E7%94%A8%E4%BA%8E%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E6%83%85%E5%86%B5%5Cn%20%20%20%20%20%20%20%201.%20%E8%BD%BB%E6%9D%BE%E7%9A%84%E5%B0%86%E5%BA%8F%E5%8F%B7%E4%B8%8E%E6%B6%88%E6%81%AF%E8%BF%9B%E8%A1%8C%E5%85%B3%E8%81%94%5Cn%20%20%20%20%20%20%20%202.%20%E8%BD%BB%E6%9D%BE%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E6%9D%A1%E7%9B%AE%EF%BC%8C%E5%8F%AA%E8%A6%81%E7%BB%99%E5%BA%8F%E5%8F%B7%5Cn%20%20%20%20%20%20%20%203.%E6%94%AF%E6%8C%81%E9%AB%98%E5%B9%B6%E5%8F%91(%E5%A4%9A%E7%BA%BF%E7%A8%8B)%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20ConcurrentSkipListMap%3CLong%2CString%3E%20outstandingConfirms%20%3D%20new%20ConcurrentSkipListMap%3C%3E()%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%88%90%E5%8A%9F%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20ackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F2.%20%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%20%20%20%E5%89%A9%E4%B8%8B%E7%9A%84%E5%B0%B1%E6%98%AF%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(multiple)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%A6%82%E6%9E%9C%E6%98%AF%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%EF%BC%8C%E5%B0%B1%E5%8E%BB%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ConcurrentNavigableMap%3CLong%2CString%3E%20confirmed%20%3D%20outstandingConfirms.headMap(deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20confirmed.clear()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%A6%82%E6%9E%9C%E6%98%AF%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%EF%BC%8C%E5%B0%B1%E5%8E%BB%E5%8D%95%E4%B8%AA%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20outstandingConfirms.remove(deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20nackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F3.%20%E6%89%93%E5%8D%B0%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%E6%9C%89%E5%93%AA%E4%BA%9B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20outstandingConfirms.get(deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%EF%BC%9A%5C%22%2Bmessage%2B%5C%22%3A%3A%3A%3A%3A%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AFtag%3A%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%87%86%E5%A4%87%E6%B6%88%E6%81%AF%E7%9A%84%E7%9B%91%E5%90%AC%E5%99%A8%EF%BC%8C%E7%9B%91%E5%90%AC%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E6%88%90%E5%8A%9F%E4%BA%86%EF%BC%8C%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E5%A4%B1%E8%B4%A5%E4%BA%86%5Cn%20%20%20%20%20%20%20%20channel.addConfirmListener(ackCallback%2C%20nackCallback)%3B%20%20%2F%2F%E5%BC%82%E6%AD%A5%E9%80%9A%E7%9F%A5%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22%E6%B6%88%E6%81%AF%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%201.%20%E6%AD%A4%E5%A4%84%E8%AE%B0%E5%BD%95%E4%B8%8B%E6%89%80%E6%9C%89%E8%A6%81%E5%8F%91%E9%80%81%E7%9A%84%E6%B6%88%E6%81%AF%20%20%E6%B6%88%E6%81%AF%E7%9A%84%E6%80%BB%E5%92%8C(%E6%AF%8F%E5%8F%91%E4%B8%80%E6%AC%A1%E6%B6%88%E6%81%AF%E5%B0%B1%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20outstandingConfirms.put(channel.getNextPublishSeqNo()%2Cmessage)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20message.getBytes())%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%20%2B%20MESSAGE_COUNT%20%2B%20%5C%22%E4%B8%AA%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%20%2B%20(end%20-%20begin)%20%2B%20%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220a036573%22%7D\"></card><p data-lake-id=\"u24ef3936\" id=\"u24ef3936\"><br></p><blockquote data-lake-id=\"u468ca4b1\" id=\"u468ca4b1\"><p data-lake-id=\"u6e59d7fb\" id=\"u6e59d7fb\"><span data-lake-id=\"u4c233bde\" id=\"u4c233bde\">以上三种发布确认速度对比：</span></p></blockquote><p data-lake-id=\"u53e9db23\" id=\"u53e9db23\"><br></p><ul list=\"ubda67d26\"><li fid=\"u90682ff7\" data-lake-id=\"uafded0e5\" id=\"uafded0e5\"><span data-lake-id=\"u55706386\" id=\"u55706386\">单独发布消息：同步等待确认，简单，但吞吐量非常有限。</span></li></ul><ul list=\"u920464d7\"><li fid=\"u864c41fe\" data-lake-id=\"u94b38ace\" id=\"u94b38ace\"><span data-lake-id=\"ue688ad98\" id=\"ue688ad98\">批量发布消息：批量同步等待确认，简单，合理的吞吐量，一旦出现问题，很难推断出是哪条出现了问题</span></li></ul><ul list=\"u1811646a\"><li fid=\"ucee8d4b9\" data-lake-id=\"uc70e4029\" id=\"uc70e4029\"><span data-lake-id=\"uce17cf14\" id=\"uce17cf14\">异步处理：最佳性能和资源利用，在出现错误的情况下，可以很好的控制，但是实现起来稍微难些。</span></li></ul><p data-lake-id=\"u9569dffd\" id=\"u9569dffd\"><br></p><h2 data-lake-id=\"04596875\" id=\"04596875\"><span data-lake-id=\"u613065a8\" id=\"u613065a8\">交换机</span></h2><p data-lake-id=\"u2d479111\" id=\"u2d479111\"><br></p><p data-lake-id=\"u97889cc2\" id=\"u97889cc2\"><br></p><p data-lake-id=\"u80d50401\" id=\"u80d50401\"><br></p><h3 data-lake-id=\"a3034a5f\" id=\"a3034a5f\"><span data-lake-id=\"ud107708e\" id=\"ud107708e\">交换机的作用</span></h3><p data-lake-id=\"u03675e5f\" id=\"u03675e5f\"><br></p><p data-lake-id=\"u10101ef7\" id=\"u10101ef7\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638406810806-e429e00e-78d1-42e2-ab92-c3a53f8c2fa9.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D270%26id%3Duc3415ba1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D387%26originWidth%3D1291%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D191628%26status%3Ddone%26style%3Dnone%26taskId%3Duee2f50b0-7b80-4d38-9c1b-25806445f5f%26title%3D%26width%3D900.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22tFgNi%22%7D\"></card></p><p data-lake-id=\"u73fbd331\" id=\"u73fbd331\"><br></p><h3 data-lake-id=\"f71f343d\" id=\"f71f343d\"><span data-lake-id=\"udce3eba1\" id=\"udce3eba1\">交换机的类型</span></h3><p data-lake-id=\"ufcff41c1\" id=\"ufcff41c1\"><br></p><ul list=\"u6b7fcdd4\"><li fid=\"uc60d6b8e\" data-lake-id=\"ud837129c\" id=\"ud837129c\"><span data-lake-id=\"u86ef0948\" id=\"u86ef0948\">直接（direct）== 路由类型</span></li></ul><ul list=\"u64dabf1f\"><li fid=\"u13283976\" data-lake-id=\"u3a192338\" id=\"u3a192338\"><span data-lake-id=\"u11dc7ef6\" id=\"u11dc7ef6\">主题（topic）</span></li></ul><ul list=\"uf43ec12e\"><li fid=\"uf7678f46\" data-lake-id=\"u181beacc\" id=\"u181beacc\"><span data-lake-id=\"ubaca4975\" id=\"ubaca4975\">标题（headers）（企业不常用）</span></li></ul><ul list=\"uf352ef6e\"><li fid=\"u49f78635\" data-lake-id=\"ude1c64c5\" id=\"ude1c64c5\"><span data-lake-id=\"u6f4ca6d9\" id=\"u6f4ca6d9\">扇出（fanout）== 发布订阅类型</span></li></ul><ul list=\"u17450d46\"><li fid=\"u8c74f284\" data-lake-id=\"ubc65d5ac\" id=\"ubc65d5ac\"><span data-lake-id=\"uc966f232\" id=\"uc966f232\">无名类型（默认类型），通常用空串进行识别</span></li></ul><p data-lake-id=\"u7841bf48\" id=\"u7841bf48\"><br></p><p data-lake-id=\"uabda8adb\" id=\"uabda8adb\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638407294007-f1bd9624-be98-4b90-ba72-9c29d88c326d.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D76%26id%3Du21ac6756%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D76%26originWidth%3D987%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D103665%26status%3Ddone%26style%3Dnone%26taskId%3Du47150f74-3b3b-4cc4-befe-f25d9650214%26title%3D%26width%3D987%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22KlfHY%22%7D\"></card></p><p data-lake-id=\"uefca42b0\" id=\"uefca42b0\"><br></p><h3 data-lake-id=\"192ebf07\" id=\"192ebf07\"><span data-lake-id=\"u9072179f\" id=\"u9072179f\">临时队列</span></h3><p data-lake-id=\"u759723a3\" id=\"u759723a3\"><br></p><p data-lake-id=\"ua828dd89\" id=\"ua828dd89\"><span data-lake-id=\"ud0203d2a\" id=\"ud0203d2a\">不带有持久化，一旦断开消费者的连接，队列将被自动删除。<br /></span><span data-lake-id=\"uef76f3f7\" id=\"uef76f3f7\">​</span></p><p data-lake-id=\"u117c1c40\" id=\"u117c1c40\"><br></p><p data-lake-id=\"udc7c1eb9\" id=\"udc7c1eb9\"><span data-lake-id=\"u26374f4c\" id=\"u26374f4c\">创建临时队列：</span></p><p data-lake-id=\"uc7d27537\" id=\"uc7d27537\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22String%20queueName%20%3D%20channel.queueDeclare().getQueue()%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22493f5cb2%22%7D\"></card><p data-lake-id=\"uf4a72fb6\" id=\"uf4a72fb6\"><br></p><p data-lake-id=\"u0810dd91\" id=\"u0810dd91\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638407906977-786b78e8-bfba-4cab-9aee-9ac7ec38a884.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D278%26id%3Du31ce7deb%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D410%26originWidth%3D1086%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D55531%26status%3Ddone%26style%3Dnone%26taskId%3Dub3aa0ca4-c823-418b-b8c7-0b7fbd67333%26title%3D%26width%3D736.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22T0K86%22%7D\"></card></p><p data-lake-id=\"u186f5254\" id=\"u186f5254\"><br></p><h3 data-lake-id=\"f4f12c7a\" id=\"f4f12c7a\"><span data-lake-id=\"ucf133bc6\" id=\"ucf133bc6\">绑定</span></h3><p data-lake-id=\"u3f311869\" id=\"u3f311869\"><br></p><p data-lake-id=\"u06749896\" id=\"u06749896\"><span data-lake-id=\"u2397429d\" id=\"u2397429d\">就是交换机与队列之间的捆绑关系。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638408143523-d4c904d9-33e5-46bd-ad67-885e78b4c34b.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D637%26id%3Du8140e36d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D637%26originWidth%3D487%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D26522%26status%3Ddone%26style%3Dnone%26taskId%3Dua5ea4c46-36c5-4183-aefe-f6a3f676385%26title%3D%26width%3D487%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22fwITJ%22%7D\"></card></p><p data-lake-id=\"u2f756d95\" id=\"u2f756d95\"><br></p><h3 data-lake-id=\"b3f97d74\" id=\"b3f97d74\"><span data-lake-id=\"u8d977267\" id=\"u8d977267\">发布订阅模式（扇出模式 fanout）</span></h3><p data-lake-id=\"u60ac1fb4\" id=\"u60ac1fb4\"><br></p><p data-lake-id=\"u47c5c857\" id=\"u47c5c857\"><span data-lake-id=\"ufc889c6d\" id=\"ufc889c6d\">类似广播，两个 routingkey 相同<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638408427104-577b627a-521a-4d94-89be-5bf0102440ea.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D218%26id%3Du3ae99c2f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D292%26originWidth%3D1200%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D205919%26status%3Ddone%26style%3Dnone%26taskId%3Dufe252eb8-02f2-410e-8b74-b8d091c0d4a%26title%3D%26width%3D894%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22PeGnm%22%7D\"></card></p><p data-lake-id=\"u34a7c050\" id=\"u34a7c050\"><br></p><ol list=\"u4e11381f\"><li fid=\"uffe46d07\" data-lake-id=\"ua058bafa\" id=\"ua058bafa\"><span data-lake-id=\"udd2b4bc0\" id=\"udd2b4bc0\">生产者</span></li></ol><p data-lake-id=\"u527d2fcd\" id=\"u527d2fcd\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.five%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A59%5Cn%20*%20%E5%8F%91%E6%B6%88%E6%81%AF%EF%BC%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20*%2F%5Cnpublic%20class%20EmitLog%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22fanout%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(EXCHANGE_NAME%2C%20%5C%22%5C%22%2C%20null%2C%20message.getBytes(StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22064b8440%22%7D\"></card><p data-lake-id=\"ube6bfff0\" id=\"ube6bfff0\"><br></p><ol list=\"u503d83bd\" start=\"2\"><li fid=\"udec7f53c\" data-lake-id=\"u9725dfb0\" id=\"u9725dfb0\"><span data-lake-id=\"ue0140b5f\" id=\"ue0140b5f\">两个消费者</span></li></ol><p data-lake-id=\"u2a01f03c\" id=\"u2a01f03c\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.five%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A35%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogs01%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22fanout%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%20%20%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%20(%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%EF%BC%8C%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E5%BD%93%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E4%B8%8E%E9%98%9F%E5%88%97%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%98%9F%E5%88%97%E5%B0%B1%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4)%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20channel.queueDeclare().getQueue()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%EF%BC%8C%E6%8A%8A%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%E6%89%93%E5%8D%B0%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs01%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%224ebe62a0%22%7D\"></card><p data-lake-id=\"u7d8e0aa1\" id=\"u7d8e0aa1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.five%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A35%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogs02%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22fanout%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%20%20%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%20(%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%EF%BC%8C%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E5%BD%93%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E4%B8%8E%E9%98%9F%E5%88%97%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%98%9F%E5%88%97%E5%B0%B1%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4)%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20channel.queueDeclare().getQueue()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%EF%BC%8C%E6%8A%8A%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%E6%89%93%E5%8D%B0%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs02%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22bd022965%22%7D\"></card><p data-lake-id=\"ub0920585\" id=\"ub0920585\"><br></p><p data-lake-id=\"u9415957b\" id=\"u9415957b\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638410904168-80b297c1-26ef-4ee4-815c-065abea79bd2.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D328%26id%3Du29891926%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D328%26originWidth%3D580%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D28269%26status%3Ddone%26style%3Dnone%26taskId%3Du6700fa8b-9b2f-4717-91cf-0dfb20b528b%26title%3D%26width%3D580%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Jf7Cl%22%7D\"></card><span data-lake-id=\"uc0fe1860\" id=\"uc0fe1860\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638410913426-c4d1faa3-7b8b-478c-ba35-665d73e98e8b.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D248%26id%3Dua55ed718%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D248%26originWidth%3D528%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D34020%26status%3Ddone%26style%3Dnone%26taskId%3Du415b65a3-7d21-4e16-a1a0-a15d7f3c4ca%26title%3D%26width%3D528%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22HNmyl%22%7D\"></card><span data-lake-id=\"u6e5683e5\" id=\"u6e5683e5\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638410920504-2f4c6248-02a0-4765-8647-4c8ab63551e1.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D255%26id%3Du9c537a4f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D255%26originWidth%3D517%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D35282%26status%3Ddone%26style%3Dnone%26taskId%3Du97bfb701-f8bd-45ca-ac41-6f8259d9775%26title%3D%26width%3D517%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22BBNfG%22%7D\"></card></p><p data-lake-id=\"u64f3af66\" id=\"u64f3af66\"><br></p><h3 data-lake-id=\"a7c987c4\" id=\"a7c987c4\"><span data-lake-id=\"u0a451a87\" id=\"u0a451a87\">直接交换机（路由模式 direct）</span></h3><p data-lake-id=\"u6628277e\" id=\"u6628277e\"><br></p><p data-lake-id=\"uc914fe9f\" id=\"uc914fe9f\"><span data-lake-id=\"ud4ff4146\" id=\"ud4ff4146\">两个 routingkey 不相同<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638411099834-bf80fb1d-473a-4a01-8553-e47ee2cd3670.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D303%26id%3Dueba6aa41%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D303%26originWidth%3D874%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D98369%26status%3Ddone%26style%3Dnone%26taskId%3Du2145da18-8429-4959-ab30-43bcc28bb61%26title%3D%26width%3D874%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22t5eGH%22%7D\"></card><span data-lake-id=\"u1eb7de15\" id=\"u1eb7de15\"><br /></span><span data-lake-id=\"u9ba6bc34\" id=\"u9ba6bc34\">可以多重绑定。<br /></span><strong><span data-lake-id=\"uba4e10e3\" id=\"uba4e10e3\">生产者发消息给队列，直接交换机通过不同 routingkey 路由到相应的队列，然后消费者接收指定日志。</span></strong></p><p data-lake-id=\"u3ab1ef95\" id=\"u3ab1ef95\"><br></p><ol list=\"ub56a82f0\"><li fid=\"u29f08130\" data-lake-id=\"uf3812b97\" id=\"uf3812b97\"><span data-lake-id=\"ue933e58c\" id=\"ue933e58c\">发消息</span></li></ol><p data-lake-id=\"u7dffc5fc\" id=\"u7dffc5fc\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.six%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A59%5Cn%20*%20%E5%8F%91%E6%B6%88%E6%81%AF%EF%BC%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20*%2F%5Cnpublic%20class%20DirectLogs%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22direct_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(EXCHANGE_NAME%2C%20%5C%22error%5C%22%2C%20null%2C%20message.getBytes(StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222a901417%22%7D\"></card><p data-lake-id=\"uf9ac8eab\" id=\"uf9ac8eab\"><br></p><ol list=\"uad1b784c\" start=\"2\"><li fid=\"u3cab60b9\" data-lake-id=\"ufe981695\" id=\"ufe981695\"><span data-lake-id=\"u9b69f27d\" id=\"u9b69f27d\">接收消息</span></li></ol><p data-lake-id=\"uca90e43f\" id=\"uca90e43f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.six%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2010%3A15%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsDirect01%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22direct_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(%5C%22console%5C%22%2Cfalse%2Cfalse%2Cfalse%2Cnull)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(%5C%22console%5C%22%2CEXCHANGE_NAME%2C%5C%22info%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(%5C%22console%5C%22%2CEXCHANGE_NAME%2C%5C%22warning%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs01%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(%5C%22console%5C%22%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22fc2f4488%22%7D\"></card><p data-lake-id=\"u1cc8d4b5\" id=\"u1cc8d4b5\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.six%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2010%3A15%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsDirect02%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22direct_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(%5C%22disk%5C%22%2Cfalse%2Cfalse%2Cfalse%2Cnull)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(%5C%22disk%5C%22%2CEXCHANGE_NAME%2C%5C%22error%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs02%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(%5C%22disk%5C%22%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d5727d5b%22%7D\"></card><p data-lake-id=\"uab85209b\" id=\"uab85209b\"><br></p><p data-lake-id=\"u1a362bc4\" id=\"u1a362bc4\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638413931242-2c3ef4c2-f3e6-4e6e-ba39-5437dad24d40.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D182%26id%3Du9de2b784%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D182%26originWidth%3D630%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D21691%26status%3Ddone%26style%3Dnone%26taskId%3Du7cd93b89-df35-4f94-aa33-6626b0dc70b%26title%3D%26width%3D630%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22eyPPs%22%7D\"></card><span data-lake-id=\"u37cd2242\" id=\"u37cd2242\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638413948375-568b73ae-0203-4f53-9a9b-528667192aa2.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D182%26id%3Duc8400be0%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D182%26originWidth%3D683%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D24900%26status%3Ddone%26style%3Dnone%26taskId%3Du38d71d59-3dd8-4324-9fae-335fd043524%26title%3D%26width%3D683%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22U0kJT%22%7D\"></card></p><p data-lake-id=\"u154435a1\" id=\"u154435a1\"><br></p><h3 data-lake-id=\"c4e17e43\" id=\"c4e17e43\"><span data-lake-id=\"u9924c5e2\" id=\"u9924c5e2\">主题交换机（Topic）</span></h3><p data-lake-id=\"ubdbf1ba0\" id=\"ubdbf1ba0\"><br></p><p data-lake-id=\"ucae3280a\" id=\"ucae3280a\"><span data-lake-id=\"uc1d10b00\" id=\"uc1d10b00\">规范：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638414479059-98f3dc8e-ee99-4093-b2cb-81eaecec9acb.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D226%26id%3Du34e92b6a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D226%26originWidth%3D834%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D170475%26status%3Ddone%26style%3Dnone%26taskId%3Due217ff8b-9da9-493e-9a4b-07c6ab22bab%26title%3D%26width%3D834%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22KCIOt%22%7D\"></card><span data-lake-id=\"u579a3771\" id=\"u579a3771\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638415621949-8c1e4089-881d-482e-a377-ab7f224a2c92.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D257%26id%3Du76cf3ab8%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D257%26originWidth%3D801%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D151366%26status%3Ddone%26style%3Dnone%26taskId%3Du98d7748e-2fc6-4df3-a740-cae3ba06db9%26title%3D%26width%3D801%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22HeQJL%22%7D\"></card><span data-lake-id=\"u141af3b3\" id=\"u141af3b3\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638415680787-e95ef7a6-bec4-44b3-8e45-1e0c4adac6f7.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D350%26id%3Du280d2c9d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D350%26originWidth%3D829%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D181864%26status%3Ddone%26style%3Dnone%26taskId%3Du67807a72-c793-4b0b-a14e-e6270164016%26title%3D%26width%3D829%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22ZuvJl%22%7D\"></card><span data-lake-id=\"u97ad8abd\" id=\"u97ad8abd\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638415855921-8e2750b0-e5df-4b1c-90a3-7e3f696543d6.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D188%26id%3Duf97e55b4%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D188%26originWidth%3D920%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D178229%26status%3Ddone%26style%3Dnone%26taskId%3Dufb1118a1-0b9d-4a97-bd09-0ff626585f5%26title%3D%26width%3D920%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22iZC7I%22%7D\"></card></p><p data-lake-id=\"u5bf7d3d8\" id=\"u5bf7d3d8\"><br></p><h3 data-lake-id=\"36d4697d\" id=\"36d4697d\"><span data-lake-id=\"ud625f05f\" id=\"ud625f05f\">主题交换机（实战）</span></h3><p data-lake-id=\"ub70d80a5\" id=\"ub70d80a5\"><br></p><p data-lake-id=\"uca5a3ec7\" id=\"uca5a3ec7\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638416303199-5f9e655c-c5c2-4a16-9d12-ba873c31c8e6.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D331%26id%3Du07108cc7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D331%26originWidth%3D1114%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D231103%26status%3Ddone%26style%3Dnone%26taskId%3Dud57ef875-e371-4fa6-980a-20a29a7366e%26title%3D%26width%3D1114%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22zgYBJ%22%7D\"></card></p><p data-lake-id=\"u71bf4d07\" id=\"u71bf4d07\"><br></p><ol list=\"ud4092d2a\"><li fid=\"u74054fe3\" data-lake-id=\"ub54f7556\" id=\"ub54f7556\"><span data-lake-id=\"u8b30a1dc\" id=\"u8b30a1dc\">消费者</span></li></ol><p data-lake-id=\"u39a550d2\" id=\"u39a550d2\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.seven%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2011%3A37%5Cn%20*%20%E5%A3%B0%E6%98%8E%E4%B8%BB%E9%A2%98%E4%BA%A4%E6%8D%A2%E6%9C%BA%20%20%E5%8F%8A%E7%9B%B8%E5%85%B3%E9%98%9F%E5%88%97%5Cn%20*%20%3Cp%3E%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20C2%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsTopic01%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22topic_logs%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22topic%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20%5C%22Q1%5C%22%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%BB%91%E5%AE%9A%20routingkey%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22*.orange.*%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E9%98%9F%E5%88%97%EF%BC%9A%5C%22%20%2B%20queueName%20%2B%20%5C%22%E7%BB%91%E5%AE%9A%E9%94%AE%EF%BC%9A%5C%22%20%2B%20message.getEnvelope().getRoutingKey())%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221860808d%22%7D\"></card><p data-lake-id=\"ucf8d429e\" id=\"ucf8d429e\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.seven%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2011%3A37%5Cn%20*%20%E5%A3%B0%E6%98%8E%E4%B8%BB%E9%A2%98%E4%BA%A4%E6%8D%A2%E6%9C%BA%20%20%E5%8F%8A%E7%9B%B8%E5%85%B3%E9%98%9F%E5%88%97%5Cn%20*%20%3Cp%3E%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20C2%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsTopic02%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22topic_logs%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22topic%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20%5C%22Q2%5C%22%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%BB%91%E5%AE%9A%20routingkey%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22*.*.rabbit%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22lazy.%23%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E9%98%9F%E5%88%97%EF%BC%9A%5C%22%20%2B%20queueName%20%2B%20%5C%22%E7%BB%91%E5%AE%9A%E9%94%AE%EF%BC%9A%5C%22%20%2B%20message.getEnvelope().getRoutingKey())%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%226972b59b%22%7D\"></card><p data-lake-id=\"ubd93dfb6\" id=\"ubd93dfb6\"><br></p><ol list=\"u65e6951e\" start=\"2\"><li fid=\"u8b725ab3\" data-lake-id=\"u9e924b7c\" id=\"u9e924b7c\"><span data-lake-id=\"uabdadacb\" id=\"uabdadacb\">生产者</span></li></ol><p data-lake-id=\"u9a490197\" id=\"u9a490197\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.seven%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.security.spec.ECField%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2014%3A45%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cnpublic%20class%20EmitLogTopic%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22topic_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E4%B8%8B%E5%9B%BE%E7%BB%91%E5%AE%9A%E5%85%B3%E7%B3%BB%E5%A6%82%E4%B8%8B%EF%BC%9A%5Cn%20%20%20%20%20%20%20%20%20*%20Q1--%3E%20%E7%BB%91%E5%AE%9A%E7%9A%84%E6%98%AF%EF%BC%9A%20%E4%B8%AD%E9%97%B4%E5%B8%A63%E4%B8%AA%E5%8D%95%E8%AF%8D%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88*.orange*%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20Q2--%3E%20%E7%BB%91%E5%AE%9A%E7%9A%84%E6%98%AF%EF%BC%9A%20%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E6%98%AFrabbit%E7%9A%843%E4%B8%AA%E5%8D%95%E8%AF%8D%EF%BC%88*.*.rabbit%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E6%98%AFlazy%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%8D%95%E8%AF%8D%EF%BC%88lazy.%23%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20String%3E%20bindingKeyMap%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.orange.rabbit%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q1Q2%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.orange.elephant%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q1Q2%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.pink.rabbit%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q1%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.brown.fox%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q2%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.orange.male.rabbit%5C%22%2C%20%5C%22%E8%99%BD%E7%84%B6%E6%BB%A1%E8%B6%B3%E4%B8%A4%E4%B8%AA%E7%BB%91%E5%AE%9A%E4%BD%86%E5%8F%AA%E8%A2%AB%E9%98%9F%E5%88%97Q2%E6%8E%A5%E6%94%B6%E4%B8%80%E6%AC%A1%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.brown.fox%5C%22%2C%20%5C%22%E4%B8%8D%E5%8C%B9%E9%85%8D%E4%BB%BB%E4%BD%95%E7%BB%91%E5%AE%9A%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%BB%BB%E4%BD%95%E9%98%9F%E5%88%97%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BC%9A%E8%A2%AB%E4%B8%A2%E5%BC%83%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.orange.male.rabbit%5C%22%2C%20%5C%22%E6%98%AF%E5%9B%9B%E4%B8%AA%E5%8D%95%E8%AF%8D%E4%B8%8D%E5%8C%B9%E9%85%8D%E4%BB%BB%E4%BD%95%E7%BB%91%E5%AE%9A%E5%AE%9A%E4%BC%9A%E4%B8%A2%E5%BC%83%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.orange.male.rabbit%5C%22%2C%20%5C%22%E6%98%AF%E5%9B%9B%E4%B8%AA%E5%8D%95%E8%AF%8D%E4%BD%86%E5%8C%B9%E9%85%8DQ2%5C%22)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20for%20(Map.Entry%3CString%2C%20String%3E%20bindingKeyEntry%20%3A%20bindingKeyMap.entrySet())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20routingKey%20%3D%20bindingKeyEntry.getKey()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20bindingKeyEntry.getValue()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(EXCHANGE_NAME%2C%20routingKey%2C%20null%2C%20message.getBytes(StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2256e802f3%22%7D\"></card><p data-lake-id=\"u2545c488\" id=\"u2545c488\"><br></p><p data-lake-id=\"u8f7b2119\" id=\"u8f7b2119\"><span data-lake-id=\"u35993936\" id=\"u35993936\">先启动消费者，再启动生产者。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430253833-e55a9ffe-37a0-4c04-b7b7-093a65480f71.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D540%26id%3Du94f62b22%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D540%26originWidth%3D683%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D63817%26status%3Ddone%26style%3Dnone%26taskId%3Du846aee7e-23e7-429c-8c68-098657667fa%26title%3D%26width%3D683%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22r1tul%22%7D\"></card><span data-lake-id=\"u868c8c5a\" id=\"u868c8c5a\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430292235-0a8fd8ca-fdd9-4f2e-9a52-de2398da4db4.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D548%26id%3Du5b1d2810%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D548%26originWidth%3D649%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D60902%26status%3Ddone%26style%3Dnone%26taskId%3Duf769df3d-232c-4803-866e-9b789b65799%26title%3D%26width%3D649%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22p0vbD%22%7D\"></card><span data-lake-id=\"uc40afe97\" id=\"uc40afe97\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430299720-f401248d-7efc-425f-aff1-59f8cda3349d.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D257%26id%3Du7c6af404%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D257%26originWidth%3D674%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D33728%26status%3Ddone%26style%3Dnone%26taskId%3Du0e4568aa-d243-4696-a1eb-02eebf586cf%26title%3D%26width%3D674%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Axrk6%22%7D\"></card></p><p data-lake-id=\"u8c98ba91\" id=\"u8c98ba91\"><br></p><h2 data-lake-id=\"3dead64c\" id=\"3dead64c\"><span data-lake-id=\"u047b4415\" id=\"u047b4415\">死信队列</span></h2><p data-lake-id=\"u1870ddac\" id=\"u1870ddac\"><br></p><p data-lake-id=\"ub7284874\" id=\"ub7284874\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430356782-4196f6b8-209f-489a-a5e5-e61974e711ef.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D299%26id%3Dud95905f1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D299%26originWidth%3D1069%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D430772%26status%3Ddone%26style%3Dnone%26taskId%3Due469e4ea-c3e9-44f2-a5e6-4ac2443deba%26title%3D%26width%3D1069%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22ZL2Da%22%7D\"></card><span data-lake-id=\"u8cdb6967\" id=\"u8cdb6967\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430504276-84f3e02c-d80f-4fe9-9b9a-b8d9ac3b8290.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D298%26id%3Du8670c10d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D298%26originWidth%3D643%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D162345%26status%3Ddone%26style%3Dnone%26taskId%3Due72cf50e-a8d2-4f86-8a8f-e35ebf10e89%26title%3D%26width%3D643%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22rBdXQ%22%7D\"></card><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430601814-eb3112b8-d77b-4213-ad2c-df3c394a36b7.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D553%26id%3Dufda1712c%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D553%26originWidth%3D1136%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D162361%26status%3Ddone%26style%3Dnone%26taskId%3Du55e88e2a-dc14-44b5-9eb9-8663773f317%26title%3D%26width%3D1136%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22pQqf7%22%7D\"></card></p><p data-lake-id=\"uad6c0443\" id=\"uad6c0443\"><br></p><ul list=\"ub4dba9c5\"><li fid=\"u4ab60c3a\" data-lake-id=\"uc3ccb3d3\" id=\"uc3ccb3d3\"><span data-lake-id=\"u77883d71\" id=\"u77883d71\">消费者 1：</span></li></ul><p data-lake-id=\"u3530fd70\" id=\"u3530fd70\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2015%3A40%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%851%5Cn%20*%2F%5Cnpublic%20class%20Consumer01%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_EXCHANGE%20%3D%20%5C%22normal_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_EXCHANGE%20%3D%20%5C%22dead_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_QUEUE%20%3D%20%5C%22normal_queue%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_QUEUE%20%3D%20%5C%22dead_queue%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%AD%BB%E4%BF%A1%E5%92%8C%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%8C%20%E7%B1%BB%E5%9E%8B%E4%B8%BAdirect%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(NORMAL_EXCHANGE%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(DEAD_EXCHANGE%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%5Cn%2F%2F%20%20%20%20%20%20%20%20arguments.put(%5C%22x-message-ttl%5C%22%2C10000)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%AD%A3%E5%B8%B8%E9%98%9F%E5%88%97%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20DEAD_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1RoutingKey%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22lisi%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%A3%E5%B8%B8%E9%98%9F%E5%88%97%E7%9A%84%E9%95%BF%E5%BA%A6%E7%9A%84%E9%99%90%E5%88%B6%5Cn%2F%2F%20%20%20%20%20%20%20%20arguments.put(%5C%22x-max-length%5C%22%2C%2019)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(NORMAL_QUEUE%2C%20false%2C%20false%2C%20false%2C%20arguments)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(DEAD_QUEUE%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E9%98%9F%E5%88%97%E7%BB%91%E5%AE%9A%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(NORMAL_QUEUE%2C%20NORMAL_EXCHANGE%2C%20%5C%22zhangsan%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(DEAD_QUEUE%2C%20DEAD_EXCHANGE%2C%20%5C%22lisi%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF.........%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(msg.equals(%5C%22info5%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%AD%A4%E6%B6%88%E6%81%AF%E8%A2%ABC1%E6%8B%92%E7%BB%9D%E7%9A%84%5C%22%20%2B%20msg)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%8B%92%E7%BB%9D%E6%AD%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%B8%8D%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E3%80%82%E5%9B%A0%E6%AD%A4%E6%88%90%E4%B8%BA%E6%AD%BB%E4%BF%A1%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicReject(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22Consumer01%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20msg)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E4%B8%8D%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicAck(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%88%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%BC%80%E5%90%AF%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8C%E5%B0%B1%E4%B8%8D%E5%AD%98%E5%9C%A8%E6%8B%92%E7%BB%9D%E4%BA%86%EF%BC%89%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(NORMAL_QUEUE%2C%20false%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%226b32ccf8%22%7D\"></card><p data-lake-id=\"u435ef8b3\" id=\"u435ef8b3\"><br></p><ul list=\"u9833d078\"><li fid=\"uafeaa448\" data-lake-id=\"u991e0c89\" id=\"u991e0c89\"><span data-lake-id=\"u6d37fec1\" id=\"u6d37fec1\">消费者 2：</span></li></ul><p data-lake-id=\"ufa7c436f\" id=\"ufa7c436f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2015%3A40%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%852%5Cn%20*%2F%5Cnpublic%20class%20Consumer02%20%7B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_QUEUE%20%3D%20%5C%22dead_queue%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF.........%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22Consumer02%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(DEAD_QUEUE%2C%20false%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220aee91a1%22%7D\"></card><p data-lake-id=\"ud595d97e\" id=\"ud595d97e\"><br></p><ul list=\"u7a57cbe8\"><li fid=\"u52c405ea\" data-lake-id=\"u2bd56aa9\" id=\"u2bd56aa9\"><span data-lake-id=\"ubce8fc66\" id=\"ubce8fc66\">生产者：</span></li></ul><p data-lake-id=\"u44801151\" id=\"u44801151\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.AMQP%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2016%3A13%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97-%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_EXCHANGE%20%3D%20%5C%22normal_exchange%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E6%97%B6%E9%97%B4%20%20%E8%AE%BE%E7%BD%AEttl%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20AMQP.BasicProperties%20properties%20%3D%20new%20AMQP.BasicProperties().builder().expiration(%5C%2210000%5C%22).build()%3B%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%201%3B%20i%20%3C%2011%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22info%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(NORMAL_EXCHANGE%2C%20%5C%22zhangsan%5C%22%2C%20properties%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221656143b%22%7D\"></card><p data-lake-id=\"u6e029386\" id=\"u6e029386\"><br></p><p data-lake-id=\"u5a3eb9d2\" id=\"u5a3eb9d2\"><span data-lake-id=\"uea2ed46a\" id=\"uea2ed46a\">测试步骤：</span></p><p data-lake-id=\"uba408812\" id=\"uba408812\"><br></p><ol list=\"u12605c33\"><li fid=\"u8cc5814f\" data-lake-id=\"u835dcc9d\" id=\"u835dcc9d\"><span data-lake-id=\"u643f8ba9\" id=\"u643f8ba9\">运行消费者：会发现普通和死信交换机已经绑定各自的队列。</span></li></ol><p data-lake-id=\"u058f5168\" id=\"u058f5168\"><br></p><p data-lake-id=\"u9ebcebd9\" id=\"u9ebcebd9\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638445377947-e4a087d0-b755-4178-aa6d-7ae082107bb0.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D495%26id%3Dud91030e8%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D495%26originWidth%3D541%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23775%26status%3Ddone%26style%3Dnone%26taskId%3Du8f85c23d-a811-41b4-a478-a20609fc50a%26title%3D%26width%3D541%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22xwjE9%22%7D\"></card><span data-lake-id=\"u20dcc1c0\" id=\"u20dcc1c0\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638445475857-ba40932b-588f-43d3-b3a6-5f2660bcd241.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D498%26id%3Dub28b2410%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D498%26originWidth%3D601%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D25129%26status%3Ddone%26style%3Dnone%26taskId%3Du8de3a461-08ce-49b9-9936-e0cf7fa1363%26title%3D%26width%3D601%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Jcymv%22%7D\"></card></p><p data-lake-id=\"u62f48d77\" id=\"u62f48d77\"><br></p><ol list=\"u58c0cf9c\" start=\"2\"><li fid=\"ufe890c6a\" data-lake-id=\"u09f241e0\" id=\"u09f241e0\"><span data-lake-id=\"u80004425\" id=\"u80004425\">测试</span><strong><span data-lake-id=\"u9f91257d\" id=\"u9f91257d\">队列达到最大长度</span></strong><span data-lake-id=\"uec0838b8\" id=\"uec0838b8\">，关闭消费者 1 和 2，开启生产者：消息会积压在队列中，消费者 1 所在的普通队列消息限制有 6 条，剩下的 4 条会进入消费者 2 所在的死信队列。如下图所示：</span></li></ol><p data-lake-id=\"u9dbb6efd\" id=\"u9dbb6efd\"><br></p><p data-lake-id=\"ud3960aab\" id=\"ud3960aab\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638448087379-8c4e5c46-39ca-49fd-8024-4111b0a5d431.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D571%26id%3Du9eb9c88a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D571%26originWidth%3D1083%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D79389%26status%3Ddone%26style%3Dnone%26taskId%3Dua5f78b60-fd26-4cb8-9cf8-f0e0f17270b%26title%3D%26width%3D1083%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22s5bzi%22%7D\"></card></p><p data-lake-id=\"ue98b05db\" id=\"ue98b05db\"><br></p><ol list=\"u16ba7dae\" start=\"3\"><li fid=\"u3f9d6140\" data-lake-id=\"uc5b05a1e\" id=\"uc5b05a1e\"><span data-lake-id=\"u3d2dd79c\" id=\"u3d2dd79c\">取消普通队列的最大长度限制，测试</span><strong><span data-lake-id=\"u66fe44e1\" id=\"u66fe44e1\">消息 ttl 过期</span></strong><span data-lake-id=\"u0eb10fc6\" id=\"u0eb10fc6\">：关闭消费者 1 和 2，开启生产者发送消息。（消息会因为没人接收，会在 ttl 时间内积压在普通队列中， ttl 过期后，消息会进入死信队列中。）</span></li></ol><p data-lake-id=\"u66bade46\" id=\"u66bade46\"><br></p><p data-lake-id=\"u12585112\" id=\"u12585112\"><span data-lake-id=\"u50a28f4b\" id=\"u50a28f4b\">生产者：</span></p><p data-lake-id=\"u60d2c488\" id=\"u60d2c488\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.AMQP%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2016%3A13%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97-%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_EXCHANGE%20%3D%20%5C%22normal_exchange%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E6%97%B6%E9%97%B4%20%20%E8%AE%BE%E7%BD%AEttl%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20AMQP.BasicProperties%20properties%20%3D%20new%20AMQP.BasicProperties().builder().expiration(%5C%2210000%5C%22).build()%3B%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%201%3B%20i%20%3C%2011%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22info%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(NORMAL_EXCHANGE%2C%20%5C%22zhangsan%5C%22%2C%20properties%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221656143b-1%22%7D\"></card><p data-lake-id=\"ufcc5276d\" id=\"ufcc5276d\"><br></p><ol list=\"u6e510735\" start=\"4\"><li fid=\"ub9db9807\" data-lake-id=\"u3643f27c\" id=\"u3643f27c\"><span data-lake-id=\"ud42e38c6\" id=\"ud42e38c6\">测试</span><strong><span data-lake-id=\"u7a7018e8\" id=\"u7a7018e8\">消息被拒</span></strong><span data-lake-id=\"u3f6dd4c9\" id=\"u3f6dd4c9\">：</span></li></ol><p data-lake-id=\"u1325a418\" id=\"u1325a418\"><br></p><p data-lake-id=\"u1e4cfe0d\" id=\"u1e4cfe0d\"><span data-lake-id=\"u012d5846\" id=\"u012d5846\">开启消费者 1 和 2，再开启生产者。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638450659287-e191b69a-07c6-4d5e-8f54-05d22263a235.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D274%26id%3Du03d42d3b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D274%26originWidth%3D642%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D32103%26status%3Ddone%26style%3Dnone%26taskId%3Duf69d66f1-feae-4ff6-83ca-af7f8a83127%26title%3D%26width%3D642%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22jR4qW%22%7D\"></card><span data-lake-id=\"u2fc681b9\" id=\"u2fc681b9\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638450668535-06aa1842-3563-455e-bb20-6376694fae1f.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D202%26id%3Du33f7f3ac%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D202%26originWidth%3D616%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23460%26status%3Ddone%26style%3Dnone%26taskId%3Dua7a303f7-25d6-4fc0-8d46-d522a51ded6%26title%3D%26width%3D616%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22vAYSS%22%7D\"></card></p><p data-lake-id=\"u56fa6a3a\" id=\"u56fa6a3a\"><br></p><h2 data-lake-id=\"38e2258c\" id=\"38e2258c\"><span data-lake-id=\"ub402faff\" id=\"ub402faff\">延迟队列（基于死信队列）</span></h2><p data-lake-id=\"uaeb50e00\" id=\"uaeb50e00\"><br></p><p data-lake-id=\"uce6f04f4\" id=\"uce6f04f4\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638450862631-363c8d24-6a72-463a-b827-201e6f79cb79.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D128%26id%3Du8aa7212b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D128%26originWidth%3D1081%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D190603%26status%3Ddone%26style%3Dnone%26taskId%3Due97c71c8-4947-4c82-be00-e98e36ba920%26title%3D%26width%3D1081%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22xrjpE%22%7D\"></card><span data-lake-id=\"u28d9db40\" id=\"u28d9db40\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638451047144-5f4983f1-3a0e-472b-95f3-26635a911749.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D399%26id%3Dud5620b6f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D399%26originWidth%3D869%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D265988%26status%3Ddone%26style%3Dnone%26taskId%3Dub1f53a1e-1377-4e43-ab1d-13e29cf4118%26title%3D%26width%3D869%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22O4W2R%22%7D\"></card></p><p data-lake-id=\"u003e5655\" id=\"u003e5655\"><br></p><h3 data-lake-id=\"5bff6472\" id=\"5bff6472\"><span data-lake-id=\"u69a0df70\" id=\"u69a0df70\">整合 SpringBoot</span></h3><p data-lake-id=\"ua9246d88\" id=\"ua9246d88\"><br></p><p data-lake-id=\"u17c7855e\" id=\"u17c7855e\"><br></p><p data-lake-id=\"u37d8ad14\" id=\"u37d8ad14\"><br></p><h4 data-lake-id=\"73ad366e\" id=\"73ad366e\"><span data-lake-id=\"u0a7e6e9e\" id=\"u0a7e6e9e\">实现延迟队列：</span></h4><p data-lake-id=\"u50e8e4bb\" id=\"u50e8e4bb\"><br></p><ol list=\"u3facdfea\"><li fid=\"u192c3c99\" data-lake-id=\"ue7753788\" id=\"ue7753788\"><span data-lake-id=\"udfd2b47e\" id=\"udfd2b47e\">依赖：</span></li></ol><p data-lake-id=\"u3122c714\" id=\"u3122c714\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%3C%3Fxml%20version%3D%5C%221.0%5C%22%20encoding%3D%5C%22UTF-8%5C%22%3F%3E%5Cn%3Cproject%20xmlns%3D%5C%22http%3A%2F%2Fmaven.apache.org%2FPOM%2F4.0.0%5C%22%20xmlns%3Axsi%3D%5C%22http%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema-instance%5C%22%5Cn%20%20%20%20%20%20%20%20%20xsi%3AschemaLocation%3D%5C%22http%3A%2F%2Fmaven.apache.org%2FPOM%2F4.0.0%20https%3A%2F%2Fmaven.apache.org%2Fxsd%2Fmaven-4.0.0.xsd%5C%22%3E%5Cn%20%20%20%20%3CmodelVersion%3E4.0.0%3C%2FmodelVersion%3E%5Cn%20%20%20%20%3Cparent%3E%5Cn%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-parent%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%3Cversion%3E2.6.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3CrelativePath%2F%3E%20%3C!--%20lookup%20parent%20from%20repository%20--%3E%5Cn%20%20%20%20%3C%2Fparent%3E%5Cn%20%20%20%20%3CgroupId%3Ecom.atguigu.rabbitmq%3C%2FgroupId%3E%5Cn%20%20%20%20%3CartifactId%3Espringboot-rabbitmq%3C%2FartifactId%3E%5Cn%20%20%20%20%3Cversion%3E0.0.1-SNAPSHOT%3C%2Fversion%3E%5Cn%20%20%20%20%3Cname%3Espringboot-rabbitmq%3C%2Fname%3E%5Cn%20%20%20%20%3Cdescription%3EDemo%20project%20for%20Spring%20Boot%3C%2Fdescription%3E%5Cn%20%20%20%20%3Cproperties%3E%5Cn%20%20%20%20%20%20%20%20%3Cjava.version%3E1.8%3C%2Fjava.version%3E%5Cn%20%20%20%20%3C%2Fproperties%3E%5Cn%20%20%20%20%3Cdependencies%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-test%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.springframework.boot%2Fspring-boot-starter-amqp%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-amqp%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.6.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.springframework.boot%2Fspring-boot-starter-web%20--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--web%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%90%AF%E5%8A%A8--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-web%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.6.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%E5%BF%AB%E9%80%9F%E8%BF%9B%E8%A1%8Cjson%E8%BD%AC%E6%8D%A2--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fcom.alibaba%2Ffastjson%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Ecom.alibaba%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Efastjson%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E1.2.78%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fio.springfox%2Fspringfox-swagger2%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eio.springfox%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espringfox-swagger2%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E3.0.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fio.springfox%2Fspringfox-swagger-ui%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eio.springfox%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espringfox-swagger-ui%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E3.0.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.springframework.amqp%2Fspring-rabbit-test%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.amqp%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-rabbit-test%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.4.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.projectlombok%2Flombok%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.projectlombok%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Elombok%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E1.18.22%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Eprovided%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%3C%2Fdependencies%3E%5Cn%5Cn%20%20%20%20%3Cbuild%3E%5Cn%20%20%20%20%20%20%20%20%3Cplugins%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cplugin%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-maven-plugin%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fplugin%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fplugins%3E%5Cn%20%20%20%20%3C%2Fbuild%3E%5Cn%5Cn%3C%2Fproject%3E%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2273700fd7%22%7D\"></card><p data-lake-id=\"uc2b4899d\" id=\"uc2b4899d\"><br></p><ol list=\"u61a89e08\" start=\"2\"><li fid=\"u69964bea\" data-lake-id=\"u1245e541\" id=\"u1245e541\"><span data-lake-id=\"u9f81332b\" id=\"u9f81332b\">yml 配置文件：</span></li></ol><p data-lake-id=\"u73830d88\" id=\"u73830d88\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22spring%3A%5Cn%20%20rabbitmq%3A%5Cn%20%20%20%20host%3A%2059.110.171.189%5Cn%20%20%20%20port%3A%205672%5Cn%20%20%20%20username%3A%20admin%5Cn%20%20%20%20password%3A%20123%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22c4ed4d31%22%7D\"></card><p data-lake-id=\"uc99c78c6\" id=\"uc99c78c6\"><br></p><ol list=\"u91eb0172\" start=\"3\"><li fid=\"u49c48c85\" data-lake-id=\"u7aebac69\" id=\"u7aebac69\"><span data-lake-id=\"ua76b3319\" id=\"ua76b3319\">swagger 配置类：</span></li></ol><p data-lake-id=\"u0ccd9e4c\" id=\"u0ccd9e4c\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20springfox.documentation.builders.ApiInfoBuilder%3B%5Cnimport%20springfox.documentation.service.ApiInfo%3B%5Cnimport%20springfox.documentation.service.Contact%3B%5Cnimport%20springfox.documentation.spi.DocumentationType%3B%5Cnimport%20springfox.documentation.spring.web.plugins.Docket%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2022%3A34%5Cn%20*%2F%5Cnpublic%20class%20SwaggerConfig%20%7B%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Docket%20webApiConfig()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20Docket(DocumentationType.SWAGGER_2)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.groupName(%5C%22webApi%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.apiInfo(webApiInfo())%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.select()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20private%20ApiInfo%20webApiInfo()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20ApiInfoBuilder()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.title(%5C%22rabbitmq%20%20%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.description(%5C%22%20%E6%9C%AC%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E4%BA%86%20rabbitmq%20%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.version(%5C%221.0%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.contact(new%20Contact(%5C%22enjoy6288%5C%22%2C%20%5C%22http%3A%2F%2Fatguigu.com%5C%22%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%221846015350%40qq.com%5C%22))%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.build()%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22e6248552%22%7D\"></card><p data-lake-id=\"u5da333d3\" id=\"u5da333d3\"><br></p><p data-lake-id=\"u737ba50b\" id=\"u737ba50b\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638490298754-a2b1ced5-676b-4f68-86e0-31f05266088f.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D215%26id%3Du8ba627f6%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D215%26originWidth%3D1100%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D132048%26status%3Ddone%26style%3Dnone%26taskId%3Dud9c3f28a-b8df-44d1-b9df-dc90c70e046%26title%3D%26width%3D1100%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Iv7m8%22%7D\"></card></p><p data-lake-id=\"u13d19082\" id=\"u13d19082\"><br></p><ol list=\"u34fa8725\" start=\"4\"><li fid=\"ucf82ec3b\" data-lake-id=\"uce104d61\" id=\"uce104d61\"><span data-lake-id=\"u508e2cbd\" id=\"u508e2cbd\">声明队列配置文件：</span></li></ol><p data-lake-id=\"u0de2ea78\" id=\"u0de2ea78\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%208%3A15%5Cn%20*%20TTL%E9%98%9F%E5%88%97%EF%BC%8C%20%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%B1%BB%E4%BB%A3%E7%A0%81%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20TtlQueueConfig%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20X_EXCHANGE%20%3D%20%5C%22X%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20Y_DEAD_LETTER_EXCHANGE%20%3D%20%5C%22Y%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_A%20%3D%20%5C%22QA%5C%22%3B%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_B%20%3D%20%5C%22QB%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_LETTER_QUEUE%20%3D%20%5C%22QD%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8ExExchange%20%E5%88%AB%E5%90%8D%5Cn%20%20%20%20%40Bean(%5C%22xExchange%5C%22)%5Cn%20%20%20%20public%20DirectExchange%20xExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20DirectExchange(X_EXCHANGE)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%40Bean(%5C%22yExchange%5C%22)%5Cn%20%20%20%20public%20DirectExchange%20yExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20DirectExchange(Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%20%20ttl%E4%B8%BA10s%5Cn%20%20%20%20%40Bean(%5C%22queueA%5C%22)%5Cn%20%20%20%20public%20Queue%20queueA()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E(3)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%20routing-key%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AEttl%20%20%E5%8D%95%E4%BD%8D%E4%B8%BAms%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-message-ttl%5C%22%2C%2010000)%3B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(QUEUE_A).withArguments(arguments).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%20%20ttl%E4%B8%BA40s%5Cn%20%20%20%20%40Bean(%5C%22queueB%5C%22)%5Cn%20%20%20%20public%20Queue%20queueB()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E(3)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%20routing-key%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AEttl%20%20%E5%8D%95%E4%BD%8D%E4%B8%BAms%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-message-ttl%5C%22%2C%2040000)%3B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(QUEUE_B).withArguments(arguments).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean(%5C%22queueD%5C%22)%5Cn%20%20%20%20public%20Queue%20queueD()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(DEAD_LETTER_QUEUE).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueABindingX(%40Qualifier(%5C%22queueA%5C%22)%20Queue%20queueA%2C%20%40Qualifier(%5C%22xExchange%5C%22)%20DirectExchange%20xExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueA).to(xExchange).with(%5C%22XA%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueBBindingX(%40Qualifier(%5C%22queueB%5C%22)%20Queue%20queueB%2C%20%40Qualifier(%5C%22xExchange%5C%22)%20DirectExchange%20xExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueB).to(xExchange).with(%5C%22XB%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueDBindingY(%40Qualifier(%5C%22queueD%5C%22)%20Queue%20queueD%2C%20%40Qualifier(%5C%22yExchange%5C%22)%20DirectExchange%20yExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueD).to(yExchange).with(%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2234c7bc48%22%7D\"></card><p data-lake-id=\"u7e4c585b\" id=\"u7e4c585b\"><br></p><ol list=\"u5cc5c3b4\" start=\"5\"><li fid=\"u2f0d55b4\" data-lake-id=\"u9edbfaeb\" id=\"u9edbfaeb\"><span data-lake-id=\"u32b3978b\" id=\"u32b3978b\">消费者：接收消息</span></li></ol><p data-lake-id=\"u938e6661\" id=\"u938e6661\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cnimport%20java.util.Date%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%209%3A01%5Cn%20*%20%E9%98%9F%E5%88%97ttl%20%E6%B6%88%E8%B4%B9%E8%80%85%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20DeadLetterQueueConsumer%20%7B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20%5C%22QD%5C%22)%5Cn%20%20%20%20public%20void%20receiveD(Message%20message%2C%20Channel%20channel)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%EF%BC%9A%7B%7D%EF%BC%8C%E6%94%B6%E5%88%B0%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222d9d521e%22%7D\"></card><p data-lake-id=\"u5ff8aeb7\" id=\"u5ff8aeb7\"><br></p><ol list=\"ufdf833d6\" start=\"6\"><li fid=\"u698e0874\" data-lake-id=\"uf7ea6cd6\" id=\"uf7ea6cd6\"><span data-lake-id=\"u44854cf1\" id=\"u44854cf1\">发送消息：Controller</span></li></ol><p data-lake-id=\"u4710b98f\" id=\"u4710b98f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.controller%3B%5Cn%5Cnimport%20io.swagger.annotations.ApiModelProperty%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.web.bind.annotation.GetMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.PathVariable%3B%5Cnimport%20org.springframework.web.bind.annotation.RequestMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.RestController%3B%5Cn%5Cnimport%20java.util.Date%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%208%3A47%5Cn%20*%20%E5%8F%91%E9%80%81%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%5Cn%20*%20%3Cp%3E%5Cn%20*%20http%3A%2F%2Flocalhost%3A8080%2Fttl%2FsendMsg%2F%E5%98%BB%E5%98%BB%E5%98%BB%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40RestController%5Cn%40RequestMapping(%5C%22%2Fttl%5C%22)%5Cnpublic%20class%20SendMsgController%20%7B%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendMsg%2F%7Bmessage%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMsg(%40PathVariable%20String%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%EF%BC%9A%7B%7D%EF%BC%8C%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1%E6%B6%88%E6%81%AF%E7%BB%99%E4%B8%A4%E4%B8%AAttl%E9%98%9F%E5%88%97%3A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(%5C%22X%5C%22%2C%20%5C%22XA%5C%22%2C%20%5C%22%E6%B6%88%E6%81%AF%E6%9D%A5%E8%87%AAttl%E4%B8%BA10s%E7%9A%84%E9%98%9F%E5%88%97%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(%5C%22X%5C%22%2C%20%5C%22XB%5C%22%2C%20%5C%22%E6%B6%88%E6%81%AF%E6%9D%A5%E8%87%AAttl%E4%B8%BA40s%E7%9A%84%E9%98%9F%E5%88%97%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22acb0bddc%22%7D\"></card><p data-lake-id=\"uca8b3875\" id=\"uca8b3875\"><br></p><p data-lake-id=\"u436ca17c\" id=\"u436ca17c\"><span data-lake-id=\"uab388077\" id=\"uab388077\"><br /></span><span data-lake-id=\"u0771e048\" id=\"u0771e048\">访问：</span><a href=\"http://localhost:8080/ttl/sendMsg/\" target=\"_blank\" data-lake-id=\"ue5bdafdd\" id=\"ue5bdafdd\"><span data-lake-id=\"u0f558b97\" id=\"u0f558b97\">http://localhost:8080/ttl/sendMsg/</span></a><span data-lake-id=\"u1325674b\" id=\"u1325674b\">嘻嘻嘻<br /></span><span data-lake-id=\"udcc8b286\" id=\"udcc8b286\">控制台打印结果：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638494307481-a59aaddb-4efb-4200-9e05-0e34602ded36.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D202%26id%3Du66541ef9%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D202%26originWidth%3D1365%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D62756%26status%3Ddone%26style%3Dnone%26taskId%3Dua128108f-eaa5-47fc-ab0d-e56fe3f57f4%26title%3D%26width%3D1365%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22tO8el%22%7D\"></card></p><p data-lake-id=\"uafa127ba\" id=\"uafa127ba\"><br></p><h4 data-lake-id=\"5d575387\" id=\"5d575387\"><span data-lake-id=\"uf06e7824\" id=\"uf06e7824\">延迟队列优化：</span></h4><p data-lake-id=\"u6257e7bc\" id=\"u6257e7bc\"><br></p><p data-lake-id=\"uf1945132\" id=\"uf1945132\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638494906968-c2a2e16a-a5b3-4c44-83bc-5846e35977d0.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D333%26id%3Du5def25ea%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D333%26originWidth%3D1070%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D169463%26status%3Ddone%26style%3Dnone%26taskId%3Duede9888d-c22a-46c9-a810-c9c1899d23a%26title%3D%26width%3D1070%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22PCbH9%22%7D\"></card><span data-lake-id=\"ucf912ccb\" id=\"ucf912ccb\"><br /></span><span data-lake-id=\"uabebb465\" id=\"uabebb465\">增加一个 QC 普通队列声明后并绑定交换机 XC。<br /></span><span data-lake-id=\"u7f39ff3a\" id=\"u7f39ff3a\">队列配置 中添加：</span></p><p data-lake-id=\"u1c33e394\" id=\"u1c33e394\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F--------------------------------%E4%BC%98%E5%8C%96%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97-------------------------------------%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%88%E4%B8%BA%E4%BA%86%E4%BC%98%E5%8C%96%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%EF%BC%89%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_C%20%3D%20%5C%22QC%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8EQC%5Cn%20%20%20%20%40Bean(%5C%22queueC%5C%22)%5Cn%20%20%20%20public%20Queue%20queueC()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E(2)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1routing-key%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(QUEUE_C).withArguments(arguments).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97QC%E5%92%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueCBindingX(%40Qualifier(%5C%22queueC%5C%22)%20Queue%20queueC%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22xExchange%5C%22)%20DirectExchange%20xExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueC).to(xExchange).with(%5C%22XC%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%2F%2F-----------------------------------%E4%BC%98%E5%8C%96%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97----------------------------------%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22a7ebc7ee%22%7D\"></card><p data-lake-id=\"u9bde3c53\" id=\"u9bde3c53\"><br></p><p data-lake-id=\"u6870970c\" id=\"u6870970c\"><span data-lake-id=\"uc6706f78\" id=\"uc6706f78\">添加 Controller 发消息控制器：</span></p><p data-lake-id=\"u69dff3a4\" id=\"u69dff3a4\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E6%B6%88%E6%81%AFttl%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendExpireMsg%2F%7Bmessage%7D%2F%7BttlTime%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMsg(%40PathVariable%20String%20message%2C%20%40PathVariable%20String%20ttlTime)%20%7B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%EF%BC%9A%7B%7D%EF%BC%8C%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1%E6%97%B6%E9%95%BF%7B%7D%E6%AF%AB%E7%A7%92%EF%BC%8Cttl%E4%BF%A1%E6%81%AF%E7%BB%99%E9%98%9F%E5%88%97QC%3A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20ttlTime%2C%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(%5C%22X%5C%22%2C%20%5C%22XC%5C%22%2C%20message%2C%20msg%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%97%B6%E5%80%99%20%20%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%95%BF%5Cn%20%20%20%20%20%20%20%20%20%20%20%20msg.getMessageProperties().setExpiration(ttlTime)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20return%20msg%3B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2237e62688%22%7D\"></card><p data-lake-id=\"uba0c942f\" id=\"uba0c942f\"><br></p><p data-lake-id=\"u44e0ad88\" id=\"u44e0ad88\"><span data-lake-id=\"ud37c99fe\" id=\"ud37c99fe\">测试：</span></p><p data-lake-id=\"u8f450987\" id=\"u8f450987\"><br></p><ol list=\"ueb5e0837\"><li fid=\"u1b4d933a\" data-lake-id=\"ub256f62c\" id=\"ub256f62c\"><span data-lake-id=\"u2294acc6\" id=\"u2294acc6\">http://localhost:8080/ttl/sendExpireMsg/你好 1/20000</span></li></ol><ol list=\"u9ff940f0\" start=\"2\"><li fid=\"ue6b2c004\" data-lake-id=\"u25a98c39\" id=\"u25a98c39\"><span data-lake-id=\"u371386de\" id=\"u371386de\">http://localhost:8080/ttl/sendExpireMsg/你好 2/2000</span></li></ol><p data-lake-id=\"u0b67b6a7\" id=\"u0b67b6a7\"><br></p><p data-lake-id=\"ub6ce48d7\" id=\"ub6ce48d7\"><span data-lake-id=\"u13466df4\" id=\"u13466df4\">结果：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638517312025-dfbbfd0b-a82c-4432-a395-2e7cc7c6e48f.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D149%26id%3Du18e59259%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D149%26originWidth%3D1285%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D42107%26status%3Ddone%26style%3Dnone%26taskId%3Duff6fb06a-df03-451f-b886-52364055048%26title%3D%26width%3D1285%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22efjYm%22%7D\"></card></p><p data-lake-id=\"u23f2f74f\" id=\"u23f2f74f\"><br></p><h2 data-lake-id=\"d0cad89d\" id=\"d0cad89d\"><span data-lake-id=\"u85be1934\" id=\"u85be1934\">延迟队列（基于插件）</span></h2><p data-lake-id=\"u81531559\" id=\"u81531559\"><br></p><p data-lake-id=\"ufd1c2e21\" id=\"ufd1c2e21\"><span data-lake-id=\"u630fc20d\" id=\"u630fc20d\">进入 rabbitmq 安装目录下的 plugins 目录 ，cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins<br /></span><span data-lake-id=\"u62a50af5\" id=\"u62a50af5\">执行命令让该插件生效：rabbitmq-plugins enable rabbitmq_delayed_message_exchange<br /></span><span data-lake-id=\"u3bface68\" id=\"u3bface68\">然后重启 rabbitmq：systemctl restart rabbitmq-server<br /></span><span data-lake-id=\"u9db1a728\" id=\"u9db1a728\">会发现交换机多了一个新类型，意味着延迟消息将由交换机来完成，而不是队列。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638519642120-f3258006-3639-4551-805e-26bbd1e67c85.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D530%26id%3Du66b7d498%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D767%26originWidth%3D690%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D56472%26status%3Ddone%26style%3Dnone%26taskId%3Du707609ca-e368-4b6c-9833-ec8cc57ca15%26title%3D%26width%3D477.00006103515625%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22PD1AH%22%7D\"></card><span data-lake-id=\"u2f8263ea\" id=\"u2f8263ea\"><br /><br /><br /></span><span data-lake-id=\"ud9ab44e0\" id=\"ud9ab44e0\">原来的情况：基于死信<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638520455616-cfcde47e-bee3-4ef6-83b6-6630dbe54d9a.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D443%26id%3Dua9957719%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D601%26originWidth%3D1033%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D226301%26status%3Ddone%26style%3Dnone%26taskId%3Dua95f3b09-635a-4782-abfd-57901f34a8b%26title%3D%26width%3D760.9862060546875%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22UOPGa%22%7D\"></card><span data-lake-id=\"u4f03ca10\" id=\"u4f03ca10\"><br /></span><span data-lake-id=\"u3dd91de7\" id=\"u3dd91de7\">现在：基于延迟插件<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638520591056-7591eaf6-b99f-4059-8cbb-6a6ee0ea64f2.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D177%26id%3Du11577081%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D224%26originWidth%3D976%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D94107%26status%3Ddone%26style%3Dnone%26taskId%3Du47b17a31-4f94-4f3c-a75f-2014f181765%26title%3D%26width%3D770.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22a4gyh%22%7D\"></card><span data-lake-id=\"ud0d616ab\" id=\"ud0d616ab\"><br /></span><span data-lake-id=\"u294d8a9a\" id=\"u294d8a9a\">代码架构：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638520764180-7b9e927e-1166-470d-ac32-dda16bb87ae1.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D188%26id%3Dud9b4ba5b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D188%26originWidth%3D1062%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D84300%26status%3Ddone%26style%3Dnone%26taskId%3Du12c568cb-6151-4b2f-8f49-3f721530b6d%26title%3D%26width%3D1062%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22cPAio%22%7D\"></card></p><p data-lake-id=\"u2537b866\" id=\"u2537b866\"><br></p><ol list=\"udc24c677\"><li fid=\"u2d0fa43d\" data-lake-id=\"u54cbff16\" id=\"u54cbff16\"><span data-lake-id=\"u497ba1cf\" id=\"u497ba1cf\">配置类</span></li></ol><p data-lake-id=\"ucf6f84e6\" id=\"ucf6f84e6\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2016%3A41%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20DelayedQueueConfig%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20DELAYED_QUEUE_NAME%20%3D%20%5C%22delayed.name%5C%22%3B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20DELAYED_EXCHANGE_NAME%20%3D%20%5C%22delayed.exchange%5C%22%3B%5Cn%20%20%20%20%2F%2Frouting-key%5Cn%20%20%20%20public%20static%20final%20String%20DELAYED_ROUTING_KEY%20%3D%20%5C%22delayed.routingkey%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20delayedQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(DELAYED_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%20%E5%9F%BA%E4%BA%8E%E6%8F%92%E4%BB%B6%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20CustomExchange%20delayedExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-delayed-type%5C%22%2C%20%5C%22direct%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%201.%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E7%B1%BB%E5%9E%8B%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E6%8C%81%E4%B9%85%E5%8C%96%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20*%205.%20%E5%85%B6%E4%BB%96%E7%9A%84%E5%8F%82%E6%95%B0%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20return%20new%20CustomExchange(DELAYED_EXCHANGE_NAME%2C%20%5C%22x-delayed-message%5C%22%2C%20true%2C%20false%2C%20arguments)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20delayedQueueBindingDelayedExchange(%40Qualifier(%5C%22delayedQueue%5C%22)%20Queue%20delayedQueue%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22delayedExchange%5C%22)%20CustomExchange%20delayedExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs()%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22576e3b9e%22%7D\"></card><p data-lake-id=\"u88264fd1\" id=\"u88264fd1\"><br></p><ol list=\"ub8ffacac\" start=\"2\"><li fid=\"u680ffbb9\" data-lake-id=\"ue3e31a7b\" id=\"ue3e31a7b\"><span data-lake-id=\"u5b76b6d1\" id=\"u5b76b6d1\">Controller 生产者：</span></li></ol><p data-lake-id=\"u4fdb5ab5\" id=\"u4fdb5ab5\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E5%9F%BA%E4%BA%8E%E5%BB%B6%E8%BF%9F%E6%8F%92%E4%BB%B6%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendDelayMsg%2F%7Bmessage%7D%2F%7BdelayTime%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMsg(%40PathVariable%20String%20message%2C%20%40PathVariable%20Integer%20delayTime)%20%7B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%3A%7B%7D%2C%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1%E6%97%B6%E9%95%BF%7B%7D%E6%AF%AB%E7%A7%92%E4%BF%A1%E6%81%AF%E7%BB%99%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97delayed.queue%3A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20delayTime%2C%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME%2C%20DelayedQueueConfig.DELAYED_ROUTING_KEY%2C%20message%2C%20msg%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%97%B6%E5%80%99%20%20%20%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%95%BF%20%20%E5%8D%95%E4%BD%8D%EF%BC%9Ams%5Cn%20%20%20%20%20%20%20%20%20%20%20%20msg.getMessageProperties().setDelay(delayTime)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20return%20msg%3B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22eb8d3858%22%7D\"></card><p data-lake-id=\"uaa1f405b\" id=\"uaa1f405b\"><br></p><ol list=\"u4c1a94d3\" start=\"3\"><li fid=\"uf67e9227\" data-lake-id=\"u4e37ad14\" id=\"u4e37ad14\"><span data-lake-id=\"uc301cdab\" id=\"uc301cdab\">消费者：</span></li></ol><p data-lake-id=\"u8e368a72\" id=\"u8e368a72\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.DelayedQueueConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cnimport%20java.util.Date%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2019%3A36%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E5%9F%BA%E4%BA%8E%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20DelayQueueConsumer%20%7B%5Cn%20%20%20%20%2F%2F%E7%9B%91%E5%90%AC%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20DelayedQueueConfig.DELAYED_QUEUE_NAME)%5Cn%20%20%20%20public%20void%20receiveDelayQueue(Message%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%3A%7B%7D%2C%E6%94%B6%E5%88%B0%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2220ede713%22%7D\"></card><p data-lake-id=\"uc629c46a\" id=\"uc629c46a\"><br></p><p data-lake-id=\"u7f843083\" id=\"u7f843083\"><span data-lake-id=\"u7ccea2ef\" id=\"u7ccea2ef\">测试：<br /></span><span data-lake-id=\"ufb9ca283\" id=\"ufb9ca283\">发起请求：</span><a href=\"http://localhost:8080/ttl/sendDelayMsg/com\" target=\"_blank\" data-lake-id=\"u0ed23d19\" id=\"u0ed23d19\"><span data-lake-id=\"ucce40a65\" id=\"ucce40a65\">http://localhost:8080/ttl/sendDelayMsg/com</span></a><span data-lake-id=\"u6e4179e0\" id=\"u6e4179e0\"> on baby1/20000<br /></span><span data-lake-id=\"ub54e37e9\" id=\"ub54e37e9\"> </span><a href=\"http://localhost:8080/ttl/sendDelayMsg/com\" target=\"_blank\" data-lake-id=\"u591aeafc\" id=\"u591aeafc\"><span data-lake-id=\"u41e0134b\" id=\"u41e0134b\">http://localhost:8080/ttl/sendDelayMsg/com</span></a><span data-lake-id=\"u06ea87d6\" id=\"u06ea87d6\"> on baby2/2000<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638532349237-315b969f-d021-4448-8aa8-d5a1d41950a0.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D208%26id%3Duf33e7fe7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D208%26originWidth%3D1432%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D71640%26status%3Ddone%26style%3Dnone%26taskId%3Due722c22b-16d9-40a2-9a28-e95348df5d0%26title%3D%26width%3D1432%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22P79jF%22%7D\"></card><span data-lake-id=\"u0735baa9\" id=\"u0735baa9\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638532663153-40afab72-d363-4536-94fc-4889e40d764b.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D224%26id%3Du7813c3ed%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D266%26originWidth%3D1121%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D457006%26status%3Ddone%26style%3Dnone%26taskId%3Du0e4002d8-2179-43cc-bcfd-7c69cd127b5%26title%3D%26width%3D941.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22aEVGf%22%7D\"></card></p><p data-lake-id=\"u816be002\" id=\"u816be002\"><br></p><h2 data-lake-id=\"d338501f\" id=\"d338501f\"><span data-lake-id=\"uf2c90131\" id=\"uf2c90131\">发布确认高级</span></h2><p data-lake-id=\"u78a1b073\" id=\"u78a1b073\"><br></p><p data-lake-id=\"ue1d328fd\" id=\"ue1d328fd\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638533419869-3aa9b7ad-ee4e-4fd8-9e42-fd6af4aafe70.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D225%26id%3Du7ed4e098%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D341%26originWidth%3D945%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D186643%26status%3Ddone%26style%3Dnone%26taskId%3Duc65852ff-c2a9-416e-bef6-2991c80fa8b%26title%3D%26width%3D623.0000610351562%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22OAmnb%22%7D\"></card><span data-lake-id=\"u02ce7662\" id=\"u02ce7662\"> <br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638533456413-9ead4e1d-f118-4a55-8d05-bcdd4d5fc47f.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D131%26id%3Du954992f9%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D144%26originWidth%3D839%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D73103%26status%3Ddone%26style%3Dnone%26taskId%3Du9819bc42-f398-487a-b319-358e2acd1ba%26title%3D%26width%3D762.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22sjopK%22%7D\"></card></p><p data-lake-id=\"ua0b992e2\" id=\"ua0b992e2\"><br></p><h3 data-lake-id=\"3f64dd13\" id=\"3f64dd13\"><span data-lake-id=\"uc55d922c\" id=\"uc55d922c\">回调接口 : (若交换机收不到消息)</span></h3><p data-lake-id=\"uc0c6652d\" id=\"uc0c6652d\"><br></p><ol list=\"u18e7d6f4\"><li fid=\"uf5a85a9a\" data-lake-id=\"uf961977a\" id=\"uf961977a\"><span data-lake-id=\"u663b1458\" id=\"u663b1458\">配置类</span></li></ol><p data-lake-id=\"u1415f6ed\" id=\"u1415f6ed\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A15%5Cn%20*%20%E9%85%8D%E7%BD%AE%E7%B1%BB%20%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%20%EF%BC%88%E9%AB%98%E7%BA%A7%EF%BC%89%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20ConfirmConfig%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_EXCHANGE_NAME%20%3D%20%5C%22confirm_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_QUEUE_NAME%20%3D%20%5C%22confirm_queue%5C%22%3B%5Cn%20%20%20%20%2F%2Frouting-key%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_ROUTING_KEY%20%3D%20%5C%22key1%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20DirectExchange%20confirmExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20DirectExchange(CONFIRM_EXCHANGE_NAME)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20confirmQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(CONFIRM_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueBindingExchange(%40Qualifier(%5C%22confirmQueue%5C%22)%20Queue%20confirmQueue%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22confirmExchange%5C%22)%20DirectExchange%20confirmExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222a45d705%22%7D\"></card><p data-lake-id=\"u4ecde0f6\" id=\"u4ecde0f6\"><br></p><ol list=\"ub54f2c05\" start=\"2\"><li fid=\"u4e3bb631\" data-lake-id=\"ua5227561\" id=\"ua5227561\"><span data-lake-id=\"ued86c520\" id=\"ued86c520\">生产者：发消息</span></li></ol><p data-lake-id=\"ub699d97d\" id=\"ub699d97d\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.controller%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.connection.CorrelationData%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.web.bind.annotation.GetMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.PathVariable%3B%5Cnimport%20org.springframework.web.bind.annotation.RequestMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.RestController%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A27%5Cn%20*%20%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40RestController%5Cn%40RequestMapping(%5C%22%2Fconfirm%5C%22)%5Cnpublic%20class%20ProducerController%20%7B%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendMessage%2F%7Bmessage%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMessage(%40PathVariable%20String%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20CorrelationData%20correlationData%20%3D%20new%20CorrelationData(%5C%221%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME%2C%20ConfirmConfig.CONFIRM_ROUTING_KEY%2C%20message%2C%20correlationData)%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E4%B8%BA%EF%BC%9A%7B%7D%5C%22%2C%20message)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%227ba8c971%22%7D\"></card><p data-lake-id=\"ua928c4f5\" id=\"ua928c4f5\"><br></p><ol list=\"u3aa9a4e3\" start=\"3\"><li fid=\"u4732e243\" data-lake-id=\"u7b775a6c\" id=\"u7b775a6c\"><span data-lake-id=\"u0cd0e120\" id=\"u0cd0e120\">消费者：</span></li></ol><p data-lake-id=\"ud61ac3f3\" id=\"ud61ac3f3\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A33%5Cn%20*%20%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20Consumer%20%7B%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20ConfirmConfig.CONFIRM_QUEUE_NAME)%5Cn%20%20%20%20public%20void%20receiveConfirmMessage(Message%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E9%98%9F%E5%88%97confirm.queue%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22ee5ae00f%22%7D\"></card><p data-lake-id=\"u04196b83\" id=\"u04196b83\"><br></p><ol list=\"u99465ece\" start=\"4\"><li fid=\"u995125c0\" data-lake-id=\"u60a6d2ac\" id=\"u60a6d2ac\"><span data-lake-id=\"uda277bab\" id=\"uda277bab\">回调接口</span></li></ol><p data-lake-id=\"u706addb6\" id=\"u706addb6\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.connection.CorrelationData%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cnimport%20javax.annotation.PostConstruct%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A50%5Cn%20*%20%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20MyCallBack%20implements%20RabbitTemplate.ConfirmCallback%20%7B%5Cn%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%40PostConstruct%5Cn%20%20%20%20public%20void%20init()%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B3%A8%E5%85%A5%20%EF%BC%88%E9%9C%80%E8%A6%81%E5%B0%86%E5%BD%93%E5%89%8D%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%B3%A8%E5%85%A5%E5%88%B0RabbitTemplate%E7%9A%84ConfirmCallback%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E4%B8%AD%EF%BC%89%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.setConfirmCallback(this)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F**%5Cn%20%20%20%20%20*%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%A1%AE%E8%AE%A4%E5%9B%9E%E8%B0%83%E6%96%B9%E6%B3%95%5Cn%20%20%20%20%20*%201.%20%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BA%86%20%20%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20*%201.1%20correlationData%20%E4%BF%9D%E5%AD%98%E5%9B%9E%E8%B0%83%E6%B6%88%E6%81%AF%E7%9A%84id%E5%8F%8A%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20*%201.2%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%20%20ack%20%3D%20true%5Cn%20%20%20%20%20*%201.3%20cause%20%20null%5Cn%20%20%20%20%20*%202.%20%E5%8F%91%E6%B6%88%E6%81%AF%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%8E%A5%E6%94%B6%E5%A4%B1%E8%B4%A5%20%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20*%202.1%20correlationData%20%E4%BF%9D%E5%AD%98%E5%9B%9E%E8%B0%83%E6%B6%88%E6%81%AF%E7%9A%84id%E5%8F%8A%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20*%202.2%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%20ack%20%3D%20false%5Cn%20%20%20%20%20*%202.3%20cause%20%20%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%8E%9F%E5%9B%A0%5Cn%20%20%20%20%20*%5Cn%20%20%20%20%20*%20%40param%20correlationData%5Cn%20%20%20%20%20*%20%40param%20ack%5Cn%20%20%20%20%20*%20%40param%20cause%5Cn%20%20%20%20%20*%2F%5Cn%20%20%20%20%40Override%5Cn%20%20%20%20public%20void%20confirm(CorrelationData%20correlationData%2C%20boolean%20ack%2C%20String%20cause)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20id%20%3D%20correlationData%20!%3D%20null%20%3F%20correlationData.getId()%20%3A%20%5C%22%5C%22%3B%5Cn%20%20%20%20%20%20%20%20if%20(ack)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20log.info(%5C%22%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B7%B2%E7%BB%8F%E6%94%B6%E5%88%B0id%E4%B8%BA%EF%BC%9A%7B%7D%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%2C%20id)%3B%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20log.error(%5C%22%E4%BA%A4%E6%8D%A2%E6%9C%BA%E8%BF%98%E6%9C%AA%E6%94%B6%E5%88%B0id%E4%B8%BA%3A%7B%7D%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8C%E7%94%B1%E4%BA%8E%E5%8E%9F%E5%9B%A0%EF%BC%9A%7B%7D%5C%22%2C%20id%2C%20cause)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22b57f810e%22%7D\"></card><p data-lake-id=\"uef78c20d\" id=\"uef78c20d\"><br></p><p data-lake-id=\"ua5e09f93\" id=\"ua5e09f93\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638537772169-a45dc229-e5ed-410a-8e46-69f3fb39f21e.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D518%26id%3Du396acbb1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D518%26originWidth%3D973%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D369736%26status%3Ddone%26style%3Dnone%26taskId%3Du8a93ee99-1d87-4fd1-880d-a166a5e50f1%26title%3D%26width%3D973%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Bk8N5%22%7D\"></card></p><p data-lake-id=\"u67dd6b93\" id=\"u67dd6b93\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22spring%3A%5Cn%20%20rabbitmq%3A%5Cn%20%20%20%20host%3A%2059.110.171.189%5Cn%20%20%20%20port%3A%205672%5Cn%20%20%20%20username%3A%20admin%5Cn%20%20%20%20password%3A%20123%5Cn%20%20%20%20publisher-confirm-type%3A%20correlated%20%20%20%20%23%20%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22ab4a519d%22%7D\"></card><p data-lake-id=\"ub25474b6\" id=\"ub25474b6\"><br></p><ol list=\"u6cb1d6f7\" start=\"5\"><li fid=\"u8a5f17a7\" data-lake-id=\"ud16eafd0\" id=\"ud16eafd0\"><span data-lake-id=\"u14d7f9ca\" id=\"u14d7f9ca\">发送请求 : http://localhost:8080/confirm/sendMessage/大家好 1</span></li></ol><p data-lake-id=\"u38416d74\" id=\"u38416d74\"><br></p><p data-lake-id=\"u78e4294b\" id=\"u78e4294b\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638537854600-e11783cd-28be-4b75-8f36-434ecab3f990.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D190%26id%3Due332f12f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D190%26originWidth%3D1135%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D51915%26status%3Ddone%26style%3Dnone%26taskId%3Duba52e997-898f-49e3-9067-645cfb69f68%26title%3D%26width%3D1135%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Emijw%22%7D\"></card></p><p data-lake-id=\"u7221df5d\" id=\"u7221df5d\"><br></p><ol list=\"u6dde4edd\" start=\"6\"><li fid=\"u496945b0\" data-lake-id=\"u9c66e047\" id=\"u9c66e047\"><span data-lake-id=\"u6641ac44\" id=\"u6641ac44\">测试交换机收不到消息：在发送消息中，将交换机名字后面拼接上&quot;123&quot;，再次启动，发送请求： http://localhost:8080/confirm/sendMessage/大家好 1</span></li></ol><p data-lake-id=\"ubcb758d6\" id=\"ubcb758d6\"><br></p><p data-lake-id=\"u22d07271\" id=\"u22d07271\"><span data-lake-id=\"u70e7d21c\" id=\"u70e7d21c\">会得到：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638538268620-8dcbc2ae-eaa1-4b60-8822-9cd20f509c52.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D222%26id%3Du3e470d69%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D222%26originWidth%3D1872%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D66288%26status%3Ddone%26style%3Dnone%26taskId%3Du7f0330f7-a846-488e-8b25-71c1f3cf0a7%26title%3D%26width%3D1872%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22J3ZRH%22%7D\"></card></p><p data-lake-id=\"uc7e4f269\" id=\"uc7e4f269\"><br></p><ol list=\"ubf8d1f03\" start=\"7\"><li fid=\"ufd84ad2f\" data-lake-id=\"u8c7d1937\" id=\"u8c7d1937\"><span data-lake-id=\"u4796d64a\" id=\"u4796d64a\">测试队列收不到消息</span></li></ol><p data-lake-id=\"u108dd925\" id=\"u108dd925\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.controller%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.connection.CorrelationData%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.web.bind.annotation.GetMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.PathVariable%3B%5Cnimport%20org.springframework.web.bind.annotation.RequestMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.RestController%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A27%5Cn%20*%20%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40RestController%5Cn%40RequestMapping(%5C%22%2Fconfirm%5C%22)%5Cnpublic%20class%20ProducerController%20%7B%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendMessage%2F%7Bmessage%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMessage(%40PathVariable%20String%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20CorrelationData%20correlationData1%20%3D%20new%20CorrelationData(%5C%221%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ConfirmConfig.CONFIRM_ROUTING_KEY%2C%20message%2C%20correlationData1)%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E4%B8%BA%EF%BC%9A%7B%7D%5C%22%2C%20message)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20CorrelationData%20correlationData2%20%3D%20new%20CorrelationData(%5C%222%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ConfirmConfig.CONFIRM_ROUTING_KEY%2B%5C%222%5C%22%2C%20message%2C%20correlationData2)%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E4%B8%BA%EF%BC%9A%7B%7D%5C%22%2C%20message)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%228e842df0%22%7D\"></card><p data-lake-id=\"u1b20db2a\" id=\"u1b20db2a\"><br></p><p data-lake-id=\"uce701b63\" id=\"uce701b63\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638538743381-bfc4680e-692b-4303-a0f3-87cd9425978d.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D247%26id%3Du241a2996%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D247%26originWidth%3D1157%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D67266%26status%3Ddone%26style%3Dnone%26taskId%3Du3edf7078-e740-4b0a-866c-03de3cfb9db%26title%3D%26width%3D1157%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22SGy2Z%22%7D\"></card><span data-lake-id=\"u94b8d528\" id=\"u94b8d528\"><br /></span><span data-lake-id=\"u11773354\" id=\"u11773354\">可见，队列没有收到消息，也没有应答和确认。</span></p><p data-lake-id=\"ubbd10bfa\" id=\"ubbd10bfa\"><br></p><h3 data-lake-id=\"9a49228a\" id=\"9a49228a\"><span data-lake-id=\"u69229606\" id=\"u69229606\">若队列收不到消息</span></h3><p data-lake-id=\"uf0412cea\" id=\"uf0412cea\"><br></p><p data-lake-id=\"u17a29e6c\" id=\"u17a29e6c\"><br></p><p data-lake-id=\"u18410005\" id=\"u18410005\"><br></p><h4 data-lake-id=\"7df88dac\" id=\"7df88dac\"><span data-lake-id=\"uacff6e07\" id=\"uacff6e07\">回退消息</span></h4><p data-lake-id=\"u6d37cd3e\" id=\"u6d37cd3e\"><br></p><p data-lake-id=\"u9d159a4e\" id=\"u9d159a4e\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638539584832-557a9bbc-89d4-4162-a0d4-599eb7f3df21.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D210%26id%3Du40b5093d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D210%26originWidth%3D976%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D298616%26status%3Ddone%26style%3Dnone%26taskId%3Du13a46749-be43-4430-beb2-483ea013efc%26title%3D%26width%3D976%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22thCkG%22%7D\"></card></p><p data-lake-id=\"uf348cbd9\" id=\"uf348cbd9\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22spring%3A%5Cn%20%20rabbitmq%3A%5Cn%20%20%20%20host%3A%2059.110.171.189%5Cn%20%20%20%20port%3A%205672%5Cn%20%20%20%20username%3A%20admin%5Cn%20%20%20%20password%3A%20123%5Cn%20%20%20%20publisher-confirm-type%3A%20correlated%20%20%20%23%20%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%5Cn%20%20%20%20publisher-returns%3A%20true%20%20%20%20%20%20%20%23%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%EF%BC%88%E6%B6%88%E6%81%AF%E5%9C%A8%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%82%A3%E8%8B%A5%E8%B7%AF%E7%94%B1%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%88%99%E4%BC%9A%E5%9B%9E%E9%80%80%E6%B6%88%E6%81%AF%E7%BB%99%E7%94%9F%E4%BA%A7%E8%80%85%EF%BC%89%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%229bc2e551%22%7D\"></card><p data-lake-id=\"ude0471d2\" id=\"ude0471d2\"><br></p><p data-lake-id=\"u4ecdba54\" id=\"u4ecdba54\"><span data-lake-id=\"u58fdf937\" id=\"u58fdf937\">回退接口：</span></p><p data-lake-id=\"ub365cc32\" id=\"ub365cc32\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E6%B3%A8%E5%85%A5%5Cn%40PostConstruct%5Cn%20%20%20%20public%20void%20init()%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B3%A8%E5%85%A5%20%EF%BC%88%E9%9C%80%E8%A6%81%E5%B0%86%E5%BD%93%E5%89%8D%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%B3%A8%E5%85%A5%E5%88%B0RabbitTemplate%E7%9A%84ConfirmCallback%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E4%B8%AD%EF%BC%89%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.setConfirmCallback(this)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.setReturnsCallback(this)%3B%5Cn%20%20%20%20%7D%5Cn%2F**%5Cn%20%20%20%20%20*%20%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%BD%93%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E4%B8%8D%E5%8F%AF%E8%BE%BE%E7%9B%AE%E7%9A%84%E5%9C%B0%E6%97%B6%E5%B0%86%E6%B6%88%E6%81%AF%E8%BF%94%E5%9B%9E%E7%BB%99%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20%20%20%20%20*%20%E5%8F%AA%E6%9C%89%E4%B8%8D%E5%8F%AF%E5%88%B0%E7%9B%AE%E7%9A%84%E5%9C%B0%E6%97%B6%EF%BC%8C%E6%89%8D%E8%BF%9B%E8%A1%8C%E5%9B%9E%E9%80%80%5Cn%20%20%20%20%20*%5Cn%20%20%20%20%20*%20%40param%20returnedMessage%5Cn%20%20%20%20%20*%2F%5Cn%20%20%20%20%40Override%5Cn%20%20%20%20public%20void%20returnedMessage(ReturnedMessage%20returnedMessage)%20%7B%5Cn%20%20%20%20%20%20%20%20log.error(%5C%22%E6%B6%88%E6%81%AF%7B%7D%EF%BC%8C%E8%A2%AB%E4%BA%A4%E6%8D%A2%E6%9C%BA%7B%7D%E9%80%80%E5%9B%9E%EF%BC%8C%E9%80%80%E5%9B%9E%E5%8E%9F%E5%9B%A0%EF%BC%9A%7B%7D%2C%E8%B7%AF%E7%94%B1key%3A%7B%7D%5C%22%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20new%20String(returnedMessage.getMessage().getBody())%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20returnedMessage.getExchange()%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20returnedMessage.getReplyText()%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20returnedMessage.getRoutingKey())%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220cc635d1%22%7D\"></card><p data-lake-id=\"u2654fc7c\" id=\"u2654fc7c\"><br></p><p data-lake-id=\"uf86bf68a\" id=\"uf86bf68a\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638542234889-03b41ef6-8fc5-4ffb-9f36-7287d4ff9476.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D267%26id%3Duddd5e8ec%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D267%26originWidth%3D1293%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D78730%26status%3Ddone%26style%3Dnone%26taskId%3Du4c513758-cf34-415c-a9f3-845a33faec5%26title%3D%26width%3D1293%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22tOHQ4%22%7D\"></card></p><p data-lake-id=\"uc53a419f\" id=\"uc53a419f\"><br></p><h4 data-lake-id=\"2d534732\" id=\"2d534732\"><span data-lake-id=\"u10e834ce\" id=\"u10e834ce\">备份交换机</span></h4><p data-lake-id=\"uabcf7a93\" id=\"uabcf7a93\"><br></p><p data-lake-id=\"u73453e3c\" id=\"u73453e3c\"><span data-lake-id=\"ueeed5229\" id=\"ueeed5229\">添加一个交换机和两个队列。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638578627259-759238ba-aac5-42f9-b645-401c5c9a05d2.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D328%26id%3Dud35a1613%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D328%26originWidth%3D930%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D197049%26status%3Ddone%26style%3Dnone%26taskId%3Du04e4ef45-34c3-49a8-84c0-93d70b4ebb6%26title%3D%26width%3D930%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22j2ALj%22%7D\"></card></p><p data-lake-id=\"udb3c78de\" id=\"udb3c78de\"><br></p><ol list=\"u15b76342\"><li fid=\"u4c5a4eb6\" data-lake-id=\"u2c143d03\" id=\"u2c143d03\"><span data-lake-id=\"u8bcff5cb\" id=\"u8bcff5cb\">配置类</span></li></ol><p data-lake-id=\"u7df36999\" id=\"u7df36999\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A15%5Cn%20*%20%E9%85%8D%E7%BD%AE%E7%B1%BB%20%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%20%EF%BC%88%E9%AB%98%E7%BA%A7%EF%BC%89%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20ConfirmConfig%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_EXCHANGE_NAME%20%3D%20%5C%22confirm_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_QUEUE_NAME%20%3D%20%5C%22confirm_queue%5C%22%3B%5Cn%20%20%20%20%2F%2Frouting-key%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_ROUTING_KEY%20%3D%20%5C%22key1%5C%22%3B%5Cn%20%20%20%20%2F%2F%20--------------------------%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA---------------------------------%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20BACKUP_EXCHANGE_NAME%20%3D%20%5C%22backup_exchange%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20BACKUP_QUEUE_NAME%20%3D%20%5C%22backup_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8A%A5%E8%AD%A6%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20WARNING_QUEUE_NAME%20%3D%20%5C%22warning_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F--------------------------------------------------------------------%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E7%A1%AE%E8%AE%A4%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%88%E8%A6%81%E8%BD%AC%E5%8F%91%E5%88%B0%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%89%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20DirectExchange%20confirmExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(true)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.withArgument(%5C%22alternate-exchange%5C%22%2C%20BACKUP_EXCHANGE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20confirmQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(CONFIRM_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueBindingExchange(%40Qualifier(%5C%22confirmQueue%5C%22)%20Queue%20confirmQueue%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22confirmExchange%5C%22)%20DirectExchange%20confirmExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20FanoutExchange%20backupExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20FanoutExchange(BACKUP_EXCHANGE_NAME)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20backupQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(BACKUP_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E6%8A%A5%E8%AD%A6%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20warningQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(WARNING_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%EF%BC%88%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E5%A4%87%E4%BB%BD%E9%98%9F%E5%88%97%EF%BC%89%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20backupQueueBindingBackupExchange(%40Qualifier(%5C%22backupExchange%5C%22)%20FanoutExchange%20backupExchange%2C%20%40Qualifier(%5C%22backupQueue%5C%22)%20Queue%20backupQueue)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(backupQueue).to(backupExchange)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%EF%BC%88%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E6%8A%A5%E8%AD%A6%E9%98%9F%E5%88%97%EF%BC%89%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20warningQueueBindingBackupExchange(%40Qualifier(%5C%22backupExchange%5C%22)%20FanoutExchange%20backupExchange%2C%20%40Qualifier(%5C%22warningQueue%5C%22)%20Queue%20warningQueue)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(warningQueue).to(backupExchange)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%227e31c035%22%7D\"></card><p data-lake-id=\"u2d96580e\" id=\"u2d96580e\"><br></p><ol list=\"u2e9dedfa\" start=\"2\"><li fid=\"ufdf85b68\" data-lake-id=\"ub0f9ce9a\" id=\"ub0f9ce9a\"><span data-lake-id=\"ua927c9ba\" id=\"ua927c9ba\">消费者（报警消费者）</span></li></ol><p data-lake-id=\"u699010ce\" id=\"u699010ce\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F4%209%3A10%5Cn%20*%20%E6%8A%A5%E8%AD%A6%E6%B6%88%E8%B4%B9%E8%80%85%5Cn%20*%2F%5Cn%40Component%5Cn%40Slf4j%5Cnpublic%20class%20WarningConsumer%20%7B%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%8A%A5%E8%AD%A6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20ConfirmConfig.WARNING_QUEUE_NAME)%5Cn%20%20%20%20public%20void%20receiveWarningMsg(Message%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.error(%5C%22%E6%8A%A5%E8%AD%A6%E5%8F%91%E7%8E%B0%E4%B8%8D%E5%8F%AF%E8%B7%AF%E7%94%B1%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2235bc7912%22%7D\"></card><p data-lake-id=\"ud84928fa\" id=\"ud84928fa\"><br></p><p data-lake-id=\"ue7878fb1\" id=\"ue7878fb1\"><span data-lake-id=\"ud8e024bd\" id=\"ud8e024bd\">发送请求：http://localhost:8080/confirm/sendMessage/大家好 1<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638581402507-07326d95-5109-4750-b3ab-c4751b23d55d.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D263%26id%3Dudc9907e1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D263%26originWidth%3D1171%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D75848%26status%3Ddone%26style%3Dnone%26taskId%3Du7fb8b716-7979-4acf-b11c-fe1cb99bebd%26title%3D%26width%3D1171%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Lep12%22%7D\"></card></p><p data-lake-id=\"uc9ac1a25\" id=\"uc9ac1a25\"><br></p><blockquote data-lake-id=\"u591724e9\" id=\"u591724e9\"><p data-lake-id=\"ud9d05a36\" id=\"ud9d05a36\"><strong><span data-lake-id=\"u1e4adb4e\" id=\"u1e4adb4e\">备份交换机的优先级高于回退消息、</span></strong></p></blockquote><p data-lake-id=\"ua078c614\" id=\"ua078c614\"><br></p><p data-lake-id=\"uab27aa2a\" id=\"uab27aa2a\"><br></p><p data-lake-id=\"ud02d49fe\" id=\"ud02d49fe\"><br></p><h2 data-lake-id=\"c06ec42e\" id=\"c06ec42e\"><span data-lake-id=\"u7369f8e6\" id=\"u7369f8e6\">其他知识点</span></h2><p data-lake-id=\"u4f098a02\" id=\"u4f098a02\"><br></p><p data-lake-id=\"u3abc395c\" id=\"u3abc395c\"><br></p><p data-lake-id=\"u471eac83\" id=\"u471eac83\"><br></p><h3 data-lake-id=\"71a92fdf\" id=\"71a92fdf\"><span data-lake-id=\"u20dc07dc\" id=\"u20dc07dc\">幂等性</span></h3><p data-lake-id=\"u648dd420\" id=\"u648dd420\"><br></p><p data-lake-id=\"u8e5b1edb\" id=\"u8e5b1edb\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638581856478-4611604a-34c1-486b-a3b7-c809f3d94f0e.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D620%26id%3Dua03a1a2a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D620%26originWidth%3D977%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D628166%26status%3Ddone%26style%3Dnone%26taskId%3Du3bbefde1-d01a-481e-b831-abe2598835f%26title%3D%26width%3D977%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22pWlKw%22%7D\"></card><span data-lake-id=\"ude9d2f3b\" id=\"ude9d2f3b\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638582165848-9189cc73-c68b-4631-b30d-dad30387a032.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D523%26id%3Du37f187c9%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D523%26originWidth%3D1001%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D609037%26status%3Ddone%26style%3Dnone%26taskId%3Dudd6ff171-0753-4d6f-a510-a8761c65fcb%26title%3D%26width%3D1001%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22o6DXP%22%7D\"></card></p><p data-lake-id=\"u2dbfadbc\" id=\"u2dbfadbc\"><br></p><p data-lake-id=\"ubcb1ea0b\" id=\"ubcb1ea0b\"><br></p><p data-lake-id=\"u62eecae6\" id=\"u62eecae6\"><br></p><h3 data-lake-id=\"507580b5\" id=\"507580b5\"><span data-lake-id=\"u3de3316a\" id=\"u3de3316a\">优先级队列</span></h3><p data-lake-id=\"u7da11996\" id=\"u7da11996\"><br></p><p data-lake-id=\"u3cc63c54\" id=\"u3cc63c54\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638582363595-025332ba-94e1-4485-b6ab-e0542d69fab7.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D326%26id%3Du83200fbd%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D326%26originWidth%3D987%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D447217%26status%3Ddone%26style%3Dnone%26taskId%3Dueea7db03-7906-4cef-baef-0ebe50a0185%26title%3D%26width%3D987%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22h3cca%22%7D\"></card><span data-lake-id=\"u87ffed88\" id=\"u87ffed88\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638582579936-dd221c3d-efc6-4e4b-b854-6667d27682a1.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D343%26id%3Du3930b1c7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D402%26originWidth%3D1186%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D288467%26status%3Ddone%26style%3Dnone%26taskId%3Du70a2eadf-0b86-470c-a5a8-b7d8f612ad3%26title%3D%26width%3D1010.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22WVQYU%22%7D\"></card><span data-lake-id=\"u5e870bf4\" id=\"u5e870bf4\"><br /></span><span data-lake-id=\"u54768020\" id=\"u54768020\">实现优先级:</span></p><p data-lake-id=\"u6cc05b3e\" id=\"u6cc05b3e\"><br></p><ol list=\"u3b2bd50a\"><li fid=\"uc81d90cd\" data-lake-id=\"ua6331a27\" id=\"ua6331a27\"><span data-lake-id=\"ue8e9a456\" id=\"ue8e9a456\">生产者：</span></li></ol><p data-lake-id=\"ua01e5a8f\" id=\"ua01e5a8f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.AMQP%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F28%2022%3A15%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%20%EF%BC%9A%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20private%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello1%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%2F%2F%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E5%B7%A5%E5%8E%82ip%20%20%E8%BF%9E%E6%8E%A5rabbitmq%E7%9A%84%E9%98%9F%E5%88%97%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E6%88%B7%E5%90%8D%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E5%AF%86%E7%A0%81%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%5Cn%2F%2F%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E8%8E%B7%E5%8F%96%E4%BF%A1%E9%81%93%5Cn%2F%2F%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%82%E6%95%B0%EF%BC%9B1.%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%202.%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%E5%90%A6%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%88%E7%A3%81%E7%9B%98%EF%BC%89%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%88%E4%B8%8D%E6%8C%81%E4%B9%85%E5%8C%96false%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%203.%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E5%8F%AA%E4%BE%9B%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E6%98%AF%E5%90%A6%E6%B6%88%E6%81%AF%E7%8B%AC%E6%9C%89%EF%BC%8Ctrue%E5%8F%AA%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AFfalse%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%204.%20%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%90%8E%EF%BC%8C%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Ctrue%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Cfalse%E4%B8%8D%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%205.%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%88%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF......%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%AE%98%E6%96%B9%E5%85%81%E8%AE%B8%E6%98%AF0-255%E4%B9%8B%E9%97%B4%E3%80%82%E6%AD%A4%E5%A4%84%E8%AE%BE%E7%BD%AE10.%20%E5%85%81%E8%AE%B8%E4%BC%98%E5%85%88%E7%BA%A7%E8%8C%83%E5%9B%B4%E4%B8%BA0-10%20%20%20%E4%B8%8D%E8%A6%81%E8%AE%BE%E7%BD%AE%E8%BF%87%E5%A4%A7%20%20%20%E6%B5%AA%E8%B4%B9CPU%E4%B8%8E%E5%86%85%E5%AD%98%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-max-priority%5C%22%2C%2010)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(QUEUE_NAME%2C%20true%2C%20false%2C%20false%2C%20arguments)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%2011%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22info%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20%3D%3D%205)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20AMQP.BasicProperties%20properties%20%3D%20new%20AMQP.BasicProperties().builder().priority(5).build()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20QUEUE_NAME%2C%20properties%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20QUEUE_NAME%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%20%E5%8F%91%E9%80%81%E5%88%B0%E5%93%AA%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E8%B7%AF%E7%94%B1%E7%9A%84key%E5%80%BC%E6%98%AF%E5%93%AA%E4%B8%AA%EF%BC%8C%E6%9C%AC%E6%AC%A1%E6%98%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%B6%88%E6%81%AF%E4%BD%93%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%AE%8C%E6%AF%95%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22e42f278b%22%7D\"></card><p data-lake-id=\"uc6f9bdd8\" id=\"uc6f9bdd8\"><br></p><p data-lake-id=\"ue80f4739\" id=\"ue80f4739\"><span data-lake-id=\"ub89a1ea2\" id=\"ub89a1ea2\">启动生产者：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584428018-a99005d9-2193-463c-9f45-3f72656510ca.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D245%26id%3Du9109bfc5%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D245%26originWidth%3D673%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D24479%26status%3Ddone%26style%3Dnone%26taskId%3Du0a4a6f5a-f03f-4ab3-8fcc-d9bdc327aad%26title%3D%26width%3D673%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22shKB3%22%7D\"></card></p><p data-lake-id=\"u291a7eb3\" id=\"u291a7eb3\"><br></p><h3 data-lake-id=\"07eab7c1\" id=\"07eab7c1\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584267331-0bf02c8d-6536-43a8-aa18-ee5f4ed82255.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D500%26id%3DAvLAP%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D500%26originWidth%3D1065%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D74831%26status%3Ddone%26style%3Dnone%26taskId%3Du77c77f80-cfec-453b-bc9f-f82bf26b07c%26title%3D%26width%3D1065%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22cIQXz%22%7D\"></card></h3><p data-lake-id=\"ucb9b4527\" id=\"ucb9b4527\"><br></p><ol list=\"ufc7ca6f8\" start=\"2\"><li fid=\"ua7a7b9eb\" data-lake-id=\"u5b439607\" id=\"u5b439607\"><span data-lake-id=\"u556ed9c1\" id=\"u556ed9c1\">消费者 :</span></li></ol><p data-lake-id=\"u293cdbaa\" id=\"u293cdbaa\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.*%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.Arrays%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2015%3A04%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%3A%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Consumer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello1%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%2F%2F%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%20%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF(%E6%88%90%E5%8A%9F%E5%90%8E%E7%9A%84%E5%9B%9E%E8%B0%83)%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(new%20String(message.getBody()))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%96%E6%B6%88%E6%B6%88%E6%81%AF%E6%97%B6%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20CancelCallback%20cancelCallback%20%3D%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%A2%AB%E4%B8%AD%E6%96%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%E6%B6%88%E8%B4%B9%E5%93%AA%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E6%B6%88%E8%B4%B9%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E6%98%AF%E5%90%A6%E8%A6%81%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8Ctrue%E4%BB%A3%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%2Cfalse%E4%BB%A3%E8%A1%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%B6%88%E8%B4%B9%E8%80%85%E6%9C%AA%E6%88%90%E5%8A%9F%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(QUEUE_NAME%2C%20true%2C%20deliverCallback%2C%20cancelCallback)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2281930e95%22%7D\"></card><p data-lake-id=\"u16cfd581\" id=\"u16cfd581\"><br></p><p data-lake-id=\"ud1908c6e\" id=\"ud1908c6e\"><span data-lake-id=\"ucb8356bd\" id=\"ucb8356bd\">启动消费者，<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584610103-d784c402-b9b7-4321-80d9-c4b95990f410.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D346%26id%3Du91a8ee8e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D346%26originWidth%3D652%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D36450%26status%3Ddone%26style%3Dnone%26taskId%3Du90a3da53-d612-4152-b8b6-157c3e789ca%26title%3D%26width%3D652%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22UEHzd%22%7D\"></card></p><p data-lake-id=\"u87611f1d\" id=\"u87611f1d\"><br></p><h3 data-lake-id=\"8508a884\" id=\"8508a884\"><span data-lake-id=\"u855e9604\" id=\"u855e9604\">惰性队列</span></h3><p data-lake-id=\"uc5f84afb\" id=\"uc5f84afb\"><br></p><p data-lake-id=\"u0b31325e\" id=\"u0b31325e\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584657059-9bf42f28-e7a0-4c4f-8a39-c56038bd0071.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D425%26id%3Dud4e3da7e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D425%26originWidth%3D993%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D597255%26status%3Ddone%26style%3Dnone%26taskId%3Du2ff8ea80-3715-4c63-a718-4d71e1b8488%26title%3D%26width%3D993%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22wMAkZ%22%7D\"></card><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584904322-348e89b5-e2f2-4df0-ba11-7540a061f849.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D613%26id%3Du9cab5578%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D613%26originWidth%3D1175%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D404748%26status%3Ddone%26style%3Dnone%26taskId%3Duc0905b86-a7ec-4a0f-8a69-356a47ad688%26title%3D%26width%3D1175%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22NaNR3%22%7D\"></card><span data-lake-id=\"u64172734\" id=\"u64172734\"><br /></span><span data-lake-id=\"uba38271b\" id=\"uba38271b\">惰性队列执行性能不太好，因此默认情况下不使用惰性队列，而使用正常队列。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638585096408-ecb74216-dfa9-41e3-b7bd-bd5236b2c1da.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D431%26id%3Du4ab29e59%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D431%26originWidth%3D967%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D466179%26status%3Ddone%26style%3Dnone%26taskId%3Dub1da4c7a-e46a-44f7-9b2f-e5129f4a839%26title%3D%26width%3D967%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22ZtuGu%22%7D\"></card><span data-lake-id=\"u65e4732c\" id=\"u65e4732c\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638585305462-e73859d4-5121-406a-b308-57cede7f1bac.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D413%26id%3Duf8c1b8a8%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D413%26originWidth%3D966%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D247424%26status%3Ddone%26style%3Dnone%26taskId%3Dua29dd158-1851-4974-bd9b-3c01a9c0ea5%26title%3D%26width%3D966%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22wFSJu%22%7D\"></card></p><p data-lake-id=\"u76b838dd\" id=\"u76b838dd\"><br></p><ul list=\"ud877048a\"><li fid=\"u61f80eea\" data-lake-id=\"u4d99bf08\" id=\"u4d99bf08\"><span data-lake-id=\"u181db35b\" id=\"u181db35b\">惰性队列从</span><strong><span data-lake-id=\"ue23e1779\" id=\"ue23e1779\">磁盘</span></strong><span data-lake-id=\"u40148889\" id=\"u40148889\">上读取消息，因此消费消息比较慢，但是内存消耗较小，在内存中只存储一些索引。一旦需要消费这些消息时，惰性队列会通过内存中的索引，去读取磁盘中相应的消息，到内存，再消费消息。</span></li></ul><ul list=\"u055673c0\"><li fid=\"ud503864a\" data-lake-id=\"u07689e77\" id=\"u07689e77\"><span data-lake-id=\"ue0dc9030\" id=\"ue0dc9030\">正常队列从</span><strong><span data-lake-id=\"u2d44c37e\" id=\"u2d44c37e\">内存</span></strong><span data-lake-id=\"ub2ed9b46\" id=\"ub2ed9b46\">中读取消息，因此消费消息比较快，但是内存消耗较大。</span></li></ul><p data-lake-id=\"u27df5c54\" id=\"u27df5c54\"><br></p><h2 data-lake-id=\"23eaf825\" id=\"23eaf825\"><span data-lake-id=\"u5a936f08\" id=\"u5a936f08\">rabbitmq 集群</span></h2><p data-lake-id=\"u5557a767\" id=\"u5557a767\"><br></p><p data-lake-id=\"u0ad69f32\" id=\"u0ad69f32\"><br></p><p data-lake-id=\"u20e292f4\" id=\"u20e292f4\"><br></p><h3 data-lake-id=\"c0131d2a\" id=\"c0131d2a\"><span data-lake-id=\"u57794d8d\" id=\"u57794d8d\">集群原理</span></h3><p data-lake-id=\"u5c043ed3\" id=\"u5c043ed3\"><br></p><p data-lake-id=\"udb2f051a\" id=\"udb2f051a\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638586666884-b99e8e77-81ef-4547-a9cd-1dcd00e86009.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D501%26id%3Du84ce9d05%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D501%26originWidth%3D1025%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D171726%26status%3Ddone%26style%3Dnone%26taskId%3Dud7aa0990-8e0c-4e31-9dd1-c6d20007401%26title%3D%26width%3D1025%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22hjXVB%22%7D\"></card></p><p data-lake-id=\"u13f38595\" id=\"u13f38595\"><br></p><h3 data-lake-id=\"b80e581a\" id=\"b80e581a\"><span data-lake-id=\"ua8738995\" id=\"ua8738995\">镜像队列（备份）</span></h3><p data-lake-id=\"u18d348a8\" id=\"u18d348a8\"><br></p><p data-lake-id=\"u638524b5\" id=\"u638524b5\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638587610363-c97ef89e-768e-4278-a087-89f20e211145.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D348%26id%3Due8695270%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D348%26originWidth%3D981%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D453959%26status%3Ddone%26style%3Dnone%26taskId%3Due9f78068-c45e-4cc9-a3e0-595ae6c7337%26title%3D%26width%3D981%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FTNYI%22%7D\"></card></p><p data-lake-id=\"ube043d14\" id=\"ube043d14\"><br></p><h3 data-lake-id=\"3702723f\" id=\"3702723f\"><span data-lake-id=\"u6b2b8ea2\" id=\"u6b2b8ea2\">高可用负载均衡</span></h3><p data-lake-id=\"u442f2d09\" id=\"u442f2d09\"><br></p><p data-lake-id=\"u2e5b02e2\" id=\"u2e5b02e2\"><span data-lake-id=\"ufc900772\" id=\"ufc900772\">若节点 1 宕机了，生产者需要连接节点 2 或节点 3。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588031855-ab97c0f3-9861-4222-b593-0a4dbfbf566d.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D754%26id%3Du0c60fb59%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D754%26originWidth%3D1028%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D344345%26status%3Ddone%26style%3Dnone%26taskId%3Duaef85042-099b-42a3-8caf-268a89b7438%26title%3D%26width%3D1028%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22XmCHx%22%7D\"></card><span data-lake-id=\"u6247fda2\" id=\"u6247fda2\"><br /></span><span data-lake-id=\"uf4b7c837\" id=\"uf4b7c837\">出现问题：生产者无法变更 rabbitmq 的 ip，此时需要借助外力 Haproxy。</span></p><p data-lake-id=\"u7f61765f\" id=\"u7f61765f\"><br></p><h4 data-lake-id=\"ea97af39\" id=\"ea97af39\"><span data-lake-id=\"u8b712db1\" id=\"u8b712db1\">Haproxy 实现高可用 负载均衡（高并发）</span></h4><p data-lake-id=\"ubf6aa704\" id=\"ubf6aa704\"><br></p><p data-lake-id=\"ud147c6a9\" id=\"ud147c6a9\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588332155-384a9066-f6ed-434c-bd8d-a08678795b99.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D177%26id%3Du91155287%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D177%26originWidth%3D973%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D240431%26status%3Ddone%26style%3Dnone%26taskId%3Du9a4dff8d-f824-447c-b845-2962ddc0650%26title%3D%26width%3D973%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22BHuXj%22%7D\"></card><span data-lake-id=\"u550eb749\" id=\"u550eb749\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588403571-837d2496-d169-4b00-aa3c-4459e5dfd616.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D644%26id%3Du63b0c105%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D644%26originWidth%3D740%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D224363%26status%3Ddone%26style%3Dnone%26taskId%3Du400f5630-901e-4db7-8556-6d72a1f206a%26title%3D%26width%3D740%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FRrD8%22%7D\"></card><span data-lake-id=\"uc1db626c\" id=\"uc1db626c\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588495639-57e1823e-e317-48f1-bd99-4a64ab26b8b3.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D711%26id%3Duefaa64c3%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D711%26originWidth%3D860%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D371827%26status%3Ddone%26style%3Dnone%26taskId%3Du8f30ca6f-4949-4c9d-899d-b31600baa56%26title%3D%26width%3D860%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22K5Fpn%22%7D\"></card></p><p data-lake-id=\"ub8c1111e\" id=\"ub8c1111e\"><br></p><h2 data-lake-id=\"80fc5d12\" id=\"80fc5d12\"><span data-lake-id=\"u0e79ddbd\" id=\"u0e79ddbd\">联合交换机</span></h2><p data-lake-id=\"uf8765abf\" id=\"uf8765abf\"><br></p><p data-lake-id=\"u19f4fde9\" id=\"u19f4fde9\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638600972390-f8eabb13-fdba-432b-8b93-c4798757e13e.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D660%26id%3Du1565c7a2%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D660%26originWidth%3D1136%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D882067%26status%3Ddone%26style%3Dnone%26taskId%3Du40ae3ed4-1bbc-4baa-b912-40f55e8b353%26title%3D%26width%3D1136%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FkHCS%22%7D\"></card><span data-lake-id=\"ue7c4b67b\" id=\"ue7c4b67b\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638601768985-91857261-fe17-4687-bc9f-f8d9daf1a364.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D524%26id%3Duafeaba48%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D524%26originWidth%3D1115%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D307899%26status%3Ddone%26style%3Dnone%26taskId%3Du4499a665-a618-4138-a2f2-5bdf1dbaca0%26title%3D%26width%3D1115%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FgJli%22%7D\"></card><span data-lake-id=\"u07d151a2\" id=\"u07d151a2\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638601930969-0c445ecb-7e66-43cd-a7d1-3aa8c76f884d.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D581%26id%3Du6d4c749b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D581%26originWidth%3D505%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D221677%26status%3Ddone%26style%3Dnone%26taskId%3Duf8d981fd-837f-4eb6-83f6-a7deba0a018%26title%3D%26width%3D505%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22NxTl9%22%7D\"></card><span data-lake-id=\"u4f114bbf\" id=\"u4f114bbf\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638602088334-f76d8ba1-5c6d-4280-87c8-b7d58d42f902.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D506%26id%3Du4b7146f5%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D506%26originWidth%3D976%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D158537%26status%3Ddone%26style%3Dnone%26taskId%3Du64d80530-7388-4c12-9d3b-48d90765e0b%26title%3D%26width%3D976%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22oVYwK%22%7D\"></card><span data-lake-id=\"ufecf6f23\" id=\"ufecf6f23\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638602110103-8ee2df46-7982-4b08-a6c8-e4d9c701b69f.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D666%26id%3Du65df8122%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D666%26originWidth%3D933%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D302115%26status%3Ddone%26style%3Dnone%26taskId%3Du970ef30c-4b50-4327-928e-6bf0cdbc242%26title%3D%26width%3D933%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22A9wRm%22%7D\"></card></p><p data-lake-id=\"u6827fec5\" id=\"u6827fec5\"><br></p><h2 data-lake-id=\"997a4ba0\" id=\"997a4ba0\"><span data-lake-id=\"u484fad48\" id=\"u484fad48\">联邦队列</span></h2><p data-lake-id=\"ud2dd89e2\" id=\"ud2dd89e2\"><br></p><p data-lake-id=\"ufbf7e7f8\" id=\"ufbf7e7f8\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638602602857-2efc1842-e9c7-409e-a302-2b4c63e92027.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D833%26id%3Du3d500d40%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D833%26originWidth%3D1312%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D553687%26status%3Ddone%26style%3Dnone%26taskId%3Du77ecfe28-0a6d-4318-bc8e-c80d6183ecc%26title%3D%26width%3D1312%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22qvMwP%22%7D\"></card><span data-lake-id=\"u2cc42176\" id=\"u2cc42176\"><br /></span><span data-lake-id=\"u43963498\" id=\"u43963498\">两个不同地区数据同步。<br /></span><span data-lake-id=\"ufaa05362\" id=\"ufaa05362\"> </span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603240478-ba4a3a39-d3dc-41b3-9ee9-c8d9f2718ff9.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D551%26id%3Du0dc6d91b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D551%26originWidth%3D1149%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D244288%26status%3Ddone%26style%3Dnone%26taskId%3Du65c1251d-b002-4909-ae1d-f27aa9d85ee%26title%3D%26width%3D1149%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Rmak1%22%7D\"></card></p><p data-lake-id=\"u6d139d21\" id=\"u6d139d21\"><br></p><h2 data-lake-id=\"Shovel\" id=\"Shovel\"><span data-lake-id=\"uc6c63b07\" id=\"uc6c63b07\">Shovel</span></h2><p data-lake-id=\"u8914465d\" id=\"u8914465d\"><br></p><p data-lake-id=\"ufcf1b723\" id=\"ufcf1b723\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603352779-28d006e0-d330-4802-935c-040341c1ca8d.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D324%26id%3Duc852da4a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D324%26originWidth%3D1287%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D568699%26status%3Ddone%26style%3Dnone%26taskId%3Du2b770501-53fa-4cbc-a428-000590e2c17%26title%3D%26width%3D1287%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22fxL0i%22%7D\"></card><span data-lake-id=\"udab537c0\" id=\"udab537c0\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603460089-03466d04-df20-4ab2-8968-f1b5ef5905ca.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D409%26id%3Dua502f49e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D409%26originWidth%3D871%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D188661%26status%3Ddone%26style%3Dnone%26taskId%3Du48a08d45-4dad-40e0-9723-55db3e3ef79%26title%3D%26width%3D871%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22lh1tz%22%7D\"></card><span data-lake-id=\"ucad6ce11\" id=\"ucad6ce11\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603378352-15aca4d9-af9b-48c1-b796-60a86b637ebd.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D667%26id%3Duec9ad770%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D667%26originWidth%3D864%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D266940%26status%3Ddone%26style%3Dnone%26taskId%3Du8acd6a6e-3ed2-4306-8639-2eeb16612c3%26title%3D%26width%3D864%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22jpTqS%22%7D\"></card><span data-lake-id=\"u4fdf1f0b\" id=\"u4fdf1f0b\"><br /></span><span data-lake-id=\"uc8cf98b9\" id=\"uc8cf98b9\"> </span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603594801-6bd296a5-c23b-418f-a94e-5261833d5605.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D592%26id%3Du903663bb%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D592%26originWidth%3D994%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D194438%26status%3Ddone%26style%3Dnone%26taskId%3Dud10d2c55-8f5b-4b88-b096-8942402c361%26title%3D%26width%3D994%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22oSJ3T%22%7D\"></card><span data-lake-id=\"u6738e9dc\" id=\"u6738e9dc\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603639753-9ae10564-7bad-4528-afd2-867c58d1f413.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D121%26id%3Du71e6fa9c%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D121%26originWidth%3D1169%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D88867%26status%3Ddone%26style%3Dnone%26taskId%3Du55070310-f786-4b38-98ce-55db2f75ca1%26title%3D%26width%3D1169%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Gjcgc%22%7D\"></card></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"u0d7e0fb8\" id=\"u0d7e0fb8\"><span data-lake-id=\"u909f53e3\" id=\"u909f53e3\">---</span></p><p data-lake-id=\"uc679db55\" id=\"uc679db55\"><span data-lake-id=\"u4c1a62fc\" id=\"u4c1a62fc\">title: RabbitMQ学习笔记<br /></span><span data-lake-id=\"u55719a35\" id=\"u55719a35\">categories: 知识<br /></span><span data-lake-id=\"ue4c70803\" id=\"ue4c70803\">tags: [RabbitMQ, 消息中间件]</span></p><p data-lake-id=\"uaca5ecf0\" id=\"uaca5ecf0\"><span data-lake-id=\"udd666371\" id=\"udd666371\">--- </span></p><p data-lake-id=\"u34c88f82\" id=\"u34c88f82\"><span data-lake-id=\"ufccbef48\" id=\"ufccbef48\">​</span><br></p><p data-lake-id=\"u5a3553e0\" id=\"u5a3553e0\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1630671540955-650bc67f-569a-4cef-a095-ec73a3b34897.png%23clientId%3Duc20dad1f-a2b4-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D740%26id%3Du64b4ea35%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D740%26originWidth%3D1340%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D584856%26status%3Ddone%26style%3Dnone%26taskId%3Du20a11e76-4e9c-49b4-8ca4-cc25eac0808%26title%3D%26width%3D1340%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1340%2C%22originHeight%22%3A740%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23efe7e7%22%2C%22id%22%3A%22FmDdj%22%7D\"></card><span data-lake-id=\"uc073c3a2\" id=\"uc073c3a2\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1630672453989-c5f9d3cf-e77f-4c3e-8a9d-173b49f0aa4c.png%23clientId%3Duc20dad1f-a2b4-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D473%26id%3Dub505e50f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D473%26originWidth%3D1544%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D451836%26status%3Ddone%26style%3Dnone%26taskId%3Du973d9d93-5ee4-44e2-9f50-b28d8e8f15e%26title%3D%26width%3D1544%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1544%2C%22originHeight%22%3A473%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f6f6f6%22%2C%22id%22%3A%22N1Vbj%22%7D\"></card><span data-lake-id=\"ufdb92570\" id=\"ufdb92570\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1630673109375-2f65953f-32f5-4be8-9353-9d08abb6587f.png%23clientId%3Duc20dad1f-a2b4-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D794%26id%3Duce851ada%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D794%26originWidth%3D1520%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D669042%26status%3Ddone%26style%3Dnone%26taskId%3Du1e0c19d3-9eae-4ab1-9e35-b33c4bbbcd6%26title%3D%26width%3D1520%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1520%2C%22originHeight%22%3A794%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23b2b1b0%22%2C%22id%22%3A%22zGC4d%22%7D\"></card></p><p data-lake-id=\"u329797e5\" id=\"u329797e5\"><br></p><h2 data-lake-id=\"9c0cd8ed\" id=\"9c0cd8ed\"><span data-lake-id=\"u0c12fd73\" id=\"u0c12fd73\">为什么要用 rabbitMQ？</span></h2><h3 data-lake-id=\"81220e89\" id=\"81220e89\"><span data-lake-id=\"u450596fc\" id=\"u450596fc\">1. 流量削峰</span></h3><p data-lake-id=\"u034d5ee5\" id=\"u034d5ee5\"><br></p><p data-lake-id=\"u03a10fc5\" id=\"u03a10fc5\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1637998719062-ee3b7961-8606-40b9-9bd6-139143630402.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D91%26id%3Du7a7d8c10%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D182%26originWidth%3D990%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D78126%26status%3Ddone%26style%3Dnone%26taskId%3Du903bdc4d-2ce4-4ac8-97d1-9cf8226327b%26title%3D%26width%3D495%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A990%2C%22originHeight%22%3A182%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f3f3f3%22%2C%22id%22%3A%22Ds1E5%22%7D\"></card></p><p data-lake-id=\"u874b8d44\" id=\"u874b8d44\"><br></p><h3 data-lake-id=\"c491023f\" id=\"c491023f\"><span data-lake-id=\"u898d65ad\" id=\"u898d65ad\">2. 应用解耦</span></h3><p data-lake-id=\"ue8c60717\" id=\"ue8c60717\"><br></p><p data-lake-id=\"u4ba4ff6a\" id=\"u4ba4ff6a\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1637998760193-a4f14c2c-a22b-4c92-b207-ae58a962577a.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D182%26id%3Du8f01ca2b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D363%26originWidth%3D1085%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D190648%26status%3Ddone%26style%3Dnone%26taskId%3Du30e77d52-0f3b-4d69-b06f-8229a9c232f%26title%3D%26width%3D542.5%26referrerpolicy%3Dno-referrer%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1085%2C%22originHeight%22%3A363%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f7f7f7%22%2C%22id%22%3A%22hMEcn%22%7D\"></card></p><p data-lake-id=\"u6d37b294\" id=\"u6d37b294\"><br></p><h3 data-lake-id=\"d4ef8fda\" id=\"d4ef8fda\"><span data-lake-id=\"u020e8192\" id=\"u020e8192\">3. 异步处理</span></h3><p data-lake-id=\"ufa9eb4bc\" id=\"ufa9eb4bc\"><br></p><p data-lake-id=\"u20a06663\" id=\"u20a06663\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009293978-1fde3fa6-5de6-476b-bc8f-4381749e748c.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D315%26id%3Du2602b5b4%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D630%26originWidth%3D1167%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D283589%26status%3Ddone%26style%3Dnone%26taskId%3Duf5236049-2c88-4e12-b15e-7d99585efad%26title%3D%26width%3D583.5%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1167%2C%22originHeight%22%3A630%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f6f6f6%22%2C%22id%22%3A%22EqXpn%22%7D\"></card></p><p data-lake-id=\"u0a94a1a3\" id=\"u0a94a1a3\"><br></p><h2 data-lake-id=\"753ccaa2\" id=\"753ccaa2\"><span data-lake-id=\"u4a58fcf4\" id=\"u4a58fcf4\">RabbitMQ 核心部分</span></h2><p data-lake-id=\"u29bdd22c\" id=\"u29bdd22c\"><br></p><p data-lake-id=\"uab230d58\" id=\"uab230d58\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009378104-cb162a2f-4170-4d24-99c1-4e3ee09087ae.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D284%26id%3Du45cac300%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D568%26originWidth%3D1077%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D305514%26status%3Ddone%26style%3Dnone%26taskId%3Du95a38925-5c34-45dd-bfca-d140d73dc3f%26title%3D%26width%3D538.5%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1077%2C%22originHeight%22%3A568%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f8f2f1%22%2C%22id%22%3A%22TB3Zf%22%7D\"></card></p><p data-lake-id=\"u0943ec06\" id=\"u0943ec06\"><br></p><h2 data-lake-id=\"a260da3a\" id=\"a260da3a\"><span data-lake-id=\"u4615632f\" id=\"u4615632f\">各个名词介绍</span></h2><p data-lake-id=\"u9ab39537\" id=\"u9ab39537\"><br></p><p data-lake-id=\"ub76612d7\" id=\"ub76612d7\"><br></p><p data-lake-id=\"u698e3664\" id=\"u698e3664\"><br></p><h3 data-lake-id=\"c83a4ba0\" id=\"c83a4ba0\"><span data-lake-id=\"ud5ce219f\" id=\"ud5ce219f\">RabbitMQ 工作原理</span></h3><p data-lake-id=\"u21effb62\" id=\"u21effb62\"><br></p><p data-lake-id=\"ua7741f7e\" id=\"ua7741f7e\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009501957-eb0902f3-1fa1-47d5-9bc7-8d03f6e12de0.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D257%26id%3Du79c375f5%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D514%26originWidth%3D1060%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D210068%26status%3Ddone%26style%3Dnone%26taskId%3Due02a7c50-c563-46af-a784-5ae4c1dcdfe%26title%3D%26width%3D530%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1060%2C%22originHeight%22%3A514%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23efc150%22%2C%22id%22%3A%22sf1J3%22%7D\"></card><span data-lake-id=\"u0075424c\" id=\"u0075424c\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009567915-6084eb1d-d428-47ec-844f-b3b48c6c6d0c.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D310%26id%3Du9337433a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D619%26originWidth%3D1135%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D776522%26status%3Ddone%26style%3Dnone%26taskId%3Duced2ac5e-e117-4050-8e39-087f63ff410%26title%3D%26width%3D567.5%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1135%2C%22originHeight%22%3A619%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e1dccf%22%2C%22id%22%3A%22ft4q6%22%7D\"></card><span data-lake-id=\"u893d075b\" id=\"u893d075b\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638009610891-4a5dba18-6006-41bf-a068-b2f33ed7df48.png%23clientId%3Dudb8aea13-24db-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D63%26id%3Du38d6f233%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D126%26originWidth%3D1128%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D136646%26status%3Ddone%26style%3Dnone%26taskId%3Du3dada18e-9ab8-40c9-8042-2e2f9f40306%26title%3D%26width%3D564%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1128%2C%22originHeight%22%3A126%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23cdc5b8%22%2C%22id%22%3A%22rJuNv%22%7D\"></card></p><p data-lake-id=\"u1525aa57\" id=\"u1525aa57\"><br></p><h2 data-lake-id=\"e655a410\" id=\"e655a410\"><span data-lake-id=\"u705eb6e6\" id=\"u705eb6e6\">安装</span></h2><p data-lake-id=\"u05de2581\" id=\"u05de2581\"><br></p><p data-lake-id=\"uf6aced4d\" id=\"uf6aced4d\"><a href=\"https://www.rabbitmq.com/download.html\" target=\"_blank\" data-lake-id=\"ue8f1a388\" id=\"ue8f1a388\"><span data-lake-id=\"u33a9052d\" id=\"u33a9052d\">rabbitmq.com/download.html</span></a><span data-lake-id=\"uf625d546\" id=\"uf625d546\"><br /></span><span data-lake-id=\"u097a9a4a\" id=\"u097a9a4a\">erlang 和 rabbitMQ 版本匹配：<br /></span><a href=\"https://www.cnblogs.com/gne-hwz/p/10714013.html\" target=\"_blank\" data-lake-id=\"u79f01256\" id=\"u79f01256\"><span data-lake-id=\"u5287bc87\" id=\"u5287bc87\">https://www.cnblogs.com/gne-hwz/p/10714013.html</span></a><span data-lake-id=\"u1249a5dd\" id=\"u1249a5dd\"><br /></span><span data-lake-id=\"u5969764e\" id=\"u5969764e\">安装：</span><a href=\"https://blog.csdn.net/almahehe/article/details/75390572\" target=\"_blank\" data-lake-id=\"u4866f597\" id=\"u4866f597\"><span data-lake-id=\"uf1b9b81f\" id=\"uf1b9b81f\">https://blog.csdn.net/almahehe/article/details/75390572</span></a><span data-lake-id=\"ua09b2180\" id=\"ua09b2180\"><br /></span><span data-lake-id=\"u9b14d83d\" id=\"u9b14d83d\">（建议看尚硅谷视频进行快速安装）<br /></span><span data-lake-id=\"ue3b0bc72\" id=\"ue3b0bc72\">安装之后，可以访问 ip:15672 ，查看发送消息的端口（5672）和用户。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638169386681-e382c30c-baba-4fbb-bd40-aaa7b0a1eac6.png%23clientId%3Duc4bbfa15-6ab6-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D173%26id%3Du1a771f9c%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D102%26originWidth%3D450%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D28980%26status%3Ddone%26style%3Dnone%26taskId%3Dua13bea1f-438b-4ef8-8913-b4ccb9fa78c%26title%3D%26width%3D761.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A450%2C%22originHeight%22%3A102%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f1f1f1%22%2C%22id%22%3A%22pNXMC%22%7D\"></card></p><p data-lake-id=\"u9691fe71\" id=\"u9691fe71\"><br></p><h2 data-lake-id=\"c729f8ef\" id=\"c729f8ef\"><span data-lake-id=\"ufb9fdbed\" id=\"ufb9fdbed\">简单队列模式</span></h2><h3 data-lake-id=\"f5abe6f8\" id=\"f5abe6f8\"><span data-lake-id=\"ueaf18294\" id=\"ueaf18294\">生产者代码</span></h3><p data-lake-id=\"u9247b990\" id=\"u9247b990\"><br></p><ol list=\"ua5bc81d8\"><li fid=\"ud363da97\" data-lake-id=\"ua2bec32f\" id=\"ua2bec32f\"><span data-lake-id=\"ud39a2801\" id=\"ud39a2801\">项目依赖：</span></li></ol><p data-lake-id=\"ua99c915f\" id=\"ua99c915f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22%3Cdependencies%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%E6%8C%87%E5%AE%9Ajdk%E7%BC%96%E8%AF%91%E7%89%88%E6%9C%AC--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.apache.maven.plugins%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Emaven-compiler-plugin%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E3.8.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fcom.rabbitmq%2Famqp-client%20--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--rabbitmq%E4%BE%9D%E8%B5%96%E5%AE%A2%E6%88%B7%E7%AB%AF--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Ecom.rabbitmq%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Eamqp-client%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E5.8.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fcommons-io%2Fcommons-io%20--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E6%B5%81%E7%9A%84%E4%BE%9D%E8%B5%96--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Ecommons-io%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Ecommons-io%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.6%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.slf4j%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Eslf4j-simple%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E1.7.25%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%3C%2Fdependencies%3E%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220859d073%22%7D\"></card><p data-lake-id=\"ud6903308\" id=\"ud6903308\"><br></p><ol list=\"u6eef3ccd\" start=\"2\"><li fid=\"uc78933dd\" data-lake-id=\"uadcc7a78\" id=\"uadcc7a78\"><span data-lake-id=\"u4718b128\" id=\"u4718b128\">生产者代码：</span></li></ol><p data-lake-id=\"u087456f1\" id=\"u087456f1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22japackage%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.Connection%3B%5Cnimport%20com.rabbitmq.client.ConnectionFactory%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F28%2022%3A15%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%20%EF%BC%9A%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20private%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E5%B7%A5%E5%8E%82ip%20%20%E8%BF%9E%E6%8E%A5rabbitmq%E7%9A%84%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E6%88%B7%E5%90%8D%5Cn%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%AF%86%E7%A0%81%5Cn%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%5Cn%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%8E%B7%E5%8F%96%E4%BF%A1%E9%81%93%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%82%E6%95%B0%EF%BC%9B1.%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%202.%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%E5%90%A6%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%88%E7%A3%81%E7%9B%98%EF%BC%89%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%88%E4%B8%8D%E6%8C%81%E4%B9%85%E5%8C%96false%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%203.%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E5%8F%AA%E4%BE%9B%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E6%98%AF%E5%90%A6%E6%B6%88%E6%81%AF%E7%8B%AC%E6%9C%89%EF%BC%8Ctrue%E5%8F%AA%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AFfalse%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%204.%20%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%90%8E%EF%BC%8C%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Ctrue%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Cfalse%E4%B8%8D%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%205.%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%88%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF......%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(QUEUE_NAME%2Cfalse%2Cfalse%2Cfalse%2Cnull)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22hello%20world%5C%22%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%20%E5%8F%91%E9%80%81%E5%88%B0%E5%93%AA%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E8%B7%AF%E7%94%B1%E7%9A%84key%E5%80%BC%E6%98%AF%E5%93%AA%E4%B8%AA%EF%BC%8C%E6%9C%AC%E6%AC%A1%E6%98%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%B6%88%E6%81%AF%E4%BD%93%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2CQUEUE_NAME%2Cnull%2Cmessage.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%AE%8C%E6%AF%95%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22551912bc%22%7D\"></card><p data-lake-id=\"ua3657b02\" id=\"ua3657b02\"><br></p><p data-lake-id=\"u11483b33\" id=\"u11483b33\"><span data-lake-id=\"u967b6ec8\" id=\"u967b6ec8\">如果运行报超时错误，需要打开云服务器的安全组 5672 端口。<br /></span><span data-lake-id=\"udc1e13a8\" id=\"udc1e13a8\">（参考博客：</span><a href=\"https://www.cnblogs.com/jxearlier/p/11920825.html\" target=\"_blank\" data-lake-id=\"u7dcde88d\" id=\"u7dcde88d\"><span data-lake-id=\"udec279e8\" id=\"udec279e8\">https://www.cnblogs.com/jxearlier/p/11920825.html</span></a><span data-lake-id=\"u5dae9d38\" id=\"u5dae9d38\">）</span></p><h3 data-lake-id=\"3b753fe7\" id=\"3b753fe7\"><span data-lake-id=\"uae969ae3\" id=\"uae969ae3\">消费者代码</span></h3><p data-lake-id=\"ud87a77a1\" id=\"ud87a77a1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.rabbitmq.client.*%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2015%3A04%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%3A%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Consumer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%20%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%96%E6%B6%88%E6%B6%88%E6%81%AF%E6%97%B6%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20CancelCallback%20cancelCallback%20%3D%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%A2%AB%E4%B8%AD%E6%96%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%E6%B6%88%E8%B4%B9%E5%93%AA%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E6%B6%88%E8%B4%B9%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E6%98%AF%E5%90%A6%E8%A6%81%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8Ctrue%E4%BB%A3%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%2Cfalse%E4%BB%A3%E8%A1%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%B6%88%E8%B4%B9%E8%80%85%E6%9C%AA%E6%88%90%E5%8A%9F%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(QUEUE_NAME%2C%20true%2CdeliverCallback%2CcancelCallback)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d7bd0f8f%22%7D\"></card><p data-lake-id=\"u161ab880\" id=\"u161ab880\"><br></p><p data-lake-id=\"u2f7061dc\" id=\"u2f7061dc\"><span data-lake-id=\"u492a9635\" id=\"u492a9635\">运行结果：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638172828992-073b0df6-a480-4260-a724-e17e9191a44c.png%23clientId%3Duc4bbfa15-6ab6-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D20%26id%3Du3ee077b2%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D20%26originWidth%3D296%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D2932%26status%3Ddone%26style%3Dnone%26taskId%3Dud645c173-0157-49f2-89fb-5d58c2cd89a%26title%3D%26width%3D296%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A296%2C%22originHeight%22%3A20%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3e49%22%2C%22id%22%3A%22kWU4Y%22%7D\"></card></p><p data-lake-id=\"u0b7711d3\" id=\"u0b7711d3\"><br></p><h3 data-lake-id=\"56a70cf7\" id=\"56a70cf7\"><span data-lake-id=\"u6cb3fb74\" id=\"u6cb3fb74\">测试生产者和消费者代码：</span></h3><p data-lake-id=\"uac0eac74\" id=\"uac0eac74\"><br></p><ol list=\"u51f71829\"><li fid=\"ucee08304\" data-lake-id=\"u4916faee\" id=\"u4916faee\"><span data-lake-id=\"u36a54dd5\" id=\"u36a54dd5\">先运行消费者代码，发现没有消息，再运行生产者代码，发送消息，再看消费者代码控制台，此时已经接收到消息。</span></li></ol><p data-lake-id=\"ua57feed9\" id=\"ua57feed9\"><br></p><h2 data-lake-id=\"3d1bae02\" id=\"3d1bae02\"><span data-lake-id=\"u9f020e50\" id=\"u9f020e50\">工作队列模式</span></h2><p data-lake-id=\"u8a14f32f\" id=\"u8a14f32f\"><br></p><p data-lake-id=\"u924e23c9\" id=\"u924e23c9\"><br></p><p data-lake-id=\"ub993060c\" id=\"ub993060c\"><br></p><h3 data-lake-id=\"d9addd15\" id=\"d9addd15\"><span data-lake-id=\"u3ad8ec7f\" id=\"u3ad8ec7f\">轮训分发消息</span></h3><p data-lake-id=\"u0a21536f\" id=\"u0a21536f\"><br></p><p data-lake-id=\"u1c457a9d\" id=\"u1c457a9d\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638191830547-a43bbaa1-a524-4603-b6a9-0824e943cf9c.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D546%26id%3Ducf96c5e0%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D546%26originWidth%3D1278%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D220503%26status%3Ddone%26style%3Dnone%26taskId%3Dub030755f-49df-4184-9d0d-65bfa0e561e%26title%3D%26width%3D1278%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1278%2C%22originHeight%22%3A546%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f7f7f7%22%2C%22id%22%3A%22kyxCV%22%7D\"></card></p><p data-lake-id=\"ubbe06130\" id=\"ubbe06130\"><br></p><ol list=\"u993bcc81\"><li fid=\"ub0e7382c\" data-lake-id=\"ua4977f19\" id=\"ua4977f19\"><span data-lake-id=\"u142ff8d4\" id=\"u142ff8d4\">抽取连接工厂工具类：</span></li></ol><p data-lake-id=\"u1321a065\" id=\"u1321a065\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.utils%3B%5Cn%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.Connection%3B%5Cnimport%20com.rabbitmq.client.ConnectionFactory%3B%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2019%3A48%5Cn%20*%20%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%E5%88%9B%E5%BB%BA%E4%BF%A1%E9%81%93%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB%5Cn%20*%2F%5Cnpublic%20class%20RabbitMqUtils%20%7B%5Cn%20%20%20%20public%20static%20Channel%20getChannel()%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20return%20channel%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d79993aa%22%7D\"></card><p data-lake-id=\"u63f36183\" id=\"u63f36183\"><br></p><ol list=\"u9211bc6e\" start=\"2\"><li fid=\"uaa9721e3\" data-lake-id=\"u07f51501\" id=\"u07f51501\"><span data-lake-id=\"uf408d5cc\" id=\"uf408d5cc\">工作线程代码：（消费者）</span></li></ol><p data-lake-id=\"ud95a0f1f\" id=\"ud95a0f1f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.two%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.CancelCallback%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cnimport%20com.rabbitmq.client.Delivery%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2019%3A55%5Cn%20*%20%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%EF%BC%88%E7%9B%B8%E5%BD%93%E4%BA%8E%E4%B9%8B%E5%89%8D%E7%9A%84%E6%B6%88%E8%B4%B9%E8%80%85%EF%BC%89%5Cn%20*%2F%5Cnpublic%20class%20Worker01%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%20%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%9A%84%E6%8E%A5%E6%94%B6%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E6%8E%A5%E6%94%B6%E8%A2%AB%E5%8F%96%E6%B6%88%E6%97%B6%20%E6%89%A7%E8%A1%8C%5Cn%20%20%20%20%20%20%20%20CancelCallback%20cancelCallback%20%3D%20(consumerTag)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(consumerTag%20%2B%20%5C%22%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E6%8E%A5%E5%8F%A3%E5%9B%9E%E8%B0%83%E9%80%BB%E8%BE%91%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%E6%B6%88%E8%B4%B9%E5%93%AA%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E6%B6%88%E8%B4%B9%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E6%98%AF%E5%90%A6%E8%A6%81%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8Ctrue%E4%BB%A3%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%2Cfalse%E4%BB%A3%E8%A1%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%B6%88%E8%B4%B9%E8%80%85%E6%9C%AA%E6%88%90%E5%8A%9F%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(QUEUE_NAME%2C%20true%2C%20deliverCallback%2C%20cancelCallback)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%229d76e763%22%7D\"></card><p data-lake-id=\"u3c81ab45\" id=\"u3c81ab45\"><br></p><ol list=\"u1721a5be\" start=\"3\"><li fid=\"u2f522a92\" data-lake-id=\"u3d36e889\" id=\"u3d36e889\"><span data-lake-id=\"u40d2ed30\" id=\"u40d2ed30\">启动两个工作线程（消费者）</span></li></ol><p data-lake-id=\"ub9bad24a\" id=\"ub9bad24a\"><br></p><p data-lake-id=\"u880b1412\" id=\"u880b1412\"><span data-lake-id=\"ud7746195\" id=\"ud7746195\">前提是在 idea 设置允许方法多个并行运行：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638188489814-b081e679-bc7f-4cad-964e-bfb80575820c.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D636%26id%3Duf61f07dc%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D869%26originWidth%3D1143%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D94819%26status%3Ddone%26style%3Dnone%26taskId%3Du4472c929-c48f-4a7d-ab7d-ec2994b75e5%26title%3D%26width%3D836.9862060546875%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1143%2C%22originHeight%22%3A869%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%233b4043%22%2C%22id%22%3A%22zVInE%22%7D\"></card><span data-lake-id=\"ubfdf41bf\" id=\"ubfdf41bf\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638188418807-97ce766a-47ef-458c-8413-d496cbcddbed.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D172%26id%3Du35f12aab%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D172%26originWidth%3D669%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D20804%26status%3Ddone%26style%3Dnone%26taskId%3Duf688cf36-6dc9-43f1-be3d-946b8a45d78%26title%3D%26width%3D669%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A669%2C%22originHeight%22%3A172%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232a373f%22%2C%22id%22%3A%22yNG1N%22%7D\"></card></p><p data-lake-id=\"ub776168d\" id=\"ub776168d\"><br></p><ol list=\"u8fb16ba1\" start=\"4\"><li fid=\"u324d4ebf\" data-lake-id=\"ud4caf9e9\" id=\"ud4caf9e9\"><span data-lake-id=\"uf8568ee5\" id=\"uf8568ee5\">生产者代码：</span></li></ol><p data-lake-id=\"u09bb0f44\" id=\"u09bb0f44\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.two%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2021%3A04%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%20%E5%8F%91%E9%80%81%E5%A4%A7%E9%87%8F%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Task01%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%82%E6%95%B0%EF%BC%9B1.%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%202.%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%E5%90%A6%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%88%E7%A3%81%E7%9B%98%EF%BC%89%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%88%E4%B8%8D%E6%8C%81%E4%B9%85%E5%8C%96false%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%203.%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E5%8F%AA%E4%BE%9B%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E6%98%AF%E5%90%A6%E6%B6%88%E6%81%AF%E7%8B%AC%E6%9C%89%EF%BC%8Ctrue%E5%8F%AA%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AFfalse%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%204.%20%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%90%8E%EF%BC%8C%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Ctrue%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Cfalse%E4%B8%8D%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%205.%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%88%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF......%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(QUEUE_NAME%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20QUEUE_NAME%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%AE%8C%E6%88%90%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%225346bd81%22%7D\"></card><p data-lake-id=\"u0c3323ed\" id=\"u0c3323ed\"><br></p><ol list=\"u35971760\" start=\"5\"><li fid=\"u07c2ae97\" data-lake-id=\"u5fbb9819\" id=\"u5fbb9819\"><span data-lake-id=\"u5bb71885\" id=\"u5bb71885\">测试：启动生产者</span></li></ol><p data-lake-id=\"u647c8fbd\" id=\"u647c8fbd\"><br></p><p data-lake-id=\"ud09fcf35\" id=\"ud09fcf35\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638192109706-2649384b-8559-4d7e-8609-220f576c3e25.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D275%26id%3Du4261e57f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D275%26originWidth%3D591%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D25224%26status%3Ddone%26style%3Dnone%26taskId%3Due3dff20d-583f-4d0b-bb12-94ccae95bc1%26title%3D%26width%3D591%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A591%2C%22originHeight%22%3A275%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232c373d%22%2C%22id%22%3A%22PuJou%22%7D\"></card><span data-lake-id=\"ud9d3a671\" id=\"ud9d3a671\"><br /></span><span data-lake-id=\"uc8756aef\" id=\"uc8756aef\">可以看见消费者轮循接收消息：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638192164342-16d183be-bbe5-4de9-bac4-d87bd87a746b.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D179%26id%3Due97a7cdb%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D179%26originWidth%3D591%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23018%26status%3Ddone%26style%3Dnone%26taskId%3Du7cff6d1a-b142-4d52-a1c5-1cca6fd241e%26title%3D%26width%3D591%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A591%2C%22originHeight%22%3A179%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3c44%22%2C%22id%22%3A%22Upfv4%22%7D\"></card><span data-lake-id=\"ude7e3baa\" id=\"ude7e3baa\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638192176544-d380de90-ff7a-48a7-a080-c4a1ac193460.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D198%26id%3Dubb73d589%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D198%26originWidth%3D598%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23978%26status%3Ddone%26style%3Dnone%26taskId%3Du3ac63e3a-6d82-4340-9fed-c68c8fbf564%26title%3D%26width%3D598%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A598%2C%22originHeight%22%3A198%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232f3b43%22%2C%22id%22%3A%22xLv8Q%22%7D\"></card></p><p data-lake-id=\"u9b4baf19\" id=\"u9b4baf19\"><br></p><h2 data-lake-id=\"269fc561\" id=\"269fc561\"><span data-lake-id=\"ucee7fa76\" id=\"ucee7fa76\">消息应答</span></h2><p data-lake-id=\"u6a6463c8\" id=\"u6a6463c8\"><br></p><p data-lake-id=\"uce771e06\" id=\"uce771e06\"><br></p><p data-lake-id=\"u4921363f\" id=\"u4921363f\"><br></p><h3 data-lake-id=\"398e8d91\" id=\"398e8d91\"><span data-lake-id=\"u29d2557e\" id=\"u29d2557e\">自动应答</span></h3><p data-lake-id=\"u375825be\" id=\"u375825be\"><br></p><p data-lake-id=\"ua916566e\" id=\"ua916566e\"><span data-lake-id=\"ue97919fe\" id=\"ue97919fe\">不建议使用，仅适用在消费者可以高效并以某种速率能够处理这些消息的情况。</span></p><p data-lake-id=\"u5267e3be\" id=\"u5267e3be\"><br></p><h3 data-lake-id=\"a7945bf1\" id=\"a7945bf1\"><span data-lake-id=\"uc4459f0a\" id=\"uc4459f0a\">手动应答</span></h3><p data-lake-id=\"uc5fde435\" id=\"uc5fde435\"><br></p><p data-lake-id=\"ud58827d8\" id=\"ud58827d8\"><br></p><p data-lake-id=\"u5b06088a\" id=\"u5b06088a\"><br></p><h4 data-lake-id=\"bdff53ca\" id=\"bdff53ca\"><span data-lake-id=\"u8e89b299\" id=\"u8e89b299\">消息应答的方法：</span></h4><p data-lake-id=\"u91742edc\" id=\"u91742edc\"><br></p><p data-lake-id=\"u50ffcea8\" id=\"u50ffcea8\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638193415623-6b7ff26f-8cc3-4abd-b1c6-41f79897f0cf.png%23clientId%3Du43ded51d-0244-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D312%26id%3Dud16b0385%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D312%26originWidth%3D737%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D100867%26status%3Ddone%26style%3Dnone%26taskId%3Du39cf8244-b605-4c5d-baca-fe2103cd9d3%26title%3D%26width%3D737%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A737%2C%22originHeight%22%3A312%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f5f5f5%22%2C%22id%22%3A%22S2b1y%22%7D\"></card></p><p data-lake-id=\"u9dec6f82\" id=\"u9dec6f82\"><br></p><h4 data-lake-id=\"70c2cd3d\" id=\"70c2cd3d\"><span data-lake-id=\"udd5077f9\" id=\"udd5077f9\">批量处理 Multiple</span></h4><p data-lake-id=\"ubcb490e9\" id=\"ubcb490e9\"><br></p><p data-lake-id=\"u50a423cf\" id=\"u50a423cf\"><span data-lake-id=\"u38f6a02d\" id=\"u38f6a02d\">手动应答的好处：可以批量应答，并减少网络拥堵。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638282925466-4d3081e6-809c-4a5f-9472-741dacb0cc7c.png%23clientId%3Dub82069db-0272-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D588%26id%3Du97ebb457%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D811%26originWidth%3D1024%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D292383%26status%3Ddone%26style%3Dnone%26taskId%3Duf04a703e-97b1-4fe2-b58f-33d8b0dff4d%26title%3D%26width%3D741.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1024%2C%22originHeight%22%3A811%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f6f5f5%22%2C%22id%22%3A%22rUzZh%22%7D\"></card><span data-lake-id=\"uccc1f103\" id=\"uccc1f103\"><br /></span><span data-lake-id=\"udcc741b7\" id=\"udcc741b7\">但是批量应答可能会丢失消息。所以尽量不要批量应答，将 multiple 设置为 false。</span></p><p data-lake-id=\"ue797ecdd\" id=\"ue797ecdd\"><br></p><h3 data-lake-id=\"8f744d87\" id=\"8f744d87\"><span data-lake-id=\"u0947adaa\" id=\"u0947adaa\">消息自动重新入队</span></h3><p data-lake-id=\"ub78af706\" id=\"ub78af706\"><br></p><p data-lake-id=\"u48684c84\" id=\"u48684c84\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638317239422-ab1bab41-ac6f-4a05-b3c5-c539d9e6dcd1.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D85%26id%3Du97c18f3b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D79%26originWidth%3D665%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D57746%26status%3Ddone%26style%3Dnone%26taskId%3Du14e494b5-3291-4daf-ada5-47aafa5eab0%26title%3D%26width%3D715.0000610351562%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A665%2C%22originHeight%22%3A79%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23ebeae9%22%2C%22id%22%3A%22qAYOD%22%7D\"></card><span data-lake-id=\"u261fb783\" id=\"u261fb783\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638317701734-1133a417-ebbe-4ad9-8453-f0803583491a.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D308%26id%3Du7be19416%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D469%26originWidth%3D1088%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D306122%26status%3Ddone%26style%3Dnone%26taskId%3Du7d90ec89-bd9a-4090-bda5-c09c6014c27%26title%3D%26width%3D714.9862060546875%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1088%2C%22originHeight%22%3A469%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e5e4df%22%2C%22id%22%3A%22o9cFt%22%7D\"></card><span data-lake-id=\"u63cecd77\" id=\"u63cecd77\"><br /></span><span data-lake-id=\"u3de7e416\" id=\"u3de7e416\">测试：<br /></span><span data-lake-id=\"u4dc11cc9\" id=\"u4dc11cc9\"> 1. 生产者：</span></p><p data-lake-id=\"uf22d07da\" id=\"uf22d07da\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.three%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2014%3A46%5Cn%20*%20%E6%B6%88%E6%81%AF%E5%9C%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E6%97%B6%E4%B8%8D%E4%B8%A2%E5%A4%B1%2C%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E9%87%8D%E6%96%B0%E6%B6%88%E8%B4%B9%5Cn%20*%2F%5Cnpublic%20class%20Task2%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20TASK_QUEUE_NAME%20%3D%20%5C%22ack_queue%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(TASK_QUEUE_NAME%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20TASK_QUEUE_NAME%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2207cf3bd5%22%7D\"></card><p data-lake-id=\"u7a59e1ef\" id=\"u7a59e1ef\"><br></p><ol list=\"u5f697a5a\" start=\"2\"><li fid=\"u2dd03fad\" data-lake-id=\"ua5680886\" id=\"ua5680886\"><span data-lake-id=\"u3013537c\" id=\"u3013537c\">两个消费者（消息手动应答）：</span></li></ol><p data-lake-id=\"u9ced89cf\" id=\"u9ced89cf\"><br></p><p data-lake-id=\"udf412596\" id=\"udf412596\"><span data-lake-id=\"u8c75a599\" id=\"u8c75a599\">消费者一：</span></p><p data-lake-id=\"ueae64f29\" id=\"ueae64f29\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.three%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.atguigu.rabbitmq.utils.SleepUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2014%3A58%5Cn%20*%20%E6%B6%88%E6%81%AF%E5%9C%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E6%97%B6%E4%B8%8D%E4%B8%A2%E5%A4%B1%EF%BC%8C%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E9%87%8D%E6%96%B0%E6%B6%88%E8%B4%B9%5Cn%20*%2F%5Cnpublic%20class%20Work03%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20TASK_QUEUE_NAME%20%3D%20%5C%22ack_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22C1%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%97%B6%E9%97%B4%E8%BE%83%E7%9F%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%B2%89%E7%9D%A11s%5Cn%20%20%20%20%20%20%20%20%20%20%20%20SleepUtils.sleep(1)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%88%E9%80%9A%E8%BF%87%E4%BF%A1%E9%81%93%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F*%E5%8F%82%E6%95%B0%EF%BC%9A%5Cn%20%20%20%20%20%20%20%20%20%20%20%201.%20%E6%B6%88%E6%81%AF%E7%9A%84%E6%A0%87%E8%AE%B0%20tag%5Cn%20%20%20%20%20%20%20%20%20%20%20%202.%20%E6%98%AF%E5%90%A6%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%20%20false%3A%E4%B8%8D%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%E4%BF%A1%E9%81%93%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8Ctrue%3A%E6%89%B9%E9%87%8F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicAck(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E9%87%87%E7%94%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%5Cn%20%20%20%20%20%20%20%20boolean%20autoAck%20%3D%20false%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(TASK_QUEUE_NAME%2C%20autoAck%2C%20deliverCallback%2C%20(consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(consumerTag%20%2B%20%5C%22%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%9B%9E%E8%B0%83%E9%80%BB%E8%BE%91%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D))%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%227fa74098%22%7D\"></card><p data-lake-id=\"u510b8aea\" id=\"u510b8aea\"><br></p><p data-lake-id=\"u13871e3e\" id=\"u13871e3e\"><span data-lake-id=\"u6439174b\" id=\"u6439174b\">消费者二：</span></p><p data-lake-id=\"ufa927a3f\" id=\"ufa927a3f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22xml%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.three%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.atguigu.rabbitmq.utils.SleepUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2014%3A58%5Cn%20*%20%E6%B6%88%E6%81%AF%E5%9C%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E6%97%B6%E4%B8%8D%E4%B8%A2%E5%A4%B1%EF%BC%8C%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E9%87%8D%E6%96%B0%E6%B6%88%E8%B4%B9%5Cn%20*%2F%5Cnpublic%20class%20Work04%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20TASK_QUEUE_NAME%20%3D%20%5C%22ack_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22C2%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%97%B6%E9%97%B4%E8%BE%83%E7%9F%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%B2%89%E7%9D%A11s%5Cn%20%20%20%20%20%20%20%20%20%20%20%20SleepUtils.sleep(30)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%88%E9%80%9A%E8%BF%87%E4%BF%A1%E9%81%93%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F*%E5%8F%82%E6%95%B0%EF%BC%9A%5Cn%20%20%20%20%20%20%20%20%20%20%20%201.%20%E6%B6%88%E6%81%AF%E7%9A%84%E6%A0%87%E8%AE%B0%20tag%5Cn%20%20%20%20%20%20%20%20%20%20%20%202.%20%E6%98%AF%E5%90%A6%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%20%20false%3A%E4%B8%8D%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%E4%BF%A1%E9%81%93%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8Ctrue%3A%E6%89%B9%E9%87%8F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicAck(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E9%87%87%E7%94%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%5Cn%20%20%20%20%20%20%20%20boolean%20autoAck%20%3D%20false%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(TASK_QUEUE_NAME%2C%20autoAck%2C%20deliverCallback%2C%20(consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(consumerTag%20%2B%20%5C%22%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%9B%9E%E8%B0%83%E9%80%BB%E8%BE%91%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D))%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22f6acdd41%22%7D\"></card><p data-lake-id=\"ucab58ba8\" id=\"ucab58ba8\"><br></p><p data-lake-id=\"u3fb35c0e\" id=\"u3fb35c0e\"><span data-lake-id=\"ub6504087\" id=\"ub6504087\">测试步骤：<br /></span><span data-lake-id=\"uc0861472\" id=\"uc0861472\">① 先启动 task2，创建 ack_queue 队列；（在 ip:15672 的 queue 列表中可以看到目前拥有的队列）<br /></span><span data-lake-id=\"uf95d76a3\" id=\"uf95d76a3\">② 启动 work02，work03 接收消息（消费者）；<br /></span><span data-lake-id=\"ua771a0ff\" id=\"ua771a0ff\">③ 发消息：在 task2 控制台输入 aa,bb,cc,dd,ee,ff，可以看到 work2 和 work3 是轮训接收消息；如果到 work03 应该接收消息 ee 时，work03 突然挂掉，此时 ee 会被转发给 work02 中的 C1，这时 C1 会接收到 ee，因此消息不会丢失，这说明了 rabbitmq 有手动应答的能力，只要没有收到消息，就不会手动应答，从而将消息放回队列。而队列又再次将消息传递给 C1 进行重新消费，从而导致 ee 并没有丢失。</span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638348662336-051f5011-f512-44d1-bb05-053e49ba050c.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D499%26id%3Du60c5aa9e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D499%26originWidth%3D1092%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D254728%26status%3Ddone%26style%3Dnone%26taskId%3Du6c03afcd-9d58-4d4b-b839-5e4801e20e0%26title%3D%26width%3D1092%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1092%2C%22originHeight%22%3A499%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f5f5f5%22%2C%22id%22%3A%22Rq0q6%22%7D\"></card></p><p data-lake-id=\"ub25bd699\" id=\"ub25bd699\"><br></p><h2 data-lake-id=\"274a6bb3\" id=\"274a6bb3\"><span data-lake-id=\"u3b0468ca\" id=\"u3b0468ca\">队列持久化</span></h2><p data-lake-id=\"u65611189\" id=\"u65611189\"><br></p><p data-lake-id=\"ue951fa0d\" id=\"ue951fa0d\"><span data-lake-id=\"u4a41f4f0\" id=\"u4a41f4f0\">如果存在同名未被持久化的队列，则需要先删除原先的未被持久化的队列，再重新生成一个持久化队列。</span></p><p data-lake-id=\"u9565990f\" id=\"u9565990f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cnboolean%20durable%20%3D%20true%3B%20%2F%2F%E5%9C%A8%E7%94%9F%E4%BA%A7%E8%80%85%E4%B8%AD%EF%BC%8C%E9%9C%80%E8%A6%81%E8%AE%A9queue%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96%5Cnchannel.queueDeclare(TASK_QUEUE_NAME%2C%20durable%2C%20false%2C%20false%2C%20null)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221a197cbd%22%7D\"></card><p data-lake-id=\"ua4a455e1\" id=\"ua4a455e1\"><br></p><p data-lake-id=\"u003d6059\" id=\"u003d6059\"><span data-lake-id=\"ub4006d96\" id=\"ub4006d96\">生成一个持久化队列之后，在 rabbitmq 控制台中这个队列的 features 属性会出现 D（代表持久化）。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638359722330-59d15b49-1b8d-4d93-85aa-ecd40227bd45.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D129%26id%3Dufd6f763b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D129%26originWidth%3D781%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D13881%26status%3Ddone%26style%3Dnone%26taskId%3Duab54d6ef-4036-4edf-bca6-ba4a9dcac1d%26title%3D%26width%3D781%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A781%2C%22originHeight%22%3A129%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f3f1f0%22%2C%22id%22%3A%22iMXeX%22%7D\"></card></p><p data-lake-id=\"u3e80b572\" id=\"u3e80b572\"><br></p><h2 data-lake-id=\"f1739dad\" id=\"f1739dad\"><span data-lake-id=\"ufec32f24\" id=\"ufec32f24\">消息持久化</span></h2><p data-lake-id=\"uc661f556\" id=\"uc661f556\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E8%AE%BE%E7%BD%AE%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E4%B8%BA%E6%8C%81%E4%B9%85%E5%8C%96%E6%B6%88%E6%81%AF%EF%BC%88%E8%A6%81%E6%B1%82%E4%BF%9D%E5%AD%98%E5%88%B0%E7%A3%81%E7%9B%98%E4%B8%8AMessageProperties.PERSISTENT_TEXT_PLAIN%EF%BC%89%5Cnchannel.basicPublish(%5C%22%5C%22%2C%20TASK_QUEUE_NAME%2C%20MessageProperties.PERSISTENT_TEXT_PLAIN%2C%20message.getBytes())%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222ac9ced1%22%7D\"></card><p data-lake-id=\"u478658c1\" id=\"u478658c1\"><br></p><p data-lake-id=\"u88b0d835\" id=\"u88b0d835\"><br></p><p data-lake-id=\"u2a1a3ee8\" id=\"u2a1a3ee8\"><br></p><h2 data-lake-id=\"afba844e\" id=\"afba844e\"><span data-lake-id=\"u1e31118a\" id=\"u1e31118a\">不公平分发</span></h2><p data-lake-id=\"ubf424800\" id=\"ubf424800\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%9C%A8%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%AD%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E4%B9%8B%E5%89%8D%E8%AE%BE%E7%BD%AE%E4%B8%8D%E5%85%AC%E5%B9%B3%E5%88%86%E5%8F%91%5Cnint%20prefetchCount%20%3D%201%3B%5Cnchannel.basicQos(prefetchCount)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22b23fdf5a%22%7D\"></card><p data-lake-id=\"u6ed41d59\" id=\"u6ed41d59\"><br></p><p data-lake-id=\"u828c250f\" id=\"u828c250f\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638361240814-a1349c7f-2e3e-410a-ba3b-f2f872fab0bb.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D232%26id%3Du1ff04a34%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D232%26originWidth%3D385%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D20173%26status%3Ddone%26style%3Dnone%26taskId%3Dub1b60899-802e-4d67-9aed-a99c48b5db3%26title%3D%26width%3D385%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A385%2C%22originHeight%22%3A232%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23303d45%22%2C%22id%22%3A%22vTMLG%22%7D\"></card><span data-lake-id=\"uac36cfc2\" id=\"uac36cfc2\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638361251165-68b13d22-fe49-4fd8-9471-26161051c180.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D177%26id%3Du477bebf6%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D177%26originWidth%3D431%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D18613%26status%3Ddone%26style%3Dnone%26taskId%3Due60522ee-50ed-46f9-ae69-472369ce4b6%26title%3D%26width%3D431%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A431%2C%22originHeight%22%3A177%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232c3a42%22%2C%22id%22%3A%22zGQk4%22%7D\"></card></p><p data-lake-id=\"u606a7603\" id=\"u606a7603\"><br></p><h2 data-lake-id=\"e7e8ffe0\" id=\"e7e8ffe0\"><span data-lake-id=\"u8c5b6027\" id=\"u8c5b6027\">预取值</span></h2><p data-lake-id=\"uc821be09\" id=\"uc821be09\"><br></p><p data-lake-id=\"uf28a9818\" id=\"uf28a9818\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638361857297-fa168e46-191d-44b2-8ce2-df2cb52a382d.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D282%26id%3Due1e2c233%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D453%26originWidth%3D1130%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D347909%26status%3Ddone%26style%3Dnone%26taskId%3Due241edd5-d375-46cb-9668-4a4eb4d7c9c%26title%3D%26width%3D703.0000610351562%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1130%2C%22originHeight%22%3A453%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e4e4e5%22%2C%22id%22%3A%22mwjn3%22%7D\"></card></p><p data-lake-id=\"u85729c36\" id=\"u85729c36\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22int%20prefetchCount%20%3D%205%3B%5Cnchannel.basicQos(prefetchCount)%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221f902658%22%7D\"></card><p data-lake-id=\"uac932245\" id=\"uac932245\"><br></p><p data-lake-id=\"ucf3fd997\" id=\"ucf3fd997\"><br></p><p data-lake-id=\"u92071e4b\" id=\"u92071e4b\"><br></p><h2 data-lake-id=\"1e9c309f\" id=\"1e9c309f\"><span data-lake-id=\"u32130f3f\" id=\"u32130f3f\">发布确认原理</span></h2><p data-lake-id=\"ua7b44864\" id=\"ua7b44864\"><br></p><p data-lake-id=\"uf9cf497a\" id=\"uf9cf497a\"><br></p><p data-lake-id=\"uc237fdfc\" id=\"uc237fdfc\"><br></p><h2 data-lake-id=\"e61fd426\" id=\"e61fd426\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638364988019-b29d7c44-ebca-4978-95fd-034500d1bd7b.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D369%26id%3Du98ff6bb0%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D369%26originWidth%3D930%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D222643%26status%3Ddone%26style%3Dnone%26taskId%3Dua25c2547-8233-4893-8d5b-4406b84e85f%26title%3D%26width%3D930%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A930%2C%22originHeight%22%3A369%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23fafafb%22%2C%22id%22%3A%22Xek0V%22%7D\"></card></h2><p data-lake-id=\"ub971425a\" id=\"ub971425a\"><br></p><p data-lake-id=\"uff8b9cca\" id=\"uff8b9cca\"><span data-lake-id=\"uc353e344\" id=\"uc353e344\">在信道之后开启发布确认：</span></p><p data-lake-id=\"u0e87e7d9\" id=\"u0e87e7d9\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E4%BF%A1%E9%81%93%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cnchannel.confirmSelect()%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22ad539932%22%7D\"></card><p data-lake-id=\"u240d4823\" id=\"u240d4823\"><br></p><p data-lake-id=\"uda74d6f1\" id=\"uda74d6f1\"><br></p><p data-lake-id=\"u11342da4\" id=\"u11342da4\"><br></p><h2 data-lake-id=\"f1ad8c9b\" id=\"f1ad8c9b\"><span data-lake-id=\"uf0e1d45c\" id=\"uf0e1d45c\">单个发布确认</span></h2><p data-lake-id=\"u3cbeb3a0\" id=\"u3cbeb3a0\"><br></p><p data-lake-id=\"uc4d6c015\" id=\"uc4d6c015\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638365489548-64267da5-f60d-4b88-98af-bdf5806d5038.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D203%26id%3Dub1148f56%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D203%26originWidth%3D993%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D342872%26status%3Ddone%26style%3Dnone%26taskId%3Du2df32a3e-4c69-4599-868a-d81e33495ec%26title%3D%26width%3D993%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A993%2C%22originHeight%22%3A203%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23d0dcda%22%2C%22id%22%3A%22qVQAu%22%7D\"></card></p><p data-lake-id=\"u6734b8e1\" id=\"u6734b8e1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.four%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.UUID%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F1%2021%3A32%5Cn%20*%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%E6%A8%A1%E5%BC%8F%EF%BC%9A%5Cn%20*%20%E4%BD%BF%E7%94%A8%E7%9A%84%E6%97%B6%E9%97%B4%20%20%E6%AF%94%E8%BE%83%E5%93%AA%E7%A7%8D%E7%A1%AE%E8%AE%A4%E6%96%B9%E5%BC%8F%E6%98%AF%E6%9C%80%E5%A5%BD%E7%9A%84%5Cn%20*%201.%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%20*%202.%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%5Cn%20*%203.%E5%BC%82%E6%AD%A5%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%5Cn%20*%2F%5Cnpublic%20class%20ConfireMessage%20%7B%5Cn%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%AA%E6%95%B0%5Cn%20%20%20%20public%20static%20final%20int%20MESSAGE_COUNT%20%3D%201000%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20InterruptedException%2C%20TimeoutException%2C%20IOException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F1.%20%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20ConfireMessage.publicMessageIndividually()%3B%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B629726ms%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageIndividually()%20throws%20IOException%2C%20TimeoutException%2C%20InterruptedException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20massage%20%3D%20i%20%2B%20%5C%22%5C%22%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20massage.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8D%95%E4%B8%AA%E6%B6%88%E6%81%AF%E5%B0%B1%E9%A9%AC%E4%B8%8A%E8%BF%9B%E8%A1%8C%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20boolean%20flag%20%3D%20channel.waitForConfirms()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(flag)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E6%88%90%E5%8A%9F%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%2BMESSAGE_COUNT%2B%5C%22%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%2B(end%20-%20begin)%2B%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22e9bbaca4%22%7D\"></card><p data-lake-id=\"u662ff4b5\" id=\"u662ff4b5\"><br></p><p data-lake-id=\"u9a18410d\" id=\"u9a18410d\"><br></p><p data-lake-id=\"ud961b543\" id=\"ud961b543\"><br></p><h2 data-lake-id=\"498cf9b3\" id=\"498cf9b3\"><span data-lake-id=\"u10e0af31\" id=\"u10e0af31\">批量发布确认</span></h2><p data-lake-id=\"ue56ad038\" id=\"ue56ad038\"><br></p><p data-lake-id=\"ub790e1b8\" id=\"ub790e1b8\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638366964213-10397181-357d-4896-9e91-84690b69c982.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D137%26id%3Dude627a73%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D137%26originWidth%3D968%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D206130%26status%3Ddone%26style%3Dnone%26taskId%3Du0c3dafe3-1f66-4cc1-83ba-f5e8edae8b3%26title%3D%26width%3D968%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A968%2C%22originHeight%22%3A137%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23d7d9d8%22%2C%22id%22%3A%22tMsLz%22%7D\"></card></p><p data-lake-id=\"u31587570\" id=\"u31587570\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageBatch()%20throws%20IOException%2C%20TimeoutException%2C%20InterruptedException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%E5%A4%A7%E5%B0%8F%5Cn%20%20%20%20%20%20%20%20int%20batchSize%20%3D%20100%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E5%B8%83%E6%B6%88%E6%81%AF%EF%BC%8C%20%E6%89%B9%E9%87%8F%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20i%20%2B%20%5C%22%5C%22%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20%25%20batchSize%20%3D%3D%200)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.waitForConfirms()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%20%2B%20MESSAGE_COUNT%20%2B%20%5C%22%E4%B8%AA%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%20%2B%20(end%20-%20begin)%20%2B%20%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222f62025c%22%7D\"></card><p data-lake-id=\"uf3e134d2\" id=\"uf3e134d2\"><br></p><p data-lake-id=\"u47f2cb22\" id=\"u47f2cb22\"><br></p><p data-lake-id=\"u6d154a3b\" id=\"u6d154a3b\"><br></p><h2 data-lake-id=\"836eb661\" id=\"836eb661\"><span data-lake-id=\"u4945ac71\" id=\"u4945ac71\">异步发布确认</span></h2><p data-lake-id=\"u0f0edc87\" id=\"u0f0edc87\"><br></p><p data-lake-id=\"u494d78ca\" id=\"u494d78ca\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638368249755-46e1c3b8-f891-48b0-a77b-21b9a80f4e5e.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D119%26id%3Du5fcd19f7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D119%26originWidth%3D1189%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D231115%26status%3Ddone%26style%3Dnone%26taskId%3Du473c99f9-e088-4ad3-84e3-82e606c7d63%26title%3D%26width%3D1189%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1189%2C%22originHeight%22%3A119%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23e2dfd4%22%2C%22id%22%3A%22Jwh7I%22%7D\"></card><span data-lake-id=\"uf46f8c96\" id=\"uf46f8c96\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638368124379-5cdb8cbd-707a-4a1f-92f4-3dc511a9ec11.png%23clientId%3Du446e2507-b64d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D571%26id%3Du4b5d988b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D441%26originWidth%3D964%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D239080%26status%3Ddone%26style%3Dnone%26taskId%3Dua0b85de0-7119-4e3a-a0be-75854b9aaac%26title%3D%26width%3D1248.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A964%2C%22originHeight%22%3A441%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f7f7f7%22%2C%22id%22%3A%22T1TVR%22%7D\"></card></p><p data-lake-id=\"u52c10243\" id=\"u52c10243\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E6%B6%88%E6%81%AF%E7%9A%84%E4%B8%AA%E6%95%B0%5Cn%20%20%20%20public%20static%20final%20int%20MESSAGE_COUNT%20%3D%201000%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20InterruptedException%2C%20TimeoutException%2C%20IOException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F1.%20%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%5Cn%2F%2F%20%20%20%20%20%20%20%20ConfireMessage.publicMessageIndividually()%3B%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B629726ms%5Cn%2F%2F%20%20%20%20%20%20%20%202.%20%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%5Cn%2F%2F%20%20%20%20%20%20%20%20ConfireMessage.publicMessageBatch()%3B%20%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6761ms%EF%BC%88%E5%BC%8A%E7%AB%AF%EF%BC%9A%E6%97%A0%E6%B3%95%E7%A1%AE%E8%AE%A4%E5%93%AA%E4%B8%AA%E6%B6%88%E6%81%AF%E6%9C%AA%E8%A2%AB%E7%A1%AE%E8%AE%A4%EF%BC%89%5Cn%2F%2F%20%20%20%20%20%20%20%203.%20%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20ConfireMessage.publicMessageAsync()%3B%20%2F%2F%E5%8F%91%E5%B8%831000%E4%B8%AA%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6181ms%5Cn%20%20%20%20%7D%5Cn%2F%2F%E5%BC%82%E6%AD%A5%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageAsync()%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%88%90%E5%8A%9F%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20ackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20nackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%87%86%E5%A4%87%E6%B6%88%E6%81%AF%E7%9A%84%E7%9B%91%E5%90%AC%E5%99%A8%EF%BC%8C%E7%9B%91%E5%90%AC%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E6%88%90%E5%8A%9F%E4%BA%86%EF%BC%8C%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E5%A4%B1%E8%B4%A5%E4%BA%86%5Cn%20%20%20%20%20%20%20%20channel.addConfirmListener(ackCallback%2C%20nackCallback)%3B%20%20%2F%2F%E5%BC%82%E6%AD%A5%E9%80%9A%E7%9F%A5%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%82%E6%AD%A5%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20massage%20%3D%20%5C%22%E6%B6%88%E6%81%AF%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20massage.getBytes())%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%20%2B%20MESSAGE_COUNT%20%2B%20%5C%22%E4%B8%AA%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%20%2B%20(end%20-%20begin)%20%2B%20%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d6247f11%22%7D\"></card><p data-lake-id=\"uc4a48e34\" id=\"uc4a48e34\"><br></p><p data-lake-id=\"u32eb914f\" id=\"u32eb914f\"><br></p><p data-lake-id=\"u776a938a\" id=\"u776a938a\"><br></p><h2 data-lake-id=\"e8b363bb\" id=\"e8b363bb\"><span data-lake-id=\"uf8094a1f\" id=\"uf8094a1f\">如何处理异步未确认消息</span></h2><p data-lake-id=\"ucecfe414\" id=\"ucecfe414\"><br></p><p data-lake-id=\"uf632b3ef\" id=\"uf632b3ef\"><span data-lake-id=\"u39a67765\" id=\"u39a67765\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638404469016-06a08296-9aa6-4d65-8d1c-4c70fb4cd5b8.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D97%26id%3Du0927e367%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D97%26originWidth%3D1033%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D122865%26status%3Ddone%26style%3Dnone%26taskId%3Du67d3a3c6-2f1a-4be9-9c0c-f7d2e743935%26title%3D%26width%3D1033%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1033%2C%22originHeight%22%3A97%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23dcd8cd%22%2C%22id%22%3A%22frSPr%22%7D\"></card><span data-lake-id=\"u2e30a431\" id=\"u2e30a431\"><br /></span><span data-lake-id=\"u52adf52f\" id=\"u52adf52f\">上述异步确认有两个线程：</span></p><p data-lake-id=\"uf8bfc172\" id=\"uf8bfc172\"><br></p><ul list=\"u45e3622c\"><li fid=\"uc618e51c\" data-lake-id=\"ueacc7571\" id=\"ueacc7571\"><span data-lake-id=\"u97ac8cde\" id=\"u97ac8cde\">发消息的线程</span></li></ul><ul list=\"u70863da8\"><li fid=\"u94e1bd53\" data-lake-id=\"u5e95d849\" id=\"u5e95d849\"><span data-lake-id=\"uf05b2386\" id=\"uf05b2386\">监听器的线程</span></li></ul><p data-lake-id=\"u51d043a1\" id=\"u51d043a1\"><br></p><p data-lake-id=\"u969efa72\" id=\"u969efa72\"><span data-lake-id=\"u56ff6b24\" id=\"u56ff6b24\">两个线程之间交互，只能用</span><strong><span data-lake-id=\"ue97cc8c5\" id=\"ue97cc8c5\">并发链路式队列（可以在确认发布与发布线程之间进行消息传递）</span></strong><span data-lake-id=\"ud94ae86f\" id=\"ud94ae86f\">。</span></p><p data-lake-id=\"u60c1e577\" id=\"u60c1e577\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%BC%82%E6%AD%A5%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20public%20static%20void%20publicMessageAsync()%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20UUID.randomUUID().toString()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E4%BF%A1%E9%81%93%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20true%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%5Cn%20%20%20%20%20%20%20%20channel.confirmSelect()%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E6%9C%89%E5%BA%8F%E7%9A%84%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E9%80%82%E7%94%A8%E4%BA%8E%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E6%83%85%E5%86%B5%5Cn%20%20%20%20%20%20%20%201.%20%E8%BD%BB%E6%9D%BE%E7%9A%84%E5%B0%86%E5%BA%8F%E5%8F%B7%E4%B8%8E%E6%B6%88%E6%81%AF%E8%BF%9B%E8%A1%8C%E5%85%B3%E8%81%94%5Cn%20%20%20%20%20%20%20%202.%20%E8%BD%BB%E6%9D%BE%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E6%9D%A1%E7%9B%AE%EF%BC%8C%E5%8F%AA%E8%A6%81%E7%BB%99%E5%BA%8F%E5%8F%B7%5Cn%20%20%20%20%20%20%20%203.%E6%94%AF%E6%8C%81%E9%AB%98%E5%B9%B6%E5%8F%91(%E5%A4%9A%E7%BA%BF%E7%A8%8B)%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20ConcurrentSkipListMap%3CLong%2CString%3E%20outstandingConfirms%20%3D%20new%20ConcurrentSkipListMap%3C%3E()%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%88%90%E5%8A%9F%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20ackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F2.%20%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%20%20%20%E5%89%A9%E4%B8%8B%E7%9A%84%E5%B0%B1%E6%98%AF%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if(multiple)%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%A6%82%E6%9E%9C%E6%98%AF%E6%89%B9%E9%87%8F%E7%A1%AE%E8%AE%A4%EF%BC%8C%E5%B0%B1%E5%8E%BB%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ConcurrentNavigableMap%3CLong%2CString%3E%20confirmed%20%3D%20outstandingConfirms.headMap(deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20confirmed.clear()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%A6%82%E6%9E%9C%E6%98%AF%E5%8D%95%E4%B8%AA%E7%A1%AE%E8%AE%A4%EF%BC%8C%E5%B0%B1%E5%8E%BB%E5%8D%95%E4%B8%AA%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20outstandingConfirms.remove(deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%5Cn%20%20%20%20%20%20%20%20ConfirmCallback%20nackCallback%20%3D%20(deliveryTag%2C%20multiple)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F3.%20%E6%89%93%E5%8D%B0%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%E6%9C%89%E5%93%AA%E4%BA%9B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20outstandingConfirms.get(deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%EF%BC%9A%5C%22%2Bmessage%2B%5C%22%3A%3A%3A%3A%3A%E6%9C%AA%E7%A1%AE%E8%AE%A4%E7%9A%84%E6%B6%88%E6%81%AFtag%3A%5C%22%20%2B%20deliveryTag)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%87%86%E5%A4%87%E6%B6%88%E6%81%AF%E7%9A%84%E7%9B%91%E5%90%AC%E5%99%A8%EF%BC%8C%E7%9B%91%E5%90%AC%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E6%88%90%E5%8A%9F%E4%BA%86%EF%BC%8C%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E5%A4%B1%E8%B4%A5%E4%BA%86%5Cn%20%20%20%20%20%20%20%20channel.addConfirmListener(ackCallback%2C%20nackCallback)%3B%20%20%2F%2F%E5%BC%82%E6%AD%A5%E9%80%9A%E7%9F%A5%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20long%20begin%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%89%B9%E9%87%8F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20MESSAGE_COUNT%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22%E6%B6%88%E6%81%AF%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%201.%20%E6%AD%A4%E5%A4%84%E8%AE%B0%E5%BD%95%E4%B8%8B%E6%89%80%E6%9C%89%E8%A6%81%E5%8F%91%E9%80%81%E7%9A%84%E6%B6%88%E6%81%AF%20%20%E6%B6%88%E6%81%AF%E7%9A%84%E6%80%BB%E5%92%8C(%E6%AF%8F%E5%8F%91%E4%B8%80%E6%AC%A1%E6%B6%88%E6%81%AF%E5%B0%B1%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20outstandingConfirms.put(channel.getNextPublishSeqNo()%2Cmessage)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20queueName%2C%20null%2C%20message.getBytes())%3B%5Cn%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20long%20end%20%3D%20System.currentTimeMillis()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E5%8F%91%E5%B8%83%5C%22%20%2B%20MESSAGE_COUNT%20%2B%20%5C%22%E4%B8%AA%E5%BC%82%E6%AD%A5%E7%A1%AE%E8%AE%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E8%80%97%E6%97%B6%5C%22%20%2B%20(end%20-%20begin)%20%2B%20%5C%22ms%5C%22)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220a036573%22%7D\"></card><p data-lake-id=\"u24ef3936\" id=\"u24ef3936\"><br></p><blockquote data-lake-id=\"u468ca4b1\" id=\"u468ca4b1\"><p data-lake-id=\"u6e59d7fb\" id=\"u6e59d7fb\"><span data-lake-id=\"u4c233bde\" id=\"u4c233bde\">以上三种发布确认速度对比：</span></p></blockquote><p data-lake-id=\"u53e9db23\" id=\"u53e9db23\"><br></p><ul list=\"ubda67d26\"><li fid=\"u90682ff7\" data-lake-id=\"uafded0e5\" id=\"uafded0e5\"><span data-lake-id=\"u55706386\" id=\"u55706386\">单独发布消息：同步等待确认，简单，但吞吐量非常有限。</span></li></ul><ul list=\"u920464d7\"><li fid=\"u864c41fe\" data-lake-id=\"u94b38ace\" id=\"u94b38ace\"><span data-lake-id=\"ue688ad98\" id=\"ue688ad98\">批量发布消息：批量同步等待确认，简单，合理的吞吐量，一旦出现问题，很难推断出是哪条出现了问题</span></li></ul><ul list=\"u1811646a\"><li fid=\"ucee8d4b9\" data-lake-id=\"uc70e4029\" id=\"uc70e4029\"><span data-lake-id=\"uce17cf14\" id=\"uce17cf14\">异步处理：最佳性能和资源利用，在出现错误的情况下，可以很好的控制，但是实现起来稍微难些。</span></li></ul><p data-lake-id=\"u9569dffd\" id=\"u9569dffd\"><br></p><h2 data-lake-id=\"04596875\" id=\"04596875\"><span data-lake-id=\"u613065a8\" id=\"u613065a8\">交换机</span></h2><p data-lake-id=\"u2d479111\" id=\"u2d479111\"><br></p><p data-lake-id=\"u97889cc2\" id=\"u97889cc2\"><br></p><p data-lake-id=\"u80d50401\" id=\"u80d50401\"><br></p><h3 data-lake-id=\"a3034a5f\" id=\"a3034a5f\"><span data-lake-id=\"ud107708e\" id=\"ud107708e\">交换机的作用</span></h3><p data-lake-id=\"u03675e5f\" id=\"u03675e5f\"><br></p><p data-lake-id=\"u10101ef7\" id=\"u10101ef7\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638406810806-e429e00e-78d1-42e2-ab92-c3a53f8c2fa9.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D270%26id%3Duc3415ba1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D387%26originWidth%3D1291%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D191628%26status%3Ddone%26style%3Dnone%26taskId%3Duee2f50b0-7b80-4d38-9c1b-25806445f5f%26title%3D%26width%3D900.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1291%2C%22originHeight%22%3A387%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f5f4f4%22%2C%22id%22%3A%22tFgNi%22%7D\"></card></p><p data-lake-id=\"u73fbd331\" id=\"u73fbd331\"><br></p><h3 data-lake-id=\"f71f343d\" id=\"f71f343d\"><span data-lake-id=\"udce3eba1\" id=\"udce3eba1\">交换机的类型</span></h3><p data-lake-id=\"ufcff41c1\" id=\"ufcff41c1\"><br></p><ul list=\"u6b7fcdd4\"><li fid=\"uc60d6b8e\" data-lake-id=\"ud837129c\" id=\"ud837129c\"><span data-lake-id=\"u86ef0948\" id=\"u86ef0948\">直接（direct）== 路由类型</span></li></ul><ul list=\"u64dabf1f\"><li fid=\"u13283976\" data-lake-id=\"u3a192338\" id=\"u3a192338\"><span data-lake-id=\"u11dc7ef6\" id=\"u11dc7ef6\">主题（topic）</span></li></ul><ul list=\"uf43ec12e\"><li fid=\"uf7678f46\" data-lake-id=\"u181beacc\" id=\"u181beacc\"><span data-lake-id=\"ubaca4975\" id=\"ubaca4975\">标题（headers）（企业不常用）</span></li></ul><ul list=\"uf352ef6e\"><li fid=\"u49f78635\" data-lake-id=\"ude1c64c5\" id=\"ude1c64c5\"><span data-lake-id=\"u6f4ca6d9\" id=\"u6f4ca6d9\">扇出（fanout）== 发布订阅类型</span></li></ul><ul list=\"u17450d46\"><li fid=\"u8c74f284\" data-lake-id=\"ubc65d5ac\" id=\"ubc65d5ac\"><span data-lake-id=\"uc966f232\" id=\"uc966f232\">无名类型（默认类型），通常用空串进行识别</span></li></ul><p data-lake-id=\"u7841bf48\" id=\"u7841bf48\"><br></p><p data-lake-id=\"uabda8adb\" id=\"uabda8adb\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638407294007-f1bd9624-be98-4b90-ba72-9c29d88c326d.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D76%26id%3Du21ac6756%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D76%26originWidth%3D987%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D103665%26status%3Ddone%26style%3Dnone%26taskId%3Du47150f74-3b3b-4cc4-befe-f25d9650214%26title%3D%26width%3D987%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A987%2C%22originHeight%22%3A76%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23cbc7bb%22%2C%22id%22%3A%22KlfHY%22%7D\"></card></p><p data-lake-id=\"uefca42b0\" id=\"uefca42b0\"><br></p><h3 data-lake-id=\"192ebf07\" id=\"192ebf07\"><span data-lake-id=\"u9072179f\" id=\"u9072179f\">临时队列</span></h3><p data-lake-id=\"u759723a3\" id=\"u759723a3\"><br></p><p data-lake-id=\"ua828dd89\" id=\"ua828dd89\"><span data-lake-id=\"ud0203d2a\" id=\"ud0203d2a\">不带有持久化，一旦断开消费者的连接，队列将被自动删除。<br /></span><span data-lake-id=\"uef76f3f7\" id=\"uef76f3f7\">​</span></p><p data-lake-id=\"u117c1c40\" id=\"u117c1c40\"><br></p><p data-lake-id=\"udc7c1eb9\" id=\"udc7c1eb9\"><span data-lake-id=\"u26374f4c\" id=\"u26374f4c\">创建临时队列：</span></p><p data-lake-id=\"uc7d27537\" id=\"uc7d27537\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22String%20queueName%20%3D%20channel.queueDeclare().getQueue()%3B%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22493f5cb2%22%7D\"></card><p data-lake-id=\"uf4a72fb6\" id=\"uf4a72fb6\"><br></p><p data-lake-id=\"u0810dd91\" id=\"u0810dd91\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638407906977-786b78e8-bfba-4cab-9aee-9ac7ec38a884.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D278%26id%3Du31ce7deb%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D410%26originWidth%3D1086%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D55531%26status%3Ddone%26style%3Dnone%26taskId%3Dub3aa0ca4-c823-418b-b8c7-0b7fbd67333%26title%3D%26width%3D736.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1086%2C%22originHeight%22%3A410%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f4f2f1%22%2C%22id%22%3A%22T0K86%22%7D\"></card></p><p data-lake-id=\"u186f5254\" id=\"u186f5254\"><br></p><h3 data-lake-id=\"f4f12c7a\" id=\"f4f12c7a\"><span data-lake-id=\"ucf133bc6\" id=\"ucf133bc6\">绑定</span></h3><p data-lake-id=\"u3f311869\" id=\"u3f311869\"><br></p><p data-lake-id=\"u06749896\" id=\"u06749896\"><span data-lake-id=\"u2397429d\" id=\"u2397429d\">就是交换机与队列之间的捆绑关系。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638408143523-d4c904d9-33e5-46bd-ad67-885e78b4c34b.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D637%26id%3Du8140e36d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D637%26originWidth%3D487%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D26522%26status%3Ddone%26style%3Dnone%26taskId%3Dua5ea4c46-36c5-4183-aefe-f6a3f676385%26title%3D%26width%3D487%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A487%2C%22originHeight%22%3A637%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23faf5f5%22%2C%22id%22%3A%22fwITJ%22%7D\"></card></p><p data-lake-id=\"u2f756d95\" id=\"u2f756d95\"><br></p><h3 data-lake-id=\"b3f97d74\" id=\"b3f97d74\"><span data-lake-id=\"u8d977267\" id=\"u8d977267\">发布订阅模式（扇出模式 fanout）</span></h3><p data-lake-id=\"u60ac1fb4\" id=\"u60ac1fb4\"><br></p><p data-lake-id=\"u47c5c857\" id=\"u47c5c857\"><span data-lake-id=\"ufc889c6d\" id=\"ufc889c6d\">类似广播，两个 routingkey 相同<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638408427104-577b627a-521a-4d94-89be-5bf0102440ea.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D218%26id%3Du3ae99c2f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D292%26originWidth%3D1200%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D205919%26status%3Ddone%26style%3Dnone%26taskId%3Dufe252eb8-02f2-410e-8b74-b8d091c0d4a%26title%3D%26width%3D894%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A1200%2C%22originHeight%22%3A292%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f8ebea%22%2C%22id%22%3A%22PeGnm%22%7D\"></card></p><p data-lake-id=\"u34a7c050\" id=\"u34a7c050\"><br></p><ol list=\"u4e11381f\"><li fid=\"uffe46d07\" data-lake-id=\"ua058bafa\" id=\"ua058bafa\"><span data-lake-id=\"udd2b4bc0\" id=\"udd2b4bc0\">生产者</span></li></ol><p data-lake-id=\"u527d2fcd\" id=\"u527d2fcd\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.five%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A59%5Cn%20*%20%E5%8F%91%E6%B6%88%E6%81%AF%EF%BC%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20*%2F%5Cnpublic%20class%20EmitLog%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22fanout%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(EXCHANGE_NAME%2C%20%5C%22%5C%22%2C%20null%2C%20message.getBytes(StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22064b8440%22%7D\"></card><p data-lake-id=\"ube6bfff0\" id=\"ube6bfff0\"><br></p><ol list=\"u503d83bd\" start=\"2\"><li fid=\"udec7f53c\" data-lake-id=\"u9725dfb0\" id=\"u9725dfb0\"><span data-lake-id=\"ue0140b5f\" id=\"ue0140b5f\">两个消费者</span></li></ol><p data-lake-id=\"u2a01f03c\" id=\"u2a01f03c\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.five%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A35%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogs01%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22fanout%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%20%20%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%20(%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%EF%BC%8C%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E5%BD%93%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E4%B8%8E%E9%98%9F%E5%88%97%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%98%9F%E5%88%97%E5%B0%B1%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4)%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20channel.queueDeclare().getQueue()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%EF%BC%8C%E6%8A%8A%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%E6%89%93%E5%8D%B0%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs01%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%224ebe62a0%22%7D\"></card><p data-lake-id=\"u7d8e0aa1\" id=\"u7d8e0aa1\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.five%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A35%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogs02%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22fanout%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%20%20%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%20(%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E9%98%9F%E5%88%97%EF%BC%8C%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E5%BD%93%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E4%B8%8E%E9%98%9F%E5%88%97%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%98%9F%E5%88%97%E5%B0%B1%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4)%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20channel.queueDeclare().getQueue()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%EF%BC%8C%E6%8A%8A%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%E6%89%93%E5%8D%B0%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs02%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22bd022965%22%7D\"></card><p data-lake-id=\"ub0920585\" id=\"ub0920585\"><br></p><p data-lake-id=\"u9415957b\" id=\"u9415957b\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638410904168-80b297c1-26ef-4ee4-815c-065abea79bd2.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D328%26id%3Du29891926%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D328%26originWidth%3D580%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D28269%26status%3Ddone%26style%3Dnone%26taskId%3Du6700fa8b-9b2f-4717-91cf-0dfb20b528b%26title%3D%26width%3D580%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A580%2C%22originHeight%22%3A328%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%232c383f%22%2C%22id%22%3A%22Jf7Cl%22%7D\"></card><span data-lake-id=\"uc0fe1860\" id=\"uc0fe1860\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638410913426-c4d1faa3-7b8b-478c-ba35-665d73e98e8b.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D248%26id%3Dua55ed718%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D248%26originWidth%3D528%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D34020%26status%3Ddone%26style%3Dnone%26taskId%3Du415b65a3-7d21-4e16-a1a0-a15d7f3c4ca%26title%3D%26width%3D528%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A528%2C%22originHeight%22%3A248%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23323e46%22%2C%22id%22%3A%22HNmyl%22%7D\"></card><span data-lake-id=\"u6e5683e5\" id=\"u6e5683e5\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638410920504-2f4c6248-02a0-4765-8647-4c8ab63551e1.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D255%26id%3Du9c537a4f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D255%26originWidth%3D517%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D35282%26status%3Ddone%26style%3Dnone%26taskId%3Du97bfb701-f8bd-45ca-ac41-6f8259d9775%26title%3D%26width%3D517%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A517%2C%22originHeight%22%3A255%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23323e46%22%2C%22id%22%3A%22BBNfG%22%7D\"></card></p><p data-lake-id=\"u64f3af66\" id=\"u64f3af66\"><br></p><h3 data-lake-id=\"a7c987c4\" id=\"a7c987c4\"><span data-lake-id=\"u0a451a87\" id=\"u0a451a87\">直接交换机（路由模式 direct）</span></h3><p data-lake-id=\"u6628277e\" id=\"u6628277e\"><br></p><p data-lake-id=\"uc914fe9f\" id=\"uc914fe9f\"><span data-lake-id=\"ud4ff4146\" id=\"ud4ff4146\">两个 routingkey 不相同<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638411099834-bf80fb1d-473a-4a01-8553-e47ee2cd3670.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D303%26id%3Dueba6aa41%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D303%26originWidth%3D874%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D98369%26status%3Ddone%26style%3Dnone%26taskId%3Du2145da18-8429-4959-ab30-43bcc28bb61%26title%3D%26width%3D874%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22originWidth%22%3A874%2C%22originHeight%22%3A303%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22averageHue%22%3A%22%23f6e6e4%22%2C%22id%22%3A%22t5eGH%22%7D\"></card><span data-lake-id=\"u1eb7de15\" id=\"u1eb7de15\"><br /></span><span data-lake-id=\"u9ba6bc34\" id=\"u9ba6bc34\">可以多重绑定。<br /></span><strong><span data-lake-id=\"uba4e10e3\" id=\"uba4e10e3\">生产者发消息给队列，直接交换机通过不同 routingkey 路由到相应的队列，然后消费者接收指定日志。</span></strong></p><p data-lake-id=\"u3ab1ef95\" id=\"u3ab1ef95\"><br></p><ol list=\"ub56a82f0\"><li fid=\"u29f08130\" data-lake-id=\"uf3812b97\" id=\"uf3812b97\"><span data-lake-id=\"ue933e58c\" id=\"ue933e58c\">发消息</span></li></ol><p data-lake-id=\"u7dffc5fc\" id=\"u7dffc5fc\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.six%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.Scanner%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%209%3A59%5Cn%20*%20%E5%8F%91%E6%B6%88%E6%81%AF%EF%BC%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20*%2F%5Cnpublic%20class%20DirectLogs%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22direct_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20Scanner%20scanner%20%3D%20new%20Scanner(System.in)%3B%5Cn%20%20%20%20%20%20%20%20while%20(scanner.hasNext())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20scanner.next()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(EXCHANGE_NAME%2C%20%5C%22error%5C%22%2C%20null%2C%20message.getBytes(StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222a901417%22%7D\"></card><p data-lake-id=\"uf9ac8eab\" id=\"uf9ac8eab\"><br></p><ol list=\"uad1b784c\" start=\"2\"><li fid=\"u3cab60b9\" data-lake-id=\"ufe981695\" id=\"ufe981695\"><span data-lake-id=\"u9b69f27d\" id=\"u9b69f27d\">接收消息</span></li></ol><p data-lake-id=\"uca90e43f\" id=\"uca90e43f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.six%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2010%3A15%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsDirect01%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22direct_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(%5C%22console%5C%22%2Cfalse%2Cfalse%2Cfalse%2Cnull)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(%5C%22console%5C%22%2CEXCHANGE_NAME%2C%5C%22info%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(%5C%22console%5C%22%2CEXCHANGE_NAME%2C%5C%22warning%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs01%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(%5C%22console%5C%22%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22fc2f4488%22%7D\"></card><p data-lake-id=\"u1cc8d4b5\" id=\"u1cc8d4b5\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.six%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2010%3A15%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsDirect02%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22direct_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(%5C%22disk%5C%22%2Cfalse%2Cfalse%2Cfalse%2Cnull)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(%5C%22disk%5C%22%2CEXCHANGE_NAME%2C%5C%22error%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22ReceiveLogs02%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8E%A5%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%EF%BC%9A%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(%5C%22disk%5C%22%2C%20true%2C%20%20deliverCallback%2CconsumerTag-%3E%7B%7D)%3B%5Cn%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22d5727d5b%22%7D\"></card><p data-lake-id=\"uab85209b\" id=\"uab85209b\"><br></p><p data-lake-id=\"u1a362bc4\" id=\"u1a362bc4\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638413931242-2c3ef4c2-f3e6-4e6e-ba39-5437dad24d40.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D182%26id%3Du9de2b784%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D182%26originWidth%3D630%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D21691%26status%3Ddone%26style%3Dnone%26taskId%3Du7cd93b89-df35-4f94-aa33-6626b0dc70b%26title%3D%26width%3D630%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22eyPPs%22%7D\"></card><span data-lake-id=\"u37cd2242\" id=\"u37cd2242\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638413948375-568b73ae-0203-4f53-9a9b-528667192aa2.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D182%26id%3Duc8400be0%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D182%26originWidth%3D683%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D24900%26status%3Ddone%26style%3Dnone%26taskId%3Du38d71d59-3dd8-4324-9fae-335fd043524%26title%3D%26width%3D683%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22U0kJT%22%7D\"></card></p><p data-lake-id=\"u154435a1\" id=\"u154435a1\"><br></p><h3 data-lake-id=\"c4e17e43\" id=\"c4e17e43\"><span data-lake-id=\"u9924c5e2\" id=\"u9924c5e2\">主题交换机（Topic）</span></h3><p data-lake-id=\"ubdbf1ba0\" id=\"ubdbf1ba0\"><br></p><p data-lake-id=\"ucae3280a\" id=\"ucae3280a\"><span data-lake-id=\"uc1d10b00\" id=\"uc1d10b00\">规范：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638414479059-98f3dc8e-ee99-4093-b2cb-81eaecec9acb.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D226%26id%3Du34e92b6a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D226%26originWidth%3D834%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D170475%26status%3Ddone%26style%3Dnone%26taskId%3Due217ff8b-9da9-493e-9a4b-07c6ab22bab%26title%3D%26width%3D834%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22KCIOt%22%7D\"></card><span data-lake-id=\"u579a3771\" id=\"u579a3771\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638415621949-8c1e4089-881d-482e-a377-ab7f224a2c92.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D257%26id%3Du76cf3ab8%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D257%26originWidth%3D801%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D151366%26status%3Ddone%26style%3Dnone%26taskId%3Du98d7748e-2fc6-4df3-a740-cae3ba06db9%26title%3D%26width%3D801%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22HeQJL%22%7D\"></card><span data-lake-id=\"u141af3b3\" id=\"u141af3b3\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638415680787-e95ef7a6-bec4-44b3-8e45-1e0c4adac6f7.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D350%26id%3Du280d2c9d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D350%26originWidth%3D829%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D181864%26status%3Ddone%26style%3Dnone%26taskId%3Du67807a72-c793-4b0b-a14e-e6270164016%26title%3D%26width%3D829%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22ZuvJl%22%7D\"></card><span data-lake-id=\"u97ad8abd\" id=\"u97ad8abd\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638415855921-8e2750b0-e5df-4b1c-90a3-7e3f696543d6.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D188%26id%3Duf97e55b4%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D188%26originWidth%3D920%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D178229%26status%3Ddone%26style%3Dnone%26taskId%3Dufb1118a1-0b9d-4a97-bd09-0ff626585f5%26title%3D%26width%3D920%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22iZC7I%22%7D\"></card></p><p data-lake-id=\"u5bf7d3d8\" id=\"u5bf7d3d8\"><br></p><h3 data-lake-id=\"36d4697d\" id=\"36d4697d\"><span data-lake-id=\"ud625f05f\" id=\"ud625f05f\">主题交换机（实战）</span></h3><p data-lake-id=\"ub70d80a5\" id=\"ub70d80a5\"><br></p><p data-lake-id=\"uca5a3ec7\" id=\"uca5a3ec7\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638416303199-5f9e655c-c5c2-4a16-9d12-ba873c31c8e6.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D331%26id%3Du07108cc7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D331%26originWidth%3D1114%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D231103%26status%3Ddone%26style%3Dnone%26taskId%3Dud57ef875-e371-4fa6-980a-20a29a7366e%26title%3D%26width%3D1114%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22zgYBJ%22%7D\"></card></p><p data-lake-id=\"u71bf4d07\" id=\"u71bf4d07\"><br></p><ol list=\"ud4092d2a\"><li fid=\"u74054fe3\" data-lake-id=\"ub54f7556\" id=\"ub54f7556\"><span data-lake-id=\"u8b30a1dc\" id=\"u8b30a1dc\">消费者</span></li></ol><p data-lake-id=\"u39a550d2\" id=\"u39a550d2\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.seven%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2011%3A37%5Cn%20*%20%E5%A3%B0%E6%98%8E%E4%B8%BB%E9%A2%98%E4%BA%A4%E6%8D%A2%E6%9C%BA%20%20%E5%8F%8A%E7%9B%B8%E5%85%B3%E9%98%9F%E5%88%97%5Cn%20*%20%3Cp%3E%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20C2%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsTopic01%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22topic_logs%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22topic%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20%5C%22Q1%5C%22%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%BB%91%E5%AE%9A%20routingkey%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22*.orange.*%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E9%98%9F%E5%88%97%EF%BC%9A%5C%22%20%2B%20queueName%20%2B%20%5C%22%E7%BB%91%E5%AE%9A%E9%94%AE%EF%BC%9A%5C%22%20%2B%20message.getEnvelope().getRoutingKey())%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221860808d%22%7D\"></card><p data-lake-id=\"ucf8d429e\" id=\"ucf8d429e\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.seven%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2011%3A37%5Cn%20*%20%E5%A3%B0%E6%98%8E%E4%B8%BB%E9%A2%98%E4%BA%A4%E6%8D%A2%E6%9C%BA%20%20%E5%8F%8A%E7%9B%B8%E5%85%B3%E9%98%9F%E5%88%97%5Cn%20*%20%3Cp%3E%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20C2%5Cn%20*%2F%5Cnpublic%20class%20ReceiveLogsTopic02%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22topic_logs%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(EXCHANGE_NAME%2C%20%5C%22topic%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20String%20queueName%20%3D%20%5C%22Q2%5C%22%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(queueName%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%BB%91%E5%AE%9A%20routingkey%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22*.*.rabbit%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueBind(queueName%2C%20EXCHANGE_NAME%2C%20%5C%22lazy.%23%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%8E%A5%E6%94%B6%E9%98%9F%E5%88%97%EF%BC%9A%5C%22%20%2B%20queueName%20%2B%20%5C%22%E7%BB%91%E5%AE%9A%E9%94%AE%EF%BC%9A%5C%22%20%2B%20message.getEnvelope().getRoutingKey())%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(queueName%2C%20true%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%226972b59b%22%7D\"></card><p data-lake-id=\"ubd93dfb6\" id=\"ubd93dfb6\"><br></p><ol list=\"u65e6951e\" start=\"2\"><li fid=\"u8b725ab3\" data-lake-id=\"u9e924b7c\" id=\"u9e924b7c\"><span data-lake-id=\"uabdadacb\" id=\"uabdadacb\">生产者</span></li></ol><p data-lake-id=\"u9a490197\" id=\"u9a490197\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.seven%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.security.spec.ECField%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2014%3A45%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cnpublic%20class%20EmitLogTopic%20%7B%5Cn%20%20%20%20public%20static%20final%20String%20EXCHANGE_NAME%20%3D%20%5C%22topic_logs%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E4%B8%8B%E5%9B%BE%E7%BB%91%E5%AE%9A%E5%85%B3%E7%B3%BB%E5%A6%82%E4%B8%8B%EF%BC%9A%5Cn%20%20%20%20%20%20%20%20%20*%20Q1--%3E%20%E7%BB%91%E5%AE%9A%E7%9A%84%E6%98%AF%EF%BC%9A%20%E4%B8%AD%E9%97%B4%E5%B8%A63%E4%B8%AA%E5%8D%95%E8%AF%8D%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%88*.orange*%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20Q2--%3E%20%E7%BB%91%E5%AE%9A%E7%9A%84%E6%98%AF%EF%BC%9A%20%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E6%98%AFrabbit%E7%9A%843%E4%B8%AA%E5%8D%95%E8%AF%8D%EF%BC%88*.*.rabbit%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E6%98%AFlazy%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%8D%95%E8%AF%8D%EF%BC%88lazy.%23%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20String%3E%20bindingKeyMap%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.orange.rabbit%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q1Q2%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.orange.elephant%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q1Q2%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.pink.rabbit%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q1%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.brown.fox%5C%22%2C%20%5C%22%E8%A2%AB%E9%98%9F%E5%88%97Q2%E6%8E%A5%E6%94%B6%E5%88%B0%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.orange.male.rabbit%5C%22%2C%20%5C%22%E8%99%BD%E7%84%B6%E6%BB%A1%E8%B6%B3%E4%B8%A4%E4%B8%AA%E7%BB%91%E5%AE%9A%E4%BD%86%E5%8F%AA%E8%A2%AB%E9%98%9F%E5%88%97Q2%E6%8E%A5%E6%94%B6%E4%B8%80%E6%AC%A1%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22quick.brown.fox%5C%22%2C%20%5C%22%E4%B8%8D%E5%8C%B9%E9%85%8D%E4%BB%BB%E4%BD%95%E7%BB%91%E5%AE%9A%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%BB%BB%E4%BD%95%E9%98%9F%E5%88%97%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BC%9A%E8%A2%AB%E4%B8%A2%E5%BC%83%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.orange.male.rabbit%5C%22%2C%20%5C%22%E6%98%AF%E5%9B%9B%E4%B8%AA%E5%8D%95%E8%AF%8D%E4%B8%8D%E5%8C%B9%E9%85%8D%E4%BB%BB%E4%BD%95%E7%BB%91%E5%AE%9A%E5%AE%9A%E4%BC%9A%E4%B8%A2%E5%BC%83%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20bindingKeyMap.put(%5C%22lazy.orange.male.rabbit%5C%22%2C%20%5C%22%E6%98%AF%E5%9B%9B%E4%B8%AA%E5%8D%95%E8%AF%8D%E4%BD%86%E5%8C%B9%E9%85%8DQ2%5C%22)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20for%20(Map.Entry%3CString%2C%20String%3E%20bindingKeyEntry%20%3A%20bindingKeyMap.entrySet())%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20routingKey%20%3D%20bindingKeyEntry.getKey()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20bindingKeyEntry.getValue()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(EXCHANGE_NAME%2C%20routingKey%2C%20null%2C%20message.getBytes(StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%87%BA%E6%B6%88%E6%81%AF%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2256e802f3%22%7D\"></card><p data-lake-id=\"u2545c488\" id=\"u2545c488\"><br></p><p data-lake-id=\"u8f7b2119\" id=\"u8f7b2119\"><span data-lake-id=\"u35993936\" id=\"u35993936\">先启动消费者，再启动生产者。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430253833-e55a9ffe-37a0-4c04-b7b7-093a65480f71.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D540%26id%3Du94f62b22%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D540%26originWidth%3D683%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D63817%26status%3Ddone%26style%3Dnone%26taskId%3Du846aee7e-23e7-429c-8c68-098657667fa%26title%3D%26width%3D683%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22r1tul%22%7D\"></card><span data-lake-id=\"u868c8c5a\" id=\"u868c8c5a\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430292235-0a8fd8ca-fdd9-4f2e-9a52-de2398da4db4.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D548%26id%3Du5b1d2810%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D548%26originWidth%3D649%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D60902%26status%3Ddone%26style%3Dnone%26taskId%3Duf769df3d-232c-4803-866e-9b789b65799%26title%3D%26width%3D649%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22p0vbD%22%7D\"></card><span data-lake-id=\"uc40afe97\" id=\"uc40afe97\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430299720-f401248d-7efc-425f-aff1-59f8cda3349d.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D257%26id%3Du7c6af404%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D257%26originWidth%3D674%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D33728%26status%3Ddone%26style%3Dnone%26taskId%3Du0e4568aa-d243-4696-a1eb-02eebf586cf%26title%3D%26width%3D674%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Axrk6%22%7D\"></card></p><p data-lake-id=\"u8c98ba91\" id=\"u8c98ba91\"><br></p><h2 data-lake-id=\"3dead64c\" id=\"3dead64c\"><span data-lake-id=\"u047b4415\" id=\"u047b4415\">死信队列</span></h2><p data-lake-id=\"u1870ddac\" id=\"u1870ddac\"><br></p><p data-lake-id=\"ub7284874\" id=\"ub7284874\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430356782-4196f6b8-209f-489a-a5e5-e61974e711ef.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D299%26id%3Dud95905f1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D299%26originWidth%3D1069%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D430772%26status%3Ddone%26style%3Dnone%26taskId%3Due469e4ea-c3e9-44f2-a5e6-4ac2443deba%26title%3D%26width%3D1069%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22ZL2Da%22%7D\"></card><span data-lake-id=\"u8cdb6967\" id=\"u8cdb6967\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430504276-84f3e02c-d80f-4fe9-9b9a-b8d9ac3b8290.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D298%26id%3Du8670c10d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D298%26originWidth%3D643%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D162345%26status%3Ddone%26style%3Dnone%26taskId%3Due72cf50e-a8d2-4f86-8a8f-e35ebf10e89%26title%3D%26width%3D643%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22rBdXQ%22%7D\"></card><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638430601814-eb3112b8-d77b-4213-ad2c-df3c394a36b7.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D553%26id%3Dufda1712c%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D553%26originWidth%3D1136%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D162361%26status%3Ddone%26style%3Dnone%26taskId%3Du55e88e2a-dc14-44b5-9eb9-8663773f317%26title%3D%26width%3D1136%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22pQqf7%22%7D\"></card></p><p data-lake-id=\"uad6c0443\" id=\"uad6c0443\"><br></p><ul list=\"ub4dba9c5\"><li fid=\"u4ab60c3a\" data-lake-id=\"uc3ccb3d3\" id=\"uc3ccb3d3\"><span data-lake-id=\"u77883d71\" id=\"u77883d71\">消费者 1：</span></li></ul><p data-lake-id=\"u3530fd70\" id=\"u3530fd70\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2015%3A40%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%851%5Cn%20*%2F%5Cnpublic%20class%20Consumer01%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_EXCHANGE%20%3D%20%5C%22normal_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_EXCHANGE%20%3D%20%5C%22dead_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_QUEUE%20%3D%20%5C%22normal_queue%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_QUEUE%20%3D%20%5C%22dead_queue%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%AD%BB%E4%BF%A1%E5%92%8C%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%8C%20%E7%B1%BB%E5%9E%8B%E4%B8%BAdirect%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(NORMAL_EXCHANGE%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20channel.exchangeDeclare(DEAD_EXCHANGE%2C%20BuiltinExchangeType.DIRECT)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%5Cn%2F%2F%20%20%20%20%20%20%20%20arguments.put(%5C%22x-message-ttl%5C%22%2C10000)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%AD%A3%E5%B8%B8%E9%98%9F%E5%88%97%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20DEAD_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1RoutingKey%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22lisi%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%A3%E5%B8%B8%E9%98%9F%E5%88%97%E7%9A%84%E9%95%BF%E5%BA%A6%E7%9A%84%E9%99%90%E5%88%B6%5Cn%2F%2F%20%20%20%20%20%20%20%20arguments.put(%5C%22x-max-length%5C%22%2C%2019)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(NORMAL_QUEUE%2C%20false%2C%20false%2C%20false%2C%20arguments)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(DEAD_QUEUE%2C%20false%2C%20false%2C%20false%2C%20null)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E9%98%9F%E5%88%97%E7%BB%91%E5%AE%9A%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(NORMAL_QUEUE%2C%20NORMAL_EXCHANGE%2C%20%5C%22zhangsan%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%E4%B8%8E%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20channel.queueBind(DEAD_QUEUE%2C%20DEAD_EXCHANGE%2C%20%5C%22lisi%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF.........%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(msg.equals(%5C%22info5%5C%22))%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%AD%A4%E6%B6%88%E6%81%AF%E8%A2%ABC1%E6%8B%92%E7%BB%9D%E7%9A%84%5C%22%20%2B%20msg)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E6%8B%92%E7%BB%9D%E6%AD%A4%E6%B6%88%E6%81%AF%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%B8%8D%E6%94%BE%E5%9B%9E%E9%98%9F%E5%88%97%E4%B8%AD%E3%80%82%E5%9B%A0%E6%AD%A4%E6%88%90%E4%B8%BA%E6%AD%BB%E4%BF%A1%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicReject(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22Consumer01%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20msg)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E4%B8%8D%E6%89%B9%E9%87%8F%E5%BA%94%E7%AD%94%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicAck(message.getEnvelope().getDeliveryTag()%2C%20false)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%BC%80%E5%90%AF%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%88%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%BC%80%E5%90%AF%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8C%E5%B0%B1%E4%B8%8D%E5%AD%98%E5%9C%A8%E6%8B%92%E7%BB%9D%E4%BA%86%EF%BC%89%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(NORMAL_QUEUE%2C%20false%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%226b32ccf8%22%7D\"></card><p data-lake-id=\"u435ef8b3\" id=\"u435ef8b3\"><br></p><ul list=\"u9833d078\"><li fid=\"uafeaa448\" data-lake-id=\"u991e0c89\" id=\"u991e0c89\"><span data-lake-id=\"u6d37fec1\" id=\"u6d37fec1\">消费者 2：</span></li></ul><p data-lake-id=\"ufa7c436f\" id=\"ufa7c436f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.BuiltinExchangeType%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20com.rabbitmq.client.DeliverCallback%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.nio.charset.StandardCharsets%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2015%3A40%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%852%5Cn%20*%2F%5Cnpublic%20class%20Consumer02%20%7B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_QUEUE%20%3D%20%5C%22dead_queue%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E7%AD%89%E5%BE%85%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF.........%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22Consumer02%E6%8E%A5%E6%94%B6%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%20%2B%20new%20String(message.getBody()%2C%20StandardCharsets.UTF_8))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(DEAD_QUEUE%2C%20false%2C%20deliverCallback%2C%20consumerTag%20-%3E%20%7B%5Cn%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220aee91a1%22%7D\"></card><p data-lake-id=\"ud595d97e\" id=\"ud595d97e\"><br></p><ul list=\"u7a57cbe8\"><li fid=\"u52c405ea\" data-lake-id=\"u2bd56aa9\" id=\"u2bd56aa9\"><span data-lake-id=\"ubce8fc66\" id=\"ubce8fc66\">生产者：</span></li></ul><p data-lake-id=\"u44801151\" id=\"u44801151\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.AMQP%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2016%3A13%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97-%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_EXCHANGE%20%3D%20%5C%22normal_exchange%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E6%97%B6%E9%97%B4%20%20%E8%AE%BE%E7%BD%AEttl%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20AMQP.BasicProperties%20properties%20%3D%20new%20AMQP.BasicProperties().builder().expiration(%5C%2210000%5C%22).build()%3B%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%201%3B%20i%20%3C%2011%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22info%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(NORMAL_EXCHANGE%2C%20%5C%22zhangsan%5C%22%2C%20properties%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221656143b%22%7D\"></card><p data-lake-id=\"u6e029386\" id=\"u6e029386\"><br></p><p data-lake-id=\"u5a3eb9d2\" id=\"u5a3eb9d2\"><span data-lake-id=\"uea2ed46a\" id=\"uea2ed46a\">测试步骤：</span></p><p data-lake-id=\"uba408812\" id=\"uba408812\"><br></p><ol list=\"u12605c33\"><li fid=\"u8cc5814f\" data-lake-id=\"u835dcc9d\" id=\"u835dcc9d\"><span data-lake-id=\"u643f8ba9\" id=\"u643f8ba9\">运行消费者：会发现普通和死信交换机已经绑定各自的队列。</span></li></ol><p data-lake-id=\"u058f5168\" id=\"u058f5168\"><br></p><p data-lake-id=\"u9ebcebd9\" id=\"u9ebcebd9\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638445377947-e4a087d0-b755-4178-aa6d-7ae082107bb0.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D495%26id%3Dud91030e8%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D495%26originWidth%3D541%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23775%26status%3Ddone%26style%3Dnone%26taskId%3Du8f85c23d-a811-41b4-a478-a20609fc50a%26title%3D%26width%3D541%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22xwjE9%22%7D\"></card><span data-lake-id=\"u20dcc1c0\" id=\"u20dcc1c0\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638445475857-ba40932b-588f-43d3-b3a6-5f2660bcd241.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D498%26id%3Dub28b2410%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D498%26originWidth%3D601%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D25129%26status%3Ddone%26style%3Dnone%26taskId%3Du8de3a461-08ce-49b9-9936-e0cf7fa1363%26title%3D%26width%3D601%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Jcymv%22%7D\"></card></p><p data-lake-id=\"u62f48d77\" id=\"u62f48d77\"><br></p><ol list=\"u58c0cf9c\" start=\"2\"><li fid=\"ufe890c6a\" data-lake-id=\"u09f241e0\" id=\"u09f241e0\"><span data-lake-id=\"u80004425\" id=\"u80004425\">测试</span><strong><span data-lake-id=\"u9f91257d\" id=\"u9f91257d\">队列达到最大长度</span></strong><span data-lake-id=\"uec0838b8\" id=\"uec0838b8\">，关闭消费者 1 和 2，开启生产者：消息会积压在队列中，消费者 1 所在的普通队列消息限制有 6 条，剩下的 4 条会进入消费者 2 所在的死信队列。如下图所示：</span></li></ol><p data-lake-id=\"u9dbb6efd\" id=\"u9dbb6efd\"><br></p><p data-lake-id=\"ud3960aab\" id=\"ud3960aab\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638448087379-8c4e5c46-39ca-49fd-8024-4111b0a5d431.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D571%26id%3Du9eb9c88a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D571%26originWidth%3D1083%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D79389%26status%3Ddone%26style%3Dnone%26taskId%3Dua5f78b60-fd26-4cb8-9cf8-f0e0f17270b%26title%3D%26width%3D1083%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22s5bzi%22%7D\"></card></p><p data-lake-id=\"ue98b05db\" id=\"ue98b05db\"><br></p><ol list=\"u16ba7dae\" start=\"3\"><li fid=\"u3f9d6140\" data-lake-id=\"uc5b05a1e\" id=\"uc5b05a1e\"><span data-lake-id=\"u3d2dd79c\" id=\"u3d2dd79c\">取消普通队列的最大长度限制，测试</span><strong><span data-lake-id=\"u66fe44e1\" id=\"u66fe44e1\">消息 ttl 过期</span></strong><span data-lake-id=\"u0eb10fc6\" id=\"u0eb10fc6\">：关闭消费者 1 和 2，开启生产者发送消息。（消息会因为没人接收，会在 ttl 时间内积压在普通队列中， ttl 过期后，消息会进入死信队列中。）</span></li></ol><p data-lake-id=\"u66bade46\" id=\"u66bade46\"><br></p><p data-lake-id=\"u12585112\" id=\"u12585112\"><span data-lake-id=\"u50a28f4b\" id=\"u50a28f4b\">生产者：</span></p><p data-lake-id=\"u60d2c488\" id=\"u60d2c488\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.eight%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.AMQP%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2016%3A13%5Cn%20*%20%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97-%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20NORMAL_EXCHANGE%20%3D%20%5C%22normal_exchange%5C%22%3B%5Cn%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E6%97%B6%E9%97%B4%20%20%E8%AE%BE%E7%BD%AEttl%E6%97%B6%E9%97%B4%5Cn%20%20%20%20%20%20%20%20AMQP.BasicProperties%20properties%20%3D%20new%20AMQP.BasicProperties().builder().expiration(%5C%2210000%5C%22).build()%3B%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%201%3B%20i%20%3C%2011%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22info%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(NORMAL_EXCHANGE%2C%20%5C%22zhangsan%5C%22%2C%20properties%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%221656143b-1%22%7D\"></card><p data-lake-id=\"ufcc5276d\" id=\"ufcc5276d\"><br></p><ol list=\"u6e510735\" start=\"4\"><li fid=\"ub9db9807\" data-lake-id=\"u3643f27c\" id=\"u3643f27c\"><span data-lake-id=\"ud42e38c6\" id=\"ud42e38c6\">测试</span><strong><span data-lake-id=\"u7a7018e8\" id=\"u7a7018e8\">消息被拒</span></strong><span data-lake-id=\"u3f6dd4c9\" id=\"u3f6dd4c9\">：</span></li></ol><p data-lake-id=\"u1325a418\" id=\"u1325a418\"><br></p><p data-lake-id=\"u1e4cfe0d\" id=\"u1e4cfe0d\"><span data-lake-id=\"u012d5846\" id=\"u012d5846\">开启消费者 1 和 2，再开启生产者。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638450659287-e191b69a-07c6-4d5e-8f54-05d22263a235.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D274%26id%3Du03d42d3b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D274%26originWidth%3D642%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D32103%26status%3Ddone%26style%3Dnone%26taskId%3Duf69d66f1-feae-4ff6-83ca-af7f8a83127%26title%3D%26width%3D642%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22jR4qW%22%7D\"></card><span data-lake-id=\"u2fc681b9\" id=\"u2fc681b9\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638450668535-06aa1842-3563-455e-bb20-6376694fae1f.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D202%26id%3Du33f7f3ac%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D202%26originWidth%3D616%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D23460%26status%3Ddone%26style%3Dnone%26taskId%3Dua7a303f7-25d6-4fc0-8d46-d522a51ded6%26title%3D%26width%3D616%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22vAYSS%22%7D\"></card></p><p data-lake-id=\"u56fa6a3a\" id=\"u56fa6a3a\"><br></p><h2 data-lake-id=\"38e2258c\" id=\"38e2258c\"><span data-lake-id=\"ub402faff\" id=\"ub402faff\">延迟队列（基于死信队列）</span></h2><p data-lake-id=\"uaeb50e00\" id=\"uaeb50e00\"><br></p><p data-lake-id=\"uce6f04f4\" id=\"uce6f04f4\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638450862631-363c8d24-6a72-463a-b827-201e6f79cb79.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D128%26id%3Du8aa7212b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D128%26originWidth%3D1081%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D190603%26status%3Ddone%26style%3Dnone%26taskId%3Due97c71c8-4947-4c82-be00-e98e36ba920%26title%3D%26width%3D1081%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22xrjpE%22%7D\"></card><span data-lake-id=\"u28d9db40\" id=\"u28d9db40\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638451047144-5f4983f1-3a0e-472b-95f3-26635a911749.png%23clientId%3Du268c19fe-902d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D399%26id%3Dud5620b6f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D399%26originWidth%3D869%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D265988%26status%3Ddone%26style%3Dnone%26taskId%3Dub1f53a1e-1377-4e43-ab1d-13e29cf4118%26title%3D%26width%3D869%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22O4W2R%22%7D\"></card></p><p data-lake-id=\"u003e5655\" id=\"u003e5655\"><br></p><h3 data-lake-id=\"5bff6472\" id=\"5bff6472\"><span data-lake-id=\"u69a0df70\" id=\"u69a0df70\">整合 SpringBoot</span></h3><p data-lake-id=\"ua9246d88\" id=\"ua9246d88\"><br></p><p data-lake-id=\"u17c7855e\" id=\"u17c7855e\"><br></p><p data-lake-id=\"u37d8ad14\" id=\"u37d8ad14\"><br></p><h4 data-lake-id=\"73ad366e\" id=\"73ad366e\"><span data-lake-id=\"u0a7e6e9e\" id=\"u0a7e6e9e\">实现延迟队列：</span></h4><p data-lake-id=\"u50e8e4bb\" id=\"u50e8e4bb\"><br></p><ol list=\"u3facdfea\"><li fid=\"u192c3c99\" data-lake-id=\"ue7753788\" id=\"ue7753788\"><span data-lake-id=\"udfd2b47e\" id=\"udfd2b47e\">依赖：</span></li></ol><p data-lake-id=\"u3122c714\" id=\"u3122c714\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%3C%3Fxml%20version%3D%5C%221.0%5C%22%20encoding%3D%5C%22UTF-8%5C%22%3F%3E%5Cn%3Cproject%20xmlns%3D%5C%22http%3A%2F%2Fmaven.apache.org%2FPOM%2F4.0.0%5C%22%20xmlns%3Axsi%3D%5C%22http%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema-instance%5C%22%5Cn%20%20%20%20%20%20%20%20%20xsi%3AschemaLocation%3D%5C%22http%3A%2F%2Fmaven.apache.org%2FPOM%2F4.0.0%20https%3A%2F%2Fmaven.apache.org%2Fxsd%2Fmaven-4.0.0.xsd%5C%22%3E%5Cn%20%20%20%20%3CmodelVersion%3E4.0.0%3C%2FmodelVersion%3E%5Cn%20%20%20%20%3Cparent%3E%5Cn%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-parent%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%3Cversion%3E2.6.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3CrelativePath%2F%3E%20%3C!--%20lookup%20parent%20from%20repository%20--%3E%5Cn%20%20%20%20%3C%2Fparent%3E%5Cn%20%20%20%20%3CgroupId%3Ecom.atguigu.rabbitmq%3C%2FgroupId%3E%5Cn%20%20%20%20%3CartifactId%3Espringboot-rabbitmq%3C%2FartifactId%3E%5Cn%20%20%20%20%3Cversion%3E0.0.1-SNAPSHOT%3C%2Fversion%3E%5Cn%20%20%20%20%3Cname%3Espringboot-rabbitmq%3C%2Fname%3E%5Cn%20%20%20%20%3Cdescription%3EDemo%20project%20for%20Spring%20Boot%3C%2Fdescription%3E%5Cn%20%20%20%20%3Cproperties%3E%5Cn%20%20%20%20%20%20%20%20%3Cjava.version%3E1.8%3C%2Fjava.version%3E%5Cn%20%20%20%20%3C%2Fproperties%3E%5Cn%20%20%20%20%3Cdependencies%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-test%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.springframework.boot%2Fspring-boot-starter-amqp%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-amqp%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.6.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.springframework.boot%2Fspring-boot-starter-web%20--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--web%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%90%AF%E5%8A%A8--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-starter-web%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.6.1%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%E5%BF%AB%E9%80%9F%E8%BF%9B%E8%A1%8Cjson%E8%BD%AC%E6%8D%A2--%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fcom.alibaba%2Ffastjson%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Ecom.alibaba%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Efastjson%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E1.2.78%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fio.springfox%2Fspringfox-swagger2%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eio.springfox%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espringfox-swagger2%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E3.0.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Fio.springfox%2Fspringfox-swagger-ui%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eio.springfox%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espringfox-swagger-ui%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E3.0.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.springframework.amqp%2Fspring-rabbit-test%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.amqp%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-rabbit-test%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E2.4.0%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Etest%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%20%20%20%20%3C!--%20https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.projectlombok%2Flombok%20--%3E%5Cn%20%20%20%20%20%20%20%20%3Cdependency%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.projectlombok%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Elombok%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cversion%3E1.18.22%3C%2Fversion%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cscope%3Eprovided%3C%2Fscope%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fdependency%3E%5Cn%20%20%20%20%3C%2Fdependencies%3E%5Cn%5Cn%20%20%20%20%3Cbuild%3E%5Cn%20%20%20%20%20%20%20%20%3Cplugins%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3Cplugin%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3CgroupId%3Eorg.springframework.boot%3C%2FgroupId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3CartifactId%3Espring-boot-maven-plugin%3C%2FartifactId%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fplugin%3E%5Cn%20%20%20%20%20%20%20%20%3C%2Fplugins%3E%5Cn%20%20%20%20%3C%2Fbuild%3E%5Cn%5Cn%3C%2Fproject%3E%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2273700fd7%22%7D\"></card><p data-lake-id=\"uc2b4899d\" id=\"uc2b4899d\"><br></p><ol list=\"u61a89e08\" start=\"2\"><li fid=\"u69964bea\" data-lake-id=\"u1245e541\" id=\"u1245e541\"><span data-lake-id=\"u9f81332b\" id=\"u9f81332b\">yml 配置文件：</span></li></ol><p data-lake-id=\"u73830d88\" id=\"u73830d88\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22spring%3A%5Cn%20%20rabbitmq%3A%5Cn%20%20%20%20host%3A%2059.110.171.189%5Cn%20%20%20%20port%3A%205672%5Cn%20%20%20%20username%3A%20admin%5Cn%20%20%20%20password%3A%20123%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22c4ed4d31%22%7D\"></card><p data-lake-id=\"uc99c78c6\" id=\"uc99c78c6\"><br></p><ol list=\"u91eb0172\" start=\"3\"><li fid=\"u49c48c85\" data-lake-id=\"u7aebac69\" id=\"u7aebac69\"><span data-lake-id=\"ua76b3319\" id=\"ua76b3319\">swagger 配置类：</span></li></ol><p data-lake-id=\"u0ccd9e4c\" id=\"u0ccd9e4c\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20springfox.documentation.builders.ApiInfoBuilder%3B%5Cnimport%20springfox.documentation.service.ApiInfo%3B%5Cnimport%20springfox.documentation.service.Contact%3B%5Cnimport%20springfox.documentation.spi.DocumentationType%3B%5Cnimport%20springfox.documentation.spring.web.plugins.Docket%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F2%2022%3A34%5Cn%20*%2F%5Cnpublic%20class%20SwaggerConfig%20%7B%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Docket%20webApiConfig()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20Docket(DocumentationType.SWAGGER_2)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.groupName(%5C%22webApi%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.apiInfo(webApiInfo())%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.select()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20private%20ApiInfo%20webApiInfo()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20ApiInfoBuilder()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.title(%5C%22rabbitmq%20%20%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.description(%5C%22%20%E6%9C%AC%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E4%BA%86%20rabbitmq%20%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.version(%5C%221.0%5C%22)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.contact(new%20Contact(%5C%22enjoy6288%5C%22%2C%20%5C%22http%3A%2F%2Fatguigu.com%5C%22%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%221846015350%40qq.com%5C%22))%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.build()%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22e6248552%22%7D\"></card><p data-lake-id=\"u5da333d3\" id=\"u5da333d3\"><br></p><p data-lake-id=\"u737ba50b\" id=\"u737ba50b\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638490298754-a2b1ced5-676b-4f68-86e0-31f05266088f.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D215%26id%3Du8ba627f6%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D215%26originWidth%3D1100%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D132048%26status%3Ddone%26style%3Dnone%26taskId%3Dud9c3f28a-b8df-44d1-b9df-dc90c70e046%26title%3D%26width%3D1100%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Iv7m8%22%7D\"></card></p><p data-lake-id=\"u13d19082\" id=\"u13d19082\"><br></p><ol list=\"u34fa8725\" start=\"4\"><li fid=\"ucf82ec3b\" data-lake-id=\"uce104d61\" id=\"uce104d61\"><span data-lake-id=\"u508e2cbd\" id=\"u508e2cbd\">声明队列配置文件：</span></li></ol><p data-lake-id=\"u0de2ea78\" id=\"u0de2ea78\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%208%3A15%5Cn%20*%20TTL%E9%98%9F%E5%88%97%EF%BC%8C%20%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%B1%BB%E4%BB%A3%E7%A0%81%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20TtlQueueConfig%20%7B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20X_EXCHANGE%20%3D%20%5C%22X%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20Y_DEAD_LETTER_EXCHANGE%20%3D%20%5C%22Y%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_A%20%3D%20%5C%22QA%5C%22%3B%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_B%20%3D%20%5C%22QB%5C%22%3B%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20DEAD_LETTER_QUEUE%20%3D%20%5C%22QD%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8ExExchange%20%E5%88%AB%E5%90%8D%5Cn%20%20%20%20%40Bean(%5C%22xExchange%5C%22)%5Cn%20%20%20%20public%20DirectExchange%20xExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20DirectExchange(X_EXCHANGE)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%40Bean(%5C%22yExchange%5C%22)%5Cn%20%20%20%20public%20DirectExchange%20yExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20DirectExchange(Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%20%20ttl%E4%B8%BA10s%5Cn%20%20%20%20%40Bean(%5C%22queueA%5C%22)%5Cn%20%20%20%20public%20Queue%20queueA()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E(3)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%20routing-key%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AEttl%20%20%E5%8D%95%E4%BD%8D%E4%B8%BAms%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-message-ttl%5C%22%2C%2010000)%3B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(QUEUE_A).withArguments(arguments).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%20%20ttl%E4%B8%BA40s%5Cn%20%20%20%20%40Bean(%5C%22queueB%5C%22)%5Cn%20%20%20%20public%20Queue%20queueB()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E(3)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%20routing-key%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AEttl%20%20%E5%8D%95%E4%BD%8D%E4%B8%BAms%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-message-ttl%5C%22%2C%2040000)%3B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(QUEUE_B).withArguments(arguments).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean(%5C%22queueD%5C%22)%5Cn%20%20%20%20public%20Queue%20queueD()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(DEAD_LETTER_QUEUE).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueABindingX(%40Qualifier(%5C%22queueA%5C%22)%20Queue%20queueA%2C%20%40Qualifier(%5C%22xExchange%5C%22)%20DirectExchange%20xExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueA).to(xExchange).with(%5C%22XA%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueBBindingX(%40Qualifier(%5C%22queueB%5C%22)%20Queue%20queueB%2C%20%40Qualifier(%5C%22xExchange%5C%22)%20DirectExchange%20xExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueB).to(xExchange).with(%5C%22XB%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueDBindingY(%40Qualifier(%5C%22queueD%5C%22)%20Queue%20queueD%2C%20%40Qualifier(%5C%22yExchange%5C%22)%20DirectExchange%20yExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueD).to(yExchange).with(%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2234c7bc48%22%7D\"></card><p data-lake-id=\"u7e4c585b\" id=\"u7e4c585b\"><br></p><ol list=\"u5cc5c3b4\" start=\"5\"><li fid=\"u2f0d55b4\" data-lake-id=\"u9edbfaeb\" id=\"u9edbfaeb\"><span data-lake-id=\"u32b3978b\" id=\"u32b3978b\">消费者：接收消息</span></li></ol><p data-lake-id=\"u938e6661\" id=\"u938e6661\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cnimport%20java.util.Date%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%209%3A01%5Cn%20*%20%E9%98%9F%E5%88%97ttl%20%E6%B6%88%E8%B4%B9%E8%80%85%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20DeadLetterQueueConsumer%20%7B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20%5C%22QD%5C%22)%5Cn%20%20%20%20public%20void%20receiveD(Message%20message%2C%20Channel%20channel)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%EF%BC%9A%7B%7D%EF%BC%8C%E6%94%B6%E5%88%B0%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222d9d521e%22%7D\"></card><p data-lake-id=\"u5ff8aeb7\" id=\"u5ff8aeb7\"><br></p><ol list=\"ufdf833d6\" start=\"6\"><li fid=\"u698e0874\" data-lake-id=\"uf7ea6cd6\" id=\"uf7ea6cd6\"><span data-lake-id=\"u44854cf1\" id=\"u44854cf1\">发送消息：Controller</span></li></ol><p data-lake-id=\"u4710b98f\" id=\"u4710b98f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.controller%3B%5Cn%5Cnimport%20io.swagger.annotations.ApiModelProperty%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.web.bind.annotation.GetMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.PathVariable%3B%5Cnimport%20org.springframework.web.bind.annotation.RequestMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.RestController%3B%5Cn%5Cnimport%20java.util.Date%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%208%3A47%5Cn%20*%20%E5%8F%91%E9%80%81%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%5Cn%20*%20%3Cp%3E%5Cn%20*%20http%3A%2F%2Flocalhost%3A8080%2Fttl%2FsendMsg%2F%E5%98%BB%E5%98%BB%E5%98%BB%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40RestController%5Cn%40RequestMapping(%5C%22%2Fttl%5C%22)%5Cnpublic%20class%20SendMsgController%20%7B%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendMsg%2F%7Bmessage%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMsg(%40PathVariable%20String%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%EF%BC%9A%7B%7D%EF%BC%8C%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1%E6%B6%88%E6%81%AF%E7%BB%99%E4%B8%A4%E4%B8%AAttl%E9%98%9F%E5%88%97%3A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(%5C%22X%5C%22%2C%20%5C%22XA%5C%22%2C%20%5C%22%E6%B6%88%E6%81%AF%E6%9D%A5%E8%87%AAttl%E4%B8%BA10s%E7%9A%84%E9%98%9F%E5%88%97%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(%5C%22X%5C%22%2C%20%5C%22XB%5C%22%2C%20%5C%22%E6%B6%88%E6%81%AF%E6%9D%A5%E8%87%AAttl%E4%B8%BA40s%E7%9A%84%E9%98%9F%E5%88%97%5C%22%20%2B%20message)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22acb0bddc%22%7D\"></card><p data-lake-id=\"uca8b3875\" id=\"uca8b3875\"><br></p><p data-lake-id=\"u436ca17c\" id=\"u436ca17c\"><span data-lake-id=\"uab388077\" id=\"uab388077\"><br /></span><span data-lake-id=\"u0771e048\" id=\"u0771e048\">访问：</span><a href=\"http://localhost:8080/ttl/sendMsg/\" target=\"_blank\" data-lake-id=\"ue5bdafdd\" id=\"ue5bdafdd\"><span data-lake-id=\"u0f558b97\" id=\"u0f558b97\">http://localhost:8080/ttl/sendMsg/</span></a><span data-lake-id=\"u1325674b\" id=\"u1325674b\">嘻嘻嘻<br /></span><span data-lake-id=\"udcc8b286\" id=\"udcc8b286\">控制台打印结果：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638494307481-a59aaddb-4efb-4200-9e05-0e34602ded36.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D202%26id%3Du66541ef9%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D202%26originWidth%3D1365%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D62756%26status%3Ddone%26style%3Dnone%26taskId%3Dua128108f-eaa5-47fc-ab0d-e56fe3f57f4%26title%3D%26width%3D1365%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22tO8el%22%7D\"></card></p><p data-lake-id=\"uafa127ba\" id=\"uafa127ba\"><br></p><h4 data-lake-id=\"5d575387\" id=\"5d575387\"><span data-lake-id=\"uf06e7824\" id=\"uf06e7824\">延迟队列优化：</span></h4><p data-lake-id=\"u6257e7bc\" id=\"u6257e7bc\"><br></p><p data-lake-id=\"uf1945132\" id=\"uf1945132\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638494906968-c2a2e16a-a5b3-4c44-83bc-5846e35977d0.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D333%26id%3Du5def25ea%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D333%26originWidth%3D1070%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D169463%26status%3Ddone%26style%3Dnone%26taskId%3Duede9888d-c22a-46c9-a810-c9c1899d23a%26title%3D%26width%3D1070%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22PCbH9%22%7D\"></card><span data-lake-id=\"ucf912ccb\" id=\"ucf912ccb\"><br /></span><span data-lake-id=\"uabebb465\" id=\"uabebb465\">增加一个 QC 普通队列声明后并绑定交换机 XC。<br /></span><span data-lake-id=\"u7f39ff3a\" id=\"u7f39ff3a\">队列配置 中添加：</span></p><p data-lake-id=\"u1c33e394\" id=\"u1c33e394\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F--------------------------------%E4%BC%98%E5%8C%96%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97-------------------------------------%5Cn%20%20%20%20%2F%2F%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%88%E4%B8%BA%E4%BA%86%E4%BC%98%E5%8C%96%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%EF%BC%89%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_C%20%3D%20%5C%22QC%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8EQC%5Cn%20%20%20%20%40Bean(%5C%22queueC%5C%22)%5Cn%20%20%20%20public%20Queue%20queueC()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E(2)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-exchange%5C%22%2C%20Y_DEAD_LETTER_EXCHANGE)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E6%AD%BB%E4%BF%A1routing-key%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-dead-letter-routing-key%5C%22%2C%20%5C%22YD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(QUEUE_C).withArguments(arguments).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E6%99%AE%E9%80%9A%E9%98%9F%E5%88%97QC%E5%92%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueCBindingX(%40Qualifier(%5C%22queueC%5C%22)%20Queue%20queueC%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22xExchange%5C%22)%20DirectExchange%20xExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(queueC).to(xExchange).with(%5C%22XC%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%20%20%20%20%2F%2F-----------------------------------%E4%BC%98%E5%8C%96%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97----------------------------------%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22a7ebc7ee%22%7D\"></card><p data-lake-id=\"u9bde3c53\" id=\"u9bde3c53\"><br></p><p data-lake-id=\"u6870970c\" id=\"u6870970c\"><span data-lake-id=\"uc6706f78\" id=\"uc6706f78\">添加 Controller 发消息控制器：</span></p><p data-lake-id=\"u69dff3a4\" id=\"u69dff3a4\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E6%B6%88%E6%81%AFttl%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendExpireMsg%2F%7Bmessage%7D%2F%7BttlTime%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMsg(%40PathVariable%20String%20message%2C%20%40PathVariable%20String%20ttlTime)%20%7B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%EF%BC%9A%7B%7D%EF%BC%8C%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1%E6%97%B6%E9%95%BF%7B%7D%E6%AF%AB%E7%A7%92%EF%BC%8Cttl%E4%BF%A1%E6%81%AF%E7%BB%99%E9%98%9F%E5%88%97QC%3A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20ttlTime%2C%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(%5C%22X%5C%22%2C%20%5C%22XC%5C%22%2C%20message%2C%20msg%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%97%B6%E5%80%99%20%20%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%95%BF%5Cn%20%20%20%20%20%20%20%20%20%20%20%20msg.getMessageProperties().setExpiration(ttlTime)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20return%20msg%3B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2237e62688%22%7D\"></card><p data-lake-id=\"uba0c942f\" id=\"uba0c942f\"><br></p><p data-lake-id=\"u44e0ad88\" id=\"u44e0ad88\"><span data-lake-id=\"ud37c99fe\" id=\"ud37c99fe\">测试：</span></p><p data-lake-id=\"u8f450987\" id=\"u8f450987\"><br></p><ol list=\"ueb5e0837\"><li fid=\"u1b4d933a\" data-lake-id=\"ub256f62c\" id=\"ub256f62c\"><span data-lake-id=\"u2294acc6\" id=\"u2294acc6\">http://localhost:8080/ttl/sendExpireMsg/你好 1/20000</span></li></ol><ol list=\"u9ff940f0\" start=\"2\"><li fid=\"ue6b2c004\" data-lake-id=\"u25a98c39\" id=\"u25a98c39\"><span data-lake-id=\"u371386de\" id=\"u371386de\">http://localhost:8080/ttl/sendExpireMsg/你好 2/2000</span></li></ol><p data-lake-id=\"u0b67b6a7\" id=\"u0b67b6a7\"><br></p><p data-lake-id=\"ub6ce48d7\" id=\"ub6ce48d7\"><span data-lake-id=\"u13466df4\" id=\"u13466df4\">结果：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638517312025-dfbbfd0b-a82c-4432-a395-2e7cc7c6e48f.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D149%26id%3Du18e59259%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D149%26originWidth%3D1285%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D42107%26status%3Ddone%26style%3Dnone%26taskId%3Duff6fb06a-df03-451f-b886-52364055048%26title%3D%26width%3D1285%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22efjYm%22%7D\"></card></p><p data-lake-id=\"u23f2f74f\" id=\"u23f2f74f\"><br></p><h2 data-lake-id=\"d0cad89d\" id=\"d0cad89d\"><span data-lake-id=\"u85be1934\" id=\"u85be1934\">延迟队列（基于插件）</span></h2><p data-lake-id=\"u81531559\" id=\"u81531559\"><br></p><p data-lake-id=\"ufd1c2e21\" id=\"ufd1c2e21\"><span data-lake-id=\"u630fc20d\" id=\"u630fc20d\">进入 rabbitmq 安装目录下的 plugins 目录 ，cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins<br /></span><span data-lake-id=\"u62a50af5\" id=\"u62a50af5\">执行命令让该插件生效：rabbitmq-plugins enable rabbitmq_delayed_message_exchange<br /></span><span data-lake-id=\"u3bface68\" id=\"u3bface68\">然后重启 rabbitmq：systemctl restart rabbitmq-server<br /></span><span data-lake-id=\"u9db1a728\" id=\"u9db1a728\">会发现交换机多了一个新类型，意味着延迟消息将由交换机来完成，而不是队列。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638519642120-f3258006-3639-4551-805e-26bbd1e67c85.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D530%26id%3Du66b7d498%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D767%26originWidth%3D690%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D56472%26status%3Ddone%26style%3Dnone%26taskId%3Du707609ca-e368-4b6c-9833-ec8cc57ca15%26title%3D%26width%3D477.00006103515625%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22PD1AH%22%7D\"></card><span data-lake-id=\"u2f8263ea\" id=\"u2f8263ea\"><br /><br /><br /></span><span data-lake-id=\"ud9ab44e0\" id=\"ud9ab44e0\">原来的情况：基于死信<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638520455616-cfcde47e-bee3-4ef6-83b6-6630dbe54d9a.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D443%26id%3Dua9957719%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D601%26originWidth%3D1033%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D226301%26status%3Ddone%26style%3Dnone%26taskId%3Dua95f3b09-635a-4782-abfd-57901f34a8b%26title%3D%26width%3D760.9862060546875%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22UOPGa%22%7D\"></card><span data-lake-id=\"u4f03ca10\" id=\"u4f03ca10\"><br /></span><span data-lake-id=\"u3dd91de7\" id=\"u3dd91de7\">现在：基于延迟插件<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638520591056-7591eaf6-b99f-4059-8cbb-6a6ee0ea64f2.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D177%26id%3Du11577081%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D224%26originWidth%3D976%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D94107%26status%3Ddone%26style%3Dnone%26taskId%3Du47b17a31-4f94-4f3c-a75f-2014f181765%26title%3D%26width%3D770.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22a4gyh%22%7D\"></card><span data-lake-id=\"ud0d616ab\" id=\"ud0d616ab\"><br /></span><span data-lake-id=\"u294d8a9a\" id=\"u294d8a9a\">代码架构：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638520764180-7b9e927e-1166-470d-ac32-dda16bb87ae1.png%23clientId%3Du7522214d-0203-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D188%26id%3Dud9b4ba5b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D188%26originWidth%3D1062%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D84300%26status%3Ddone%26style%3Dnone%26taskId%3Du12c568cb-6151-4b2f-8f49-3f721530b6d%26title%3D%26width%3D1062%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22cPAio%22%7D\"></card></p><p data-lake-id=\"u2537b866\" id=\"u2537b866\"><br></p><ol list=\"udc24c677\"><li fid=\"u2d0fa43d\" data-lake-id=\"u54cbff16\" id=\"u54cbff16\"><span data-lake-id=\"u497ba1cf\" id=\"u497ba1cf\">配置类</span></li></ol><p data-lake-id=\"ucf6f84e6\" id=\"ucf6f84e6\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2016%3A41%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20DelayedQueueConfig%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20DELAYED_QUEUE_NAME%20%3D%20%5C%22delayed.name%5C%22%3B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20DELAYED_EXCHANGE_NAME%20%3D%20%5C%22delayed.exchange%5C%22%3B%5Cn%20%20%20%20%2F%2Frouting-key%5Cn%20%20%20%20public%20static%20final%20String%20DELAYED_ROUTING_KEY%20%3D%20%5C%22delayed.routingkey%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20delayedQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(DELAYED_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%20%E5%9F%BA%E4%BA%8E%E6%8F%92%E4%BB%B6%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20CustomExchange%20delayedExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-delayed-type%5C%22%2C%20%5C%22direct%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%201.%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E7%B1%BB%E5%9E%8B%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E6%8C%81%E4%B9%85%E5%8C%96%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%20*%205.%20%E5%85%B6%E4%BB%96%E7%9A%84%E5%8F%82%E6%95%B0%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20return%20new%20CustomExchange(DELAYED_EXCHANGE_NAME%2C%20%5C%22x-delayed-message%5C%22%2C%20true%2C%20false%2C%20arguments)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20delayedQueueBindingDelayedExchange(%40Qualifier(%5C%22delayedQueue%5C%22)%20Queue%20delayedQueue%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22delayedExchange%5C%22)%20CustomExchange%20delayedExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs()%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22576e3b9e%22%7D\"></card><p data-lake-id=\"u88264fd1\" id=\"u88264fd1\"><br></p><ol list=\"ub8ffacac\" start=\"2\"><li fid=\"u680ffbb9\" data-lake-id=\"ue3e31a7b\" id=\"ue3e31a7b\"><span data-lake-id=\"u5b76b6d1\" id=\"u5b76b6d1\">Controller 生产者：</span></li></ol><p data-lake-id=\"u4fdb5ab5\" id=\"u4fdb5ab5\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E5%9F%BA%E4%BA%8E%E5%BB%B6%E8%BF%9F%E6%8F%92%E4%BB%B6%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendDelayMsg%2F%7Bmessage%7D%2F%7BdelayTime%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMsg(%40PathVariable%20String%20message%2C%20%40PathVariable%20Integer%20delayTime)%20%7B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%3A%7B%7D%2C%E5%8F%91%E9%80%81%E4%B8%80%E6%9D%A1%E6%97%B6%E9%95%BF%7B%7D%E6%AF%AB%E7%A7%92%E4%BF%A1%E6%81%AF%E7%BB%99%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97delayed.queue%3A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20delayTime%2C%20message)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME%2C%20DelayedQueueConfig.DELAYED_ROUTING_KEY%2C%20message%2C%20msg%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%97%B6%E5%80%99%20%20%20%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%95%BF%20%20%E5%8D%95%E4%BD%8D%EF%BC%9Ams%5Cn%20%20%20%20%20%20%20%20%20%20%20%20msg.getMessageProperties().setDelay(delayTime)%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20return%20msg%3B%5Cn%20%20%20%20%20%20%20%20%7D)%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22eb8d3858%22%7D\"></card><p data-lake-id=\"uaa1f405b\" id=\"uaa1f405b\"><br></p><ol list=\"u4c1a94d3\" start=\"3\"><li fid=\"uf67e9227\" data-lake-id=\"u4e37ad14\" id=\"u4e37ad14\"><span data-lake-id=\"uc301cdab\" id=\"uc301cdab\">消费者：</span></li></ol><p data-lake-id=\"u8e368a72\" id=\"u8e368a72\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.DelayedQueueConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cnimport%20java.util.Date%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2019%3A36%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E5%9F%BA%E4%BA%8E%E6%8F%92%E4%BB%B6%E7%9A%84%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20DelayQueueConsumer%20%7B%5Cn%20%20%20%20%2F%2F%E7%9B%91%E5%90%AC%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20DelayedQueueConfig.DELAYED_QUEUE_NAME)%5Cn%20%20%20%20public%20void%20receiveDelayQueue(Message%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4%3A%7B%7D%2C%E6%94%B6%E5%88%B0%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20new%20Date().toString()%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2220ede713%22%7D\"></card><p data-lake-id=\"uc629c46a\" id=\"uc629c46a\"><br></p><p data-lake-id=\"u7f843083\" id=\"u7f843083\"><span data-lake-id=\"u7ccea2ef\" id=\"u7ccea2ef\">测试：<br /></span><span data-lake-id=\"ufb9ca283\" id=\"ufb9ca283\">发起请求：</span><a href=\"http://localhost:8080/ttl/sendDelayMsg/com\" target=\"_blank\" data-lake-id=\"u0ed23d19\" id=\"u0ed23d19\"><span data-lake-id=\"ucce40a65\" id=\"ucce40a65\">http://localhost:8080/ttl/sendDelayMsg/com</span></a><span data-lake-id=\"u6e4179e0\" id=\"u6e4179e0\"> on baby1/20000<br /></span><span data-lake-id=\"ub54e37e9\" id=\"ub54e37e9\"> </span><a href=\"http://localhost:8080/ttl/sendDelayMsg/com\" target=\"_blank\" data-lake-id=\"u591aeafc\" id=\"u591aeafc\"><span data-lake-id=\"u41e0134b\" id=\"u41e0134b\">http://localhost:8080/ttl/sendDelayMsg/com</span></a><span data-lake-id=\"u06ea87d6\" id=\"u06ea87d6\"> on baby2/2000<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638532349237-315b969f-d021-4448-8aa8-d5a1d41950a0.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D208%26id%3Duf33e7fe7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D208%26originWidth%3D1432%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D71640%26status%3Ddone%26style%3Dnone%26taskId%3Due722c22b-16d9-40a2-9a28-e95348df5d0%26title%3D%26width%3D1432%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22P79jF%22%7D\"></card><span data-lake-id=\"u0735baa9\" id=\"u0735baa9\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638532663153-40afab72-d363-4536-94fc-4889e40d764b.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D224%26id%3Du7813c3ed%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D266%26originWidth%3D1121%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D457006%26status%3Ddone%26style%3Dnone%26taskId%3Du0e4002d8-2179-43cc-bcfd-7c69cd127b5%26title%3D%26width%3D941.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22aEVGf%22%7D\"></card></p><p data-lake-id=\"u816be002\" id=\"u816be002\"><br></p><h2 data-lake-id=\"d338501f\" id=\"d338501f\"><span data-lake-id=\"uf2c90131\" id=\"uf2c90131\">发布确认高级</span></h2><p data-lake-id=\"u78a1b073\" id=\"u78a1b073\"><br></p><p data-lake-id=\"ue1d328fd\" id=\"ue1d328fd\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638533419869-3aa9b7ad-ee4e-4fd8-9e42-fd6af4aafe70.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D225%26id%3Du7ed4e098%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D341%26originWidth%3D945%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D186643%26status%3Ddone%26style%3Dnone%26taskId%3Duc65852ff-c2a9-416e-bef6-2991c80fa8b%26title%3D%26width%3D623.0000610351562%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22OAmnb%22%7D\"></card><span data-lake-id=\"u02ce7662\" id=\"u02ce7662\"> <br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638533456413-9ead4e1d-f118-4a55-8d05-bcdd4d5fc47f.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D131%26id%3Du954992f9%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D144%26originWidth%3D839%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D73103%26status%3Ddone%26style%3Dnone%26taskId%3Du9819bc42-f398-487a-b319-358e2acd1ba%26title%3D%26width%3D762.9931030273438%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22sjopK%22%7D\"></card></p><p data-lake-id=\"ua0b992e2\" id=\"ua0b992e2\"><br></p><h3 data-lake-id=\"3f64dd13\" id=\"3f64dd13\"><span data-lake-id=\"uc55d922c\" id=\"uc55d922c\">回调接口 : (若交换机收不到消息)</span></h3><p data-lake-id=\"uc0c6652d\" id=\"uc0c6652d\"><br></p><ol list=\"u18e7d6f4\"><li fid=\"uf5a85a9a\" data-lake-id=\"uf961977a\" id=\"uf961977a\"><span data-lake-id=\"u663b1458\" id=\"u663b1458\">配置类</span></li></ol><p data-lake-id=\"u1415f6ed\" id=\"u1415f6ed\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A15%5Cn%20*%20%E9%85%8D%E7%BD%AE%E7%B1%BB%20%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%20%EF%BC%88%E9%AB%98%E7%BA%A7%EF%BC%89%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20ConfirmConfig%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_EXCHANGE_NAME%20%3D%20%5C%22confirm_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_QUEUE_NAME%20%3D%20%5C%22confirm_queue%5C%22%3B%5Cn%20%20%20%20%2F%2Frouting-key%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_ROUTING_KEY%20%3D%20%5C%22key1%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20DirectExchange%20confirmExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20DirectExchange(CONFIRM_EXCHANGE_NAME)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20confirmQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(CONFIRM_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueBindingExchange(%40Qualifier(%5C%22confirmQueue%5C%22)%20Queue%20confirmQueue%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22confirmExchange%5C%22)%20DirectExchange%20confirmExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%222a45d705%22%7D\"></card><p data-lake-id=\"u4ecde0f6\" id=\"u4ecde0f6\"><br></p><ol list=\"ub54f2c05\" start=\"2\"><li fid=\"u4e3bb631\" data-lake-id=\"ua5227561\" id=\"ua5227561\"><span data-lake-id=\"ued86c520\" id=\"ued86c520\">生产者：发消息</span></li></ol><p data-lake-id=\"ub699d97d\" id=\"ub699d97d\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.controller%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.connection.CorrelationData%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.web.bind.annotation.GetMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.PathVariable%3B%5Cnimport%20org.springframework.web.bind.annotation.RequestMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.RestController%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A27%5Cn%20*%20%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40RestController%5Cn%40RequestMapping(%5C%22%2Fconfirm%5C%22)%5Cnpublic%20class%20ProducerController%20%7B%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendMessage%2F%7Bmessage%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMessage(%40PathVariable%20String%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20CorrelationData%20correlationData%20%3D%20new%20CorrelationData(%5C%221%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME%2C%20ConfirmConfig.CONFIRM_ROUTING_KEY%2C%20message%2C%20correlationData)%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E4%B8%BA%EF%BC%9A%7B%7D%5C%22%2C%20message)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%227ba8c971%22%7D\"></card><p data-lake-id=\"ua928c4f5\" id=\"ua928c4f5\"><br></p><ol list=\"u3aa9a4e3\" start=\"3\"><li fid=\"u4732e243\" data-lake-id=\"u7b775a6c\" id=\"u7b775a6c\"><span data-lake-id=\"u0cd0e120\" id=\"u0cd0e120\">消费者：</span></li></ol><p data-lake-id=\"ud61ac3f3\" id=\"ud61ac3f3\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A33%5Cn%20*%20%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20Consumer%20%7B%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20ConfirmConfig.CONFIRM_QUEUE_NAME)%5Cn%20%20%20%20public%20void%20receiveConfirmMessage(Message%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E6%8E%A5%E6%94%B6%E5%88%B0%E7%9A%84%E9%98%9F%E5%88%97confirm.queue%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22ee5ae00f%22%7D\"></card><p data-lake-id=\"u04196b83\" id=\"u04196b83\"><br></p><ol list=\"u99465ece\" start=\"4\"><li fid=\"u995125c0\" data-lake-id=\"u60a6d2ac\" id=\"u60a6d2ac\"><span data-lake-id=\"uda277bab\" id=\"uda277bab\">回调接口</span></li></ol><p data-lake-id=\"u706addb6\" id=\"u706addb6\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.connection.CorrelationData%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cnimport%20javax.annotation.PostConstruct%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A50%5Cn%20*%20%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40Component%5Cnpublic%20class%20MyCallBack%20implements%20RabbitTemplate.ConfirmCallback%20%7B%5Cn%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%40PostConstruct%5Cn%20%20%20%20public%20void%20init()%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B3%A8%E5%85%A5%20%EF%BC%88%E9%9C%80%E8%A6%81%E5%B0%86%E5%BD%93%E5%89%8D%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%B3%A8%E5%85%A5%E5%88%B0RabbitTemplate%E7%9A%84ConfirmCallback%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E4%B8%AD%EF%BC%89%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.setConfirmCallback(this)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F**%5Cn%20%20%20%20%20*%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%A1%AE%E8%AE%A4%E5%9B%9E%E8%B0%83%E6%96%B9%E6%B3%95%5Cn%20%20%20%20%20*%201.%20%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%8E%A5%E6%94%B6%E5%88%B0%E4%BA%86%20%20%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20*%201.1%20correlationData%20%E4%BF%9D%E5%AD%98%E5%9B%9E%E8%B0%83%E6%B6%88%E6%81%AF%E7%9A%84id%E5%8F%8A%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20*%201.2%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%20%20ack%20%3D%20true%5Cn%20%20%20%20%20*%201.3%20cause%20%20null%5Cn%20%20%20%20%20*%202.%20%E5%8F%91%E6%B6%88%E6%81%AF%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%8E%A5%E6%94%B6%E5%A4%B1%E8%B4%A5%20%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20*%202.1%20correlationData%20%E4%BF%9D%E5%AD%98%E5%9B%9E%E8%B0%83%E6%B6%88%E6%81%AF%E7%9A%84id%E5%8F%8A%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20*%202.2%20%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%20ack%20%3D%20false%5Cn%20%20%20%20%20*%202.3%20cause%20%20%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%8E%9F%E5%9B%A0%5Cn%20%20%20%20%20*%5Cn%20%20%20%20%20*%20%40param%20correlationData%5Cn%20%20%20%20%20*%20%40param%20ack%5Cn%20%20%20%20%20*%20%40param%20cause%5Cn%20%20%20%20%20*%2F%5Cn%20%20%20%20%40Override%5Cn%20%20%20%20public%20void%20confirm(CorrelationData%20correlationData%2C%20boolean%20ack%2C%20String%20cause)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20id%20%3D%20correlationData%20!%3D%20null%20%3F%20correlationData.getId()%20%3A%20%5C%22%5C%22%3B%5Cn%20%20%20%20%20%20%20%20if%20(ack)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20log.info(%5C%22%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B7%B2%E7%BB%8F%E6%94%B6%E5%88%B0id%E4%B8%BA%EF%BC%9A%7B%7D%E7%9A%84%E6%B6%88%E6%81%AF%5C%22%2C%20id)%3B%5Cn%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20log.error(%5C%22%E4%BA%A4%E6%8D%A2%E6%9C%BA%E8%BF%98%E6%9C%AA%E6%94%B6%E5%88%B0id%E4%B8%BA%3A%7B%7D%E7%9A%84%E6%B6%88%E6%81%AF%EF%BC%8C%E7%94%B1%E4%BA%8E%E5%8E%9F%E5%9B%A0%EF%BC%9A%7B%7D%5C%22%2C%20id%2C%20cause)%3B%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22b57f810e%22%7D\"></card><p data-lake-id=\"uef78c20d\" id=\"uef78c20d\"><br></p><p data-lake-id=\"ua5e09f93\" id=\"ua5e09f93\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638537772169-a45dc229-e5ed-410a-8e46-69f3fb39f21e.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D518%26id%3Du396acbb1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D518%26originWidth%3D973%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D369736%26status%3Ddone%26style%3Dnone%26taskId%3Du8a93ee99-1d87-4fd1-880d-a166a5e50f1%26title%3D%26width%3D973%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Bk8N5%22%7D\"></card></p><p data-lake-id=\"u67dd6b93\" id=\"u67dd6b93\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22spring%3A%5Cn%20%20rabbitmq%3A%5Cn%20%20%20%20host%3A%2059.110.171.189%5Cn%20%20%20%20port%3A%205672%5Cn%20%20%20%20username%3A%20admin%5Cn%20%20%20%20password%3A%20123%5Cn%20%20%20%20publisher-confirm-type%3A%20correlated%20%20%20%20%23%20%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22ab4a519d%22%7D\"></card><p data-lake-id=\"ub25474b6\" id=\"ub25474b6\"><br></p><ol list=\"u6cb1d6f7\" start=\"5\"><li fid=\"u8a5f17a7\" data-lake-id=\"ud16eafd0\" id=\"ud16eafd0\"><span data-lake-id=\"u14d7f9ca\" id=\"u14d7f9ca\">发送请求 : http://localhost:8080/confirm/sendMessage/大家好 1</span></li></ol><p data-lake-id=\"u38416d74\" id=\"u38416d74\"><br></p><p data-lake-id=\"u78e4294b\" id=\"u78e4294b\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638537854600-e11783cd-28be-4b75-8f36-434ecab3f990.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D190%26id%3Due332f12f%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D190%26originWidth%3D1135%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D51915%26status%3Ddone%26style%3Dnone%26taskId%3Duba52e997-898f-49e3-9067-645cfb69f68%26title%3D%26width%3D1135%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Emijw%22%7D\"></card></p><p data-lake-id=\"u7221df5d\" id=\"u7221df5d\"><br></p><ol list=\"u6dde4edd\" start=\"6\"><li fid=\"u496945b0\" data-lake-id=\"u9c66e047\" id=\"u9c66e047\"><span data-lake-id=\"u6641ac44\" id=\"u6641ac44\">测试交换机收不到消息：在发送消息中，将交换机名字后面拼接上&quot;123&quot;，再次启动，发送请求： http://localhost:8080/confirm/sendMessage/大家好 1</span></li></ol><p data-lake-id=\"ubcb758d6\" id=\"ubcb758d6\"><br></p><p data-lake-id=\"u22d07271\" id=\"u22d07271\"><span data-lake-id=\"u70e7d21c\" id=\"u70e7d21c\">会得到：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638538268620-8dcbc2ae-eaa1-4b60-8822-9cd20f509c52.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D222%26id%3Du3e470d69%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D222%26originWidth%3D1872%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D66288%26status%3Ddone%26style%3Dnone%26taskId%3Du7f0330f7-a846-488e-8b25-71c1f3cf0a7%26title%3D%26width%3D1872%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22J3ZRH%22%7D\"></card></p><p data-lake-id=\"uc7e4f269\" id=\"uc7e4f269\"><br></p><ol list=\"ubf8d1f03\" start=\"7\"><li fid=\"ufd84ad2f\" data-lake-id=\"u8c7d1937\" id=\"u8c7d1937\"><span data-lake-id=\"u4796d64a\" id=\"u4796d64a\">测试队列收不到消息</span></li></ol><p data-lake-id=\"u108dd925\" id=\"u108dd925\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.controller%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.rabbit.connection.CorrelationData%3B%5Cnimport%20org.springframework.amqp.rabbit.core.RabbitTemplate%3B%5Cnimport%20org.springframework.beans.factory.annotation.Autowired%3B%5Cnimport%20org.springframework.web.bind.annotation.GetMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.PathVariable%3B%5Cnimport%20org.springframework.web.bind.annotation.RequestMapping%3B%5Cnimport%20org.springframework.web.bind.annotation.RestController%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A27%5Cn%20*%20%E5%BC%80%E5%A7%8B%E5%8F%91%E6%B6%88%E6%81%AF%20%20%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20*%2F%5Cn%40Slf4j%5Cn%40RestController%5Cn%40RequestMapping(%5C%22%2Fconfirm%5C%22)%5Cnpublic%20class%20ProducerController%20%7B%5Cn%20%20%20%20%40Autowired%5Cn%20%20%20%20private%20RabbitTemplate%20rabbitTemplate%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40GetMapping(%5C%22%2FsendMessage%2F%7Bmessage%7D%5C%22)%5Cn%20%20%20%20public%20void%20sendMessage(%40PathVariable%20String%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20CorrelationData%20correlationData1%20%3D%20new%20CorrelationData(%5C%221%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ConfirmConfig.CONFIRM_ROUTING_KEY%2C%20message%2C%20correlationData1)%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E4%B8%BA%EF%BC%9A%7B%7D%5C%22%2C%20message)%3B%5Cn%5Cn%20%20%20%20%20%20%20%20CorrelationData%20correlationData2%20%3D%20new%20CorrelationData(%5C%222%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ConfirmConfig.CONFIRM_ROUTING_KEY%2B%5C%222%5C%22%2C%20message%2C%20correlationData2)%3B%5Cn%20%20%20%20%20%20%20%20log.info(%5C%22%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E4%B8%BA%EF%BC%9A%7B%7D%5C%22%2C%20message)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%228e842df0%22%7D\"></card><p data-lake-id=\"u1b20db2a\" id=\"u1b20db2a\"><br></p><p data-lake-id=\"uce701b63\" id=\"uce701b63\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638538743381-bfc4680e-692b-4303-a0f3-87cd9425978d.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D247%26id%3Du241a2996%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D247%26originWidth%3D1157%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D67266%26status%3Ddone%26style%3Dnone%26taskId%3Du3edf7078-e740-4b0a-866c-03de3cfb9db%26title%3D%26width%3D1157%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22SGy2Z%22%7D\"></card><span data-lake-id=\"u94b8d528\" id=\"u94b8d528\"><br /></span><span data-lake-id=\"u11773354\" id=\"u11773354\">可见，队列没有收到消息，也没有应答和确认。</span></p><p data-lake-id=\"ubbd10bfa\" id=\"ubbd10bfa\"><br></p><h3 data-lake-id=\"9a49228a\" id=\"9a49228a\"><span data-lake-id=\"u69229606\" id=\"u69229606\">若队列收不到消息</span></h3><p data-lake-id=\"uf0412cea\" id=\"uf0412cea\"><br></p><p data-lake-id=\"u17a29e6c\" id=\"u17a29e6c\"><br></p><p data-lake-id=\"u18410005\" id=\"u18410005\"><br></p><h4 data-lake-id=\"7df88dac\" id=\"7df88dac\"><span data-lake-id=\"uacff6e07\" id=\"uacff6e07\">回退消息</span></h4><p data-lake-id=\"u6d37cd3e\" id=\"u6d37cd3e\"><br></p><p data-lake-id=\"u9d159a4e\" id=\"u9d159a4e\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638539584832-557a9bbc-89d4-4162-a0d4-599eb7f3df21.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D210%26id%3Du40b5093d%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D210%26originWidth%3D976%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D298616%26status%3Ddone%26style%3Dnone%26taskId%3Du13a46749-be43-4430-beb2-483ea013efc%26title%3D%26width%3D976%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22thCkG%22%7D\"></card></p><p data-lake-id=\"uf348cbd9\" id=\"uf348cbd9\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22spring%3A%5Cn%20%20rabbitmq%3A%5Cn%20%20%20%20host%3A%2059.110.171.189%5Cn%20%20%20%20port%3A%205672%5Cn%20%20%20%20username%3A%20admin%5Cn%20%20%20%20password%3A%20123%5Cn%20%20%20%20publisher-confirm-type%3A%20correlated%20%20%20%23%20%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%5Cn%20%20%20%20publisher-returns%3A%20true%20%20%20%20%20%20%20%23%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%EF%BC%88%E6%B6%88%E6%81%AF%E5%9C%A8%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%82%A3%E8%8B%A5%E8%B7%AF%E7%94%B1%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%88%99%E4%BC%9A%E5%9B%9E%E9%80%80%E6%B6%88%E6%81%AF%E7%BB%99%E7%94%9F%E4%BA%A7%E8%80%85%EF%BC%89%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%229bc2e551%22%7D\"></card><p data-lake-id=\"ude0471d2\" id=\"ude0471d2\"><br></p><p data-lake-id=\"u4ecdba54\" id=\"u4ecdba54\"><span data-lake-id=\"u58fdf937\" id=\"u58fdf937\">回退接口：</span></p><p data-lake-id=\"ub365cc32\" id=\"ub365cc32\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22%2F%2F%E6%B3%A8%E5%85%A5%5Cn%40PostConstruct%5Cn%20%20%20%20public%20void%20init()%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E6%B3%A8%E5%85%A5%20%EF%BC%88%E9%9C%80%E8%A6%81%E5%B0%86%E5%BD%93%E5%89%8D%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%B3%A8%E5%85%A5%E5%88%B0RabbitTemplate%E7%9A%84ConfirmCallback%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E4%B8%AD%EF%BC%89%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.setConfirmCallback(this)%3B%5Cn%20%20%20%20%20%20%20%20rabbitTemplate.setReturnsCallback(this)%3B%5Cn%20%20%20%20%7D%5Cn%2F**%5Cn%20%20%20%20%20*%20%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%BD%93%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8C%E4%B8%8D%E5%8F%AF%E8%BE%BE%E7%9B%AE%E7%9A%84%E5%9C%B0%E6%97%B6%E5%B0%86%E6%B6%88%E6%81%AF%E8%BF%94%E5%9B%9E%E7%BB%99%E7%94%9F%E4%BA%A7%E8%80%85%5Cn%20%20%20%20%20*%20%E5%8F%AA%E6%9C%89%E4%B8%8D%E5%8F%AF%E5%88%B0%E7%9B%AE%E7%9A%84%E5%9C%B0%E6%97%B6%EF%BC%8C%E6%89%8D%E8%BF%9B%E8%A1%8C%E5%9B%9E%E9%80%80%5Cn%20%20%20%20%20*%5Cn%20%20%20%20%20*%20%40param%20returnedMessage%5Cn%20%20%20%20%20*%2F%5Cn%20%20%20%20%40Override%5Cn%20%20%20%20public%20void%20returnedMessage(ReturnedMessage%20returnedMessage)%20%7B%5Cn%20%20%20%20%20%20%20%20log.error(%5C%22%E6%B6%88%E6%81%AF%7B%7D%EF%BC%8C%E8%A2%AB%E4%BA%A4%E6%8D%A2%E6%9C%BA%7B%7D%E9%80%80%E5%9B%9E%EF%BC%8C%E9%80%80%E5%9B%9E%E5%8E%9F%E5%9B%A0%EF%BC%9A%7B%7D%2C%E8%B7%AF%E7%94%B1key%3A%7B%7D%5C%22%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20new%20String(returnedMessage.getMessage().getBody())%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20returnedMessage.getExchange()%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20returnedMessage.getReplyText()%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20returnedMessage.getRoutingKey())%3B%5Cn%20%20%20%20%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%220cc635d1%22%7D\"></card><p data-lake-id=\"u2654fc7c\" id=\"u2654fc7c\"><br></p><p data-lake-id=\"uf86bf68a\" id=\"uf86bf68a\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638542234889-03b41ef6-8fc5-4ffb-9f36-7287d4ff9476.png%23clientId%3Du44e4b0cf-fc9d-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D267%26id%3Duddd5e8ec%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D267%26originWidth%3D1293%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D78730%26status%3Ddone%26style%3Dnone%26taskId%3Du4c513758-cf34-415c-a9f3-845a33faec5%26title%3D%26width%3D1293%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22tOHQ4%22%7D\"></card></p><p data-lake-id=\"uc53a419f\" id=\"uc53a419f\"><br></p><h4 data-lake-id=\"2d534732\" id=\"2d534732\"><span data-lake-id=\"u10e834ce\" id=\"u10e834ce\">备份交换机</span></h4><p data-lake-id=\"uabcf7a93\" id=\"uabcf7a93\"><br></p><p data-lake-id=\"u73453e3c\" id=\"u73453e3c\"><span data-lake-id=\"ueeed5229\" id=\"ueeed5229\">添加一个交换机和两个队列。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638578627259-759238ba-aac5-42f9-b645-401c5c9a05d2.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D328%26id%3Dud35a1613%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D328%26originWidth%3D930%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D197049%26status%3Ddone%26style%3Dnone%26taskId%3Du04e4ef45-34c3-49a8-84c0-93d70b4ebb6%26title%3D%26width%3D930%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22j2ALj%22%7D\"></card></p><p data-lake-id=\"udb3c78de\" id=\"udb3c78de\"><br></p><ol list=\"u15b76342\"><li fid=\"u4c5a4eb6\" data-lake-id=\"u2c143d03\" id=\"u2c143d03\"><span data-lake-id=\"u8bcff5cb\" id=\"u8bcff5cb\">配置类</span></li></ol><p data-lake-id=\"u7df36999\" id=\"u7df36999\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.config%3B%5Cn%5Cnimport%20org.springframework.amqp.core.*%3B%5Cnimport%20org.springframework.beans.factory.annotation.Qualifier%3B%5Cnimport%20org.springframework.context.annotation.Bean%3B%5Cnimport%20org.springframework.context.annotation.Configuration%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F3%2020%3A15%5Cn%20*%20%E9%85%8D%E7%BD%AE%E7%B1%BB%20%20%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%20%EF%BC%88%E9%AB%98%E7%BA%A7%EF%BC%89%5Cn%20*%2F%5Cn%40Configuration%5Cnpublic%20class%20ConfirmConfig%20%7B%5Cn%20%20%20%20%2F%2F%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_EXCHANGE_NAME%20%3D%20%5C%22confirm_exchange%5C%22%3B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_QUEUE_NAME%20%3D%20%5C%22confirm_queue%5C%22%3B%5Cn%20%20%20%20%2F%2Frouting-key%5Cn%20%20%20%20public%20static%20final%20String%20CONFIRM_ROUTING_KEY%20%3D%20%5C%22key1%5C%22%3B%5Cn%20%20%20%20%2F%2F%20--------------------------%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA---------------------------------%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20public%20static%20final%20String%20BACKUP_EXCHANGE_NAME%20%3D%20%5C%22backup_exchange%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20BACKUP_QUEUE_NAME%20%3D%20%5C%22backup_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8A%A5%E8%AD%A6%E9%98%9F%E5%88%97%5Cn%20%20%20%20public%20static%20final%20String%20WARNING_QUEUE_NAME%20%3D%20%5C%22warning_queue%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F--------------------------------------------------------------------%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E7%A1%AE%E8%AE%A4%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%88%E8%A6%81%E8%BD%AC%E5%8F%91%E5%88%B0%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%89%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20DirectExchange%20confirmExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(true)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.withArgument(%5C%22alternate-exchange%5C%22%2C%20BACKUP_EXCHANGE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20confirmQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(CONFIRM_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20queueBindingExchange(%40Qualifier(%5C%22confirmQueue%5C%22)%20Queue%20confirmQueue%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%40Qualifier(%5C%22confirmExchange%5C%22)%20DirectExchange%20confirmExchange)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20FanoutExchange%20backupExchange()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20new%20FanoutExchange(BACKUP_EXCHANGE_NAME)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E5%A4%87%E4%BB%BD%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20backupQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(BACKUP_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E6%8A%A5%E8%AD%A6%E9%98%9F%E5%88%97%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Queue%20warningQueue()%20%7B%5Cn%20%20%20%20%20%20%20%20return%20QueueBuilder.durable(WARNING_QUEUE_NAME).build()%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%EF%BC%88%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E5%A4%87%E4%BB%BD%E9%98%9F%E5%88%97%EF%BC%89%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20backupQueueBindingBackupExchange(%40Qualifier(%5C%22backupExchange%5C%22)%20FanoutExchange%20backupExchange%2C%20%40Qualifier(%5C%22backupQueue%5C%22)%20Queue%20backupQueue)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(backupQueue).to(backupExchange)%3B%5Cn%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%2F%2F%E7%BB%91%E5%AE%9A%EF%BC%88%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%92%8C%E6%8A%A5%E8%AD%A6%E9%98%9F%E5%88%97%EF%BC%89%5Cn%20%20%20%20%40Bean%5Cn%20%20%20%20public%20Binding%20warningQueueBindingBackupExchange(%40Qualifier(%5C%22backupExchange%5C%22)%20FanoutExchange%20backupExchange%2C%20%40Qualifier(%5C%22warningQueue%5C%22)%20Queue%20warningQueue)%20%7B%5Cn%20%20%20%20%20%20%20%20return%20BindingBuilder.bind(warningQueue).to(backupExchange)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%227e31c035%22%7D\"></card><p data-lake-id=\"u2d96580e\" id=\"u2d96580e\"><br></p><ol list=\"u2e9dedfa\" start=\"2\"><li fid=\"ufdf85b68\" data-lake-id=\"ub0f9ce9a\" id=\"ub0f9ce9a\"><span data-lake-id=\"ua927c9ba\" id=\"ua927c9ba\">消费者（报警消费者）</span></li></ol><p data-lake-id=\"u699010ce\" id=\"u699010ce\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.springbootrabbitmq.consumer%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.springbootrabbitmq.config.ConfirmConfig%3B%5Cnimport%20lombok.extern.slf4j.Slf4j%3B%5Cnimport%20org.springframework.amqp.core.Message%3B%5Cnimport%20org.springframework.amqp.rabbit.annotation.RabbitListener%3B%5Cnimport%20org.springframework.stereotype.Component%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F12%2F4%209%3A10%5Cn%20*%20%E6%8A%A5%E8%AD%A6%E6%B6%88%E8%B4%B9%E8%80%85%5Cn%20*%2F%5Cn%40Component%5Cn%40Slf4j%5Cnpublic%20class%20WarningConsumer%20%7B%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%8A%A5%E8%AD%A6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%40RabbitListener(queues%20%3D%20ConfirmConfig.WARNING_QUEUE_NAME)%5Cn%20%20%20%20public%20void%20receiveWarningMsg(Message%20message)%20%7B%5Cn%20%20%20%20%20%20%20%20String%20msg%20%3D%20new%20String(message.getBody())%3B%5Cn%20%20%20%20%20%20%20%20log.error(%5C%22%E6%8A%A5%E8%AD%A6%E5%8F%91%E7%8E%B0%E4%B8%8D%E5%8F%AF%E8%B7%AF%E7%94%B1%E6%B6%88%E6%81%AF%EF%BC%9A%7B%7D%5C%22%2C%20msg)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2235bc7912%22%7D\"></card><p data-lake-id=\"ud84928fa\" id=\"ud84928fa\"><br></p><p data-lake-id=\"ue7878fb1\" id=\"ue7878fb1\"><span data-lake-id=\"ud8e024bd\" id=\"ud8e024bd\">发送请求：http://localhost:8080/confirm/sendMessage/大家好 1<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638581402507-07326d95-5109-4750-b3ab-c4751b23d55d.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D263%26id%3Dudc9907e1%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D263%26originWidth%3D1171%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D75848%26status%3Ddone%26style%3Dnone%26taskId%3Du7fb8b716-7979-4acf-b11c-fe1cb99bebd%26title%3D%26width%3D1171%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Lep12%22%7D\"></card></p><p data-lake-id=\"uc9ac1a25\" id=\"uc9ac1a25\"><br></p><blockquote data-lake-id=\"u591724e9\" id=\"u591724e9\"><p data-lake-id=\"ud9d05a36\" id=\"ud9d05a36\"><strong><span data-lake-id=\"u1e4adb4e\" id=\"u1e4adb4e\">备份交换机的优先级高于回退消息、</span></strong></p></blockquote><p data-lake-id=\"ua078c614\" id=\"ua078c614\"><br></p><p data-lake-id=\"uab27aa2a\" id=\"uab27aa2a\"><br></p><p data-lake-id=\"ud02d49fe\" id=\"ud02d49fe\"><br></p><h2 data-lake-id=\"c06ec42e\" id=\"c06ec42e\"><span data-lake-id=\"u7369f8e6\" id=\"u7369f8e6\">其他知识点</span></h2><p data-lake-id=\"u4f098a02\" id=\"u4f098a02\"><br></p><p data-lake-id=\"u3abc395c\" id=\"u3abc395c\"><br></p><p data-lake-id=\"u471eac83\" id=\"u471eac83\"><br></p><h3 data-lake-id=\"71a92fdf\" id=\"71a92fdf\"><span data-lake-id=\"u20dc07dc\" id=\"u20dc07dc\">幂等性</span></h3><p data-lake-id=\"u648dd420\" id=\"u648dd420\"><br></p><p data-lake-id=\"u8e5b1edb\" id=\"u8e5b1edb\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638581856478-4611604a-34c1-486b-a3b7-c809f3d94f0e.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D620%26id%3Dua03a1a2a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D620%26originWidth%3D977%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D628166%26status%3Ddone%26style%3Dnone%26taskId%3Du3bbefde1-d01a-481e-b831-abe2598835f%26title%3D%26width%3D977%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22pWlKw%22%7D\"></card><span data-lake-id=\"ude9d2f3b\" id=\"ude9d2f3b\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638582165848-9189cc73-c68b-4631-b30d-dad30387a032.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D523%26id%3Du37f187c9%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D523%26originWidth%3D1001%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D609037%26status%3Ddone%26style%3Dnone%26taskId%3Dudd6ff171-0753-4d6f-a510-a8761c65fcb%26title%3D%26width%3D1001%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22o6DXP%22%7D\"></card></p><p data-lake-id=\"u2dbfadbc\" id=\"u2dbfadbc\"><br></p><p data-lake-id=\"ubcb1ea0b\" id=\"ubcb1ea0b\"><br></p><p data-lake-id=\"u62eecae6\" id=\"u62eecae6\"><br></p><h3 data-lake-id=\"507580b5\" id=\"507580b5\"><span data-lake-id=\"u3de3316a\" id=\"u3de3316a\">优先级队列</span></h3><p data-lake-id=\"u7da11996\" id=\"u7da11996\"><br></p><p data-lake-id=\"u3cc63c54\" id=\"u3cc63c54\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638582363595-025332ba-94e1-4485-b6ab-e0542d69fab7.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D326%26id%3Du83200fbd%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D326%26originWidth%3D987%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D447217%26status%3Ddone%26style%3Dnone%26taskId%3Dueea7db03-7906-4cef-baef-0ebe50a0185%26title%3D%26width%3D987%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22h3cca%22%7D\"></card><span data-lake-id=\"u87ffed88\" id=\"u87ffed88\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638582579936-dd221c3d-efc6-4e4b-b854-6667d27682a1.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D343%26id%3Du3930b1c7%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D402%26originWidth%3D1186%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D288467%26status%3Ddone%26style%3Dnone%26taskId%3Du70a2eadf-0b86-470c-a5a8-b7d8f612ad3%26title%3D%26width%3D1010.9896240234375%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22WVQYU%22%7D\"></card><span data-lake-id=\"u5e870bf4\" id=\"u5e870bf4\"><br /></span><span data-lake-id=\"u54768020\" id=\"u54768020\">实现优先级:</span></p><p data-lake-id=\"u6cc05b3e\" id=\"u6cc05b3e\"><br></p><ol list=\"u3b2bd50a\"><li fid=\"uc81d90cd\" data-lake-id=\"ua6331a27\" id=\"ua6331a27\"><span data-lake-id=\"ue8e9a456\" id=\"ue8e9a456\">生产者：</span></li></ol><p data-lake-id=\"ua01e5a8f\" id=\"ua01e5a8f\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.AMQP%3B%5Cnimport%20com.rabbitmq.client.Channel%3B%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.HashMap%3B%5Cnimport%20java.util.Map%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F28%2022%3A15%5Cn%20*%20%E7%94%9F%E4%BA%A7%E8%80%85%20%EF%BC%9A%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Producer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20private%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello1%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%2F%2F%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E5%B7%A5%E5%8E%82ip%20%20%E8%BF%9E%E6%8E%A5rabbitmq%E7%9A%84%E9%98%9F%E5%88%97%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E7%94%A8%E6%88%B7%E5%90%8D%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E5%AF%86%E7%A0%81%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%5Cn%2F%2F%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20%2F%2F%E8%8E%B7%E5%8F%96%E4%BF%A1%E9%81%93%5Cn%2F%2F%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F**%5Cn%20%20%20%20%20%20%20%20%20*%20%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%82%E6%95%B0%EF%BC%9B1.%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%202.%E9%98%9F%E5%88%97%E9%87%8C%E9%9D%A2%E7%9A%84%E6%B6%88%E6%81%AF%E6%98%AF%E5%90%A6%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%88%E7%A3%81%E7%9B%98%EF%BC%89%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%EF%BC%88%E4%B8%8D%E6%8C%81%E4%B9%85%E5%8C%96false%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%203.%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E5%8F%AA%E4%BE%9B%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E6%98%AF%E5%90%A6%E6%B6%88%E6%81%AF%E7%8B%AC%E6%9C%89%EF%BC%8Ctrue%E5%8F%AA%E5%85%81%E8%AE%B8%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AFfalse%EF%BC%88%E5%8F%AF%E4%BB%A5%E5%A4%9A%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%204.%20%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E6%B6%88%E8%B4%B9%E8%80%85%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%E5%90%8E%EF%BC%8C%E8%AF%A5%E9%98%9F%E5%88%97%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Ctrue%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%EF%BC%8Cfalse%E4%B8%8D%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%5Cn%20%20%20%20%20%20%20%20%205.%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%EF%BC%88%E5%BB%B6%E8%BF%9F%E6%B6%88%E6%81%AF......%EF%BC%89%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20Map%3CString%2C%20Object%3E%20arguments%20%3D%20new%20HashMap%3C%3E()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%AE%98%E6%96%B9%E5%85%81%E8%AE%B8%E6%98%AF0-255%E4%B9%8B%E9%97%B4%E3%80%82%E6%AD%A4%E5%A4%84%E8%AE%BE%E7%BD%AE10.%20%E5%85%81%E8%AE%B8%E4%BC%98%E5%85%88%E7%BA%A7%E8%8C%83%E5%9B%B4%E4%B8%BA0-10%20%20%20%E4%B8%8D%E8%A6%81%E8%AE%BE%E7%BD%AE%E8%BF%87%E5%A4%A7%20%20%20%E6%B5%AA%E8%B4%B9CPU%E4%B8%8E%E5%86%85%E5%AD%98%5Cn%20%20%20%20%20%20%20%20arguments.put(%5C%22x-max-priority%5C%22%2C%2010)%3B%5Cn%20%20%20%20%20%20%20%20channel.queueDeclare(QUEUE_NAME%2C%20true%2C%20false%2C%20false%2C%20arguments)%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%91%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%2011%3B%20i%2B%2B)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20String%20message%20%3D%20%5C%22info%5C%22%20%2B%20i%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20if%20(i%20%3D%3D%205)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E8%AE%BE%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20AMQP.BasicProperties%20properties%20%3D%20new%20AMQP.BasicProperties().builder().priority(5).build()%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20QUEUE_NAME%2C%20properties%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.basicPublish(%5C%22%5C%22%2C%20QUEUE_NAME%2C%20null%2C%20message.getBytes())%3B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%20%E5%8F%91%E9%80%81%E5%88%B0%E5%93%AA%E4%B8%AA%E4%BA%A4%E6%8D%A2%E6%9C%BA%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E8%B7%AF%E7%94%B1%E7%9A%84key%E5%80%BC%E6%98%AF%E5%93%AA%E4%B8%AA%EF%BC%8C%E6%9C%AC%E6%AC%A1%E6%98%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E4%BF%A1%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E6%B6%88%E6%81%AF%E4%BD%93%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E5%AE%8C%E6%AF%95%5C%22)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%22e42f278b%22%7D\"></card><p data-lake-id=\"uc6f9bdd8\" id=\"uc6f9bdd8\"><br></p><p data-lake-id=\"ue80f4739\" id=\"ue80f4739\"><span data-lake-id=\"ub89a1ea2\" id=\"ub89a1ea2\">启动生产者：<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584428018-a99005d9-2193-463c-9f45-3f72656510ca.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D245%26id%3Du9109bfc5%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D245%26originWidth%3D673%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D24479%26status%3Ddone%26style%3Dnone%26taskId%3Du0a4a6f5a-f03f-4ab3-8fcc-d9bdc327aad%26title%3D%26width%3D673%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22shKB3%22%7D\"></card></p><p data-lake-id=\"u291a7eb3\" id=\"u291a7eb3\"><br></p><h3 data-lake-id=\"07eab7c1\" id=\"07eab7c1\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584267331-0bf02c8d-6536-43a8-aa18-ee5f4ed82255.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D500%26id%3DAvLAP%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D500%26originWidth%3D1065%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D74831%26status%3Ddone%26style%3Dnone%26taskId%3Du77c77f80-cfec-453b-bc9f-f82bf26b07c%26title%3D%26width%3D1065%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22cIQXz%22%7D\"></card></h3><p data-lake-id=\"ucb9b4527\" id=\"ucb9b4527\"><br></p><ol list=\"ufc7ca6f8\" start=\"2\"><li fid=\"ua7a7b9eb\" data-lake-id=\"u5b439607\" id=\"u5b439607\"><span data-lake-id=\"u556ed9c1\" id=\"u556ed9c1\">消费者 :</span></li></ol><p data-lake-id=\"u293cdbaa\" id=\"u293cdbaa\"><br></p><card type=\"inline\" name=\"codeblock\" value=\"data:%7B%22mode%22%3A%22java%22%2C%22code%22%3A%22package%20com.atguigu.rabbitmq.one%3B%5Cn%5Cnimport%20com.atguigu.rabbitmq.utils.RabbitMqUtils%3B%5Cnimport%20com.rabbitmq.client.*%3B%5Cn%5Cnimport%20java.io.IOException%3B%5Cnimport%20java.util.Arrays%3B%5Cnimport%20java.util.concurrent.TimeoutException%3B%5Cn%5Cn%2F**%5Cn%20*%20%40author%20LiFang%5Cn%20*%20%40version%201.0%5Cn%20*%20%40since%202021%2F11%2F29%2015%3A04%5Cn%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%3A%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20*%2F%5Cnpublic%20class%20Consumer%20%7B%5Cn%20%20%20%20%2F%2F%E9%98%9F%E5%88%97%E5%90%8D%E7%A7%B0%5Cn%20%20%20%20public%20static%20final%20String%20QUEUE_NAME%20%3D%20%5C%22hello1%5C%22%3B%5Cn%5Cn%20%20%20%20%2F%2F%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF%5Cn%20%20%20%20public%20static%20void%20main(String%5B%5D%20args)%20throws%20IOException%2C%20TimeoutException%20%7B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%8E%82%5Cn%2F%2F%20%20%20%20%20%20%20%20ConnectionFactory%20factory%20%3D%20new%20ConnectionFactory()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setHost(%5C%2259.110.171.189%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setUsername(%5C%22admin%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20factory.setPassword(%5C%22123%5C%22)%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20Connection%20connection%20%3D%20factory.newConnection()%3B%5Cn%2F%2F%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20connection.createChannel()%3B%5Cn%20%20%20%20%20%20%20%20Channel%20channel%20%3D%20RabbitMqUtils.getChannel()%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%A3%B0%E6%98%8E%20%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF(%E6%88%90%E5%8A%9F%E5%90%8E%E7%9A%84%E5%9B%9E%E8%B0%83)%5Cn%20%20%20%20%20%20%20%20DeliverCallback%20deliverCallback%20%3D%20(consumerTag%2C%20message)%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(new%20String(message.getBody()))%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F%2F%E5%8F%96%E6%B6%88%E6%B6%88%E6%81%AF%E6%97%B6%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20CancelCallback%20cancelCallback%20%3D%20consumerTag%20-%3E%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20%20%20System.out.println(%5C%22%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%A2%AB%E4%B8%AD%E6%96%AD%5C%22)%3B%5Cn%20%20%20%20%20%20%20%20%7D%3B%5Cn%20%20%20%20%20%20%20%20%2F*%5Cn%20%20%20%20%20%20%20%20%20*%20%E6%B6%88%E8%B4%B9%E8%80%85%20%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF%5Cn%20%20%20%20%20%20%20%20%20*%201.%E6%B6%88%E8%B4%B9%E5%93%AA%E4%B8%AA%E9%98%9F%E5%88%97%5Cn%20%20%20%20%20%20%20%20%20*%202.%20%E6%B6%88%E8%B4%B9%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%E6%98%AF%E5%90%A6%E8%A6%81%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%EF%BC%8Ctrue%E4%BB%A3%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%BA%94%E7%AD%94%2Cfalse%E4%BB%A3%E8%A1%A8%E6%89%8B%E5%8A%A8%E5%BA%94%E7%AD%94%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%203.%20%E6%B6%88%E8%B4%B9%E8%80%85%E6%9C%AA%E6%88%90%E5%8A%9F%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%E3%80%82%5Cn%20%20%20%20%20%20%20%20%20*%204.%20%E6%B6%88%E8%B4%B9%E8%80%85%E5%8F%96%E6%B6%88%E6%B6%88%E8%B4%B9%E7%9A%84%E5%9B%9E%E8%B0%83%5Cn%20%20%20%20%20%20%20%20%20*%2F%5Cn%20%20%20%20%20%20%20%20channel.basicConsume(QUEUE_NAME%2C%20true%2C%20deliverCallback%2C%20cancelCallback)%3B%5Cn%20%20%20%20%7D%5Cn%7D%22%2C%22autoWrap%22%3Afalse%2C%22lineNumbers%22%3Atrue%2C%22heightLimit%22%3Atrue%2C%22collapsed%22%3Afalse%2C%22hideToolbar%22%3Afalse%2C%22name%22%3A%22%22%2C%22tabSize%22%3Anull%2C%22indentWithTab%22%3Afalse%2C%22lightLines%22%3A%5B%5D%2C%22foldLines%22%3A%5B%5D%2C%22theme%22%3A%22Github%20Light%22%2C%22id%22%3A%2281930e95%22%7D\"></card><p data-lake-id=\"u16cfd581\" id=\"u16cfd581\"><br></p><p data-lake-id=\"ud1908c6e\" id=\"ud1908c6e\"><span data-lake-id=\"ucb8356bd\" id=\"ucb8356bd\">启动消费者，<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584610103-d784c402-b9b7-4321-80d9-c4b95990f410.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D346%26id%3Du91a8ee8e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D346%26originWidth%3D652%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D36450%26status%3Ddone%26style%3Dnone%26taskId%3Du90a3da53-d612-4152-b8b6-157c3e789ca%26title%3D%26width%3D652%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22UEHzd%22%7D\"></card></p><p data-lake-id=\"u87611f1d\" id=\"u87611f1d\"><br></p><h3 data-lake-id=\"8508a884\" id=\"8508a884\"><span data-lake-id=\"u855e9604\" id=\"u855e9604\">惰性队列</span></h3><p data-lake-id=\"uc5f84afb\" id=\"uc5f84afb\"><br></p><p data-lake-id=\"u0b31325e\" id=\"u0b31325e\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584657059-9bf42f28-e7a0-4c4f-8a39-c56038bd0071.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D425%26id%3Dud4e3da7e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D425%26originWidth%3D993%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D597255%26status%3Ddone%26style%3Dnone%26taskId%3Du2ff8ea80-3715-4c63-a718-4d71e1b8488%26title%3D%26width%3D993%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22wMAkZ%22%7D\"></card><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638584904322-348e89b5-e2f2-4df0-ba11-7540a061f849.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D613%26id%3Du9cab5578%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D613%26originWidth%3D1175%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D404748%26status%3Ddone%26style%3Dnone%26taskId%3Duc0905b86-a7ec-4a0f-8a69-356a47ad688%26title%3D%26width%3D1175%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22NaNR3%22%7D\"></card><span data-lake-id=\"u64172734\" id=\"u64172734\"><br /></span><span data-lake-id=\"uba38271b\" id=\"uba38271b\">惰性队列执行性能不太好，因此默认情况下不使用惰性队列，而使用正常队列。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638585096408-ecb74216-dfa9-41e3-b7bd-bd5236b2c1da.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D431%26id%3Du4ab29e59%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D431%26originWidth%3D967%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D466179%26status%3Ddone%26style%3Dnone%26taskId%3Dub1da4c7a-e46a-44f7-9b2f-e5129f4a839%26title%3D%26width%3D967%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22ZtuGu%22%7D\"></card><span data-lake-id=\"u65e4732c\" id=\"u65e4732c\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638585305462-e73859d4-5121-406a-b308-57cede7f1bac.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D413%26id%3Duf8c1b8a8%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D413%26originWidth%3D966%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D247424%26status%3Ddone%26style%3Dnone%26taskId%3Dua29dd158-1851-4974-bd9b-3c01a9c0ea5%26title%3D%26width%3D966%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22wFSJu%22%7D\"></card></p><p data-lake-id=\"u76b838dd\" id=\"u76b838dd\"><br></p><ul list=\"ud877048a\"><li fid=\"u61f80eea\" data-lake-id=\"u4d99bf08\" id=\"u4d99bf08\"><span data-lake-id=\"u181db35b\" id=\"u181db35b\">惰性队列从</span><strong><span data-lake-id=\"ue23e1779\" id=\"ue23e1779\">磁盘</span></strong><span data-lake-id=\"u40148889\" id=\"u40148889\">上读取消息，因此消费消息比较慢，但是内存消耗较小，在内存中只存储一些索引。一旦需要消费这些消息时，惰性队列会通过内存中的索引，去读取磁盘中相应的消息，到内存，再消费消息。</span></li></ul><ul list=\"u055673c0\"><li fid=\"ud503864a\" data-lake-id=\"u07689e77\" id=\"u07689e77\"><span data-lake-id=\"ue0dc9030\" id=\"ue0dc9030\">正常队列从</span><strong><span data-lake-id=\"u2d44c37e\" id=\"u2d44c37e\">内存</span></strong><span data-lake-id=\"ub2ed9b46\" id=\"ub2ed9b46\">中读取消息，因此消费消息比较快，但是内存消耗较大。</span></li></ul><p data-lake-id=\"u27df5c54\" id=\"u27df5c54\"><br></p><h2 data-lake-id=\"23eaf825\" id=\"23eaf825\"><span data-lake-id=\"u5a936f08\" id=\"u5a936f08\">rabbitmq 集群</span></h2><p data-lake-id=\"u5557a767\" id=\"u5557a767\"><br></p><p data-lake-id=\"u0ad69f32\" id=\"u0ad69f32\"><br></p><p data-lake-id=\"u20e292f4\" id=\"u20e292f4\"><br></p><h3 data-lake-id=\"c0131d2a\" id=\"c0131d2a\"><span data-lake-id=\"u57794d8d\" id=\"u57794d8d\">集群原理</span></h3><p data-lake-id=\"u5c043ed3\" id=\"u5c043ed3\"><br></p><p data-lake-id=\"udb2f051a\" id=\"udb2f051a\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638586666884-b99e8e77-81ef-4547-a9cd-1dcd00e86009.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D501%26id%3Du84ce9d05%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D501%26originWidth%3D1025%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D171726%26status%3Ddone%26style%3Dnone%26taskId%3Dud7aa0990-8e0c-4e31-9dd1-c6d20007401%26title%3D%26width%3D1025%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22hjXVB%22%7D\"></card></p><p data-lake-id=\"u13f38595\" id=\"u13f38595\"><br></p><h3 data-lake-id=\"b80e581a\" id=\"b80e581a\"><span data-lake-id=\"ua8738995\" id=\"ua8738995\">镜像队列（备份）</span></h3><p data-lake-id=\"u18d348a8\" id=\"u18d348a8\"><br></p><p data-lake-id=\"u638524b5\" id=\"u638524b5\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638587610363-c97ef89e-768e-4278-a087-89f20e211145.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D348%26id%3Due8695270%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D348%26originWidth%3D981%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D453959%26status%3Ddone%26style%3Dnone%26taskId%3Due9f78068-c45e-4cc9-a3e0-595ae6c7337%26title%3D%26width%3D981%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FTNYI%22%7D\"></card></p><p data-lake-id=\"ube043d14\" id=\"ube043d14\"><br></p><h3 data-lake-id=\"3702723f\" id=\"3702723f\"><span data-lake-id=\"u6b2b8ea2\" id=\"u6b2b8ea2\">高可用负载均衡</span></h3><p data-lake-id=\"u442f2d09\" id=\"u442f2d09\"><br></p><p data-lake-id=\"u2e5b02e2\" id=\"u2e5b02e2\"><span data-lake-id=\"ufc900772\" id=\"ufc900772\">若节点 1 宕机了，生产者需要连接节点 2 或节点 3。<br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588031855-ab97c0f3-9861-4222-b593-0a4dbfbf566d.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D754%26id%3Du0c60fb59%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D754%26originWidth%3D1028%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D344345%26status%3Ddone%26style%3Dnone%26taskId%3Duaef85042-099b-42a3-8caf-268a89b7438%26title%3D%26width%3D1028%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22XmCHx%22%7D\"></card><span data-lake-id=\"u6247fda2\" id=\"u6247fda2\"><br /></span><span data-lake-id=\"uf4b7c837\" id=\"uf4b7c837\">出现问题：生产者无法变更 rabbitmq 的 ip，此时需要借助外力 Haproxy。</span></p><p data-lake-id=\"u7f61765f\" id=\"u7f61765f\"><br></p><h4 data-lake-id=\"ea97af39\" id=\"ea97af39\"><span data-lake-id=\"u8b712db1\" id=\"u8b712db1\">Haproxy 实现高可用 负载均衡（高并发）</span></h4><p data-lake-id=\"ubf6aa704\" id=\"ubf6aa704\"><br></p><p data-lake-id=\"ud147c6a9\" id=\"ud147c6a9\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588332155-384a9066-f6ed-434c-bd8d-a08678795b99.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D177%26id%3Du91155287%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D177%26originWidth%3D973%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D240431%26status%3Ddone%26style%3Dnone%26taskId%3Du9a4dff8d-f824-447c-b845-2962ddc0650%26title%3D%26width%3D973%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22BHuXj%22%7D\"></card><span data-lake-id=\"u550eb749\" id=\"u550eb749\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588403571-837d2496-d169-4b00-aa3c-4459e5dfd616.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D644%26id%3Du63b0c105%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D644%26originWidth%3D740%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D224363%26status%3Ddone%26style%3Dnone%26taskId%3Du400f5630-901e-4db7-8556-6d72a1f206a%26title%3D%26width%3D740%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FRrD8%22%7D\"></card><span data-lake-id=\"uc1db626c\" id=\"uc1db626c\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638588495639-57e1823e-e317-48f1-bd99-4a64ab26b8b3.png%23clientId%3Dueb126df1-e3fc-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D711%26id%3Duefaa64c3%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D711%26originWidth%3D860%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D371827%26status%3Ddone%26style%3Dnone%26taskId%3Du8f30ca6f-4949-4c9d-899d-b31600baa56%26title%3D%26width%3D860%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22K5Fpn%22%7D\"></card></p><p data-lake-id=\"ub8c1111e\" id=\"ub8c1111e\"><br></p><h2 data-lake-id=\"80fc5d12\" id=\"80fc5d12\"><span data-lake-id=\"u0e79ddbd\" id=\"u0e79ddbd\">联合交换机</span></h2><p data-lake-id=\"uf8765abf\" id=\"uf8765abf\"><br></p><p data-lake-id=\"u19f4fde9\" id=\"u19f4fde9\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638600972390-f8eabb13-fdba-432b-8b93-c4798757e13e.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D660%26id%3Du1565c7a2%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D660%26originWidth%3D1136%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D882067%26status%3Ddone%26style%3Dnone%26taskId%3Du40ae3ed4-1bbc-4baa-b912-40f55e8b353%26title%3D%26width%3D1136%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FkHCS%22%7D\"></card><span data-lake-id=\"ue7c4b67b\" id=\"ue7c4b67b\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638601768985-91857261-fe17-4687-bc9f-f8d9daf1a364.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D524%26id%3Duafeaba48%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D524%26originWidth%3D1115%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D307899%26status%3Ddone%26style%3Dnone%26taskId%3Du4499a665-a618-4138-a2f2-5bdf1dbaca0%26title%3D%26width%3D1115%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22FgJli%22%7D\"></card><span data-lake-id=\"u07d151a2\" id=\"u07d151a2\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638601930969-0c445ecb-7e66-43cd-a7d1-3aa8c76f884d.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D581%26id%3Du6d4c749b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D581%26originWidth%3D505%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D221677%26status%3Ddone%26style%3Dnone%26taskId%3Duf8d981fd-837f-4eb6-83f6-a7deba0a018%26title%3D%26width%3D505%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22NxTl9%22%7D\"></card><span data-lake-id=\"u4f114bbf\" id=\"u4f114bbf\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638602088334-f76d8ba1-5c6d-4280-87c8-b7d58d42f902.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D506%26id%3Du4b7146f5%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D506%26originWidth%3D976%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D158537%26status%3Ddone%26style%3Dnone%26taskId%3Du64d80530-7388-4c12-9d3b-48d90765e0b%26title%3D%26width%3D976%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22oVYwK%22%7D\"></card><span data-lake-id=\"ufecf6f23\" id=\"ufecf6f23\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638602110103-8ee2df46-7982-4b08-a6c8-e4d9c701b69f.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D666%26id%3Du65df8122%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D666%26originWidth%3D933%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D302115%26status%3Ddone%26style%3Dnone%26taskId%3Du970ef30c-4b50-4327-928e-6bf0cdbc242%26title%3D%26width%3D933%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22A9wRm%22%7D\"></card></p><p data-lake-id=\"u6827fec5\" id=\"u6827fec5\"><br></p><h2 data-lake-id=\"997a4ba0\" id=\"997a4ba0\"><span data-lake-id=\"u484fad48\" id=\"u484fad48\">联邦队列</span></h2><p data-lake-id=\"ud2dd89e2\" id=\"ud2dd89e2\"><br></p><p data-lake-id=\"ufbf7e7f8\" id=\"ufbf7e7f8\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638602602857-2efc1842-e9c7-409e-a302-2b4c63e92027.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D833%26id%3Du3d500d40%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D833%26originWidth%3D1312%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D553687%26status%3Ddone%26style%3Dnone%26taskId%3Du77ecfe28-0a6d-4318-bc8e-c80d6183ecc%26title%3D%26width%3D1312%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22qvMwP%22%7D\"></card><span data-lake-id=\"u2cc42176\" id=\"u2cc42176\"><br /></span><span data-lake-id=\"u43963498\" id=\"u43963498\">两个不同地区数据同步。<br /></span><span data-lake-id=\"ufaa05362\" id=\"ufaa05362\"> </span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603240478-ba4a3a39-d3dc-41b3-9ee9-c8d9f2718ff9.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D551%26id%3Du0dc6d91b%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D551%26originWidth%3D1149%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D244288%26status%3Ddone%26style%3Dnone%26taskId%3Du65c1251d-b002-4909-ae1d-f27aa9d85ee%26title%3D%26width%3D1149%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Rmak1%22%7D\"></card></p><p data-lake-id=\"u6d139d21\" id=\"u6d139d21\"><br></p><h2 data-lake-id=\"Shovel\" id=\"Shovel\"><span data-lake-id=\"uc6c63b07\" id=\"uc6c63b07\">Shovel</span></h2><p data-lake-id=\"u8914465d\" id=\"u8914465d\"><br></p><p data-lake-id=\"ufcf1b723\" id=\"ufcf1b723\"><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603352779-28d006e0-d330-4802-935c-040341c1ca8d.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D324%26id%3Duc852da4a%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D324%26originWidth%3D1287%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D568699%26status%3Ddone%26style%3Dnone%26taskId%3Du2b770501-53fa-4cbc-a428-000590e2c17%26title%3D%26width%3D1287%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22fxL0i%22%7D\"></card><span data-lake-id=\"udab537c0\" id=\"udab537c0\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603460089-03466d04-df20-4ab2-8968-f1b5ef5905ca.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D409%26id%3Dua502f49e%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D409%26originWidth%3D871%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D188661%26status%3Ddone%26style%3Dnone%26taskId%3Du48a08d45-4dad-40e0-9723-55db3e3ef79%26title%3D%26width%3D871%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22lh1tz%22%7D\"></card><span data-lake-id=\"ucad6ce11\" id=\"ucad6ce11\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603378352-15aca4d9-af9b-48c1-b796-60a86b637ebd.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D667%26id%3Duec9ad770%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D667%26originWidth%3D864%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D266940%26status%3Ddone%26style%3Dnone%26taskId%3Du8acd6a6e-3ed2-4306-8639-2eeb16612c3%26title%3D%26width%3D864%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22jpTqS%22%7D\"></card><span data-lake-id=\"u4fdf1f0b\" id=\"u4fdf1f0b\"><br /></span><span data-lake-id=\"uc8cf98b9\" id=\"uc8cf98b9\"> </span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603594801-6bd296a5-c23b-418f-a94e-5261833d5605.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D592%26id%3Du903663bb%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D592%26originWidth%3D994%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D194438%26status%3Ddone%26style%3Dnone%26taskId%3Dud10d2c55-8f5b-4b88-b096-8942402c361%26title%3D%26width%3D994%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22oSJ3T%22%7D\"></card><span data-lake-id=\"u6738e9dc\" id=\"u6738e9dc\"><br /></span><card type=\"inline\" name=\"image\" value=\"data:%7B%22src%22%3A%22https%3A%2F%2Fcdn.nlark.com%2Fyuque%2F0%2F2021%2Fpng%2F2324645%2F1638603639753-9ae10564-7bad-4528-afd2-867c58d1f413.png%23clientId%3Du1823549f-f362-4%26crop%3D0%26crop%3D0%26crop%3D1%26crop%3D1%26from%3Dpaste%26height%3D121%26id%3Du71e6fa9c%26margin%3D%255Bobject%2520Object%255D%26name%3Dimage.png%26originHeight%3D121%26originWidth%3D1169%26originalType%3Dbinary%26ratio%3D1%26rotation%3D0%26showTitle%3Dfalse%26size%3D88867%26status%3Ddone%26style%3Dnone%26taskId%3Du55070310-f786-4b38-98ce-55db2f75ca1%26title%3D%26width%3D1169%22%2C%22originalType%22%3A%22binary%22%2C%22linkTarget%22%3A%22%22%2C%22ratio%22%3A1%2C%22status%22%3A%22done%22%2C%22style%22%3A%22none%22%2C%22showTitle%22%3Afalse%2C%22title%22%3A%22%22%2C%22rotation%22%3A0%2C%22crop%22%3A%5B0%2C0%2C1%2C1%5D%2C%22id%22%3A%22Gjcgc%22%7D\"></card></p>",
    "public": 1,
    "status": 0,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-16T01:22:01.000Z",
    "deleted_at": null,
    "created_at": "2022-11-15T07:25:08.000Z",
    "updated_at": "2022-11-16T01:22:01.000Z",
    "published_at": "2022-11-15T08:52:10.000Z",
    "first_published_at": "2022-11-15T07:25:07.718Z",
    "word_count": 10494,
    "cover": null,
    "description": "---title: RabbitMQ学习笔记categories: 知识tags: [RabbitMQ, 消息中间件]--- 为什么要用 rabbitMQ？1. 流量削峰2. 应用解耦3. 异步处理RabbitMQ 核心部分各个名词介绍RabbitMQ 工作原理安装rabbitmq.com/d...",
    "custom_description": null,
    "hits": 0,
    "_serializer": "v2.doc_detail"
  },
  {
    "id": 106185875,
    "slug": "ttl45poabauykgvt",
    "title": "npm与pnpm之对比",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "---<br />title: npm与pnpm之对比<br />categories: 知识<br />tags: [前端工程化]<br />---\n<a name=\"a9201b98\"></a>\n## pnpm 中的问题\n\n- pnpm 的出现对于 npm 和 yarn 来说是一个比较彻底的改变，解决了很多 npm 安装依赖存在的问题，node_modules 过大、幽灵依赖。\n- pnpm 目前存在的限制在于它修改了文件的相对位置，将包和其依赖放在同一个 node_modules 下，这让一些使用了绝对路径和幽灵依赖的包在使用 pnpm 安装时会存在问题，不过 pnpm 也在解决这个问题，即通过软链接的形式将所有非工程直接依赖的包放在 .pnpm/node_modules 下，这样就解决了找不到包的问题，项目在迁移 pnpm 的话尽量可能会发现 pnpm i 后还有未安装的包，这个时候就要考虑是否引用了幽灵依赖。\n<a name=\"25f9c7fa\"></a>\n## 总结\npnpm 目前对于日常使用完全没问题，目前很多的类库还有框架都已经默认将 pnpm 作为安装工具，目前看来 pnpm 完全可以取代 npm。\n",
    "body_draft": "---<br />title: npm与pnpm之对比<br />categories: 知识<br />tags: [前端工程化]<br />---\n<a name=\"a9201b98\"></a>\n## pnpm 中的问题\n\n- pnpm 的出现对于 npm 和 yarn 来说是一个比较彻底的改变，解决了很多 npm 安装依赖存在的问题，node_modules 过大、幽灵依赖。\n- pnpm 目前存在的限制在于它修改了文件的相对位置，将包和其依赖放在同一个 node_modules 下，这让一些使用了绝对路径和幽灵依赖的包在使用 pnpm 安装时会存在问题，不过 pnpm 也在解决这个问题，即通过软链接的形式将所有非工程直接依赖的包放在 .pnpm/node_modules 下，这样就解决了找不到包的问题，项目在迁移 pnpm 的话尽量可能会发现 pnpm i 后还有未安装的包，这个时候就要考虑是否引用了幽灵依赖。\n<a name=\"25f9c7fa\"></a>\n## 总结\npnpm 目前对于日常使用完全没问题，目前很多的类库还有框架都已经默认将 pnpm 作为安装工具，目前看来 pnpm 完全可以取代 npm。\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"uced5eb9a\" class=\"ne-p\"><span class=\"ne-text\">---</span></p><p id=\"ue6754b5f\" class=\"ne-p\"><span class=\"ne-text\">title: npm与pnpm之对比<br />categories: 知识<br />tags: [前端工程化]</span></p><p id=\"u41d33b72\" class=\"ne-p\"><span class=\"ne-text\">---</span></p><h2 id=\"a9201b98\"><span class=\"ne-text\">pnpm 中的问题</span></h2><ul class=\"ne-ul\"><li id=\"u6bad533c\"><span class=\"ne-text\">pnpm 的出现对于 npm 和 yarn 来说是一个比较彻底的改变，解决了很多 npm 安装依赖存在的问题，node_modules 过大、幽灵依赖。</span></li></ul><ul class=\"ne-ul\"><li id=\"u82a5275a\"><span class=\"ne-text\">pnpm 目前存在的限制在于它修改了文件的相对位置，将包和其依赖放在同一个 node_modules 下，这让一些使用了绝对路径和幽灵依赖的包在使用 pnpm 安装时会存在问题，不过 pnpm 也在解决这个问题，即通过软链接的形式将所有非工程直接依赖的包放在 .pnpm/node_modules 下，这样就解决了找不到包的问题，项目在迁移 pnpm 的话尽量可能会发现 pnpm i 后还有未安装的包，这个时候就要考虑是否引用了幽灵依赖。</span></li></ul><h2 id=\"25f9c7fa\"><span class=\"ne-text\">总结</span></h2><p id=\"u01bd3634\" class=\"ne-p\"><span class=\"ne-text\">pnpm 目前对于日常使用完全没问题，目前很多的类库还有框架都已经默认将 pnpm 作为安装工具，目前看来 pnpm 完全可以取代 npm。</span></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"uced5eb9a\" id=\"uced5eb9a\"><span data-lake-id=\"uc1f0ed81\" id=\"uc1f0ed81\">---</span></p><p data-lake-id=\"ue6754b5f\" id=\"ue6754b5f\"><span data-lake-id=\"u9d17983f\" id=\"u9d17983f\">title: npm与pnpm之对比<br />categories: 知识<br />tags: [前端工程化]</span></p><p data-lake-id=\"u41d33b72\" id=\"u41d33b72\"><span data-lake-id=\"u1b220fe9\" id=\"u1b220fe9\">---</span></p><h2 data-lake-id=\"a9201b98\" id=\"a9201b98\"><span data-lake-id=\"udfb5e790\" id=\"udfb5e790\">pnpm 中的问题</span></h2><ul list=\"u61143ce0\"><li fid=\"u1bc8eab2\" data-lake-id=\"u6bad533c\" id=\"u6bad533c\"><span data-lake-id=\"ud07790f4\" id=\"ud07790f4\">pnpm 的出现对于 npm 和 yarn 来说是一个比较彻底的改变，解决了很多 npm 安装依赖存在的问题，node_modules 过大、幽灵依赖。</span></li></ul><ul list=\"u63ea7d71\"><li fid=\"u2e8a223c\" data-lake-id=\"u82a5275a\" id=\"u82a5275a\"><span data-lake-id=\"uead6eb92\" id=\"uead6eb92\">pnpm 目前存在的限制在于它修改了文件的相对位置，将包和其依赖放在同一个 node_modules 下，这让一些使用了绝对路径和幽灵依赖的包在使用 pnpm 安装时会存在问题，不过 pnpm 也在解决这个问题，即通过软链接的形式将所有非工程直接依赖的包放在 .pnpm/node_modules 下，这样就解决了找不到包的问题，项目在迁移 pnpm 的话尽量可能会发现 pnpm i 后还有未安装的包，这个时候就要考虑是否引用了幽灵依赖。</span></li></ul><h2 data-lake-id=\"25f9c7fa\" id=\"25f9c7fa\"><span data-lake-id=\"uafec90bc\" id=\"uafec90bc\">总结</span></h2><p data-lake-id=\"u01bd3634\" id=\"u01bd3634\"><span data-lake-id=\"u9e690dc6\" id=\"u9e690dc6\">pnpm 目前对于日常使用完全没问题，目前很多的类库还有框架都已经默认将 pnpm 作为安装工具，目前看来 pnpm 完全可以取代 npm。</span></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"uced5eb9a\" id=\"uced5eb9a\"><span data-lake-id=\"uc1f0ed81\" id=\"uc1f0ed81\">---</span></p><p data-lake-id=\"ue6754b5f\" id=\"ue6754b5f\"><span data-lake-id=\"u9d17983f\" id=\"u9d17983f\">title: npm与pnpm之对比<br />categories: 知识<br />tags: [前端工程化]</span></p><p data-lake-id=\"u41d33b72\" id=\"u41d33b72\"><span data-lake-id=\"u1b220fe9\" id=\"u1b220fe9\">---</span></p><h2 data-lake-id=\"a9201b98\" id=\"a9201b98\"><span data-lake-id=\"udfb5e790\" id=\"udfb5e790\">pnpm 中的问题</span></h2><ul list=\"u61143ce0\"><li fid=\"u1bc8eab2\" data-lake-id=\"u6bad533c\" id=\"u6bad533c\"><span data-lake-id=\"ud07790f4\" id=\"ud07790f4\">pnpm 的出现对于 npm 和 yarn 来说是一个比较彻底的改变，解决了很多 npm 安装依赖存在的问题，node_modules 过大、幽灵依赖。</span></li></ul><ul list=\"u63ea7d71\"><li fid=\"u2e8a223c\" data-lake-id=\"u82a5275a\" id=\"u82a5275a\"><span data-lake-id=\"uead6eb92\" id=\"uead6eb92\">pnpm 目前存在的限制在于它修改了文件的相对位置，将包和其依赖放在同一个 node_modules 下，这让一些使用了绝对路径和幽灵依赖的包在使用 pnpm 安装时会存在问题，不过 pnpm 也在解决这个问题，即通过软链接的形式将所有非工程直接依赖的包放在 .pnpm/node_modules 下，这样就解决了找不到包的问题，项目在迁移 pnpm 的话尽量可能会发现 pnpm i 后还有未安装的包，这个时候就要考虑是否引用了幽灵依赖。</span></li></ul><h2 data-lake-id=\"25f9c7fa\" id=\"25f9c7fa\"><span data-lake-id=\"uafec90bc\" id=\"uafec90bc\">总结</span></h2><p data-lake-id=\"u01bd3634\" id=\"u01bd3634\"><span data-lake-id=\"u9e690dc6\" id=\"u9e690dc6\">pnpm 目前对于日常使用完全没问题，目前很多的类库还有框架都已经默认将 pnpm 作为安装工具，目前看来 pnpm 完全可以取代 npm。</span></p>",
    "public": 1,
    "status": 1,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-15T08:49:56.000Z",
    "deleted_at": null,
    "created_at": "2022-11-15T07:25:02.000Z",
    "updated_at": "2022-11-15T08:49:56.000Z",
    "published_at": "2022-11-15T08:49:56.000Z",
    "first_published_at": "2022-11-15T07:25:02.440Z",
    "word_count": 290,
    "cover": null,
    "description": "---title: npm与pnpm之对比categories: 知识tags: [前端工程化]---pnpm 中的问题pnpm 的出现对于 npm 和 yarn 来说是一个比较彻底的改变，解决了很多 npm 安装依赖存在的问题，node_modules 过大、幽灵依赖。pnpm 目前存在的限...",
    "custom_description": null,
    "hits": 0,
    "_serializer": "v2.doc_detail"
  },
  {
    "id": 106185865,
    "slug": "ygpq6up9gb7autx8",
    "title": "My-New-Post",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "---<br />title: My New Post<br />tags: []<br />categories: []<br />date: 2021-04-16 08:04:00<br />---\n\n我在hexo上的第一篇博客~<br />啦啦啦~\n",
    "body_draft": "---<br />title: My New Post<br />tags: []<br />categories: []<br />date: 2021-04-16 08:04:00<br />---\n\n我在hexo上的第一篇博客~<br />啦啦啦~\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"ua79f6f2b\" class=\"ne-p\"><span class=\"ne-text\">---</span></p><p id=\"uff590005\" class=\"ne-p\"><span class=\"ne-text\">title: My New Post<br />tags: []<br />categories: []<br />date: 2021-04-16 08:04:00</span></p><p id=\"uddcc553f\" class=\"ne-p\"><span class=\"ne-text\">---</span></p><p id=\"ub981e36c\" class=\"ne-p\"><span class=\"ne-text\"></span></p><p id=\"u44e398fc\" class=\"ne-p\"><span class=\"ne-text\">我在hexo上的第一篇博客~</span></p><p id=\"u1e643f95\" class=\"ne-p\"><span class=\"ne-text\">啦啦啦~</span></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"ua79f6f2b\" id=\"ua79f6f2b\"><span data-lake-id=\"u415dbdaf\" id=\"u415dbdaf\">---</span></p><p data-lake-id=\"uff590005\" id=\"uff590005\"><span data-lake-id=\"uf3087f88\" id=\"uf3087f88\">title: My New Post<br />tags: []<br />categories: []<br />date: 2021-04-16 08:04:00</span></p><p data-lake-id=\"uddcc553f\" id=\"uddcc553f\"><span data-lake-id=\"u2d3ffdff\" id=\"u2d3ffdff\">---</span></p><p data-lake-id=\"ub981e36c\" id=\"ub981e36c\"><span data-lake-id=\"ude68e211\" id=\"ude68e211\">​</span><br></p><p data-lake-id=\"u44e398fc\" id=\"u44e398fc\"><span data-lake-id=\"uc9585ddd\" id=\"uc9585ddd\">我在hexo上的第一篇博客~</span></p><p data-lake-id=\"u1e643f95\" id=\"u1e643f95\"><span data-lake-id=\"u951c83aa\" id=\"u951c83aa\">啦啦啦~</span></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"ua79f6f2b\" id=\"ua79f6f2b\"><span data-lake-id=\"u415dbdaf\" id=\"u415dbdaf\">---</span></p><p data-lake-id=\"uff590005\" id=\"uff590005\"><span data-lake-id=\"uf3087f88\" id=\"uf3087f88\">title: My New Post<br />tags: []<br />categories: []<br />date: 2021-04-16 08:04:00</span></p><p data-lake-id=\"uddcc553f\" id=\"uddcc553f\"><span data-lake-id=\"u2d3ffdff\" id=\"u2d3ffdff\">---</span></p><p data-lake-id=\"ub981e36c\" id=\"ub981e36c\"><span data-lake-id=\"ude68e211\" id=\"ude68e211\">​</span><br></p><p data-lake-id=\"u44e398fc\" id=\"u44e398fc\"><span data-lake-id=\"uc9585ddd\" id=\"uc9585ddd\">我在hexo上的第一篇博客~</span></p><p data-lake-id=\"u1e643f95\" id=\"u1e643f95\"><span data-lake-id=\"u951c83aa\" id=\"u951c83aa\">啦啦啦~</span></p>",
    "public": 1,
    "status": 1,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-15T08:50:29.000Z",
    "deleted_at": null,
    "created_at": "2022-11-15T07:24:58.000Z",
    "updated_at": "2022-11-15T08:50:29.000Z",
    "published_at": "2022-11-15T08:50:29.000Z",
    "first_published_at": "2022-11-15T07:24:57.534Z",
    "word_count": 28,
    "cover": null,
    "description": "---title: My New Posttags: []categories: []date: 2021-04-16 08:04:00---我在hexo上的第一篇博客~啦啦啦~",
    "custom_description": null,
    "hits": 0,
    "_serializer": "v2.doc_detail"
  },
  {
    "id": 106185846,
    "slug": "uxc1tgefb4s1ftvl",
    "title": "hello-world",
    "book_id": 35046022,
    "book": {
      "id": 35046022,
      "type": "Book",
      "slug": "aiudvz",
      "name": "hexo-blog",
      "user_id": 2324645,
      "description": "杉菜酱子の博客",
      "creator_id": 2324645,
      "public": 1,
      "items_count": 8,
      "likes_count": 0,
      "watches_count": 0,
      "content_updated_at": "2022-11-17T03:45:45.050Z",
      "updated_at": "2022-11-17T03:45:45.000Z",
      "created_at": "2022-11-15T07:22:50.000Z",
      "namespace": "lifang-hmj24/aiudvz",
      "user": {
        "id": 2324645,
        "type": "User",
        "login": "lifang-hmj24",
        "name": "李芳",
        "description": "啦啦啦",
        "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
        "books_count": 66,
        "public_books_count": 3,
        "followers_count": 0,
        "following_count": 5,
        "created_at": "2020-08-08T02:59:10.000Z",
        "updated_at": "2022-11-17T02:48:04.000Z",
        "_serializer": "v2.user"
      },
      "_serializer": "v2.book"
    },
    "user_id": 2324645,
    "creator": {
      "id": 2324645,
      "type": "User",
      "login": "lifang-hmj24",
      "name": "李芳",
      "description": "啦啦啦",
      "avatar_url": "https://cdn.nlark.com/yuque/0/2020/png/2324645/1597130535124-avatar/6404390c-c4b2-4ab9-aa65-8728cc4a0ff4.png",
      "books_count": 66,
      "public_books_count": 3,
      "followers_count": 0,
      "following_count": 5,
      "created_at": "2020-08-08T02:59:10.000Z",
      "updated_at": "2022-11-17T02:48:04.000Z",
      "_serializer": "v2.user"
    },
    "format": "lake",
    "body": "--- <br />title: Hello World<br />date: 2021-7-21<br />--- <br />Welcome to [Hexo]([https://hexo.io/)!](https://hexo.io/)!) This is your very first post. Check [documentation]([https://hexo.io/docs/)](https://hexo.io/docs/)) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting]([https://hexo.io/docs/troubleshooting.html)](https://hexo.io/docs/troubleshooting.html)) or you can ask me on [GitHub]([https://github.com/hexojs/hexo/issues).](https://github.com/hexojs/hexo/issues).##)\n<a name=\"bEfxJ\"></a>\n## Quick Start\n<a name=\"MdMuP\"></a>\n### Create a new post \n``` <br />bash$ hexo new \"My New Post\" <br />``` <br />More info: [Writing]([https://hexo.io/docs/writing.html)](https://hexo.io/docs/writing.html)###)\n<a name=\"LxY6K\"></a>\n### Run server\n``` <br />bash$ hexo server<br />``` <br />More info: [Server]([https://hexo.io/docs/server.html)](https://hexo.io/docs/server.html)###)\n<a name=\"dRCiA\"></a>\n### Generate static files\n``` <br />bash$ hexo generate <br />``` <br />More info: [Generating]([https://hexo.io/docs/generating.html)###](https://hexo.io/docs/generating.html)###) Deploy to remote sites <br />``` <br />bash$ hexo deploy  <br />``` <br />More info: [Deployment]([https://hexo.io/docs/one-command-deployment.html)](https://hexo.io/docs/one-command-deployment.html))\n",
    "body_draft": "--- <br />title: Hello World<br />date: 2021-7-21<br />--- <br />Welcome to [Hexo]([https://hexo.io/)!](https://hexo.io/)!) This is your very first post. Check [documentation]([https://hexo.io/docs/)](https://hexo.io/docs/)) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting]([https://hexo.io/docs/troubleshooting.html)](https://hexo.io/docs/troubleshooting.html)) or you can ask me on [GitHub]([https://github.com/hexojs/hexo/issues).](https://github.com/hexojs/hexo/issues).##)\n<a name=\"bEfxJ\"></a>\n## Quick Start\n<a name=\"MdMuP\"></a>\n### Create a new post \n``` <br />bash$ hexo new \"My New Post\" <br />``` <br />More info: [Writing]([https://hexo.io/docs/writing.html)](https://hexo.io/docs/writing.html)###)\n<a name=\"LxY6K\"></a>\n### Run server\n``` <br />bash$ hexo server<br />``` <br />More info: [Server]([https://hexo.io/docs/server.html)](https://hexo.io/docs/server.html)###)\n<a name=\"dRCiA\"></a>\n### Generate static files\n``` <br />bash$ hexo generate <br />``` <br />More info: [Generating]([https://hexo.io/docs/generating.html)###](https://hexo.io/docs/generating.html)###) Deploy to remote sites <br />``` <br />bash$ hexo deploy  <br />``` <br />More info: [Deployment]([https://hexo.io/docs/one-command-deployment.html)](https://hexo.io/docs/one-command-deployment.html))\n",
    "body_html": "<!doctype html><div class=\"lake-content\" typography=\"classic\"><p id=\"ub483cecb\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><p id=\"uc307a430\" class=\"ne-p\"><span class=\"ne-text\">title: Hello World</span></p><p id=\"u5d03c68a\" class=\"ne-p\"><span class=\"ne-text\">date: 2021-7-21</span></p><p id=\"ufdf08c0c\" class=\"ne-p\"><span class=\"ne-text\">--- </span></p><p id=\"ucaaa8912\" class=\"ne-p\"><span class=\"ne-text\">Welcome to [Hexo](</span><a href=\"https://hexo.io/)!\" data-href=\"https://hexo.io/)!\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://hexo.io/)!</span></a><span class=\"ne-text\"> This is your very first post. Check [documentation](</span><a href=\"https://hexo.io/docs/)\" data-href=\"https://hexo.io/docs/)\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://hexo.io/docs/)</span></a><span class=\"ne-text\"> for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](</span><a href=\"https://hexo.io/docs/troubleshooting.html)\" data-href=\"https://hexo.io/docs/troubleshooting.html)\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://hexo.io/docs/troubleshooting.html)</span></a><span class=\"ne-text\"> or you can ask me on [GitHub](</span><a href=\"https://github.com/hexojs/hexo/issues).##\" data-href=\"https://github.com/hexojs/hexo/issues).##\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://github.com/hexojs/hexo/issues).</span></a></p><h2 id=\"bEfxJ\"><span class=\"ne-text\">Quick Start</span></h2><h3 id=\"MdMuP\"><span class=\"ne-text\">Create a new post </span></h3><p id=\"u29ebda3b\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"ue1e7d183\" class=\"ne-p\"><span class=\"ne-text\">bash$ hexo new &quot;My New Post&quot; </span></p><p id=\"ufa5f4e80\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"u6d033f2c\" class=\"ne-p\"><span class=\"ne-text\">More info: [Writing](</span><a href=\"https://hexo.io/docs/writing.html)###\" data-href=\"https://hexo.io/docs/writing.html)###\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://hexo.io/docs/writing.html)</span></a></p><h3 id=\"LxY6K\"><span class=\"ne-text\">Run server</span></h3><p id=\"u83e34453\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"udb57ce59\" class=\"ne-p\"><span class=\"ne-text\">bash$ hexo server</span></p><p id=\"u806543ce\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"u3baa257b\" class=\"ne-p\"><span class=\"ne-text\">More info: [Server](</span><a href=\"https://hexo.io/docs/server.html)###\" data-href=\"https://hexo.io/docs/server.html)###\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://hexo.io/docs/server.html)</span></a></p><h3 id=\"dRCiA\"><span class=\"ne-text\">Generate static files</span></h3><p id=\"uafd5cf52\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"u743a3306\" class=\"ne-p\"><span class=\"ne-text\">bash$ hexo generate </span></p><p id=\"u7b1cbc66\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"u6fce54b5\" class=\"ne-p\"><span class=\"ne-text\">More info: [Generating](</span><a href=\"https://hexo.io/docs/generating.html)###\" data-href=\"https://hexo.io/docs/generating.html)###\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://hexo.io/docs/generating.html)###</span></a><span class=\"ne-text\"> Deploy to remote sites </span></p><p id=\"u127a790a\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"u7381b570\" class=\"ne-p\"><span class=\"ne-text\">bash$ hexo deploy  </span></p><p id=\"uacc6ce9d\" class=\"ne-p\"><span class=\"ne-text\">``` </span></p><p id=\"ua163904b\" class=\"ne-p\"><span class=\"ne-text\">More info: [Deployment](</span><a href=\"https://hexo.io/docs/one-command-deployment.html)\" data-href=\"https://hexo.io/docs/one-command-deployment.html)\" target=\"_blank\" class=\"ne-link\"><span class=\"ne-text\">https://hexo.io/docs/one-command-deployment.html)</span></a></p></div>",
    "body_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"ub483cecb\" id=\"ub483cecb\"><span data-lake-id=\"uda1f9ad6\" id=\"uda1f9ad6\">--- </span></p><p data-lake-id=\"uc307a430\" id=\"uc307a430\"><span data-lake-id=\"u7afd244d\" id=\"u7afd244d\">title: Hello World</span></p><p data-lake-id=\"u5d03c68a\" id=\"u5d03c68a\"><span data-lake-id=\"ufd4ba4fc\" id=\"ufd4ba4fc\">date: 2021-7-21</span></p><p data-lake-id=\"ufdf08c0c\" id=\"ufdf08c0c\"><span data-lake-id=\"ua7e68801\" id=\"ua7e68801\">--- </span></p><p data-lake-id=\"ucaaa8912\" id=\"ucaaa8912\"><span data-lake-id=\"u1a4b7e73\" id=\"u1a4b7e73\">Welcome to [Hexo](</span><a href=\"https://hexo.io/)!\" target=\"_blank\" data-lake-id=\"ue60e2951\" id=\"ue60e2951\"><span data-lake-id=\"u6b270de0\" id=\"u6b270de0\">https://hexo.io/)!</span></a><span data-lake-id=\"u97bf1708\" id=\"u97bf1708\"> This is your very first post. Check [documentation](</span><a href=\"https://hexo.io/docs/)\" target=\"_blank\" data-lake-id=\"uf62b4d55\" id=\"uf62b4d55\"><span data-lake-id=\"uaf1cef76\" id=\"uaf1cef76\">https://hexo.io/docs/)</span></a><span data-lake-id=\"u000b347b\" id=\"u000b347b\"> for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](</span><a href=\"https://hexo.io/docs/troubleshooting.html)\" target=\"_blank\" data-lake-id=\"u210d23c6\" id=\"u210d23c6\"><span data-lake-id=\"u2b41750b\" id=\"u2b41750b\">https://hexo.io/docs/troubleshooting.html)</span></a><span data-lake-id=\"u986a0872\" id=\"u986a0872\"> or you can ask me on [GitHub](</span><a href=\"https://github.com/hexojs/hexo/issues).##\" target=\"_blank\" data-lake-id=\"ue73f193e\" id=\"ue73f193e\"><span data-lake-id=\"u5eb4e1cb\" id=\"u5eb4e1cb\">https://github.com/hexojs/hexo/issues).</span></a></p><h2 data-lake-id=\"bEfxJ\" id=\"bEfxJ\"><span data-lake-id=\"u9f4b1e18\" id=\"u9f4b1e18\">Quick Start</span></h2><h3 data-lake-id=\"MdMuP\" id=\"MdMuP\"><span data-lake-id=\"ud435e77c\" id=\"ud435e77c\">Create a new post </span></h3><p data-lake-id=\"u29ebda3b\" id=\"u29ebda3b\"><span data-lake-id=\"u066ccc71\" id=\"u066ccc71\">``` </span></p><p data-lake-id=\"ue1e7d183\" id=\"ue1e7d183\"><span data-lake-id=\"u6b663bc7\" id=\"u6b663bc7\">bash$ hexo new &quot;My New Post&quot; </span></p><p data-lake-id=\"ufa5f4e80\" id=\"ufa5f4e80\"><span data-lake-id=\"ua81ce352\" id=\"ua81ce352\">``` </span></p><p data-lake-id=\"u6d033f2c\" id=\"u6d033f2c\"><span data-lake-id=\"u14b101e1\" id=\"u14b101e1\">More info: [Writing](</span><a href=\"https://hexo.io/docs/writing.html)###\" target=\"_blank\" data-lake-id=\"u16ee1fc7\" id=\"u16ee1fc7\"><span data-lake-id=\"u6bd79d70\" id=\"u6bd79d70\">https://hexo.io/docs/writing.html)</span></a></p><h3 data-lake-id=\"LxY6K\" id=\"LxY6K\"><span data-lake-id=\"u5eb1d825\" id=\"u5eb1d825\">Run server</span></h3><p data-lake-id=\"u83e34453\" id=\"u83e34453\"><span data-lake-id=\"u28d4e34f\" id=\"u28d4e34f\">``` </span></p><p data-lake-id=\"udb57ce59\" id=\"udb57ce59\"><span data-lake-id=\"u53a8002a\" id=\"u53a8002a\">bash$ hexo server</span></p><p data-lake-id=\"u806543ce\" id=\"u806543ce\"><span data-lake-id=\"uf3818c05\" id=\"uf3818c05\">``` </span></p><p data-lake-id=\"u3baa257b\" id=\"u3baa257b\"><span data-lake-id=\"uc2698810\" id=\"uc2698810\">More info: [Server](</span><a href=\"https://hexo.io/docs/server.html)###\" target=\"_blank\" data-lake-id=\"ubb4dabf1\" id=\"ubb4dabf1\"><span data-lake-id=\"u64e3835a\" id=\"u64e3835a\">https://hexo.io/docs/server.html)</span></a></p><h3 data-lake-id=\"dRCiA\" id=\"dRCiA\"><span data-lake-id=\"u25b255b6\" id=\"u25b255b6\">Generate static files</span></h3><p data-lake-id=\"uafd5cf52\" id=\"uafd5cf52\"><span data-lake-id=\"u9b849da5\" id=\"u9b849da5\">``` </span></p><p data-lake-id=\"u743a3306\" id=\"u743a3306\"><span data-lake-id=\"ue0f950ce\" id=\"ue0f950ce\">bash$ hexo generate </span></p><p data-lake-id=\"u7b1cbc66\" id=\"u7b1cbc66\"><span data-lake-id=\"u71a933db\" id=\"u71a933db\">``` </span></p><p data-lake-id=\"u6fce54b5\" id=\"u6fce54b5\"><span data-lake-id=\"u6bdf4807\" id=\"u6bdf4807\">More info: [Generating](</span><a href=\"https://hexo.io/docs/generating.html)###\" target=\"_blank\" data-lake-id=\"ubc091431\" id=\"ubc091431\"><span data-lake-id=\"ue6f66b01\" id=\"ue6f66b01\">https://hexo.io/docs/generating.html)###</span></a><span data-lake-id=\"uaf6ef406\" id=\"uaf6ef406\"> Deploy to remote sites </span></p><p data-lake-id=\"u127a790a\" id=\"u127a790a\"><span data-lake-id=\"u8a2e914b\" id=\"u8a2e914b\">``` </span></p><p data-lake-id=\"u7381b570\" id=\"u7381b570\"><span data-lake-id=\"u6548d828\" id=\"u6548d828\">bash$ hexo deploy  </span></p><p data-lake-id=\"uacc6ce9d\" id=\"uacc6ce9d\"><span data-lake-id=\"ucfad1f8e\" id=\"ucfad1f8e\">``` </span></p><p data-lake-id=\"ua163904b\" id=\"ua163904b\"><span data-lake-id=\"u22e81fed\" id=\"u22e81fed\">More info: [Deployment](</span><a href=\"https://hexo.io/docs/one-command-deployment.html)\" target=\"_blank\" data-lake-id=\"uc5ea7da5\" id=\"uc5ea7da5\"><span data-lake-id=\"ufc0bc98b\" id=\"ufc0bc98b\">https://hexo.io/docs/one-command-deployment.html)</span></a></p>",
    "body_draft_lake": "<!doctype lake><meta name=\"doc-version\" content=\"1\" /><meta name=\"typography\" content=\"classic\" /><meta name=\"viewport\" content=\"fixed\" /><p data-lake-id=\"ub483cecb\" id=\"ub483cecb\"><span data-lake-id=\"uda1f9ad6\" id=\"uda1f9ad6\">--- </span></p><p data-lake-id=\"uc307a430\" id=\"uc307a430\"><span data-lake-id=\"u7afd244d\" id=\"u7afd244d\">title: Hello World</span></p><p data-lake-id=\"u5d03c68a\" id=\"u5d03c68a\"><span data-lake-id=\"ufd4ba4fc\" id=\"ufd4ba4fc\">date: 2021-7-21</span></p><p data-lake-id=\"ufdf08c0c\" id=\"ufdf08c0c\"><span data-lake-id=\"ua7e68801\" id=\"ua7e68801\">--- </span></p><p data-lake-id=\"ucaaa8912\" id=\"ucaaa8912\"><span data-lake-id=\"u1a4b7e73\" id=\"u1a4b7e73\">Welcome to [Hexo](</span><a href=\"https://hexo.io/)!\" target=\"_blank\" data-lake-id=\"ue60e2951\" id=\"ue60e2951\"><span data-lake-id=\"u6b270de0\" id=\"u6b270de0\">https://hexo.io/)!</span></a><span data-lake-id=\"u97bf1708\" id=\"u97bf1708\"> This is your very first post. Check [documentation](</span><a href=\"https://hexo.io/docs/)\" target=\"_blank\" data-lake-id=\"uf62b4d55\" id=\"uf62b4d55\"><span data-lake-id=\"uaf1cef76\" id=\"uaf1cef76\">https://hexo.io/docs/)</span></a><span data-lake-id=\"u000b347b\" id=\"u000b347b\"> for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](</span><a href=\"https://hexo.io/docs/troubleshooting.html)\" target=\"_blank\" data-lake-id=\"u210d23c6\" id=\"u210d23c6\"><span data-lake-id=\"u2b41750b\" id=\"u2b41750b\">https://hexo.io/docs/troubleshooting.html)</span></a><span data-lake-id=\"u986a0872\" id=\"u986a0872\"> or you can ask me on [GitHub](</span><a href=\"https://github.com/hexojs/hexo/issues).##\" target=\"_blank\" data-lake-id=\"ue73f193e\" id=\"ue73f193e\"><span data-lake-id=\"u5eb4e1cb\" id=\"u5eb4e1cb\">https://github.com/hexojs/hexo/issues).</span></a></p><h2 data-lake-id=\"bEfxJ\" id=\"bEfxJ\"><span data-lake-id=\"u9f4b1e18\" id=\"u9f4b1e18\">Quick Start</span></h2><h3 data-lake-id=\"MdMuP\" id=\"MdMuP\"><span data-lake-id=\"ud435e77c\" id=\"ud435e77c\">Create a new post </span></h3><p data-lake-id=\"u29ebda3b\" id=\"u29ebda3b\"><span data-lake-id=\"u066ccc71\" id=\"u066ccc71\">``` </span></p><p data-lake-id=\"ue1e7d183\" id=\"ue1e7d183\"><span data-lake-id=\"u6b663bc7\" id=\"u6b663bc7\">bash$ hexo new &quot;My New Post&quot; </span></p><p data-lake-id=\"ufa5f4e80\" id=\"ufa5f4e80\"><span data-lake-id=\"ua81ce352\" id=\"ua81ce352\">``` </span></p><p data-lake-id=\"u6d033f2c\" id=\"u6d033f2c\"><span data-lake-id=\"u14b101e1\" id=\"u14b101e1\">More info: [Writing](</span><a href=\"https://hexo.io/docs/writing.html)###\" target=\"_blank\" data-lake-id=\"u16ee1fc7\" id=\"u16ee1fc7\"><span data-lake-id=\"u6bd79d70\" id=\"u6bd79d70\">https://hexo.io/docs/writing.html)</span></a></p><h3 data-lake-id=\"LxY6K\" id=\"LxY6K\"><span data-lake-id=\"u5eb1d825\" id=\"u5eb1d825\">Run server</span></h3><p data-lake-id=\"u83e34453\" id=\"u83e34453\"><span data-lake-id=\"u28d4e34f\" id=\"u28d4e34f\">``` </span></p><p data-lake-id=\"udb57ce59\" id=\"udb57ce59\"><span data-lake-id=\"u53a8002a\" id=\"u53a8002a\">bash$ hexo server</span></p><p data-lake-id=\"u806543ce\" id=\"u806543ce\"><span data-lake-id=\"uf3818c05\" id=\"uf3818c05\">``` </span></p><p data-lake-id=\"u3baa257b\" id=\"u3baa257b\"><span data-lake-id=\"uc2698810\" id=\"uc2698810\">More info: [Server](</span><a href=\"https://hexo.io/docs/server.html)###\" target=\"_blank\" data-lake-id=\"ubb4dabf1\" id=\"ubb4dabf1\"><span data-lake-id=\"u64e3835a\" id=\"u64e3835a\">https://hexo.io/docs/server.html)</span></a></p><h3 data-lake-id=\"dRCiA\" id=\"dRCiA\"><span data-lake-id=\"u25b255b6\" id=\"u25b255b6\">Generate static files</span></h3><p data-lake-id=\"uafd5cf52\" id=\"uafd5cf52\"><span data-lake-id=\"u9b849da5\" id=\"u9b849da5\">``` </span></p><p data-lake-id=\"u743a3306\" id=\"u743a3306\"><span data-lake-id=\"ue0f950ce\" id=\"ue0f950ce\">bash$ hexo generate </span></p><p data-lake-id=\"u7b1cbc66\" id=\"u7b1cbc66\"><span data-lake-id=\"u71a933db\" id=\"u71a933db\">``` </span></p><p data-lake-id=\"u6fce54b5\" id=\"u6fce54b5\"><span data-lake-id=\"u6bdf4807\" id=\"u6bdf4807\">More info: [Generating](</span><a href=\"https://hexo.io/docs/generating.html)###\" target=\"_blank\" data-lake-id=\"ubc091431\" id=\"ubc091431\"><span data-lake-id=\"ue6f66b01\" id=\"ue6f66b01\">https://hexo.io/docs/generating.html)###</span></a><span data-lake-id=\"uaf6ef406\" id=\"uaf6ef406\"> Deploy to remote sites </span></p><p data-lake-id=\"u127a790a\" id=\"u127a790a\"><span data-lake-id=\"u8a2e914b\" id=\"u8a2e914b\">``` </span></p><p data-lake-id=\"u7381b570\" id=\"u7381b570\"><span data-lake-id=\"u6548d828\" id=\"u6548d828\">bash$ hexo deploy  </span></p><p data-lake-id=\"uacc6ce9d\" id=\"uacc6ce9d\"><span data-lake-id=\"ucfad1f8e\" id=\"ucfad1f8e\">``` </span></p><p data-lake-id=\"ua163904b\" id=\"ua163904b\"><span data-lake-id=\"u22e81fed\" id=\"u22e81fed\">More info: [Deployment](</span><a href=\"https://hexo.io/docs/one-command-deployment.html)\" target=\"_blank\" data-lake-id=\"uc5ea7da5\" id=\"uc5ea7da5\"><span data-lake-id=\"ufc0bc98b\" id=\"ufc0bc98b\">https://hexo.io/docs/one-command-deployment.html)</span></a></p>",
    "public": 1,
    "status": 1,
    "view_status": 0,
    "read_status": 1,
    "likes_count": 0,
    "comments_count": 0,
    "content_updated_at": "2022-11-16T01:29:25.000Z",
    "deleted_at": null,
    "created_at": "2022-11-15T07:24:52.000Z",
    "updated_at": "2022-11-16T01:29:25.000Z",
    "published_at": "2022-11-16T01:29:25.000Z",
    "first_published_at": "2022-11-15T07:24:52.424Z",
    "word_count": 101,
    "cover": null,
    "description": "--- title: Hello Worlddate: 2021-7-21--- Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/d...",
    "custom_description": null,
    "hits": 0,
    "_serializer": "v2.doc_detail"
  }
]